tree ada630e1da499723c827ba0ff1084f93daf9ed9c
parent b89e3859db0658df57abfb1396ebad8d1f4580bb
author Steve French <stfrench@microsoft.com> 1552856318 -0500
committer Sasha Levin <sashal@kernel.org> 1553731709 -0400

fix incorrect error code mapping for OBJECTID_NOT_FOUND

[ Upstream commit 85f9987b236cf46e06ffdb5c225cf1f3c0acb789 ]

It was mapped to EIO which can be confusing when user space
queries for an object GUID for an object for which the server
file system doesn't support (or hasn't saved one).

As Amir Goldstein suggested this is similar to ENOATTR
(equivalently ENODATA in Linux errno definitions) so
changing NT STATUS code mapping for OBJECTID_NOT_FOUND
to ENODATA.

Signed-off-by: Steve French <stfrench@microsoft.com>
CC: Amir Goldstein <amir73il@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 177406e154e212315d42171d0739649586154721
parent e35c5a2759f360a45f052b422a87c47971a4e2d9
author Linus Torvalds <torvalds@linux-foundation.org> 1416184580 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1416184580 -0800

Linux 3.18-rc5
tree f611cbb3ae94b19263f8b25a0caa0c272c89d73d
parent 42c36f63ac1366ab0ecc2d5717821362c259f517
author Linus Torvalds <torvalds@linux-foundation.org> 1304994834 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1304994834 -0700

Linux 2.6.39-rc7
tree e47877bba85aed21b464652ced3bfe80e857bd61
parent 51844b0f04d8f6ffff34bb7de74ea2dfc7eb1642
author Linus Torvalds <torvalds@linux-foundation.org> 1353116560 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1353116560 -0800

Linux 3.7-rc6
tree 683b04b2e627f6710c22c151b23c8cc9a165315e
parent 17f6ee43c336924d1d5fa80c64a270f963304556
author Linus Torvalds <torvalds@linux-foundation.org> 1383522111 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1383522111 -0800

Linux 3.12
tree b565f6e87617bef954378d0d970a458c7e9766f8
parent 618e859eb946d806ee9355e4c9edec2d6da17958
author Masami Hiramatsu <mhiramat@kernel.org> 1550940649 +0900
committer Sasha Levin <sashal@kernel.org> 1556927780 -0400

x86/kprobes: Avoid kretprobe recursion bug

[ Upstream commit b191fa96ea6dc00d331dcc28c1f7db5e075693a0 ]

Avoid kretprobe recursion loop bg by setting a dummy
kprobes to current_kprobe per-CPU variable.

This bug has been introduced with the asm-coded trampoline
code, since previously it used another kprobe for hooking
the function return placeholder (which only has a nop) and
trampoline handler was called from that kprobe.

This revives the old lost kprobe again.

With this fix, we don't see deadlock anymore.

And you can see that all inner-called kretprobe are skipped.

  event_1                                  235               0
  event_2                                19375           19612

The 1st column is recorded count and the 2nd is missed count.
Above shows (event_1 rec) + (event_2 rec) ~= (event_2 missed)
(some difference are here because the counter is racy)

Reported-by: Andrea Righi <righi.andrea@gmail.com>
Tested-by: Andrea Righi <righi.andrea@gmail.com>
Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
Acked-by: Steven Rostedt <rostedt@goodmis.org>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: stable@vger.kernel.org
Fixes: c9becf58d935 ("[PATCH] kretprobe: kretprobe-booster")
Link: http://lkml.kernel.org/r/155094064889.6137.972160690963039.stgit@devbox
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 21e6301668bfbd51b128a96ae74b6119f7f0392e
parent a279f27943132b8d31250407ba6cdd363c1a523c
author Dominique Martinet <dominique.martinet@cea.fr> 1535409155 +0900
committer Sasha Levin <sashal@kernel.org> 1541992243 -0500

9p: clear dangling pointers in p9stat_free

[ Upstream commit 62e3941776fea8678bb8120607039410b1b61a65 ]

p9stat_free is more of a cleanup function than a 'free' function as it
only frees the content of the struct; there are chances of use-after-free
if it is improperly used (e.g. p9stat_free called twice as it used to be
possible to)

Clearing dangling pointers makes the function idempotent and safer to use.

Link: http://lkml.kernel.org/r/1535410108-20650-2-git-send-email-asmadeus@codewreck.org
Signed-off-by: Dominique Martinet <dominique.martinet@cea.fr>
Reported-by: syzbot+d4252148d198410b864f@syzkaller.appspotmail.com
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 1694421f87dc1de680ededb168f23e5b0388cde7
parent ce221982e0bef039d7047b0f667bb414efece5af
author Linus Torvalds <torvalds@g5.osdl.org> 1150595375 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1150595375 -0700

Linux v2.6.17

Being named "Crazed Snow-Weasel" instills a lot of confidence in this
release, so I'm sure this will be one of the better ones.
tree aa32bba7baf90695b6985ee63cc4f48fb88cdc77
parent 9386aae907d9ee79d54640f09d70909393e0ddeb
author Sasha Levin <alexander.levin@verizon.com> 1505404504 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1505404504 -0400

Linux 4.1.44

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 1282fecfea7c7fd7ef52d1fed13e1a5f9c362f6b
parent 3b71710f081e90f9682a65d479cf8ae038d74213
author Linus Torvalds <torvalds@linux-foundation.org> 1298337952 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1298337952 -0800

Linux 2.6.38-rc6
tree d1e75ba7235b5978ab3f4a60584dc71d7f1ec4e6
parent feedfe2129e348e075b72a5e3e1c7c52d0c769e4
author Long Li <longli@microsoft.com> 1515615689 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1516546740 -0500

storvsc: do not assume SG list is continuous when doing bounce buffers

The original patch was made for stable 4.1 and was Acked on 08/22/2017, but for
some reason it never made it to the stable tree.

Change from v1:
Changed comment that this patch is for linux-stable 4.1 and all prior stable
kernels.

storvsc checks the SG list for gaps before passing them to Hyper-v device.
If there are gaps, data is copied to a bounce buffer and a continuous data
buffer is passed to Hyper-V.

The check on gaps assumes SG list is continuous, and not chained. This is
 not always true. Failing the check may result in incorrect I/O data
passed to the Hyper-v device.

This code path is not used post Linux 4.1.

[LL: Backport for 4.1]
Signed-off-by: Long Li <longli@microsoft.com>
Acked-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ada80794ea45710e86666cd3cf340187a1e38fd0
parent bd314d976e22e82c55e96603804ed7cb0514d252
author Linus Torvalds <torvalds@g5.osdl.org> 1158111696 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1158111696 -0700

Linux v2.6.18-rc7

One last time..
tree 0cea46e43f0625244c3d06a71d6559e5ec5419ca
parent 96050dfb25966612008dcea7d342e91fa01e993c
author Linus Torvalds <torvalds@linux-foundation.org> 1244603127 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1244603127 -0700

Linux 2.6.30
tree 5d605fac3a57ab324b1b70e6ad8db1b7f5699d0e
parent eebc21190870fb394dc785dc216ee5d1d83627d1
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1524691456 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 25a21c87b44ee636128179ae35d2724c9b65124c
parent ad931555388824fb12bc8f555e6fb6ee57ad4352
author Sasha Levin <sasha.levin@oracle.com> 1430843945 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1430843945 -0400

Linux 3.18.13

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree a562b9238eec17710c45547b15762d1f614a89fd
parent bbd465df73f0d8ba41b8a0732766a243d0f5b356
author Linus Torvalds <torvalds@linux-foundation.org> 1370738464 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1370738464 -0700

Linux 3.10-rc5
tree 7878b9ec9104c1caabf59d10845995b832a7de7e
parent a84a79e4d369a73c0130b5858199e949432da4c6
author Linus Torvalds <torvalds@linux-foundation.org> 1318910783 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1318910783 -0700

Linux 3.1-rc10
tree 496fb882da91efd98bdbca72b5ae668399a694c0
parent 8595aa8e1cfc13211c12db68b54b28a636cd78b8
author Naoya Horiguchi <n-horiguchi@ah.jp.nec.com> 1536101151 -0700
committer Sasha Levin <sashal@kernel.org> 1538619767 -0400

tools/vm/page-types.c: fix "defined but not used" warning

[ Upstream commit 7ab660f8baecfe26c1c267fa8e64d2073feae2bb ]

debugfs_known_mountpoints[] is not used any more, so let's remove it.

Link: http://lkml.kernel.org/r/1535102651-19418-1-git-send-email-n-horiguchi@ah.jp.nec.com
Signed-off-by: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Matthew Wilcox <willy@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 893b57076c708fc66e4798bb74a9e43f6eb5868d
parent a21b0696261c2865d329afa4156ce15fcdf5e772
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1169691568 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1169691568 -0800

Linux 2.6.20-rc6
tree 1512f5d3e7ee3a5659382f3dce48475abca2bec5
parent 1a499150e4ec1299232e24389f648d059ce5617a
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1200457368 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1200457368 -0800

Linux 2.6.24-rc8
tree 941c2aaf45d1d733949f8a60203bacf54f045beb
parent 4995c0b3673c6be76e54b2c89479b1cdf29e69ca
author Linus Torvalds <torvalds@linux-foundation.org> 1264802270 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1264802270 -0800

Linux 2.6.33-rc6
tree bf736e7b3fef81cc1934ca09c701253da6a5b758
parent 0d57c4c2ef7479a8a7a80a0c924a1e355e06d92f
author Sinan Kaya <okaya@codeaurora.org> 1510671301 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1520972434 -0400

dmaengine: qcom_hidma: check pending interrupts

[ Upstream commit 38680bc6b1e3592bc9e18adc1d6e259667df27ce ]

Driver is missing the interrupts if two requests are queued up at the same
time as the interrupt handler is servicing a request that was just
delivered.

The ISR clears the interrupt at the end but it could be clearing the
interrupt for an outstanding event. Therefore, second interrupt never
arrives.

Clear the interrupt first and then check for completions.

Also, make sure that request start and interrupt clear do not overlap in
time by using a spinlock.

Signed-off-by: Sinan Kaya <okaya@codeaurora.org>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7de9dba58a36d27d4be98c9cc7320cbaf2e3031e
parent e5abe67448f42f844608f616eb3c616c294e2ff7
author Felix Kuehling <Felix.Kuehling@amd.com> 1521833550 -0400
committer Sasha Levin <alexander.levin@microsoft.com> 1532524052 -0400

drm/amdgpu: Avoid reclaim while holding locks taken in MMU notifier

[ Upstream commit 6e08e0995b8f339fd2a7ee4fa11f17396405ef60 ]

When an MMU notifier runs in memory reclaim context, it can deadlock
trying to take locks that are already held in the thread causing the
memory reclaim. The solution is to avoid memory reclaim while holding
locks that are taken in MMU notifiers.

This commit fixes kmalloc while holding rmn->lock by moving the call
outside the lock. The GFX MMU notifier also locks reservation objects.
I have no good solution for avoiding reclaim while holding reservation
objects. The HSA MMU notifier will not lock any reservation objects.

v2: Moved allocation outside lock instead of using GFP_NOIO

Signed-off-by: Felix Kuehling <Felix.Kuehling@amd.com>
Acked-by: Oded Gabbay <oded.gabbay@gmail.com>
Reviewed-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Oded Gabbay <oded.gabbay@gmail.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 522158f5174abd54143e2f8b5d0e8c80981e90f9
parent af23f573e817642479fdd05e2b5da5b268eacfaf
author Linus Torvalds <torvalds@linux-foundation.org> 1235362780 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1235362780 -0800

Linux 2.6.29-rc6
tree 815770ab258afae70ce8a9797ff471dd08321775
parent 31b077aefaaddb88149d1ddffafb9a2d57938b7a
author Linus Torvalds <torvalds@linux-foundation.org> 1555002899 -0700
committer Sasha Levin <sashal@kernel.org> 1556287090 -0400

mm: add 'try_get_page()' helper function

[ Upstream commit 88b1a17dfc3ed7728316478fae0f5ad508f50397 ]

This is the same as the traditional 'get_page()' function, but instead
of unconditionally incrementing the reference count of the page, it only
does so if the count was "safe".  It returns whether the reference count
was incremented (and is marked __must_check, since the caller obviously
has to be aware of it).

Also like 'get_page()', you can't use this function unless you already
had a reference to the page.  The intent is that you can use this
exactly like get_page(), but in situations where you want to limit the
maximum reference count.

The code currently does an unconditional WARN_ON_ONCE() if we ever hit
the reference count issues (either zero or negative), as a notification
that the conditional non-increment actually happened.

NOTE! The count access for the "safety" check is inherently racy, but
that doesn't matter since the buffer we use is basically half the range
of the reference count (ie we look at the sign of the count).

Acked-by: Matthew Wilcox <willy@infradead.org>
Cc: Jann Horn <jannh@google.com>
Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree b784ee31a436c8ea461fa64cb9302a9c828172e4
parent e80b1359858df17b0034bdf7d1b6f3e0d5b97257
author Linus Torvalds <torvalds@linux-foundation.org> 1264116695 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1264116695 -0800

Linux 2.6.33-rc5
tree 5bf8266d16ed4e8a16345e0d9adf852e84fcc507
parent 8c0cefe9d34f724d7bed5aaba8f6365f9aab9828
author Prarit Bhargava <prarit@redhat.com> 1518047363 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1519831743 -0500

x86/xen: Calculate __max_logical_packages on PV domains

[ Upstream commit 63e708f826bb21470155d37b103a75d8a9e25b18 ]

The kernel panics on PV domains because native_smp_cpus_done() is
only called for HVM domains.

Calculate __max_logical_packages for PV domains.

Fixes: b4c0a7326f5d ("x86/smpboot: Fix __max_logical_packages estimate")
Signed-off-by: Prarit Bhargava <prarit@redhat.com>
Tested-and-reported-by: Simon Gaiser <simon@invisiblethingslab.com>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: Ingo Molnar <mingo@redhat.com>
Cc: "H. Peter Anvin" <hpa@zytor.com>
Cc: x86@kernel.org
Cc: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Cc: Juergen Gross <jgross@suse.com>
Cc: Dou Liyang <douly.fnst@cn.fujitsu.com>
Cc: Prarit Bhargava <prarit@redhat.com>
Cc: Kate Stewart <kstewart@linuxfoundation.org>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: Andy Lutomirski <luto@kernel.org>
Cc: Andi Kleen <ak@linux.intel.com>
Cc: Vitaly Kuznetsov <vkuznets@redhat.com>
Cc: xen-devel@lists.xenproject.org
Reviewed-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 04a19b10c5f8c579e97d23cdc0d48b0b5f0bb97b
parent da2d96d3aa181c367ac4fcb9c11ee5eb15697cdd
author Linus Torvalds <torvalds@linux-foundation.org> 1423450462 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1423450462 -0800

Linux 3.19
tree 86def094ffacc6f455b68775375b170df4657b2f
parent 52a8202dd9e756ecb0ff2d5adc870e6a2baf6be4
author Sasha Levin <sasha.levin@oracle.com> 1468433991 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1468433991 -0400

Linux 3.18.37

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree bdd6d7d304191478ceedb5b532198c398fb13add
parent 567e47935a7cddd8e823c73bb8ee0b2805cd4940
author Linus Torvalds <torvalds@linux-foundation.org> 1327014288 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1327014288 -0800

Linux 3.3-rc1
tree 391c8f6a26c5aed481d181797bb73166c58db33e
parent f0d7990d6d5cd2bb23b3fb37a05a5e42a18914c3
author Michal Hocko <mhocko@suse.com> 1550730046 -0800
committer Sasha Levin <sashal@kernel.org> 1552317089 -0400

mm, memory_hotplug: fix off-by-one in is_pageblock_removable

[ Upstream commit 891cb2a72d821f930a39d5900cb7a3aa752c1d5b ]

Rong Chen has reported the following boot crash:

    PGD 0 P4D 0
    Oops: 0000 [#1] PREEMPT SMP PTI
    CPU: 1 PID: 239 Comm: udevd Not tainted 5.0.0-rc4-00149-gefad4e4 #1
    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1 04/01/2014
    RIP: 0010:page_mapping+0x12/0x80
    Code: 5d c3 48 89 df e8 0e ad 02 00 85 c0 75 da 89 e8 5b 5d c3 0f 1f 44 00 00 53 48 89 fb 48 8b 43 08 48 8d 50 ff a8 01 48 0f 45 da <48> 8b 53 08 48 8d 42 ff 83 e2 01 48 0f 44 c3 48 83 38 ff 74 2f 48
    RSP: 0018:ffff88801fa87cd8 EFLAGS: 00010202
    RAX: ffffffffffffffff RBX: fffffffffffffffe RCX: 000000000000000a
    RDX: fffffffffffffffe RSI: ffffffff820b9a20 RDI: ffff88801e5c0000
    RBP: 6db6db6db6db6db7 R08: ffff88801e8bb000 R09: 0000000001b64d13
    R10: ffff88801fa87cf8 R11: 0000000000000001 R12: ffff88801e640000
    R13: ffffffff820b9a20 R14: ffff88801f145258 R15: 0000000000000001
    FS:  00007fb2079817c0(0000) GS:ffff88801dd00000(0000) knlGS:0000000000000000
    CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    CR2: 0000000000000006 CR3: 000000001fa82000 CR4: 00000000000006a0
    Call Trace:
     __dump_page+0x14/0x2c0
     is_mem_section_removable+0x24c/0x2c0
     removable_show+0x87/0xa0
     dev_attr_show+0x25/0x60
     sysfs_kf_seq_show+0xba/0x110
     seq_read+0x196/0x3f0
     __vfs_read+0x34/0x180
     vfs_read+0xa0/0x150
     ksys_read+0x44/0xb0
     do_syscall_64+0x5e/0x4a0
     entry_SYSCALL_64_after_hwframe+0x49/0xbe

and bisected it down to commit efad4e475c31 ("mm, memory_hotplug:
is_mem_section_removable do not pass the end of a zone").

The reason for the crash is that the mapping is garbage for poisoned
(uninitialized) page.  This shouldn't happen as all pages in the zone's
boundary should be initialized.

Later debugging revealed that the actual problem is an off-by-one when
evaluating the end_page.  'start_pfn + nr_pages' resp 'zone_end_pfn'
refers to a pfn after the range and as such it might belong to a
differen memory section.

This along with CONFIG_SPARSEMEM then makes the loop condition
completely bogus because a pointer arithmetic doesn't work for pages
from two different sections in that memory model.

Fix the issue by reworking is_pageblock_removable to be pfn based and
only use struct page where necessary.  This makes the code slightly
easier to follow and we will remove the problematic pointer arithmetic
completely.

Link: http://lkml.kernel.org/r/20190218181544.14616-1-mhocko@kernel.org
Fixes: efad4e475c31 ("mm, memory_hotplug: is_mem_section_removable do not pass the end of a zone")
Signed-off-by: Michal Hocko <mhocko@suse.com>
Reported-by: <rong.a.chen@intel.com>
Tested-by: <rong.a.chen@intel.com>
Acked-by: Mike Rapoport <rppt@linux.ibm.com>
Reviewed-by: Oscar Salvador <osalvador@suse.de>
Cc: Matthew Wilcox <willy@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 4b699371901274e6c49a4e9d551758f033917fb3
parent 8def5f51b012efb00e77ba2d04696cc0aadd0609
author Linus Torvalds <torvalds@linux-foundation.org> 1323472172 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1323472172 -0800

Linux 3.2-rc5
tree e665736548b53bb2fb9b565545a3f8669f93cf8f
parent 83373f702829dd9f6dcc56d275978d986fafee48
author Linus Torvalds <torvalds@linux-foundation.org> 1410742212 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1410742212 -0700

Linux 3.17-rc5
tree c9be7c4115b63d73bedf612bb0a1870ef03ab808
parent b86db4744230c94e480de56f1b7f31117edbf193
author Linus Torvalds <torvalds@linux-foundation.org> 1290381536 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1290381536 -0800

Linux 2.6.37-rc3
tree ec99ca5b2d71aba85dabbe18e3d84610e8fafe2d
parent 00731a62f0f167760ff7a536a30b9eb441794aaf
author Sasha Levin <sasha.levin@oracle.com> 1457128554 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1457128554 -0500

Linux 4.1.19

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b612e5257611ef33196aacc00fba813c943384d5
parent 5df3e0d953c8af6f5b96aa090824b929cb5ab599
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1191961898 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1191961898 -0700

Linux 2.6.23
tree 6cb1e0cad8192eb623edd7bfb86c2d7dd2f2e00b
parent 8ed7e1f94079c4c37c2ad287cbf2c6707ea19066
author Masami Hiramatsu <mhiramat@kernel.org> 1550940649 +0900
committer Sasha Levin <sashal@kernel.org> 1556822649 -0400

x86/kprobes: Avoid kretprobe recursion bug

[ Upstream commit b191fa96ea6dc00d331dcc28c1f7db5e075693a0 ]

Avoid kretprobe recursion loop bg by setting a dummy
kprobes to current_kprobe per-CPU variable.

This bug has been introduced with the asm-coded trampoline
code, since previously it used another kprobe for hooking
the function return placeholder (which only has a nop) and
trampoline handler was called from that kprobe.

This revives the old lost kprobe again.

With this fix, we don't see deadlock anymore.

And you can see that all inner-called kretprobe are skipped.

  event_1                                  235               0
  event_2                                19375           19612

The 1st column is recorded count and the 2nd is missed count.
Above shows (event_1 rec) + (event_2 rec) ~= (event_2 missed)
(some difference are here because the counter is racy)

Reported-by: Andrea Righi <righi.andrea@gmail.com>
Tested-by: Andrea Righi <righi.andrea@gmail.com>
Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
Acked-by: Steven Rostedt <rostedt@goodmis.org>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: stable@vger.kernel.org
Fixes: c9becf58d935 ("[PATCH] kretprobe: kretprobe-booster")
Link: http://lkml.kernel.org/r/155094064889.6137.972160690963039.stgit@devbox
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 3b282ac9be6e535c3ec80e3ef4ab2ff8a69f8574
parent 198190a188b9cefff22b51c0be5f0f70b6f9b618
author Linus Torvalds <torvalds@linux-foundation.org> 1350760292 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1350760292 -0700

Linux 3.7-rc2
tree d9c0f6f091078463e6d67b12bb40991a253cf779
parent 6befe5f69bae9f907e6c85bbfe298e404864092e
author Linus Torvalds <torvalds@linux-foundation.org> 1303876130 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1303876130 -0700

Linux 2.6.39-rc5
tree 4d3d7d0ce4dc1e28233c5233d92c2c83b959cc50
parent 6b3d2cc4e07a609fc7354daba2889a260053e5d6
author Linus Torvalds <torvalds@linux-foundation.org> 1285027013 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1285027013 -0700

Linux 2.6.36-rc5
tree 7598c6af02b24a5a2ca23ac8b908df731fc1513f
parent d0ac5d8e673aa7317c0d132ba3092935dac53298
author Linus Torvalds <torvalds@linux-foundation.org> 1421560940 +1200
committer Linus Torvalds <torvalds@linux-foundation.org> 1421560940 +1200

Linux 3.19-rc5
tree ee0b517f61432d671730c6ed8853b216fd223570
parent cb876f451455b6187a7d69de2c112c45ec4b7f99
author Linus Torvalds <torvalds@woody.osdl.org> 1166932832 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1166932832 -0800

Linux 2.6.20-rc2
tree fb970bbb53d92466c295b8bb7ec4543aff2af085
parent eb1c838fca2248ae62e5472b496ab52d3d774cc5
author Linus Torvalds <torvalds@linux-foundation.org> 1262736166 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1262736166 -0800

Linux 2.6.33-rc3
tree fe8b671c049e39cbf06b63fa320e9775cad0dc58
parent e99cc290cae141853bcd901e4c7038fe686cc46d
author Linus Torvalds <torvalds@linux-foundation.org> 1266001665 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1266001665 -0800

Linux 2.6.33-rc8
tree 7e0d37db95601a1262648b784e65238142607e01
parent 53ff7095cce683813be075379160b8e4e6ea8b85
author Linus Torvalds <torvalds@linux-foundation.org> 1263359700 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1263359700 -0800

Linux 2.6.33-rc4
tree b47d953e3aff650e759112fc07a1cb08bf2b8187
parent f5266cbd2fca04dbd0387a67f550b6667ffa4ed2
author Linus Torvalds <torvalds@linux-foundation.org> 1249087245 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1249087245 -0700

Linux 2.6.31-rc5
tree 46efd201c070e594c6da4bada354eab5e583eb0c
parent feed9bab7b14b77be8d796bcee95e2343fb82955
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1201215517 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1201215517 -0800

Linux 2.6.24
tree 15a20282c7462a9205772d775f078ff9b7e72953
parent 5576f7fb38076491a147977f10562d7318e5b0a0
author Linus Torvalds <torvalds@linux-foundation.org> 1532211843 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1533623470 -0400

mm: make vm_area_alloc() initialize core fields

[ Upstream commit 490fc053865c9cc40f1085ef8a5504f5341f79d2 ]

Like vm_area_dup(), it initializes the anon_vma_chain head, and the
basic mm pointer.

The rest of the fields end up being different for different users,
although the plan is to also initialize the 'vm_ops' field to a dummy
entry.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d4dbda5d269d79476f28582905f3448fc7d997dd
parent e8a03feb54ca7f1768bbdc2b491f9ef654e6d01d
author Linus Torvalds <torvalds@linux-foundation.org> 1271719796 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1271719796 -0700

Linux 2.6.34-rc5
tree fe83a8950bf0674624801d92f2885c52072fb1bf
parent 30ceb4ec33d5bb5669389d423b1c91b26c45d94d
author Linus Torvalds <torvalds@linux-foundation.org> 1380492158 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1380492158 -0700

Linux 3.12-rc3
tree a3197a325cf045651d115fc66ca61ac5951d56a7
parent 14a7bb94e272880155462dbdf3dfaa7cad2a3a4a
author Josh Abraham <j.abraham1776@gmail.com> 1536801234 -1000
committer Sasha Levin <sashal@kernel.org> 1538619824 -0400

xen: fix GCC warning and remove duplicate EVTCHN_ROW/EVTCHN_COL usage

[ Upstream commit 4dca864b59dd150a221730775e2f21f49779c135 ]

This patch removes duplicate macro useage in events_base.c.

It also fixes gcc warning:
variable ‘col’ set but not used [-Wunused-but-set-variable]

Signed-off-by: Joshua Abraham <j.abraham1776@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree eeab93182cfcbfb2537b7a133f5dfeacc121ef81
parent 98595dd09e3333c440fcae95bb2e79f472fb7526
author Darrick J. Wong <darrick.wong@oracle.com> 1553357429 -0400
committer Sasha Levin <sashal@kernel.org> 1553868187 -0400

ext4: prohibit fstrim in norecovery mode

[ Upstream commit 18915b5873f07e5030e6fb108a050fa7c71c59fb ]

The ext4 fstrim implementation uses the block bitmaps to find free space
that can be discarded.  If we haven't replayed the journal, the bitmaps
will be stale and we absolutely *cannot* use stale metadata to zap the
underlying storage.

Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 5fa64d47f28cde6b8151b75c7047a98292d084ca
parent 02b7d83436ae4b1d86a5df03e72c1c69af7e239d
author Linus Torvalds <torvalds@linux-foundation.org> 1340567584 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1340567584 -0700

Linux 3.5-rc4
tree 9a798ee19f7b628b4add5b2629e8d79186cdd790
parent d3712b9dfcf44ca145cf87e7f4096fa2d923471a
author Linus Torvalds <torvalds@linux-foundation.org> 1328045514 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1328045514 -0800

Linux 3.3-rc2
tree 03bfa96b6009c6a82187282345e733eddc1f5373
parent 820b688bed62f21020873c055f521b9e1f45a954
author Linus Torvalds <torvalds@linux-foundation.org> 1417990865 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1417990865 -0800

Linux 3.18
tree 5caecfdd9edab50789483eb96009e9faf5f1b241
parent 7135a71b19be1faf48b7148d77844d03bc0717d6
author Linus Torvalds <torvalds@linux-foundation.org> 1252534439 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1252534439 -0700

Linux 2.6.31
tree 6df8e6880d4deafb5e5fbe6f6921b17003dd9b0e
parent 14897e35fdc045fff9baabf0354570da22386706
author Linus Torvalds <torvalds@linux-foundation.org> 1207945949 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1207945949 -0700

Linux 2.6.25-rc9
tree b2519fea89c36b853728767c97d5f8f720bbbc62
parent 9c1a7747059a65dbc2d7703978841a37db699fbf
author Linus Torvalds <torvalds@linux-foundation.org> 1236128722 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1236128722 -0800

Linux 2.6.29-rc7
tree 2c9f8b5e11aedf3d49b984550d6825dba5c8573e
parent 74225a4cbea38034034add5da67a2f7ee23251c0
author Sasha Levin <alexander.levin@verizon.com> 1469842774 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1469842786 -0400

Linux 4.1.29

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 70b68e8e4825b9d1dca26fe6776ed179790d33a4
parent 4c23efb4e6213c51c9343319a6c3803040b0af1f
author Sasha Levin <sasha.levin@oracle.com> 1428115597 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1428115597 -0400

Linux 3.18.11

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree cc1706ff9f5a16f3e9c3fe47dd9da6fd8dd767ef
parent fcf800419cc4013acd008a5bf44e51aa77757ab0
author Dan Carpenter <dan.carpenter@oracle.com> 1534241267 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1538144093 -0400

hwmon: (adt7475) Make adt7475_read_word() return errors

[ Upstream commit f196dec6d50abb2e65fb54a0621b2f1b4d922995 ]

The adt7475_read_word() function was meant to return negative error
codes on failure.

Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Reviewed-by: Tokunori Ikegami <ikegami@allied-telesis.co.jp>
Signed-off-by: Guenter Roeck <linux@roeck-us.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 2187b071ec88547a35e5154eaf0dc11c788cd97a
parent d865983292cf1e526de8aba31870794909860d5b
author Linus Torvalds <torvalds@linux-foundation.org> 1339892717 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1339892717 -0700

Linux 3.5-rc3
tree ccfd357d152292958957b6b8a993892e7a8cc95f
parent f7c1d074200417d8204dd97b4acfdba1ebc63c89
author Linus Torvalds <torvalds@linux-foundation.org> 1397423915 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1397423915 -0700

Linux 3.15-rc1
tree 276c27209c083d20df2be35407e88f97c4951a72
parent 936c4abad6cb758c2747f0496983394cd427b72f
author Richard Weinberger <richard@nod.at> 1536008783 +0200
committer Sasha Levin <sashal@kernel.org> 1538619859 -0400

ubifs: Check for name being NULL while mounting

[ Upstream commit 37f31b6ca4311b94d985fb398a72e5399ad57925 ]

The requested device name can be NULL or an empty string.
Check for that and refuse to continue. UBIFS has to do this manually
since we cannot use mount_bdev(), which checks for this condition.

Fixes: 1e51764a3c2ac ("UBIFS: add new flash file system")
Reported-by: syzbot+38bd0f7865e5c6379280@syzkaller.appspotmail.com
Signed-off-by: Richard Weinberger <richard@nod.at>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6bc50114411d7c58c7b3fec1599f6812bcfc5f4c
parent 131f437d2baf4205da41f6d6a40f7694d4617482
author Sasha Levin <alexander.levin@verizon.com> 1474152854 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1474152854 -0400

Linux 4.1.33

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree b9cf4fd3fe6afea7ec4e09a2bd976d9964f9266e
parent 06d5e334a4f8a1f33ebfcdc89c077f4fc85bcffb
author Linus Torvalds <torvalds@linux-foundation.org> 1214003984 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1214003984 -0700

Linux 2.6.26-rc7
tree 9f2d70f53a1335b47c6b309024e570f628a451a0
parent 57014123512633ab0c38a4fea4140bf156f6a3a0
author Linus Torvalds <torvalds@linux-foundation.org> 1210550981 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1210550981 -0700

Linux 2.6.26-rc2
tree 845c25789f595df374cbb2188a64ff96015e3dee
parent ea882c2ece7c68462a3734c71c60e2572e528fe7
author Linus Torvalds <torvalds@linux-foundation.org> 1362352265 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1362352265 -0800

Linux 3.9-rc1
tree edbef8763aeb010fb3839f08f5ab5f6580000fea
parent 3ed6379a20dfd6872ce77e63b3d0466d1d6a48d1
author Yangbo Lu <yangbo.lu@nxp.com> 1515466953 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517680515 -0500

net: gianfar_ptp: move set_fipers() to spinlock protecting area

[ Upstream commit 11d827a993a969c3c6ec56758ff63a44ba19b466 ]

set_fipers() calling should be protected by spinlock in
case that any interrupt breaks related registers setting
and the function we expect. This patch is to move set_fipers()
to spinlock protecting area in ptp_gianfar_adjtime().

Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
Acked-by: Richard Cochran <richardcochran@gmail.com>
Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree e7134aa133519cad32c037223698f2219d5aefc7
parent 8fa7ddb1d0ff9bd21fcdd0cdc33e830c128904be
author Arnd Bergmann <arnd@arndb.de> 1553529043 +0100
committer Sasha Levin <sashal@kernel.org> 1555961664 -0400

ARM: iop: don't use using 64-bit DMA masks

[ Upstream commit 2125801ccce19249708ca3245d48998e70569ab8 ]

clang warns about statically defined DMA masks from the DMA_BIT_MASK
macro with length 64:

 arch/arm/mach-iop13xx/setup.c:303:35: error: shift count >= width of type [-Werror,-Wshift-count-overflow]
 static u64 iop13xx_adma_dmamask = DMA_BIT_MASK(64);
                                  ^~~~~~~~~~~~~~~~
 include/linux/dma-mapping.h:141:54: note: expanded from macro 'DMA_BIT_MASK'
 #define DMA_BIT_MASK(n) (((n) == 64) ? ~0ULL : ((1ULL<<(n))-1))
                                                      ^ ~~~

The ones in iop shouldn't really be 64 bit masks, so changing them
to what the driver can support avoids the warning.

Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 620d8127a7e4b86a1ba730e534f4b9b359243a0e
parent 9db4ed5e7e8f85a4cdd24eaaa7129d99d5139288
author Max Gurtovoy <maxg@mellanox.com> 1520273388 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1523803527 -0400

RDMA/core: Reduce poll batch for direct cq polling

[ Upstream commit d3b9e8ad425cfd5b9116732e057f1b48e4d3bcb8 ]

Fix warning limit for kernel stack consumption:

drivers/infiniband/core/cq.c: In function 'ib_process_cq_direct':
drivers/infiniband/core/cq.c:78:1: error: the frame size of 1032 bytes
is larger than 1024 bytes [-Werror=frame-larger-than=]

Using smaller ib_wc array on the stack brings us comfortably below that
limit again.

Fixes: 246d8b184c10 ("IB/cq: Don't force IB_POLL_DIRECT poll context for ib_process_cq_direct")
Reported-by: Arnd Bergmann <arnd@arndb.de>
Reviewed-by: Sergey Gorenko <sergeygo@mellanox.com>
Signed-off-by: Max Gurtovoy <maxg@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
Acked-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b76a619a82e7f3a95c08cc0894e19d3c47c68fe5
parent 1e6c5c4e4c98af5f9e905b860f4536dcc8e92402
author Linus Torvalds <torvalds@linux-foundation.org> 1267037537 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1267037537 -0800

Linux 2.6.33
tree 7653fb05a94383de17bde81e98829b9ff77a4bd8
parent 8375f9295721cd9a00e221dea71db9b1658eb785
author Larry Finger <Larry.Finger@lwfinger.net> 1511638358 -0600
committer Sasha Levin <alexander.levin@microsoft.com> 1517163338 -0500

staging: rtl8188eu: Fix incorrect response to SIOCGIWESSID

[ Upstream commit b77992d2df9e47144354d1b25328b180afa33442 ]

When not associated with an AP, wifi device drivers should respond to the
SIOCGIWESSID ioctl with a zero-length string for the SSID, which is the
behavior expected by dhcpcd.

Currently, this driver returns an error code (-1) from the ioctl call,
which causes dhcpcd to assume that the device is not a wireless interface
and therefore it fails to work correctly with it thereafter.

This problem was reported and tested at
https://github.com/lwfinger/rtl8188eu/issues/234.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree a98d3a203a3b665106e00a856fc06c0aaf2e1046
parent 9dae0a3fc4b0b9aed302a0fad61846c49cc313b1
author Linus Torvalds <torvalds@linux-foundation.org> 1406490115 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1406490115 -0700

Linux 3.16-rc7
tree 88d1b71fff3e167214f4940c30d55ea43b83a74c
parent 5e7ba4a91229d0d8a4f8490bd0ef110c3e511cb4
author Eric W. Biederman <ebiederm@xmission.com> 1503007666 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1522903863 -0400

signal/arm: Document conflicts with SI_USER and SIGFPE

[ Upstream commit 7771c66457004977b616bab785209f49d164f527 ]

Setting si_code to 0 results in a userspace seeing an si_code of 0.
This is the same si_code as SI_USER.  Posix and common sense requires
that SI_USER not be a signal specific si_code.  As such this use of 0
for the si_code is a pretty horribly broken ABI.

Further use of si_code == 0 guaranteed that copy_siginfo_to_user saw a
value of __SI_KILL and now sees a value of SIL_KILL with the result
that uid and pid fields are copied and which might copying the si_addr
field by accident but certainly not by design.  Making this a very
flakey implementation.

Utilizing FPE_FIXME, siginfo_layout will now return SIL_FAULT and the
appropriate fields will be reliably copied.

Possible ABI fixes includee:
- Send the signal without siginfo
- Don't generate a signal
- Possibly assign and use an appropriate si_code
- Don't handle cases which can't happen

Cc: Russell King <rmk@flint.arm.linux.org.uk>
Cc: linux-arm-kernel@lists.infradead.org
Ref: 451436b7bbb2 ("[ARM] Add support code for ARM hardware vector floating point")
History Tree: https://git.kernel.org/pub/scm/linux/kernel/git/tglx/history.git
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b3aa4d755a4ebd94dbf12f13df0714bef38291d6
parent b8a3ad5b53918787f4708ad9dfe90d2557cc78dd
author Linus Torvalds <torvalds@g5.osdl.org> 1160756704 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1160756704 -0700

Linux 2.6.19-rc2

That was slightly more painful than really necessary..
tree 034af672e915c73a7bb2c5d2719d19f87dcecd3f
parent 38e80121bd7d0c493072442ac7eddcba165a07a8
author Linus Torvalds <torvalds@linux-foundation.org> 1209841184 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1209841184 -0700

Linux 2.6.26-rc1
tree e906dd9f65fa5bdeaebac5c9b3f2f08a04fdbece
parent 621c2559c16fc703e24fc0e3ffad28d5477b49c7
author Linus Torvalds <torvalds@linux-foundation.org> 1241828054 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1241828054 -0700

Linux 2.6.30-rc5
tree 08d6d9678a7477f2acb010031008491f0407f447
parent 10659613e6852a5f63ad92f9b03ef86e3df5898c
author Randy Dunlap <rdunlap@infradead.org> 1530935589 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1536083076 -0400

platform/x86: toshiba_acpi: Fix defined but not used build warnings

[ Upstream commit c2e2a618eb7104e18fdcf739d4d911563812a81c ]

Fix a build warning in toshiba_acpi.c when CONFIG_PROC_FS is not enabled
by marking the unused function as __maybe_unused.

../drivers/platform/x86/toshiba_acpi.c:1685:12: warning: 'version_proc_show' defined but not used [-Wunused-function]

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Azael Avalos <coproscefalo@gmail.com>
Cc: platform-driver-x86@vger.kernel.org
Cc: Andy Shevchenko <andy@infradead.org>
Signed-off-by: Darren Hart (VMware) <dvhart@infradead.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c238b2a996b426b1383780d600b2bf6b7c386659
parent 77f5fa7916c4d67f226ba57d2e461d1cd2966979
author Ville Syrjälä <ville.syrjala@linux.intel.com> 1538157839 +0300
committer Sasha Levin <sashal@kernel.org> 1553647635 -0400

drm/dp/mst: Configure no_stop_bit correctly for remote i2c xfers

[ Upstream commit c978ae9bde582e82a04c63a4071701691dd8b35c ]

We aren't supposed to force a stop+start between every i2c msg
when performing multi message transfers. This should eg. cause
the DDC segment address to be reset back to 0 between writing
the segment address and reading the actual EDID extension block.

To quote the E-DDC spec:
"... this standard requires that the segment pointer be
 reset to 00h when a NO ACK or a STOP condition is received."

Since we're going to touch this might as well consult the
I2C_M_STOP flag to determine whether we want to force the stop
or not.

Cc: Brian Vincent <brainn@gmail.com>
References: https://bugs.freedesktop.org/show_bug.cgi?id=108081
Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20180928180403.22499-1-ville.syrjala@linux.intel.com
Reviewed-by: Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 66137538d82f66e54f31f9523e180b5c61ae9947
parent e45cc4194b96ede706205a7df824d85eb10a51eb
author Sasha Levin <alexander.levin@verizon.com> 1480437883 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1480437883 -0500

Linux 3.18.45

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 26f37926da0752110368cdd9620e0e4575c979a6
parent 0eeca28300df110bd6ed54b31193c83b87921443
author Linus Torvalds <torvalds@g5.osdl.org> 1121230006 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1121230006 -0700

Linux 2.6.13-rc3

Yeah, this time hopefully I'm not confusing the version
numbers. The last release was -rc2, _this_ is -rc3.
tree 165fb931ca4950216021ead38103c30320175b1f
parent b008351f30d7d60b34e0469fc07a8f5b1ac098ad
author Sasha Levin <sasha.levin@oracle.com> 1446323991 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1446323991 -0400

Linux 3.18.24

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b037301c2d0eee1ece16c4be115881b7c5bb1eba
parent bb4c18cbba474ae20c84171819255598cf975158
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1172638752 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1172638752 -0800

Linux 2.6.21-rc2

Too many changes for comfort since -rc1.  Some missed merges, and some
just annoyingly big fixes since.  This is not how an -rc2 should look.
Need to really calm things down!
tree 007f4f8ccbda6c5c3de5133ef39324b605f0e074
parent 0479b826457382c39d369acc95347621a347414e
author Sasha Levin <sasha.levin@oracle.com> 1455569184 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1455569184 -0500

Linux 4.1.18

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 7b4f37a4375eb1da18c429670f7271b665c5060e
parent 88a4d5cc6aba8dab689afb700ed78c70e3c15b0e
author Kairui Song <kasong@redhat.com> 1538051925 +0800
committer Sasha Levin <sashal@kernel.org> 1539640915 -0400

x86/boot: Fix kexec booting failure in the SEV bit detection code

[ Upstream commit bdec8d7fa55e6f5314ed72e5a0b435d90ff90548 ]

Commit

  1958b5fc4010 ("x86/boot: Add early boot support when running with SEV active")

can occasionally cause system resets when kexec-ing a second kernel even
if SEV is not active.

That's because get_sev_encryption_bit() uses 32-bit rIP-relative
addressing to read the value of enc_bit - a variable which caches a
previously detected encryption bit position - but kexec may allocate
the early boot code to a higher location, beyond the 32-bit addressing
limit.

In this case, garbage will be read and get_sev_encryption_bit() will
return the wrong value, leading to accessing memory with the wrong
encryption setting.

Therefore, remove enc_bit, and thus get rid of the need to do 32-bit
rIP-relative addressing in the first place.

 [ bp: massage commit message heavily. ]

Fixes: 1958b5fc4010 ("x86/boot: Add early boot support when running with SEV active")
Suggested-by: Borislav Petkov <bp@suse.de>
Signed-off-by: Kairui Song <kasong@redhat.com>
Signed-off-by: Borislav Petkov <bp@suse.de>
Reviewed-by: Tom Lendacky <thomas.lendacky@amd.com>
Cc: linux-kernel@vger.kernel.org
Cc: tglx@linutronix.de
Cc: mingo@redhat.com
Cc: hpa@zytor.com
Cc: brijesh.singh@amd.com
Cc: kexec@lists.infradead.org
Cc: dyoung@redhat.com
Cc: bhe@redhat.com
Cc: ghook@redhat.com
Link: https://lkml.kernel.org/r/20180927123845.32052-1-kasong@redhat.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 41b7bac9d555b196c490c0c9f384bddeec321b9a
parent 4bde57094b3aac7c5d80fc82530db8b03c3ce2d3
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1198200348 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1198200348 -0800

Linux 2.6.24-rc6
tree 939fcc4c6fb186592e3ca2ed9c70312d2ae3c39b
parent 6ffc8242474ff5d80aab2cef563ad10bc3ca33d0
author Kevin Hilman <khilman@baylibre.com> 1526933312 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1537966310 -0400

ARM: dts: dra7: fix DCAN node addresses

[ Upstream commit 949bdcc8a97c6078f21c8d4966436b117f2e4cd3 ]

Fix the DT node addresses to match the reg property addresses,
which were verified to match the TRM:
http://www.ti.com/lit/pdf/sprui30

Cc: Roger Quadros <rogerq@ti.com>
Signed-off-by: Kevin Hilman <khilman@baylibre.com>
Acked-by: Roger Quadros <rogerq@ti.com>
Signed-off-by: Tony Lindgren <tony@atomide.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6209aed8c4e32d21947f26589434be9117f015e2
parent 4d7e2e13063b0072958d5818d605bb5d06621061
author Stefan Schake <stschake@gmail.com> 1514563543 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1517163707 -0500

drm/vc4: Move IRQ enable to PM path

[ Upstream commit ce9caf2f79a5aa170a4b6456a03db639eed9c988 ]

We were calling enable_irq on bind, where it was already enabled previously
by the IRQ helper. Additionally, dev->irq is not set correctly until after
postinstall and so was always zero here, triggering a warning in 4.15.
Fix both by moving the enable to the power management resume path, where we
know there was a previous disable invocation during suspend.

Fixes: 253696ccd613 ("drm/vc4: Account for interrupts in flight")
Signed-off-by: Stefan Schake <stschake@gmail.com>
Signed-off-by: Eric Anholt <eric@anholt.net>
Link: https://patchwork.freedesktop.org/patch/msgid/1514563543-32511-1-git-send-email-stschake@gmail.com
Tested-by: Stefan Wahren <stefan.wahren@i2se.com>
Reviewed-by: Eric Anholt <eric@anholt.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 3d997ff57add6b0b62b880389ca49dd2a51c8656
parent 9b37ccfc637be27d9a652fcedc35e6e782c3aa78
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1204691634 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1204691634 -0800

Linux 2.6.25-rc4
tree 6fad7de43899e65799188c1a480aacc74745f9bb
parent d7df025eb4c3c571532326b01e007be52c75e5c0
author Linus Torvalds <torvalds@linux-foundation.org> 1359143848 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1359143848 -0800

Linux 3.8-rc5
tree 207c20c169605e3d348b1f78e21c4224d16f8b8d
parent 32e1572427bf964ebe038f61d9f0bf0452cbf0e8
author Linus Torvalds <torvalds@linux-foundation.org> 1291092124 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1291092124 -0800

Linux 2.6.37-rc4
tree e216a47beb68a86255b8a33532d052e8a620e9df
parent 7eb58c19279ae965770ae68032a1664bdf851ce4
author Mohammed Gamal <mgamal@redhat.com> 1522955360 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1523925093 -0400

hv_netvsc: Ensure correct teardown message sequence order

Prior to commit 0cf737808ae7 ("hv_netvsc: netvsc_teardown_gpadl() split")
the call sequence in netvsc_device_remove() was as follows (as
implemented in netvsc_destroy_buf()):
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Teardown receive buffer GPADL
3- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
4- Teardown send buffer GPADL
5- Close vmbus

This didn't work for WS2016 hosts. Commit 0cf737808ae7
("hv_netvsc: netvsc_teardown_gpadl() split") rearranged the
teardown sequence as follows:
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Close vmbus
4- Teardown receive buffer GPADL
5- Teardown send buffer GPADL

That worked well for WS2016 hosts, but it prevented guests on older hosts from
shutting down after changing network settings. Commit 0ef58b0a05c1
("hv_netvsc: change GPAD teardown order on older versions") ensured the
following message sequence for older hosts
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Teardown receive buffer GPADL
4- Teardown send buffer GPADL
5- Close vmbus

However, with this sequence calling `ip link set eth0 mtu 1000` hangs and the
process becomes uninterruptible. On futher analysis it turns out that on tearing
down the receive buffer GPADL the kernel is waiting indefinitely
in vmbus_teardown_gpadl() for a completion to be signaled.

Here is a snippet of where this occurs:
int vmbus_teardown_gpadl(struct vmbus_channel *channel, u32 gpadl_handle)
{
        struct vmbus_channel_gpadl_teardown *msg;
        struct vmbus_channel_msginfo *info;
        unsigned long flags;
        int ret;

        info = kmalloc(sizeof(*info) +
                       sizeof(struct vmbus_channel_gpadl_teardown), GFP_KERNEL);
        if (!info)
                return -ENOMEM;

        init_completion(&info->waitevent);
        info->waiting_channel = channel;
[....]
        ret = vmbus_post_msg(msg, sizeof(struct vmbus_channel_gpadl_teardown),
                             true);

        if (ret)
                goto post_msg_err;

        wait_for_completion(&info->waitevent);
[....]
}

The completion is signaled from vmbus_ongpadl_torndown(), which gets called when
the corresponding message is received from the host, which apparently never happens
in that case.
This patch works around the issue by restoring the first mentioned message sequence
for older hosts

Fixes: 0ef58b0a05c1 ("hv_netvsc: change GPAD teardown order on older versions")
Signed-off-by: Mohammed Gamal <mgamal@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 5a3e48fb93a3280a9d9898149076c40bcaecee60
parent cf2750e6332872d07323e1c8dbb5ea79018bcd97
author Richard Alpe <richard.alpe@ericsson.com> 1468504927 +0100
committer Sasha Levin <alexander.levin@verizon.com> 1472152688 -0400

tipc: fix nl compat regression for link statistics

[ Upstream commit 55e77a3e8297581c919b45adcc4d0815b69afa84 ]

Fix incorrect use of nla_strlcpy() where the first NLA_HDRLEN bytes
of the link name where left out.

Making the output of tipc-config -ls look something like:
Link statistics:
dcast-link
1:data0-1.1.2:data0
1:data0-1.1.3:data0

Also, for the record, the patch that introduce this regression
claims "Sending the whole object out can cause a leak". Which isn't
very likely as this is a compat layer, where the data we are parsing
is generated by us and we know the string to be NULL terminated. But
you can of course never be to secure.

Fixes: 5d2be1422e02 (tipc: fix an infoleak in tipc_nl_compat_link_dump)
Signed-off-by: Richard Alpe <richard.alpe@ericsson.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 767427cd03dc0dfba94134c3015d9592bef6a1e4
parent ce43f6a650a6689551a217276fb0dcca33790425
author Sasha Levin <sasha.levin@oracle.com> 1455569226 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1455569226 -0500

Linux 3.18.27

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree cfa51533eb5f6b687d118bd9bd2993f6d43e96fa
parent c841ac3959416e1a6070f76620fb65a7afcbfd61
author Łukasz Stelmach <l.stelmach@samsung.com> 1522742697 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1527972798 -0400

ARM: 8753/1: decompressor: add a missing parameter to the addruart macro

[ Upstream commit e07e3c33b9c0b5751ade624f44325c9bf2487ea6 ]

In commit 639da5ee374b ("ARM: add an extra temp register to the low
level debugging addruart macro") an additional temporary register was
added to the addruart macro, but the decompressor code wasn't updated.

Fixes: 639da5ee374b ("ARM: add an extra temp register to the low level debugging addruart macro")
Signed-off-by: Łukasz Stelmach <l.stelmach@samsung.com>
Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree f4940e60c09c30b493607fb60bce9b4c8ffc30fd
parent dcda279dede75d5cb4e6af18ba90eb4ca1e813ee
author Sasha Levin <alexander.levin@verizon.com> 1498748148 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1498748148 -0400

Linux 4.1.42

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree dadbc3901075f02dded557ec33a48a05d52218c0
parent 822316461b15e0207e50ff661f9cf830af116e9f
author Linus Torvalds <torvalds@linux-foundation.org> 1395714677 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1395714677 -0700

Linux 3.14-rc8
tree a773c1b2c72980acaca7f2626a55206eeeb1734b
parent ab465df9dda42a997f7537c875127eeb6a88158c
author Linus Torvalds <torvalds@linux-foundation.org> 1369609247 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1369609247 -0700

Linux 3.10-rc3
tree 723d5d81419f9960b8d30ed9a2ece8a58d6c4328
parent 9a6558371bcd01c2973b7638181db4ccc34eab4f
author Linus Torvalds <torvalds@linux-foundation.org> 1226277375 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1226277375 -0800

Linux 2.6.28-rc4
tree 26ad6c26a4766103bd65f23e447f7b44e9cdff7d
parent fa661eae42872662510ac30b347670ba71344acf
author Jia-Ju Bai <baijiaju1990@163.com> 1513068592 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517759837 -0500

hippi: Fix a Fix a possible sleep-in-atomic bug in rr_close

[ Upstream commit 6e266610eb6553cfb7e7eb5d11914bd01509c406 ]

The driver may sleep under a spinlock.
The function call path is:
rr_close (acquire the spinlock)
  free_irq --> may sleep

To fix it, free_irq is moved to the place without holding the spinlock.

This bug is found by my static analysis tool(DSAC) and checked by my code review.

Signed-off-by: Jia-Ju Bai <baijiaju1990@163.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree fc0354e4da0ff5ab8b8eb65d60d9a8359d02634d
parent 248d296d6d9df384996c2ed95676b367d876d48c
author Linus Torvalds <torvalds@linux-foundation.org> 1378154770 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1378154770 -0700

Linux 3.11
tree f571fbe8f635983c9ea21b73dcec53d7a68f2450
parent 0fdd07f77fd9cc6a7d49076793daef06ea5d8f13
author Linus Torvalds <torvalds@linux-foundation.org> 1259812281 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1259812281 -0800

Linux 2.6.32
tree a240df85bb663c753f5cdee95b518f7eb527516c
parent a0127afbed65b7b9f8a486c557017eafb4d4c0fc
author Linus Torvalds <torvalds@linux-foundation.org> 1341707036 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1341707036 -0700

Linux 3.5-rc6
tree a0b3677d442ed08ca16943fb471a90f5fd5bc367
parent 3dc91d4338d698ce77832985f9cb183d8eeaf6be
author Linus Torvalds <torvalds@linux-foundation.org> 1389521058 +0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1389521058 +0700

Linux 3.13-rc8
tree 83d0e6784797ffc5cd45b9920045d9298192f28f
parent b600ffaebcc4791add19e04306f0478a963abe71
author Linus Torvalds <torvalds@linux-foundation.org> 1248316379 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1248316379 -0700

Linux 2.6.31-rc4
tree 397d117fb2debc479e158169114b2fb8e14b826b
parent 885142848ea7f1d10e778fb093d26e0fc5cffafb
author Dmitry Osipenko <digetx@gmail.com> 1531843838 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1538094128 -0400

gpio: tegra: Fix tegra_gpio_irq_set_type()

[ Upstream commit f78709a5d4114edc21a5d86586ed5e56e284f2bd ]

Commit 36b312792b97 ("gpiolib: Respect error code of ->get_direction()")
broke tegra_gpio_irq_set_type() because requesting of GPIO direction must
be done after enabling GPIO function for a pin.

This patch fixes drivers probe failure like this:

 gpio gpiochip0: (tegra-gpio): gpiochip_lock_as_irq: cannot get GPIO direction
 tegra-gpio 6000d000.gpio: unable to lock Tegra GPIO 144 as IRQ

Fixes: 36b312792b97 ("gpiolib: Respect error code of ->get_direction()")
Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
Acked-by: Jon Hunter <jonathanh@nvidia.com>
Tested-by: Jon Hunter <jonathanh@nvidia.com>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 5c6aff0b9f567c03e57f4243b1e3e0eea990b939
parent 1e05ff020f692de078226fd5480adc76317e37bb
author Linus Torvalds <torvalds@linux-foundation.org> 1302567711 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1302567711 -0700

Linux 2.6.39-rc3
tree 27bd827450c836cc2d6066dbf0a6110062feea2b
parent ec6931b281797b69e6cf109f9cc94d5a2bf994e0
author Linus Torvalds <torvalds@linux-foundation.org> 1398652167 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1398652167 -0700

Linux 3.15-rc3
tree feebf216984d0c7fb7ce5842e5cdc7a5e28bbfd8
parent 00e1d655592109ea61e6a1316539ae8ce9cc3813
author Sasha Levin <sasha.levin@oracle.com> 1461067085 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1461067085 -0400

Linux 4.1.22

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree f9db86637752a6fa6483351cb5c9dbf4ed661227
parent 5219d0203904b27bf8c6c8aa4b2b1c8975c63f68
author Wenwen Wang <wang6495@umn.edu> 1538747307 -0500
committer Sasha Levin <sashal@kernel.org> 1539641094 -0400

net: cxgb3_main: fix a missing-check bug

[ Upstream commit 2c05d88818ab6571816b93edce4d53703870d7ae ]

In cxgb_extension_ioctl(), the command of the ioctl is firstly copied from
the user-space buffer 'useraddr' to 'cmd' and checked through the
switch statement. If the command is not as expected, an error code
EOPNOTSUPP is returned. In the following execution, i.e., the cases of the
switch statement, the whole buffer of 'useraddr' is copied again to a
specific data structure, according to what kind of command is requested.
However, after the second copy, there is no re-check on the newly-copied
command. Given that the buffer 'useraddr' is in the user space, a malicious
user can race to change the command between the two copies. By doing so,
the attacker can supply malicious data to the kernel and cause undefined
behavior.

This patch adds a re-check in each case of the switch statement if there is
a second copy in that case, to re-check whether the command obtained in the
second copy is the same as the one in the first copy. If not, an error code
EINVAL is returned.

Signed-off-by: Wenwen Wang <wang6495@umn.edu>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree f172777dbf25967453587d7e9a9eb07490693e27
parent 4f3a151a11da3351e2149a401d4ee18426938de7
author Linus Torvalds <torvalds@g5.osdl.org> 1148521817 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1148521817 -0700

Linux 2.6.17-rc5
tree c9cad98ad9cbba487d32812d59c456ed774d6ffb
parent 6c4d3bc99b3341067775efd4d9d13cc8e655fd7c
author Linus Torvalds <torvalds@linux-foundation.org> 1363561172 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1363561172 -0700

Linux 3.9-rc3
tree 63eb14fdcebbe0d62aeb005cf9fc889bac9e7421
parent fde42e4788471dab08f66ce618632b4efe919af5
author Jia-Ju Bai <baijiaju1990@163.com> 1513068592 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517759939 -0500

hippi: Fix a Fix a possible sleep-in-atomic bug in rr_close

[ Upstream commit 6e266610eb6553cfb7e7eb5d11914bd01509c406 ]

The driver may sleep under a spinlock.
The function call path is:
rr_close (acquire the spinlock)
  free_irq --> may sleep

To fix it, free_irq is moved to the place without holding the spinlock.

This bug is found by my static analysis tool(DSAC) and checked by my code review.

Signed-off-by: Jia-Ju Bai <baijiaju1990@163.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1a92c0656fd3296a2cbf00f89e14120aa0600099
parent a5eb1939e90772e903db9b915ea044196fc4880f
author Thadeu Lima de Souza Cascardo <cascardo@canonical.com> 1550831261 -0300
committer Sasha Levin <sashal@kernel.org> 1552423291 -0400

selftests: fib_tests: sleep after changing carrier. again.

[ Upstream commit af548a27b158d548d41e56255e6eaca1658cc3be ]

Just like commit e2ba732a1681 ("selftests: fib_tests: sleep after
changing carrier"), wait one second to allow linkwatch to propagate the
carrier change to the stack.

There are two sets of carrier tests. The first slept after the carrier
was set to off, and when the second set ran, it was likely that the
linkwatch would be able to run again without much delay, reducing the
likelihood of a race. However, if you run 'fib_tests.sh -t carrier' on a
loop, you will quickly notice the failures.

Sleeping on the second set of tests make the failures go away.

Cc: David Ahern <dsahern@gmail.com>
Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
Reviewed-by: David Ahern <dsahern@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree dbec1f19f7bc4a1e742a83d68eb3bc5767c12627
parent 4092dc8f0bcc0963c045460157107d7461a094d7
author Linus Torvalds <torvalds@linux-foundation.org> 1411939747 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1411939747 -0700

Linux 3.17-rc7
tree 667100f77ada5006323ec0f0b40ae37277afb442
parent 82e22d77bfb2523284fdf5c484c1fa5269a5d27e
author Linus Torvalds <torvalds@linux-foundation.org> 1265494632 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1265494632 -0800

Linux 2.6.33-rc7
tree 211635ef69cf5a7462b48eef4d4bc2d6d6c12b0d
parent 2bf35534062e64432809b795b3ad3b733e3656bb
author Pan Bian <bianpan2016@163.com> 1555659540 +0000
committer Sasha Levin <sashal@kernel.org> 1556839222 -0400

Input: synaptics-rmi4 - fix possible double free

[ Upstream commit bce1a78423961fce676ac65540a31b6ffd179e6d ]

The RMI4 function structure has been released in rmi_register_function
if error occurs. However, it will be released again in the function
rmi_create_function, which may result in a double-free bug.

Signed-off-by: Pan Bian <bianpan2016@163.com>
Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree fb33085ce625e166fed71153193cd4cb68cd31cd
parent c1c008cc55ab917923871db6bb461b903e9e1f76
author Linus Torvalds <torvalds@linux-foundation.org> 1377477802 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1377477802 -0700

Linux 3.11-rc7
tree 5167d1680cbcd852be9c95a347d689702c45357f
parent a3759241250e4ef7872ac0727a3c2b8d6f379f8f
author Sasha Levin <sasha.levin@oracle.com> 1436489208 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1436489208 -0400

Linux 3.18.18

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 01099b45d72a6b9977cebe34b97938b07d00a0b5
parent 075cb105cb6dcda8a585989ebd4a71f0b3c33f3e
author Linus Torvalds <torvalds@linux-foundation.org> 1320711362 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1320711362 -0800

Linux 3.2-rc1

.. with new name.  Because nothing says "really solid kernel release"
like naming it after an extinct animal that just happened to be in the
news lately.
tree c197b836ab6e8d832ddbf87ee31eb0f0d985821a
parent 72de182362e013b2c2cc92092d97fff58e429d5d
author Linus Torvalds <torvalds@linux-foundation.org> 1390185607 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1390185607 -0800

Linux 3.13
tree 5cd17c96bc429f53a93080740c935b9d71c1b028
parent 5c564705d3f0436ddc70d833b975b870ba560528
author Sasha Levin <alexander.levin@verizon.com> 1495926244 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1495967770 -0400

Linux 4.1.40

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 74371ce129b5a2a5c2b09cfede0355e0379f230b
parent e971461fc59e3823e1b8a01379ce55c3d2d89c31
author Linus Torvalds <torvalds@linux-foundation.org> 1269966279 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1269966279 -0700

Linux 2.6.34-rc3
tree a1cede93ecd05b4ba018fe7a6eeab8e44f768c45
parent a13af1a0b4bd0dcf7bd28eb802e49fdb6fcc4520
author David Hildenbrand <david@redhat.com> 1556256217 -0700
committer Sasha Levin <sashal@kernel.org> 1556838948 -0400

mm/memory_hotplug.c: drop memory device reference after find_memory_block()

[ Upstream commit 89c02e69fc5245f8a2f34b58b42d43a737af1a5e ]

Right now we are using find_memory_block() to get the node id for the
pfn range to online.  We are missing to drop a reference to the memory
block device.  While the device still gets unregistered via
device_unregister(), resulting in no user visible problem, the device is
never released via device_release(), resulting in a memory leak.  Fix
that by properly using a put_device().

Link: http://lkml.kernel.org/r/20190411110955.1430-1-david@redhat.com
Fixes: d0dc12e86b31 ("mm/memory_hotplug: optimize memory hotplug")
Signed-off-by: David Hildenbrand <david@redhat.com>
Reviewed-by: Oscar Salvador <osalvador@suse.de>
Reviewed-by: Wei Yang <richard.weiyang@gmail.com>
Acked-by: Michal Hocko <mhocko@suse.com>
Acked-by: Pankaj Gupta <pagupta@redhat.com>
Cc: David Hildenbrand <david@redhat.com>
Cc: Pavel Tatashin <pasha.tatashin@soleen.com>
Cc: Qian Cai <cai@lca.pw>
Cc: Arun KS <arunks@codeaurora.org>
Cc: Mathieu Malaterre <malat@debian.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 8c8020fbd9659fb5955c0f587fe65426ee31c7cf
parent 532df6f3faa66b28b9b053775f5fa33761b8104e
author Linus Torvalds <torvalds@linux-foundation.org> 1309820184 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1309820184 -0700

Linux 3.0-rc6
tree d9239c8dd2649c1747f76c9f9f1bbc930025292e
parent 4f7cbc3a59645e391758ef8dd585c7070bd60fbd
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1524777724 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 9a256e3020b5fc636435d5967c6f507e09b9a886
parent 925d45e43f603f4c298636a060ab0e74dd66af6a
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553815689 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree da62de18e2bc6c535a6f9b84d788819868f7a7a8
parent 0eccf60bfa9190d1588b2bf07d23d7b9b3a19d9e
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1202681894 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1202681894 -0800

Linux 2.6.25-rc1

.. and I really need to call it something else.  Maybe it is time to
bring back the weasel series, since weasels always make me feel good
about a kernel.
tree c050c4ac4381679d1b1acc6ecab11147e63633ce
parent e912c4abafa7d306539040b1a231d277fd750be8
author Sasha Levin <sasha.levin@oracle.com> 1461444400 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1461444400 -0400

Linux 3.18.32

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 02f8062cbb74636aa09732d507556fa233c78140
parent 96cd5b0856a25e2ec366702e1923070ffca53dae
author Linus Torvalds <torvalds@g5.osdl.org> 1122957948 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1122957948 -0700

Linux v2.6.13-rc5

Ok, let's get it right this time
tree e4264cf778df46da52962fd0b6602f8d35dc3270
parent f7d80d3451fefe91c6b2d3c540e6fa43eb242eaf
author Hugh Dickins <hughd@google.com> 1527897050 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1528231397 -0400

mm: fix the NULL mapping case in __isolate_lru_page()

[ Upstream commit 145e1a71e090575c74969e3daa8136d1e5b99fc8 ]

George Boole would have noticed a slight error in 4.16 commit
69d763fc6d3a ("mm: pin address_space before dereferencing it while
isolating an LRU page").  Fix it, to match both the comment above it,
and the original behaviour.

Although anonymous pages are not marked PageDirty at first, we have an
old habit of calling SetPageDirty when a page is removed from swap
cache: so there's a category of ex-swap pages that are easily
migratable, but were inadvertently excluded from compaction's async
migration in 4.16.

Link: http://lkml.kernel.org/r/alpine.LSU.2.11.1805302014001.12558@eggly.anvils
Fixes: 69d763fc6d3a ("mm: pin address_space before dereferencing it while isolating an LRU page")
Signed-off-by: Hugh Dickins <hughd@google.com>
Acked-by: Minchan Kim <minchan@kernel.org>
Acked-by: Mel Gorman <mgorman@techsingularity.net>
Reported-by:  Ivan Kalvachev <ikalvachev@gmail.com>
Cc: "Huang, Ying" <ying.huang@intel.com>
Cc: Jan Kara <jack@suse.cz>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 62801173fd720fe4e7850a6dbe56ebcdaf474867
parent 4c4d51a7316b164ba08af61aa0c124a88bc60450
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1175827016 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1175827016 -0700

Linux 2.6.21-rc6

.. perfect? Ahh, sure.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 11e65971909ac17584dad2ed18058be944556768
parent 875b7679abbb232b584f2eec59fa6e45690dd6c4
author Linus Torvalds <torvalds@linux-foundation.org> 1365392994 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1365392994 -0700

Linux 3.9-rc6
tree a56f5e61a081da06d29676a1677442e654d498eb
parent b7ffff4bb3fef527a26144a95d9dfe8c11a6b927
author Linus Torvalds <torvalds@linux-foundation.org> 1333236249 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1333236249 -0700

Linux 3.4-rc1
tree 448952ca4953d40e0eff9b56884fe6c0023e6d34
parent 4a5daceca1d96e949fc35f2f600de816862e8e74
author Linus Torvalds <torvalds@linux-foundation.org> 1243115220 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1243115220 -0700

Linux 2.6.30-rc7
tree 62f83768995b12b328dbb27b6900292ccb105bf5
parent 52135f132988284a8091940362c923218c409f57
author Sasha Levin <sasha.levin@oracle.com> 1443710345 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1443710345 -0400

Linux 3.18.22

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree e133ecc07c3cf503a71885720eeca53ce2b535bd
parent c59224d1326e56febd279032248c58672df0f14d
author Linus Torvalds <torvalds@linux-foundation.org> 1393815376 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1393815376 -0800

Linux 3.14-rc5
tree 51b6744618f8f4b3634dead9f3850825c07644a8
parent 88e237610b426897f0e9935adb6a60bd38bfe6c6
author Linus Torvalds <torvalds@linux-foundation.org> 1414367321 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1414367321 -0700

Linux 3.18-rc2
tree e5f4418ca368de890da4dbfef45fee31daf57714
parent 3e387fcdc485d94fe2c4b52e7c30c0c4cd1fe364
author Linus Torvalds <torvalds@linux-foundation.org> 1212635444 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1212635444 -0700

Linux 2.6.26-rc5
tree 5e4147807bb44381529ea7bc262529e2596f94aa
parent 7c348227ebc81cd1c2d5c5ec6cbb6f062a308250
author Pan Bian <bianpan2016@163.com> 1555659540 +0000
committer Sasha Levin <sashal@kernel.org> 1556839437 -0400

Input: synaptics-rmi4 - fix possible double free

[ Upstream commit bce1a78423961fce676ac65540a31b6ffd179e6d ]

The RMI4 function structure has been released in rmi_register_function
if error occurs. However, it will be released again in the function
rmi_create_function, which may result in a double-free bug.

Signed-off-by: Pan Bian <bianpan2016@163.com>
Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree ba122a638369be5041c3313936e13495ebe955fc
parent 363fa407c654591d95b4baaff5009e7790a80511
author Marc Zyngier <marc.zyngier@arm.com> 1535123194 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1536279361 -0400

ARM: rockchip: Force CONFIG_PM on Rockchip systems

[ Upstream commit d1558dfd9f22c99a5b8e1354ad881ee40749da89 ]

A number of the Rockchip-specific drivers (IOMMU, display controllers)
are now assuming that CONFIG_PM is set, and may completely misbehave
if that's not the case.

Since there is hardly any reason for this configuration option not
to be selected anyway, let's require it (in the same way Tegra already
does).

Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 086f3d6b72cb6b70ba451c78b8147231d54219c3
parent f815c335d21f9965f8dbe142fd168aaba1baf98e
author Linus Torvalds <torvalds@linux-foundation.org> 1252193892 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1252193892 -0700

Linux 2.6.31-rc9
tree 7eb7ec7ea61f2f12e555d2dd749977441e917083
parent 2de8221fa61f23481efef69aa9d8e5847222efa8
author Nicholas Piggin <npiggin@gmail.com> 1504240196 +1000
committer Sasha Levin <alexander.levin@verizon.com> 1513783345 -0500

cpuidle: fix broadcast control when broadcast can not be entered

[ Upstream commit f187851b9b4a76952b1158b86434563dd2031103 ]

When failing to enter broadcast timer mode for an idle state that
requires it, a new state is selected that does not require broadcast,
but the broadcast variable remains set. This causes
tick_broadcast_exit to be called despite not having entered broadcast
mode.

This causes the WARN_ON_ONCE(!irqs_disabled()) to trigger in some
cases. It does not appear to cause problems for code today, but seems
to violate the interface so should be fixed.

Signed-off-by: Nicholas Piggin <npiggin@gmail.com>
Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 595c4f590a522c1cd8f8c602b9bee931d4c5f730
parent d2899537bf0a5f5503401aa21fb0fbf5a0f95ce2
author Kangjie Lu <kjlu@umn.edu> 1552111451 -0600
committer Sasha Levin <sashal@kernel.org> 1555809994 -0400

leds: pca9532: fix a potential NULL pointer dereference

[ Upstream commit 0aab8e4df4702b31314a27ec4b0631dfad0fae0a ]

In case of_match_device cannot find a match, return -EINVAL to avoid
NULL pointer dereference.

Fixes: fa4191a609f2 ("leds: pca9532: Add device tree support")
Signed-off-by: Kangjie Lu <kjlu@umn.edu>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree 41cf8b4e0835adf522ab949d224b95f69137bed1
parent f200594275408fec382de740dfad205ba38d6317
author Randy Dunlap <rdunlap@infradead.org> 1535860888 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538240448 -0400

x86/pti: Fix section mismatch warning/error

[ Upstream commit ff924c5a1ec7548825cc2d07980b03be4224ffac ]

Fix the section mismatch warning in arch/x86/mm/pti.c:

WARNING: vmlinux.o(.text+0x6972a): Section mismatch in reference from the function pti_clone_pgtable() to the function .init.text:pti_user_pagetable_walk_pte()
The function pti_clone_pgtable() references
the function __init pti_user_pagetable_walk_pte().
This is often because pti_clone_pgtable lacks a __init
annotation or the annotation of pti_user_pagetable_walk_pte is wrong.
FATAL: modpost: Section mismatches detected.

Fixes: 85900ea51577 ("x86/pti: Map the vsyscall page if needed")
Reported-by: kbuild test robot <lkp@intel.com>
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Cc: Andy Lutomirski <luto@kernel.org>
Link: https://lkml.kernel.org/r/43a6d6a3-d69d-5eda-da09-0b1c88215a2a@infradead.org
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 092b188ee10de0b0196869de05513beda305c82a
parent a2ff82065b5b2807e699995671dc282be20ce8fd
author Linus Torvalds <torvalds@linux-foundation.org> 1382915523 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1382915523 -0700

Linux 3.12-rc7
tree 48831c32e767cdd2f018b32a0b0b4d39b5cfab8a
parent 26b840ae5d5140fe7b2226098826c449e63de072
author Linus Torvalds <torvalds@linux-foundation.org> 1368317648 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1368317648 -0700

Linux 3.10-rc1
tree e9f7b991775a88f2ce96ce4c99e9fda3447d4442
parent 3b14279924b57534832b3c1a0f5b890191777c4e
author Sasha Levin <sasha.levin@oracle.com> 1465254791 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1465254791 -0400

Linux 4.1.26

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 3b3d8f5696f75926524cd4bb36fd37c9ec818198
parent ae29a18594c40a344ddd5bcd6abe575786a5d978
author Linus Torvalds <torvalds@linux-foundation.org> 1225664239 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1225664239 -0800

Linux v2.6.28-rc3
tree ae68201f7e7e9f8b732e12ef5a3fc28cdbe8d771
parent 03df25dc0313fbde19534a187eec5829eb16dbc6
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1203109040 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1203109040 -0800

Linux 2.6.25-rc2
tree 36cc9eb30b1a8ea41263c9744c5ae0edeb52e546
parent 116c75f642ad4a6d267f399c9f1fe8b91fb822c5
author Sasha Levin <sasha.levin@oracle.com> 1468433866 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1468433866 -0400

Linux 4.1.28

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 71daa84189706ca8d99c1458fd89e0e6b931d131
parent 3a8b2732d895442119da2ed469f26cc2d9d3f3f0
author Hugh Dickins <hughd@google.com> 1527897050 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1528231459 -0400

mm: fix the NULL mapping case in __isolate_lru_page()

[ Upstream commit 145e1a71e090575c74969e3daa8136d1e5b99fc8 ]

George Boole would have noticed a slight error in 4.16 commit
69d763fc6d3a ("mm: pin address_space before dereferencing it while
isolating an LRU page").  Fix it, to match both the comment above it,
and the original behaviour.

Although anonymous pages are not marked PageDirty at first, we have an
old habit of calling SetPageDirty when a page is removed from swap
cache: so there's a category of ex-swap pages that are easily
migratable, but were inadvertently excluded from compaction's async
migration in 4.16.

Link: http://lkml.kernel.org/r/alpine.LSU.2.11.1805302014001.12558@eggly.anvils
Fixes: 69d763fc6d3a ("mm: pin address_space before dereferencing it while isolating an LRU page")
Signed-off-by: Hugh Dickins <hughd@google.com>
Acked-by: Minchan Kim <minchan@kernel.org>
Acked-by: Mel Gorman <mgorman@techsingularity.net>
Reported-by:  Ivan Kalvachev <ikalvachev@gmail.com>
Cc: "Huang, Ying" <ying.huang@intel.com>
Cc: Jan Kara <jack@suse.cz>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 15d8d144bb8ab33bf02c68b42f3b7c78e4bd0e73
parent 12b3052c3ee8f508b2c7ee4ddd63ed03423409d8
author Linus Torvalds <torvalds@linux-foundation.org> 1289874662 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1289874662 -0800

Linux 2.6.37-rc2
tree 617319dc75f7a1b991019ef0f35b611738a6d6e3
parent bdbecac0f324e736b3ee94da918aee1c898690b4
author Lucas Stach <l.stach@pengutronix.de> 1555084780 +0200
committer Sasha Levin <sashal@kernel.org> 1556839580 -0400

gpu: ipu-v3: dp: fix CSC handling

[ Upstream commit d4fad0a426c6e26f48c9a7cdd21a7fe9c198d645 ]

Initialize the flow input colorspaces to unknown and reset to that value
when the channel gets disabled. This avoids the state getting mixed up
with a previous mode.

Also keep the CSC settings for the background flow intact when disabling
the foreground flow.

Root-caused-by: Jonathan Marek <jonathan@marek.ca>
Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 1770995319d18ff4148a6c0f0acef8b5f42989f2
parent 29a30581e43fb58264a8cca4af23f3f9260c2caa
author Marc Zyngier <marc.zyngier@arm.com> 1535123194 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1535870083 -0400

ARM: rockchip: Force CONFIG_PM on Rockchip systems

[ Upstream commit d1558dfd9f22c99a5b8e1354ad881ee40749da89 ]

A number of the Rockchip-specific drivers (IOMMU, display controllers)
are now assuming that CONFIG_PM is set, and may completely misbehave
if that's not the case.

Since there is hardly any reason for this configuration option not
to be selected anyway, let's require it (in the same way Tegra already
does).

Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 74c9cebb6f06c88cd15dcdf0dc645f9bdcb134bf
parent 4cea8706c39023f5f721c88dd0ae17a097a39c98
author Linus Torvalds <torvalds@linux-foundation.org> 1276308844 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1276308844 -0700

Linux 2.6.35-rc3
tree ff3a3a49d509ac5b75221c2e201a92f98cab237f
parent 0085e4adf97ac0f25835a5925cebca91fa4fb5af
author Coly Li <colyli@suse.de> 1549687986 +0800
committer Sasha Levin <sashal@kernel.org> 1553647601 -0400

bcache: fix potential div-zero error of writeback_rate_p_term_inverse

[ Upstream commit 5b5fd3c94eef69dcfaa8648198e54c92e5687d6d ]

Current code already uses d_strtoul_nonzero() to convert input string
to an unsigned integer, to make sure writeback_rate_p_term_inverse
won't be zero value. But overflow may happen when converting input
string to an unsigned integer value by d_strtoul_nonzero(), then
dc->writeback_rate_p_term_inverse can still be set to 0 even if the
sysfs file input value is not zero, e.g. 4294967296 (a.k.a UINT_MAX+1).

If dc->writeback_rate_p_term_inverse is set to 0, it might cause a
dev-zero error in following code from __update_writeback_rate(),
	int64_t proportional_scaled =
		div_s64(error, dc->writeback_rate_p_term_inverse);

This patch replaces d_strtoul_nonzero() by sysfs_strtoul_clamp() and
limit the value range in [1, UINT_MAX]. Then the unsigned integer
overflow and dev-zero error can be avoided.

Signed-off-by: Coly Li <colyli@suse.de>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 3e9302ab09c9a9068fd8fd80708ef3a35b55e665
parent 93cb463141d50e4c6a574efc2c6e4d6d76ffed77
author Linus Torvalds <torvalds@linux-foundation.org> 1273455388 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1273455388 -0700

Linux 2.6.34-rc7
tree ffca07ffcfc481b43bbe6f0ba17ae887430b887a
parent 41c3e45f08201df41423aa1bbce272372a6967e4
author Linus Torvalds <torvalds@linux-foundation.org> 1219963922 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1219963922 -0700

Linux 2.6.27-rc5
tree 8473a03e0987053625ca1135f80eb290d4a08ee9
parent c5b8105d0ab537d6a20f3150539431bd31f2df2c
author Yangbo Lu <yangbo.lu@nxp.com> 1515466953 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517680689 -0500

net: gianfar_ptp: move set_fipers() to spinlock protecting area

[ Upstream commit 11d827a993a969c3c6ec56758ff63a44ba19b466 ]

set_fipers() calling should be protected by spinlock in
case that any interrupt breaks related registers setting
and the function we expect. This patch is to move set_fipers()
to spinlock protecting area in ptp_gianfar_adjtime().

Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
Acked-by: Richard Cochran <richardcochran@gmail.com>
Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree a3658f181a20ea5f0c7929c49c8faa46da03fd22
parent 81d92dc117bf9954f24a8d88c2d1ef26bd13ecc7
author Linus Torvalds <torvalds@linux-foundation.org> 1414969311 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1414969311 -0800

Linux 3.18-rc3
tree af24ecb2dbbc483263589fba0b50e1d693aed979
parent 6538d625215f29671864649336645dea19214135
author Linus Torvalds <torvalds@linux-foundation.org> 1400708522 +0900
committer Linus Torvalds <torvalds@linux-foundation.org> 1400708522 +0900

Linux 3.15-rc6
tree 03d47060424d7f8ab33f8367f691495c6e44bb10
parent 757e3682fdf0bd2eb941c7979c8ae7428f785340
author Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com> 1506433447 -0700
committer Sasha Levin <alexander.levin@verizon.com> 1513783140 -0500

IB/opa_vnic: Properly return the total MACs in UC MAC list

[ Upstream commit b77eb45e0d9c324245d165656ab3b38b6f386436 ]

Do not include EM specified MAC address in total MACs of the
UC MAC list.

Reviewed-by: Sudeep Dutt <sudeep.dutt@intel.com>
Signed-off-by: Niranjana Vishwanathapura <niranjana.vishwanathapura@intel.com>
Signed-off-by: Dennis Dalessandro <dennis.dalessandro@intel.com>
Signed-off-by: Doug Ledford <dledford@redhat.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree e757ad78d339a141a8fa975aec411a5c623f15df
parent bd8c540fe867c070810a3ef55541f41f7c189c9a
author Linus Torvalds <torvalds@linux-foundation.org> 1214359100 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1214359100 -0700

Linux 2.6.26-rc8
tree 065acf98a54960121c26269c51478f8acc10ef63
parent d235a4febb76a797f017836e19a952129b50b087
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553901803 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 8d490c389d08035d6c1a926d9b89b3b07f0edf7d
parent 39923134885759405e64cb9491a273a2bcd356ed
author Linus Torvalds <torvalds@linux-foundation.org> 1360358439 +1100
committer Linus Torvalds <torvalds@linux-foundation.org> 1360358439 +1100

Linux 3.8-rc7
tree 34f1cf29ac5acec0c09566dcf792a1a32d96e813
parent 097cc62283455668ad0b35c72920c6373f45c2ab
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1190242873 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1190242873 -0700

Linux 2.6.23-rc7
tree e68a70137d32a4db925952e578e026bfb7105f7b
parent 0d815142d1988899c97514a25ce5a9f4880e7fc8
author Linus Torvalds <torvalds@linux-foundation.org> 1228190363 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1228190363 -0800

Linux 2.6.28-rc7
tree db26c088646fc301cf55b57a021854c346059ff0
parent 69d1d523cc961b6f3c2fe313694263fc81ada231
author Linus Torvalds <torvalds@linux-foundation.org> 1205710334 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1205710334 -0700

Linux 2.6.25-rc6
tree 5f08f98a570d3d8af283d529a2b145a270f62805
parent cbfa66b88d5720b81b75e72e7de8116d338e6b30
author Linus Torvalds <torvalds@linux-foundation.org> 1213305744 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1213305744 -0700

Linux 2.6.26-rc6

.. and a new name, courtesy of Alan.
tree 0183d4dd7d48c5febb6201c0f5bd5d42393480b0
parent 3ec2f3f4a2a7cb57e64802ea51f294df93b33cb4
author Paul Moore <paul@paul-moore.com> 1504273474 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1513038888 -0500

audit: ensure that 'audit=1' actually enables audit for PID 1

[ Upstream commit 173743dd99a49c956b124a74c8aacb0384739a4c ]

Prior to this patch we enabled audit in audit_init(), which is too
late for PID 1 as the standard initcalls are run after the PID 1 task
is forked.  This means that we never allocate an audit_context (see
audit_alloc()) for PID 1 and therefore miss a lot of audit events
generated by PID 1.

This patch enables audit as early as possible to help ensure that when
PID 1 is forked it can allocate an audit_context if required.

Reviewed-by: Richard Guy Briggs <rgb@redhat.com>
Signed-off-by: Paul Moore <paul@paul-moore.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree adca75b632334d241b085a2ed8a04e4596fa5dc1
parent 6823cfe5531f7507cca5699cda4abd0f65a78bcf
author Linus Torvalds <torvalds@linux-foundation.org> 1243998445 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1243998445 -0700

Linux 2.6.30-rc8
tree 8f12c6be5d30527845c443b51048c183363fcf81
parent 5b064423d66159a1b33ff9d5bcb42040a03e7dfe
author Linus Torvalds <torvalds@g5.osdl.org> 1162952660 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1162952660 -0800

Linux 2.6.19-rc5

Ok, things are clearly starting to calm down.. Finally.
tree d91bf775f72f9b7fd14a9378b0adee2b61926f81
parent a6f841058dfb616bebc6b6594de90991b810fe15
author Mika Westerberg <mika.westerberg@linux.intel.com> 1535619013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1538240467 -0400

i2c: i801: Allow ACPI AML access I/O ports not reserved for SMBus

[ Upstream commit 7fd6d98b89f382d414e1db528e29a67bbd749457 ]

Commit 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict
with PCI BAR") made it possible for AML code to access SMBus I/O ports
by installing custom SystemIO OpRegion handler and blocking i80i driver
access upon first AML read/write to this OpRegion.

However, while ThinkPad T560 does have SystemIO OpRegion declared under
the SMBus device, it does not access any of the SMBus registers:

    Device (SMBU)
    {
        ...

        OperationRegion (SMBP, PCI_Config, 0x50, 0x04)
        Field (SMBP, DWordAcc, NoLock, Preserve)
        {
            ,   5,
            TCOB,   11,
            Offset (0x04)
        }

        Name (TCBV, 0x00)
        Method (TCBS, 0, NotSerialized)
        {
            If ((TCBV == 0x00))
            {
            TCBV = (\_SB.PCI0.SMBU.TCOB << 0x05)
            }

            Return (TCBV) /* \_SB_.PCI0.SMBU.TCBV */
        }

        OperationRegion (TCBA, SystemIO, TCBS (), 0x10)
        Field (TCBA, ByteAcc, NoLock, Preserve)
        {
            Offset (0x04),
            ,   9,
            CPSC,   1
        }
    }

Problem with the current approach is that it blocks all I/O port access
and because this system has touchpad connected to the SMBus controller
after first AML access (happens during suspend/resume cycle) the
touchpad fails to work anymore.

Fix this so that we allow ACPI AML I/O port access if it does not touch
the region reserved for the SMBus.

Fixes: 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict with PCI BAR")
Link: https://bugzilla.kernel.org/show_bug.cgi?id=200737
Reported-by: Yussuf Khalil <dev@pp3345.net>
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Reviewed-by: Jean Delvare <jdelvare@suse.de>
Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b35ba480452c66b7d4c4b5b4e2ced7f02c95ba04
parent 4287d3eab4e0435737c6406c45429bf51f6ba189
author Reinette Chatre <reinette.chatre@intel.com> 1508491018 -0700
committer Sasha Levin <alexander.levin@verizon.com> 1513038726 -0500

x86/intel_rdt: Fix potential deadlock during resctrl unmount

[ Upstream commit 36b6f9fcb8928c06b6638a4cf91bc9d69bb49aa2 ]

Lockdep warns about a potential deadlock:

[   66.782842] ======================================================
[   66.782888] WARNING: possible circular locking dependency detected
[   66.782937] 4.14.0-rc2-test-test+ #48 Not tainted
[   66.782983] ------------------------------------------------------
[   66.783052] umount/336 is trying to acquire lock:
[   66.783117]  (cpu_hotplug_lock.rw_sem){++++}, at: [<ffffffff81032395>] rdt_kill_sb+0x215/0x390
[   66.783193]
               but task is already holding lock:
[   66.783244]  (rdtgroup_mutex){+.+.}, at: [<ffffffff810321b6>] rdt_kill_sb+0x36/0x390
[   66.783305]
               which lock already depends on the new lock.

[   66.783364]
               the existing dependency chain (in reverse order) is:
[   66.783419]
               -> #3 (rdtgroup_mutex){+.+.}:
[   66.783467]        __lock_acquire+0x1293/0x13f0
[   66.783509]        lock_acquire+0xaf/0x220
[   66.783543]        __mutex_lock+0x71/0x9b0
[   66.783575]        mutex_lock_nested+0x1b/0x20
[   66.783610]        intel_rdt_online_cpu+0x3b/0x430
[   66.783649]        cpuhp_invoke_callback+0xab/0x8e0
[   66.783687]        cpuhp_thread_fun+0x7a/0x150
[   66.783722]        smpboot_thread_fn+0x1cc/0x270
[   66.783764]        kthread+0x16e/0x190
[   66.783794]        ret_from_fork+0x27/0x40
[   66.783825]
               -> #2 (cpuhp_state){+.+.}:
[   66.783870]        __lock_acquire+0x1293/0x13f0
[   66.783906]        lock_acquire+0xaf/0x220
[   66.783938]        cpuhp_issue_call+0x102/0x170
[   66.783974]        __cpuhp_setup_state_cpuslocked+0x154/0x2a0
[   66.784023]        __cpuhp_setup_state+0xc7/0x170
[   66.784061]        page_writeback_init+0x43/0x67
[   66.784097]        pagecache_init+0x43/0x4a
[   66.784131]        start_kernel+0x3ad/0x3f7
[   66.784165]        x86_64_start_reservations+0x2a/0x2c
[   66.784204]        x86_64_start_kernel+0x72/0x75
[   66.784241]        verify_cpu+0x0/0xfb
[   66.784270]
               -> #1 (cpuhp_state_mutex){+.+.}:
[   66.784319]        __lock_acquire+0x1293/0x13f0
[   66.784355]        lock_acquire+0xaf/0x220
[   66.784387]        __mutex_lock+0x71/0x9b0
[   66.784419]        mutex_lock_nested+0x1b/0x20
[   66.784454]        __cpuhp_setup_state_cpuslocked+0x52/0x2a0
[   66.784497]        __cpuhp_setup_state+0xc7/0x170
[   66.784535]        page_alloc_init+0x28/0x30
[   66.784569]        start_kernel+0x148/0x3f7
[   66.784602]        x86_64_start_reservations+0x2a/0x2c
[   66.784642]        x86_64_start_kernel+0x72/0x75
[   66.784678]        verify_cpu+0x0/0xfb
[   66.784707]
               -> #0 (cpu_hotplug_lock.rw_sem){++++}:
[   66.784759]        check_prev_add+0x32f/0x6e0
[   66.784794]        __lock_acquire+0x1293/0x13f0
[   66.784830]        lock_acquire+0xaf/0x220
[   66.784863]        cpus_read_lock+0x3d/0xb0
[   66.784896]        rdt_kill_sb+0x215/0x390
[   66.784930]        deactivate_locked_super+0x3e/0x70
[   66.784968]        deactivate_super+0x40/0x60
[   66.785003]        cleanup_mnt+0x3f/0x80
[   66.785034]        __cleanup_mnt+0x12/0x20
[   66.785070]        task_work_run+0x8b/0xc0
[   66.785103]        exit_to_usermode_loop+0x94/0xa0
[   66.786804]        syscall_return_slowpath+0xe8/0x150
[   66.788502]        entry_SYSCALL_64_fastpath+0xab/0xad
[   66.790194]
               other info that might help us debug this:

[   66.795139] Chain exists of:
                 cpu_hotplug_lock.rw_sem --> cpuhp_state --> rdtgroup_mutex

[   66.800035]  Possible unsafe locking scenario:

[   66.803267]        CPU0                    CPU1
[   66.804867]        ----                    ----
[   66.806443]   lock(rdtgroup_mutex);
[   66.808002]                                lock(cpuhp_state);
[   66.809565]                                lock(rdtgroup_mutex);
[   66.811110]   lock(cpu_hotplug_lock.rw_sem);
[   66.812608]
                *** DEADLOCK ***

[   66.816983] 2 locks held by umount/336:
[   66.818418]  #0:  (&type->s_umount_key#35){+.+.}, at: [<ffffffff81229738>] deactivate_super+0x38/0x60
[   66.819922]  #1:  (rdtgroup_mutex){+.+.}, at: [<ffffffff810321b6>] rdt_kill_sb+0x36/0x390

When the resctrl filesystem is unmounted the locks should be obtain in the
locks in the same order as was done when the cpus came online:

      cpu_hotplug_lock before rdtgroup_mutex.

This also requires to switch the static_branch_disable() calls to the
_cpulocked variant because now cpu hotplug lock is held already.

[ tglx: Switched to cpus_read_[un]lock ]

Signed-off-by: Reinette Chatre <reinette.chatre@intel.com>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Tested-by: Sai Praneeth Prakhya <sai.praneeth.prakhya@intel.com>
Acked-by: Vikas Shivappa <vikas.shivappa@linux.intel.com>
Acked-by: Fenghua Yu <fenghua.yu@intel.com>
Acked-by: Tony Luck <tony.luck@intel.com>
Link: https://lkml.kernel.org/r/cc292e76be073f7260604651711c47b09fd0dc81.1508490116.git.reinette.chatre@intel.com
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree a466bc8fd608b71271c2338cf92ea39920fcc0ec
parent da7a05331943f70380ceb71a6e2d462d6196334c
author Sasha Levin <sasha.levin@oracle.com> 1427159112 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1427159112 -0400

Linux 3.18.10

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 8d43d36d2c087e48148f0a5da2d733b090a5aa67
parent eae936e21bd726f9d9555f2262d439fbcd61dccf
author Linus Torvalds <torvalds@ppc970.osdl.org> 1118071349 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1118071349 -0700

Linux 2.6.12-rc6

Getting ready for the real release..
tree 28b5c4f5ae4d180e89271290d91a900676b6a357
parent 4551cc9e39cf744468224327d99542941758cf14
author Alexander Levin <alexander.levin@verizon.com> 1489752588 -0400
committer Alexander Levin <alexander.levin@verizon.com> 1489752588 -0400

Notes added by 'git notes append'
tree 24b8bb342576f543dac42d59821c4feb7ce07453
parent e9cf59aeeea49ae84ffcf0e28699b46d705e85f0
author Linus Torvalds <torvalds@linux-foundation.org> 1361231914 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1361231914 -0800

Linux 3.8
tree 4e84c95cb2c32f42a6a61f952e239a8190524db3
parent 16d983539809524973ea912eb7efeceb5ac37289
author Michael Neuling <mikey@neuling.org> 1537868207 +1000
committer Sasha Levin <sashal@kernel.org> 1539640936 -0400

powerpc/tm: Avoid possible userspace r1 corruption on reclaim

[ Upstream commit 96dc89d526ef77604376f06220e3d2931a0bfd58 ]

Current we store the userspace r1 to PACATMSCRATCH before finally
saving it to the thread struct.

In theory an exception could be taken here (like a machine check or
SLB miss) that could write PACATMSCRATCH and hence corrupt the
userspace r1. The SLB fault currently doesn't touch PACATMSCRATCH, but
others do.

We've never actually seen this happen but it's theoretically
possible. Either way, the code is fragile as it is.

This patch saves r1 to the kernel stack (which can't fault) before we
turn MSR[RI] back on. PACATMSCRATCH is still used but only with
MSR[RI] off. We then copy r1 from the kernel stack to the thread
struct once we have MSR[RI] back on.

Suggested-by: Breno Leitao <leitao@debian.org>
Signed-off-by: Michael Neuling <mikey@neuling.org>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 2e286e1f48d83a4525ed07c6e2bcc0d25f509f79
parent 39d709392ffc1d05f825191b07b7d865d434f282
author Linus Torvalds <torvalds@linux-foundation.org> 1284332857 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1284332857 -0700

Linux 2.6.36-rc4
tree c4540211d0cef9c88d96f30f89ac4b9c1a570683
parent 91cd99f677ada2af90b06cb1f59e99f27ade5740
author Linus Torvalds <torvalds@linux-foundation.org> 1221002869 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1221002869 -0700

Linux 2.6.27-rc6
tree 9d85f8c098498c0b2eb301c4bc593d704acf42c8
parent b18262eda36e1f340e3c29a8da9a36b3452621f9
author Linus Torvalds <torvalds@linux-foundation.org> 1272596525 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1272596525 -0700

Linux 2.6.34-rc6
tree 33fba2d21e08f0bccacf3fa8b644fd82acf1043c
parent 1b3de3099f320a7e5e534953a2a4a1b524e5f29d
author Miaoqing Pan <miaoqing@codeaurora.org> 1506474814 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1513265131 -0500

ath9k: fix tx99 potential info leak

[ Upstream commit ee0a47186e2fa9aa1c56cadcea470ca0ba8c8692 ]

When the user sets count to zero the string buffer would remain
completely uninitialized which causes the kernel to parse its
own stack data, potentially leading to an info leak. In addition
to that, the string might be not terminated properly when the
user data does not contain a 0-terminator.

Signed-off-by: Miaoqing Pan <miaoqing@codeaurora.org>
Reviewed-by: Christoph Böhmwalder <christoph@boehmwalder.at>
Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 711b4756a2cfc90c073af0811a3aec22dbb221ea
parent a22681fabb1564d00d54e804ec95ba9330d857ed
author Linus Torvalds <torvalds@linux-foundation.org> 1324705866 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1324705866 -0800

Linux 3.2-rc7
tree e42294de789e82e4276f1b52f0726bf2bff9ea88
parent cf1ec3481462f9bb25f4f48cce68803b7cac90af
author Matthew Wilcox <willy@infradead.org> 1554498130 -0700
committer Sasha Levin <sashal@kernel.org> 1556287061 -0400

fs: prevent page refcount overflow in pipe_buf_get

[ Upstream commit 15fab63e1e57be9fdb5eec1bbc5916e9825e9acb ]

Change pipe_buf_get() to return a bool indicating whether it succeeded
in raising the refcount of the page (if the thing in the pipe is a page).
This removes another mechanism for overflowing the page refcount.  All
callers converted to handle a failure.

Reported-by: Jann Horn <jannh@google.com>
Signed-off-by: Matthew Wilcox <willy@infradead.org>
Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 40916c8b2d93ec8afcc25980d08c17fe520cd91f
parent 9a5eca1e5ec4ed4ef1d29a4900cd5933c3c5e1a1
author Hugues Fruchet <hugues.fruchet@st.com> 1536673701 -0400
committer Sasha Levin <sashal@kernel.org> 1541992196 -0500

media: ov5640: fix restore of last mode set

[ Upstream commit 985cdcb08a0488558d1005139596b64d73bee267 ]

Mode setting depends on last mode set, in particular
because of exposure calculation when downscale mode
change between subsampling and scaling.
At stream on the last mode was wrongly set to current mode,
so no change was detected and exposure calculation
was not made, fix this.

Signed-off-by: Hugues Fruchet <hugues.fruchet@st.com>
Reviewed-by: Jacopo Mondi <jacopo@jmondi.org>
Tested-by: Jacopo Mondi <jacopo@jmondi.org>
Signed-off-by: Sakari Ailus <sakari.ailus@linux.intel.com>
Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 97470e26cfe572a85d180a1e0fdcd82f2f5896fb
parent e99b51c79b3f30056a1545ced3a65867edd4d3aa
author José Roberto de Souza <jose.souza@intel.com> 1522276237 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1532724427 -0400

drm: Add DP PSR2 sink enable bit

[ Upstream commit 4f212e40468650e220c1770876c7f25b8e0c1ff5 ]

To comply with eDP1.4a this bit should be set when enabling PSR2.

Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Reviewed-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20180328223046.16125-1-jose.souza@intel.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1f90a6eeca36f5e758a162371bf17714fe9d6fbb
parent e0b9d139f2595fafbe95fcb7b40109db724900e8
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1190680390 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1190680390 -0700

Linux 2.6.23-rc8

Getting there...
tree e0b1138164146495be6a577ce39c333b9a0b7e4c
parent 912afc3616b94c5c4af584972c7f5903b53cf15a
author Linus Torvalds <torvalds@linux-foundation.org> 1338686966 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1338686966 -0700

Linux 3.5-rc1
tree 7eecaf7e01e921db23027143851694dec6cdd748
parent 0be952c13be80ccdd3cb0d1ba25099de9468ac1b
parent a9b1b455c519ee2fd6a4f9c069511e67b5be1ac4
author Linus Torvalds <torvalds@linux-foundation.org> 1426352541 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1426352541 -0700
mergetag object a9b1b455c519ee2fd6a4f9c069511e67b5be1ac4
 type commit
 tag locks-v4.0-4
 tagger Jeff Layton <jeff.layton@primarydata.com> 1426351769 -0400
 
 File locking related fix for v4.0 (#4)
 -----BEGIN PGP SIGNATURE-----
 Version: GnuPG v1
 
 iQIcBAABAgAGBQJVBGaxAAoJEAAOaEEZVoIV9XgP/38ZN45ghfnkOCkJbWanlwQj
 E/zGcuVAuENwWFOjW1aWoOoZ010cy79cnygcr2pR6Rp0FXayLZYmfOaes0hDJt5M
 YiWE86B4vDsqhWqAehmvW4x/N0Q+LIMr1w3YwpZv8i/gr18vvvDaA4D60as7fdA5
 j0jI6KH7Dxk8xOduU5t9aSepZei+EgjIA7h/K/f7SNd3dVaSsIt5IGLPAzG0XVZl
 gsq2/R8LF9mEZgaUa8NZVzHlrwMk2hPn/JVT52nkuk/YXDYIkkLgtvYgI3RTq8Ob
 D2EI5RFhL+Qj4xTaZRcS2w+sElg4+VP0n5woSlqFGCIEa1xBOkGkXT5uT/XbDQF9
 z8m+ycscclMrr3xlzBlH+0UhyUqFGwj7wPPhkcqRJRUbL7+moI1k/14gOne/fkAU
 4hBEVu7RTADa0YcqeCiEq3EG/KGY8BIB/sf9XGOOfFd8gbro7zFfQEGaxCjjbNwA
 thwbBJueKO5Mps1oUkN7QUMXl+ElL3N7u4McdAthrOeRWt6+UQVhJpmCeukCPdSN
 EU2Ju8ZEFSuza5OiMjz8wuGPoHWadddiAnMtqxOHJUMoaL+ZuWExTvH0JzFg83Jv
 pNmaO0UC8JwFYpeJldkBlo9qJ/iqlmy2Rby4oiuCTJFbdOFdtW0hr9ZsvOuofGyt
 R8TgLrd+smcja1+bks6o
 =Qx9q
 -----END PGP SIGNATURE-----

Merge tag 'locks-v4.0-4' of git://git.samba.org/jlayton/linux

Pull file locking bugfix from Jeff Layton:
 "Just a small fix for a potential problem in one of the lease
  tracepoints"

* tag 'locks-v4.0-4' of git://git.samba.org/jlayton/linux:
  locks: fix generic_delete_lease tracepoint to use victim pointer
tree aeb2bc7a3936ccc5c2bea804c8d7589a702a9c3a
parent 079cb644eef18435c64d67cd0b3e0db833bdc450
author Russell King <rmk+kernel@armlinux.org.uk> 1523467441 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1528164696 -0400

ARM: kexec: fix kdump register saving on panic()

[ Upstream commit 2d7b3c64431245c95b05a441669c074da10db943 ]

When a panic() occurs, the kexec code uses smp_send_stop() to stop
the other CPUs, but this results in the CPU register state not being
saved, and gdb is unable to inspect the state of other CPUs.

Commit 0ee59413c967 ("x86/panic: replace smp_send_stop() with kdump
friendly version in panic path") addressed the issue on x86, but
ignored other architectures.  Address the issue on ARM by splitting
out the crash stop implementation to crash_smp_send_stop() and
adding the necessary protection.

Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ae7e618dd437c511c8352bfceb896451f9fba7af
parent cac5e8f4791997a95521012b29e656171c4ab90d
author Sasha Levin <alexander.levin@verizon.com> 1474152926 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1474152926 -0400

Linux 3.18.42

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 7c1284e012f57ed75537d41d320899ab836f20bc
parent a607a1143a58dcd31396649812df5cd3bb0d4294
author Linus Torvalds <torvalds@linux-foundation.org> 1364082764 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1364082764 -0700

Linux 3.9-rc4
tree fd62bdb89d3a5d74675c75d46a22731659b684a5
parent 55db493b65c7b6bb5d7bd3dd3c8a2fe13f5dc09c
author Linus Torvalds <torvalds@linux-foundation.org> 1261098880 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1261098880 -0800

Linux 2.6.33-rc1
tree e846a230c96a8ae7b29924569cb4d2cc1b2e54e3
parent 7874d35173d549c1a2b2f77c4b1f94379fa65698
author Linus Torvalds <torvalds@linux-foundation.org> 1217299231 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1217299231 -0700

Linux 2.6.27-rc1
tree 704ffec9216a886f849d09e50f96b273b56006aa
parent f087000a12ced3ee1c320b71cd38de75c56a7e7a
author Sasha Levin <alexander.levin@verizon.com> 1484765480 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1484765480 -0500

Linux 3.18.47

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 212e713d1b3ad856f998f839d719badf26c4095d
parent e5fcdb7ed856b714c878ad470040fe832cbe462b
author Linus Torvalds <torvalds@linux-foundation.org> 1292959600 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1292959600 -0800

Linux 2.6.37-rc7
tree 03b8d02466019ecb0d54601262a9366cd1876b21
parent f615db92784cac33a2ba9ea76967dbdf73ee72ec
author jie@chenjie6@huwei.com <jie@chenjie6@huwei.com> 1533946986 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1534601822 -0400

mm/memory.c: check return value of ioremap_prot

[ Upstream commit 24eee1e4c47977bdfb71d6f15f6011e7b6188d04 ]

ioremap_prot() can return NULL which could lead to an oops.

Link: http://lkml.kernel.org/r/1533195441-58594-1-git-send-email-chenjie6@huawei.com
Signed-off-by: chen jie <chenjie6@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Li Zefan <lizefan@huawei.com>
Cc: chenjie <chenjie6@huawei.com>
Cc: Yang Shi <shy828301@gmail.com>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1bab59ac704117935364cf5be45432c7bd599d36
parent db3c0c12494a24ac94c4880911cd5464e2690182
author Douglas Anderson <dianders@chromium.org> 1530572379 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1537411206 -0400

pinctrl: qcom: spmi-gpio: Fix pmic_gpio_config_get() to be compliant

[ Upstream commit 1cf86bc21257a330e3af51f2a4e885f1a705f6a5 ]

If you do this on an sdm845 board:
  grep "" /sys/kernel/debug/pinctrl/*spmi:pmic*/pinconf-groups

...it looks like nonsense.  For every pin you see listed:
  input bias disabled, input bias high impedance, input bias pull down, input bias pull up, ...

That's because pmic_gpio_config_get() isn't complying with the rules
that pinconf_generic_dump_one() expects.  Specifically for boolean
parameters (anything with a "struct pin_config_item" where has_arg is
false) the function expects that the function should return its value
not through the "config" parameter but should return "0" if the value
is set and "-EINVAL" if the value isn't set.

Let's fix this.

From a quick sample of other pinctrl drivers, it appears to be
tradition to also return 1 through the config parameter for these
boolean parameters when they exist.  I'm not one to knock tradition,
so I'll follow tradition and return 1 in these cases.  While I'm at
it, I'll also continue searching for four leaf clovers, kocking on
wood three times, and trying not to break mirrors.

NOTE: This also fixes an apparent typo for reading
PIN_CONFIG_BIAS_DISABLE where the old driver was accidentally
using "=" instead of "==" and thus was setting some internal
state when you tried to query PIN_CONFIG_BIAS_DISABLE.  Oops.

Fixes: eadff3024472 ("pinctrl: Qualcomm SPMI PMIC GPIO pin controller driver")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 0e6d05c826c8f0c3f12659b37108a4b8b35feb5b
parent 04e54522398956265550faca5a9a04ff30bfc2d5
author Rasmus Villemoes <linux@rasmusvillemoes.dk> 1552572374 +0100
committer Sasha Levin <sashal@kernel.org> 1555809900 -0400

leds: trigger: netdev: use memcpy in device_name_store

[ Upstream commit 909346433064b8d840dc82af26161926b8d37558 ]

If userspace doesn't end the input with a newline (which can easily
happen if the write happens from a C program that does write(fd,
iface, strlen(iface))), we may end up including garbage from a
previous, longer value in the device_name. For example

# cat device_name

# printf 'eth12' > device_name
# cat device_name
eth12
# printf 'eth3' > device_name
# cat device_name
eth32

I highly doubt anybody is relying on this behaviour, so switch to
simply copying the bytes (we've already checked that size is <
IFNAMSIZ) and unconditionally zero-terminate it; of course, we also
still have to strip a trailing newline.

This is also preparation for future patches.

Fixes: 06f502f57d0d ("leds: trigger: Introduce a NETDEV trigger")
Signed-off-by: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Acked-by: Pavel Machek <pavel@ucw.cz>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree a57bc2d9a58e26144c30645e148d9b00242738f4
parent 8f6544edb2c7a7464fbbce1d86a4de414dc0cf95
author Linus Torvalds <torvalds@linux-foundation.org> 1314038573 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1314038573 -0700

Linux 3.1-rc3
tree 55770a9334bac715161ee24edb5321fb1774b848
parent c9dc243acb73d68b1feab462635af0ba846cd1a8
author Vignesh R <vigneshr@ti.com> 1513680676 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1521473174 -0400

dmaengine: ti-dma-crossbar: Fix event mapping for TPCC_EVT_MUX_60_63

[ Upstream commit d087f15786021a9605b20f4c678312510be4cac1 ]

Register layout of a typical TPCC_EVT_MUX_M_N register is such that the
lowest numbered event is at the lowest byte address and highest numbered
event at highest byte address. But TPCC_EVT_MUX_60_63 register layout is
different,  in that the lowest numbered event is at the highest address
and highest numbered event is at the lowest address. Therefore, modify
ti_am335x_xbar_write() to handle TPCC_EVT_MUX_60_63 register
accordingly.

Signed-off-by: Vignesh R <vigneshr@ti.com>
Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c2874d57afebe5c3995c6724e77151d907fa7d03
parent 71556b9800fff8bf59075d2c1622acc9d99113ef
author Linus Torvalds <torvalds@linux-foundation.org> 1232138580 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1232138580 -0800

Linux 2.6.29-rc2
tree 841ae6f3f7798c44c50f2eff7204887e4b50b579
parent c5ef91eee5015cc968996fb0d2974cbc41e4eccd
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1196742370 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1196742370 -0800

Linux 2.6.24-rc4
tree d51171f1813be2e97fe1d25c18686e05abbd9ae7
parent b15054e323aefc91df83c94207aed3dafaf781e4
author Larry Chen <lchen@suse.com> 1538779897 -0700
committer Sasha Levin <sashal@kernel.org> 1539868086 -0400

ocfs2: fix crash in ocfs2_duplicate_clusters_by_page()

[ Upstream commit 69eb7765b9c6902444c89c54e7043242faf981e5 ]

ocfs2_duplicate_clusters_by_page() may crash if one of the extent's pages
is dirty.  When a page has not been written back, it is still in dirty
state.  If ocfs2_duplicate_clusters_by_page() is called against the dirty
page, the crash happens.

To fix this bug, we can just unlock the page and wait until the page until
its not dirty.

The following is the backtrace:

kernel BUG at /root/code/ocfs2/refcounttree.c:2961!
[exception RIP: ocfs2_duplicate_clusters_by_page+822]
__ocfs2_move_extent+0x80/0x450 [ocfs2]
? __ocfs2_claim_clusters+0x130/0x250 [ocfs2]
ocfs2_defrag_extent+0x5b8/0x5e0 [ocfs2]
__ocfs2_move_extents_range+0x2a4/0x470 [ocfs2]
ocfs2_move_extents+0x180/0x3b0 [ocfs2]
? ocfs2_wait_for_recovery+0x13/0x70 [ocfs2]
ocfs2_ioctl_move_extents+0x133/0x2d0 [ocfs2]
ocfs2_ioctl+0x253/0x640 [ocfs2]
do_vfs_ioctl+0x90/0x5f0
SyS_ioctl+0x74/0x80
do_syscall_64+0x74/0x140
entry_SYSCALL_64_after_hwframe+0x3d/0xa2

Once we find the page is dirty, we do not wait until it's clean, rather we
use write_one_page() to write it back

Link: http://lkml.kernel.org/r/20180829074740.9438-1-lchen@suse.com
[lchen@suse.com: update comments]
  Link: http://lkml.kernel.org/r/20180830075041.14879-1-lchen@suse.com
[akpm@linux-foundation.org: coding-style fixes]
Signed-off-by: Larry Chen <lchen@suse.com>
Acked-by: Changwei Ge <ge.changwei@h3c.com>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Junxiao Bi <junxiao.bi@oracle.com>
Cc: Joseph Qi <jiangqi903@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 7524d1658bcacd8a5fde8588ba39b29200f4afd6
parent 0d4fe9f12d2d73c357a9fe3f58b083d0152fadb6
author Al Viro <viro@zeniv.linux.org.uk> 1552013141 -0500
committer Sasha Levin <sashal@kernel.org> 1555961637 -0400

Fix aio_poll() races

[ Upstream commit af5c72b1fc7a00aa484e90b0c4e0eeb582545634 ]

aio_poll() has to cope with several unpleasant problems:
	* requests that might stay around indefinitely need to
be made visible for io_cancel(2); that must not be done to
a request already completed, though.
	* in cases when ->poll() has placed us on a waitqueue,
wakeup might have happened (and request completed) before ->poll()
returns.
	* worse, in some early wakeup cases request might end
up re-added into the queue later - we can't treat "woken up and
currently not in the queue" as "it's not going to stick around
indefinitely"
	* ... moreover, ->poll() might have decided not to
put it on any queues to start with, and that needs to be distinguished
from the previous case
	* ->poll() might have tried to put us on more than one queue.
Only the first will succeed for aio poll, so we might end up missing
wakeups.  OTOH, we might very well notice that only after the
wakeup hits and request gets completed (all before ->poll() gets
around to the second poll_wait()).  In that case it's too late to
decide that we have an error.

req->woken was an attempt to deal with that.  Unfortunately, it was
broken.  What we need to keep track of is not that wakeup has happened -
the thing might come back after that.  It's that async reference is
already gone and won't come back, so we can't (and needn't) put the
request on the list of cancellables.

The easiest case is "request hadn't been put on any waitqueues"; we
can tell by seeing NULL apt.head, and in that case there won't be
anything async.  We should either complete the request ourselves
(if vfs_poll() reports anything of interest) or return an error.

In all other cases we get exclusion with wakeups by grabbing the
queue lock.

If request is currently on queue and we have something interesting
from vfs_poll(), we can steal it and complete the request ourselves.

If it's on queue and vfs_poll() has not reported anything interesting,
we either put it on the cancellable list, or, if we know that it
hadn't been put on all queues ->poll() wanted it on, we steal it and
return an error.

If it's _not_ on queue, it's either been already dealt with (in which
case we do nothing), or there's aio_poll_complete_work() about to be
executed.  In that case we either put it on the cancellable list,
or, if we know it hadn't been put on all queues ->poll() wanted it on,
simulate what cancel would've done.

It's a lot more convoluted than I'd like it to be.  Single-consumer APIs
suck, and unfortunately aio is not an exception...

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree e84467ed3fc367deeac9b6aa8870bf855a4694c9
parent f14f187b508f32f81a0505d2a66d80d8dd00a729
author Rasmus Villemoes <linux@rasmusvillemoes.dk> 1552572374 +0100
committer Sasha Levin <sashal@kernel.org> 1556801923 -0400

leds: trigger: netdev: use memcpy in device_name_store

[ Upstream commit 909346433064b8d840dc82af26161926b8d37558 ]

If userspace doesn't end the input with a newline (which can easily
happen if the write happens from a C program that does write(fd,
iface, strlen(iface))), we may end up including garbage from a
previous, longer value in the device_name. For example

# cat device_name

# printf 'eth12' > device_name
# cat device_name
eth12
# printf 'eth3' > device_name
# cat device_name
eth32

I highly doubt anybody is relying on this behaviour, so switch to
simply copying the bytes (we've already checked that size is <
IFNAMSIZ) and unconditionally zero-terminate it; of course, we also
still have to strip a trailing newline.

This is also preparation for future patches.

Fixes: 06f502f57d0d ("leds: trigger: Introduce a NETDEV trigger")
Signed-off-by: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Acked-by: Pavel Machek <pavel@ucw.cz>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree e4660ac807d16a7bd3af6db2dfce539acd94ba23
parent dfd11c2e61d3c0c417d341866ed53c44933b65b4
author Linus Torvalds <torvalds@ppc970.osdl.org> 1119037709 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1119037709 -0700

Linux 2.6.12
tree f742b27f608d527d9513619211972b45ea7c67f1
parent c6c60ed1f5d738419fc7f6aa7a8d23801b8e4112
author Randy Dunlap <rdunlap@infradead.org> 1535860888 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538240459 -0400

x86/pti: Fix section mismatch warning/error

[ Upstream commit ff924c5a1ec7548825cc2d07980b03be4224ffac ]

Fix the section mismatch warning in arch/x86/mm/pti.c:

WARNING: vmlinux.o(.text+0x6972a): Section mismatch in reference from the function pti_clone_pgtable() to the function .init.text:pti_user_pagetable_walk_pte()
The function pti_clone_pgtable() references
the function __init pti_user_pagetable_walk_pte().
This is often because pti_clone_pgtable lacks a __init
annotation or the annotation of pti_user_pagetable_walk_pte is wrong.
FATAL: modpost: Section mismatches detected.

Fixes: 85900ea51577 ("x86/pti: Map the vsyscall page if needed")
Reported-by: kbuild test robot <lkp@intel.com>
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Cc: Andy Lutomirski <luto@kernel.org>
Link: https://lkml.kernel.org/r/43a6d6a3-d69d-5eda-da09-0b1c88215a2a@infradead.org
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 028d6507700d6304b569c158a777d0accbe203ef
parent 72ffaa48e11fe40d96e70bd24289b5e2b8807297
author Linus Torvalds <torvalds@linux-foundation.org> 1358479545 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1358479545 -0800

Linux 3.8-rc4
tree 0ecfe3dbc2e65aa9638c62abf0cf05057c77f884
parent 6fdb94bd95dc7a2effcbffa7a1d9e792cade57b6
author Linus Torvalds <torvalds@g5.osdl.org> 1144034530 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1144034530 -0700

Linux v2.6.17-rc1

Close of the merge window..
tree 554808e3e49d6c89016b0c6e4d56b7a590725d3e
parent 0d541064e8f58858e11cd34d81b6e83617f6eb4a
author Linus Torvalds <torvalds@g5.osdl.org> 1139790445 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1139790445 -0800

Linux v2.6.16-rc3
tree c36b8c6aed7cb3c12e6b337952b4b086fe482f2d
parent 100193f5b7c6ecd0b6c4142d50d3925b2c5950af
author Linus Torvalds <torvalds@linux-foundation.org> 1404675471 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1404675471 -0700

Linux 3.16-rc4
tree 08e8a30bd03f8e55346bafeeffe4733c583ed6a4
parent af858740b01d19e15bddaab05e37aa05d7e7b4e2
author Sasha Levin <sasha.levin@oracle.com> 1434298771 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1434298771 -0400

Linux 3.18.16

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 90a0b8eb5387bede6b19d94c0321862f34b1beab
parent cbaffba12ce08beb3e80bfda148ee0fa14aac188
author Linus Torvalds <torvalds@linux-foundation.org> 1211825273 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1211825291 -0700

Linux 2.6.26-rc4
tree 0cd1d5e74ca4f01f22e5641591cd2f2c37dc214a
parent 9b82e65d65c90faecc408bcdc14a0229736ed193
author Linus Torvalds <torvalds@linux-foundation.org> 1322108428 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1322108428 -0800

Linux 3.2-rc3
tree eb76b18b15bbe4cd8a9d0ce818fabd16ad4b00cf
parent 3fb0c4b7ca3edc0e2404174a01e1af52c23d7401
author Sasha Levin <sasha.levin@oracle.com> 1457128468 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1457128468 -0500

Linux 3.18.28

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 9253bd3b562d6c59044b6175883724f591697da4
parent 5d240918e6813b5c050eeff0c06480ee29e66df9
author Linus Torvalds <torvalds@g5.osdl.org> 1133236287 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1133236287 -0800

Linux v2.6.15-rc3
tree 41f5f823d0569a81b22037e79c22d823933a63f1
parent fc6bdb59a501740b28ed3b616641a22c8dc5dd31
author Linus Torvalds <torvalds@linux-foundation.org> 1343950690 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1343950690 -0700

Linux 3.6-rc1
tree e8b277315bb4adca860a578c186acc871aef93fe
parent 663a4f23caea3db4ef169975bf7660b180e9d21d
author Kangjie Lu <kjlu@umn.edu> 1552111451 -0600
committer Sasha Levin <sashal@kernel.org> 1555809977 -0400

leds: pca9532: fix a potential NULL pointer dereference

[ Upstream commit 0aab8e4df4702b31314a27ec4b0631dfad0fae0a ]

In case of_match_device cannot find a match, return -EINVAL to avoid
NULL pointer dereference.

Fixes: fa4191a609f2 ("leds: pca9532: Add device tree support")
Signed-off-by: Kangjie Lu <kjlu@umn.edu>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree 06fb86822414f9b00579e5946f0110211e772178
parent 0992a5d029181421877a716eaf99145828ff7eae
author Linus Torvalds <torvalds@g5.osdl.org> 1142115175 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1142115175 -0800

Linux 2.6.16-rc6

Gaah. Delayed. But all the better for it!
tree ca81ba555de7a9a68605ef98f13fbc027439cdd2
parent 77dc2db6d1d2703ee4e83d4b3dbecf4e06a910e6
author Linus Torvalds <torvalds@g5.osdl.org> 1160017025 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1160017025 -0700

Linux 2.6.19-rc1

Merge window closed..
tree 7207a6c240bde9a898c17c4da449fbb96b9884f7
parent 6b1223de276f2d4070c4f48daf0772d5e775fcee
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1526735205 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree c7351937a45d30da6674acd354ebceba32201db5
parent 5f9391e2035ae113ee73c872f1b64706eec83a1c
author Reinette Chatre <reinette.chatre@intel.com> 1508491018 -0700
committer Sasha Levin <alexander.levin@verizon.com> 1513264944 -0500

x86/intel_rdt: Fix potential deadlock during resctrl unmount

[ Upstream commit 36b6f9fcb8928c06b6638a4cf91bc9d69bb49aa2 ]

Lockdep warns about a potential deadlock:

[   66.782842] ======================================================
[   66.782888] WARNING: possible circular locking dependency detected
[   66.782937] 4.14.0-rc2-test-test+ #48 Not tainted
[   66.782983] ------------------------------------------------------
[   66.783052] umount/336 is trying to acquire lock:
[   66.783117]  (cpu_hotplug_lock.rw_sem){++++}, at: [<ffffffff81032395>] rdt_kill_sb+0x215/0x390
[   66.783193]
               but task is already holding lock:
[   66.783244]  (rdtgroup_mutex){+.+.}, at: [<ffffffff810321b6>] rdt_kill_sb+0x36/0x390
[   66.783305]
               which lock already depends on the new lock.

[   66.783364]
               the existing dependency chain (in reverse order) is:
[   66.783419]
               -> #3 (rdtgroup_mutex){+.+.}:
[   66.783467]        __lock_acquire+0x1293/0x13f0
[   66.783509]        lock_acquire+0xaf/0x220
[   66.783543]        __mutex_lock+0x71/0x9b0
[   66.783575]        mutex_lock_nested+0x1b/0x20
[   66.783610]        intel_rdt_online_cpu+0x3b/0x430
[   66.783649]        cpuhp_invoke_callback+0xab/0x8e0
[   66.783687]        cpuhp_thread_fun+0x7a/0x150
[   66.783722]        smpboot_thread_fn+0x1cc/0x270
[   66.783764]        kthread+0x16e/0x190
[   66.783794]        ret_from_fork+0x27/0x40
[   66.783825]
               -> #2 (cpuhp_state){+.+.}:
[   66.783870]        __lock_acquire+0x1293/0x13f0
[   66.783906]        lock_acquire+0xaf/0x220
[   66.783938]        cpuhp_issue_call+0x102/0x170
[   66.783974]        __cpuhp_setup_state_cpuslocked+0x154/0x2a0
[   66.784023]        __cpuhp_setup_state+0xc7/0x170
[   66.784061]        page_writeback_init+0x43/0x67
[   66.784097]        pagecache_init+0x43/0x4a
[   66.784131]        start_kernel+0x3ad/0x3f7
[   66.784165]        x86_64_start_reservations+0x2a/0x2c
[   66.784204]        x86_64_start_kernel+0x72/0x75
[   66.784241]        verify_cpu+0x0/0xfb
[   66.784270]
               -> #1 (cpuhp_state_mutex){+.+.}:
[   66.784319]        __lock_acquire+0x1293/0x13f0
[   66.784355]        lock_acquire+0xaf/0x220
[   66.784387]        __mutex_lock+0x71/0x9b0
[   66.784419]        mutex_lock_nested+0x1b/0x20
[   66.784454]        __cpuhp_setup_state_cpuslocked+0x52/0x2a0
[   66.784497]        __cpuhp_setup_state+0xc7/0x170
[   66.784535]        page_alloc_init+0x28/0x30
[   66.784569]        start_kernel+0x148/0x3f7
[   66.784602]        x86_64_start_reservations+0x2a/0x2c
[   66.784642]        x86_64_start_kernel+0x72/0x75
[   66.784678]        verify_cpu+0x0/0xfb
[   66.784707]
               -> #0 (cpu_hotplug_lock.rw_sem){++++}:
[   66.784759]        check_prev_add+0x32f/0x6e0
[   66.784794]        __lock_acquire+0x1293/0x13f0
[   66.784830]        lock_acquire+0xaf/0x220
[   66.784863]        cpus_read_lock+0x3d/0xb0
[   66.784896]        rdt_kill_sb+0x215/0x390
[   66.784930]        deactivate_locked_super+0x3e/0x70
[   66.784968]        deactivate_super+0x40/0x60
[   66.785003]        cleanup_mnt+0x3f/0x80
[   66.785034]        __cleanup_mnt+0x12/0x20
[   66.785070]        task_work_run+0x8b/0xc0
[   66.785103]        exit_to_usermode_loop+0x94/0xa0
[   66.786804]        syscall_return_slowpath+0xe8/0x150
[   66.788502]        entry_SYSCALL_64_fastpath+0xab/0xad
[   66.790194]
               other info that might help us debug this:

[   66.795139] Chain exists of:
                 cpu_hotplug_lock.rw_sem --> cpuhp_state --> rdtgroup_mutex

[   66.800035]  Possible unsafe locking scenario:

[   66.803267]        CPU0                    CPU1
[   66.804867]        ----                    ----
[   66.806443]   lock(rdtgroup_mutex);
[   66.808002]                                lock(cpuhp_state);
[   66.809565]                                lock(rdtgroup_mutex);
[   66.811110]   lock(cpu_hotplug_lock.rw_sem);
[   66.812608]
                *** DEADLOCK ***

[   66.816983] 2 locks held by umount/336:
[   66.818418]  #0:  (&type->s_umount_key#35){+.+.}, at: [<ffffffff81229738>] deactivate_super+0x38/0x60
[   66.819922]  #1:  (rdtgroup_mutex){+.+.}, at: [<ffffffff810321b6>] rdt_kill_sb+0x36/0x390

When the resctrl filesystem is unmounted the locks should be obtain in the
locks in the same order as was done when the cpus came online:

      cpu_hotplug_lock before rdtgroup_mutex.

This also requires to switch the static_branch_disable() calls to the
_cpulocked variant because now cpu hotplug lock is held already.

[ tglx: Switched to cpus_read_[un]lock ]

Signed-off-by: Reinette Chatre <reinette.chatre@intel.com>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Tested-by: Sai Praneeth Prakhya <sai.praneeth.prakhya@intel.com>
Acked-by: Vikas Shivappa <vikas.shivappa@linux.intel.com>
Acked-by: Fenghua Yu <fenghua.yu@intel.com>
Acked-by: Tony Luck <tony.luck@intel.com>
Link: https://lkml.kernel.org/r/cc292e76be073f7260604651711c47b09fd0dc81.1508490116.git.reinette.chatre@intel.com
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 93985b0b0d0e12e8c10f18d4afa0799fd4911dc8
parent e0dcd8a05be438b3d2e49ef61441ea3a463663f8
author Linus Torvalds <torvalds@linux-foundation.org> 1307351193 +0900
committer Linus Torvalds <torvalds@linux-foundation.org> 1307351193 +0900

Linux 3.0-rc2
tree 4ce87cc263e18dff8aeeb39c4a25affb6b4423bb
parent 919e67a63aa967566a909f4f6e1c13f8e88cf76e
author Sasha Levin <sasha.levin@oracle.com> 1459722386 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1459722386 -0400

Linux 4.1.21

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 804e45f72c4533bd057f62fe8b5649612c92d22b
parent ba067819126a0971c921c1cf16a14ba7ffc1174f
author Larry Finger <Larry.Finger@lwfinger.net> 1511638358 -0600
committer Sasha Levin <alexander.levin@microsoft.com> 1516496815 -0500

staging: rtl8188eu: Fix incorrect response to SIOCGIWESSID

[ Upstream commit b77992d2df9e47144354d1b25328b180afa33442 ]

When not associated with an AP, wifi device drivers should respond to the
SIOCGIWESSID ioctl with a zero-length string for the SSID, which is the
behavior expected by dhcpcd.

Currently, this driver returns an error code (-1) from the ioctl call,
which causes dhcpcd to assume that the device is not a wireless interface
and therefore it fails to work correctly with it thereafter.

This problem was reported and tested at
https://github.com/lwfinger/rtl8188eu/issues/234.

Signed-off-by: Larry Finger <Larry.Finger@lwfinger.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 28644f4bab376533b37fa9fbcecef359b70a7d97
parent 53a64cceffef98c088e56dc2d30129f1dceab056
author Greg Kroah-Hartman <gregkh@linuxfoundation.org> 1556546186 +0200
committer Sasha Levin <sashal@kernel.org> 1556619608 -0400

Revert "block/loop: Use global lock for ioctl() operation."

This reverts commit b3f3107fbd928fed6e4fecbe3da2ed5f43216439 which is
commit 310ca162d779efee8a2dc3731439680f3e9c1e86 upstream.

Jan Kara has reported seeing problems with this patch applied, as has
Salvatore Bonaccorso, so let's drop it for now.

Reported-by: Salvatore Bonaccorso <carnil@debian.org>
Reported-by: Jan Kara <jack@suse.cz>
Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Cc: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 333ee5d2b5031dc86d2f3c9d5a4bb4797bde9263
parent 82975bc6a6df743b9a01810fb32cb65d0ec5d60b
author Linus Torvalds <torvalds@linux-foundation.org> 1416785120 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1416785120 -0800

Linux 3.18-rc6
tree 137318b273db26b889675101fbd02d2e84cae5e3
parent d981289627a7e2d8ef62dfcaa11fb60da68f30c6
author Linus Torvalds <torvalds@ppc970.osdl.org> 1116991880 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1116991880 -0700

Linux 2.6.12-rc5
tree b794f25550b7dbbe9cc8eda81633df9023b4821c
parent 4d3639ac3c11afc8fdcb28f95916ef4b21c3fa36
author Linus Torvalds <torvalds@linux-foundation.org> 1413767318 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1413767318 -0700

Linux 3.18-rc1
tree 97ce168cf32ac88b9aa93408b0b681747416a504
parent d50403dcc5092e9c7d6a2525dcfc5813f7c35194
author Linus Torvalds <torvalds@linux-foundation.org> 1357179201 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1357179201 -0800

Linux 3.8-rc2
tree 03e386df0fdb76ee66514555d005d8c38ec1d662
parent cc22fd3bad4c670bbecce0eebe2b24b7d269517a
author jie@chenjie6@huwei.com <jie@chenjie6@huwei.com> 1533946986 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1534601904 -0400

mm/memory.c: check return value of ioremap_prot

[ Upstream commit 24eee1e4c47977bdfb71d6f15f6011e7b6188d04 ]

ioremap_prot() can return NULL which could lead to an oops.

Link: http://lkml.kernel.org/r/1533195441-58594-1-git-send-email-chenjie6@huawei.com
Signed-off-by: chen jie <chenjie6@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Li Zefan <lizefan@huawei.com>
Cc: chenjie <chenjie6@huawei.com>
Cc: Yang Shi <shy828301@gmail.com>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1550e26233f4cb8b289267633c8fc1fc23fd827b
parent 9138dccbb9f39f12474554ef93dcc24de2e9c8f6
author Linus Torvalds <torvalds@g5.osdl.org> 1124854754 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1124854754 -0700

Linux v2.6.13-rc7

Too many changes to release a final 2.6.13.
tree 49e1217917e157d7d9892da1beb45efa9f02e1de
parent 64efe7dda83b5748af727379ab6a9378faaa89e3
author Joerg Roedel <jroedel@suse.de> 1555066231 +0200
committer Sasha Levin <sashal@kernel.org> 1556243479 -0400

iommu/amd: Set exclusion range correctly

[ Upstream commit 3c677d206210f53a4be972211066c0f1cd47fe12 ]

The exlcusion range limit register needs to contain the
base-address of the last page that is part of the range, as
bits 0-11 of this register are treated as 0xfff by the
hardware for comparisons.

So correctly set the exclusion range in the hardware to the
last page which is _in_ the range.

Fixes: b2026aa2dce44 ('x86, AMD IOMMU: add functions for programming IOMMU MMIO space')
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 38a92b7f39748abed900c716e15246600ccdd4df
parent 372feacb36211faf18326cfddea85d69b9afe2e5
author Linus Torvalds <torvalds@linux-foundation.org> 1398017330 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1398017330 -0700

Linux 3.15-rc2
tree f03b42e6d2bd60d984761d7773450698d2bd2fc1
parent 1551260d1f0fb1d23f264582092b862fce5e2dbd
author Linus Torvalds <torvalds@linux-foundation.org> 1239139501 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1239139501 -0700

Linux 2.6.30-rc1
tree 93de0236926fc1a54465dcc67c65f75b4c115a43
parent d49ed131483200ff9c1e49a0f05e39678ba63611
author Paul Burton <paul.burton@imgtec.com> 1480099569 +0000
committer Sasha Levin <alexander.levin@microsoft.com> 1536947722 -0400

MIPS: WARN_ON invalid DMA cache maintenance, not BUG_ON

[ Upstream commit d4da0e97baea8768b3d66ccef3967bebd50dfc3b ]

If a driver causes DMA cache maintenance with a zero length then we
currently BUG and kill the kernel. As this is a scenario that we may
well be able to recover from, WARN & return in the condition instead.

Signed-off-by: Paul Burton <paul.burton@mips.com>
Acked-by: Florian Fainelli <f.fainelli@gmail.com>
Patchwork: https://patchwork.linux-mips.org/patch/14623/
Cc: Ralf Baechle <ralf@linux-mips.org>
Cc: linux-mips@linux-mips.org
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c95e6f462f1354587aa2efbc8df72e9916f4d2cb
parent b52c6402b5b42620571c36c74a12dcb45ec1e0d6
author Linus Torvalds <torvalds@linux-foundation.org> 1354562557 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1354562557 -0800

Linux 3.7-rc8
tree febf1965117c92a391a97c5fed137483fa6be071
parent 44148a667d3715f3a1c37eeff7e954c946cc1efe
author Linus Torvalds <torvalds@linux-foundation.org> 1302053443 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1302053443 -0700

Linux 2.6.39-rc2
tree 45e8e31f03f9af68d5e483822ece8ff017ccd3fc
parent a91f5c08472ce8e76351aad137eaf73be80d4b9c
author Alexandru Gagniuc <mr.nuke.me@gmail.com> 1530660463 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1536004459 -0400

PCI/AER: Honor "pcie_ports=native" even if HEST sets FIRMWARE_FIRST

[ Upstream commit 7af02fcd84c16801958936f88b848944c726ca07 ]

According to the documentation, "pcie_ports=native", linux should use
native AER and DPC services.  While that is true for the _OSC method
parsing, this is not the only place that is checked.  Should the HEST
list PCIe ports as firmware-first, linux will not use native services.

This happens because aer_acpi_firmware_first() doesn't take 'pcie_ports'
into account.  This is wrong.  DPC uses the same logic when it decides
whether to load or not, so fixing this also fixes DPC not loading.

Signed-off-by: Alexandru Gagniuc <mr.nuke.me@gmail.com>
[bhelgaas: return "false" from bool function (from kbuild robot)]
Signed-off-by: Bjorn Helgaas <bhelgaas@google.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 86e37b65c811fdc6d9f2de3b50da3292eb28da1a
parent e10154189f001b6428a83f58b03a27954f0f8022
author Linus Torvalds <torvalds@linux-foundation.org> 1268073944 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1268073944 -0800

Linux 2.6.34-rc1
tree 6c4dc4a4805f0d02d4e6e713f7ad459b64d32496
parent 7999f4b4e56d36265d789d52bb0c0bb0167346a7
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1197344923 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1197344923 -0800

Linux 2.6.24-rc5
tree 7fe962fbd07f900683db843ef5400af80dcc7798
parent 8d1dc20e8d689c7e6a0a4d2c94e36a99d5793ecb
author Linus Torvalds <torvalds@linux-foundation.org> 1299016512 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1299016512 -0800

Linux 2.6.38-rc7
tree 30816bd7a8e3bd5157b186f0a5f56fa0ec1ccb0b
parent 2bf540b73ed5b304e84bb4d4c390d49d1cfa0ef8
author Linus Torvalds <torvalds@woody.osdl.org> 1166058863 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1166058863 -0800

Linux v2.6.20-rc1

.. and so the stabilization phase starts.

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree 609beb5e65d9124c5eb1e5f5f19c918f32303595
parent f148b95a7240fb0b324be536f4428d4bedeb03d3
author Dominique Martinet <dominique.martinet@cea.fr> 1535409155 +0900
committer Sasha Levin <sashal@kernel.org> 1541992202 -0500

9p: clear dangling pointers in p9stat_free

[ Upstream commit 62e3941776fea8678bb8120607039410b1b61a65 ]

p9stat_free is more of a cleanup function than a 'free' function as it
only frees the content of the struct; there are chances of use-after-free
if it is improperly used (e.g. p9stat_free called twice as it used to be
possible to)

Clearing dangling pointers makes the function idempotent and safer to use.

Link: http://lkml.kernel.org/r/1535410108-20650-2-git-send-email-asmadeus@codewreck.org
Signed-off-by: Dominique Martinet <dominique.martinet@cea.fr>
Reported-by: syzbot+d4252148d198410b864f@syzkaller.appspotmail.com
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree d7cca06a0d1d67ad518d24b4b9c7669186d30b3c
parent 699bb02e8f70cb7666390cef0f28a5643db1a5bf
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1540654408 -0400

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree da1570530a74c857cf0ba312898549d6767804ca
parent ac0b5fa01a9975da44c52984df10ae4be4590616
author Sasha Levin <sashal@kernel.org> 1542659011 -0500
committer Sasha Levin <sashal@kernel.org> 1542659011 -0500

update config for 4.20-rc3

Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 7199fc0bfbad8fca1c7edf63cc1081da14ccfdf6
parent f9fc05e7620b3ffc93eeeda6d02fc70436676152
author Linus Torvalds <torvalds@linux-foundation.org> 1228950711 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1228950711 -0800

Linux 2.6.28-rc8
tree 81c97988b479d68ff1082ad6c2cb60c20dbeecb3
parent 2f81eccbd7a5440b43ff874c8f02d6143f41ba4f
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1188626904 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1188626904 -0700

Linux 2.6.23-rc5
tree 7d9613de84221e88c1ecb6d1212422ce79a30b84
parent fe0c9f58779988e769da544d54b660c76506e78f
author Linus Torvalds <torvalds@g5.osdl.org> 1120621593 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1120621593 -0700

Linux v2.6.13-rc3
tree 31c50a55a861d6056d59895e86b1b2bebdade90b
parent 77ec7951cf1342e352c3adc493d35645e1c773af
author Alexey Khoroshilov <khoroshilov@ispras.ru> 1514585121 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1522903944 -0400

thermal: int3400_thermal: fix error handling in int3400_thermal_probe()

[ Upstream commit 0be86969ae385c5c944286bd9f66068525de15ee ]

There are resources that are not dealocated on failure path
in int3400_thermal_probe().

Found by Linux Driver Verification project (linuxtesting.org).

Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>
Signed-off-by: Zhang Rui <rui.zhang@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d27075be8e251525a58635c26cd6d9773bb8cd70
parent 6ec6b7ef262a9af470ce49dd6ce4663ad614dedd
author Masami Hiramatsu <mhiramat@kernel.org> 1550940649 +0900
committer Sasha Levin <sashal@kernel.org> 1556927746 -0400

x86/kprobes: Avoid kretprobe recursion bug

[ Upstream commit b191fa96ea6dc00d331dcc28c1f7db5e075693a0 ]

Avoid kretprobe recursion loop bg by setting a dummy
kprobes to current_kprobe per-CPU variable.

This bug has been introduced with the asm-coded trampoline
code, since previously it used another kprobe for hooking
the function return placeholder (which only has a nop) and
trampoline handler was called from that kprobe.

This revives the old lost kprobe again.

With this fix, we don't see deadlock anymore.

And you can see that all inner-called kretprobe are skipped.

  event_1                                  235               0
  event_2                                19375           19612

The 1st column is recorded count and the 2nd is missed count.
Above shows (event_1 rec) + (event_2 rec) ~= (event_2 missed)
(some difference are here because the counter is racy)

Reported-by: Andrea Righi <righi.andrea@gmail.com>
Tested-by: Andrea Righi <righi.andrea@gmail.com>
Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
Acked-by: Steven Rostedt <rostedt@goodmis.org>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: stable@vger.kernel.org
Fixes: c9becf58d935 ("[PATCH] kretprobe: kretprobe-booster")
Link: http://lkml.kernel.org/r/155094064889.6137.972160690963039.stgit@devbox
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c6fad29c442ea7f506741297627cec9525d739d9
parent 5c05a64b44fe452955c770fabac2d910fbbb2f9c
author Miaoqing Pan <miaoqing@codeaurora.org> 1506474814 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1513265240 -0500

ath9k: fix tx99 potential info leak

[ Upstream commit ee0a47186e2fa9aa1c56cadcea470ca0ba8c8692 ]

When the user sets count to zero the string buffer would remain
completely uninitialized which causes the kernel to parse its
own stack data, potentially leading to an info leak. In addition
to that, the string might be not terminated properly when the
user data does not contain a 0-terminator.

Signed-off-by: Miaoqing Pan <miaoqing@codeaurora.org>
Reviewed-by: Christoph Böhmwalder <christoph@boehmwalder.at>
Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree c4f9586c9e689b76e3f63b6f32a1d227ee206f36
parent ea16da065802b2028b9715b84a8f050c398efbf6
author Mark Salter <msalter@redhat.com> 1517581229 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1523804580 -0400

irqchip/gic-v3: Change pr_debug message to pr_devel

[ Upstream commit b6dd4d83dc2f78cebc9a7e6e7e4bc2be4d29b94d ]

The pr_debug() in gic-v3 gic_send_sgi() can trigger a circular locking
warning:

 GICv3: CPU10: ICC_SGI1R_EL1 5000400
 ======================================================
 WARNING: possible circular locking dependency detected
 4.15.0+ #1 Tainted: G        W
 ------------------------------------------------------
 dynamic_debug01/1873 is trying to acquire lock:
  ((console_sem).lock){-...}, at: [<0000000099c891ec>] down_trylock+0x20/0x4c

 but task is already holding lock:
  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 which lock already depends on the new lock.

 the existing dependency chain (in reverse order) is:

 -> #2 (&rq->lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock+0x4c/0x60
        task_fork_fair+0x3c/0x148
        sched_fork+0x10c/0x214
        copy_process.isra.32.part.33+0x4e8/0x14f0
        _do_fork+0xe8/0x78c
        kernel_thread+0x48/0x54
        rest_init+0x34/0x2a4
        start_kernel+0x45c/0x488

 -> #1 (&p->pi_lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        try_to_wake_up+0x48/0x600
        wake_up_process+0x28/0x34
        __up.isra.0+0x60/0x6c
        up+0x60/0x68
        __up_console_sem+0x4c/0x7c
        console_unlock+0x328/0x634
        vprintk_emit+0x25c/0x390
        dev_vprintk_emit+0xc4/0x1fc
        dev_printk_emit+0x88/0xa8
        __dev_printk+0x58/0x9c
        _dev_info+0x84/0xa8
        usb_new_device+0x100/0x474
        hub_port_connect+0x280/0x92c
        hub_event+0x740/0xa84
        process_one_work+0x240/0x70c
        worker_thread+0x60/0x400
        kthread+0x110/0x13c
        ret_from_fork+0x10/0x18

 -> #0 ((console_sem).lock){-...}:
        validate_chain.isra.34+0x6e4/0xa20
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        down_trylock+0x20/0x4c
        __down_trylock_console_sem+0x3c/0x9c
        console_trylock+0x20/0xb0
        vprintk_emit+0x254/0x390
        vprintk_default+0x58/0x90
        vprintk_func+0xbc/0x164
        printk+0x80/0xa0
        __dynamic_pr_debug+0x84/0xac
        gic_raise_softirq+0x184/0x18c
        smp_cross_call+0xac/0x218
        smp_send_reschedule+0x3c/0x48
        resched_curr+0x60/0x9c
        check_preempt_curr+0x70/0xdc
        wake_up_new_task+0x310/0x470
        _do_fork+0x188/0x78c
        SyS_clone+0x44/0x50
        __sys_trace_return+0x0/0x4

 other info that might help us debug this:

 Chain exists of:
   (console_sem).lock --> &p->pi_lock --> &rq->lock

  Possible unsafe locking scenario:

        CPU0                    CPU1
        ----                    ----
   lock(&rq->lock);
                                lock(&p->pi_lock);
                                lock(&rq->lock);
   lock((console_sem).lock);

  *** DEADLOCK ***

 2 locks held by dynamic_debug01/1873:
  #0:  (&p->pi_lock){-.-.}, at: [<000000001366df53>] wake_up_new_task+0x40/0x470
  #1:  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 stack backtrace:
 CPU: 10 PID: 1873 Comm: dynamic_debug01 Tainted: G        W        4.15.0+ #1
 Hardware name: GIGABYTE R120-T34-00/MT30-GS2-00, BIOS T48 10/02/2017
 Call trace:
  dump_backtrace+0x0/0x188
  show_stack+0x24/0x2c
  dump_stack+0xa4/0xe0
  print_circular_bug.isra.31+0x29c/0x2b8
  check_prev_add.constprop.39+0x6c8/0x6dc
  validate_chain.isra.34+0x6e4/0xa20
  __lock_acquire+0x3b4/0x6e0
  lock_acquire+0xf4/0x2a8
  _raw_spin_lock_irqsave+0x58/0x70
  down_trylock+0x20/0x4c
  __down_trylock_console_sem+0x3c/0x9c
  console_trylock+0x20/0xb0
  vprintk_emit+0x254/0x390
  vprintk_default+0x58/0x90
  vprintk_func+0xbc/0x164
  printk+0x80/0xa0
  __dynamic_pr_debug+0x84/0xac
  gic_raise_softirq+0x184/0x18c
  smp_cross_call+0xac/0x218
  smp_send_reschedule+0x3c/0x48
  resched_curr+0x60/0x9c
  check_preempt_curr+0x70/0xdc
  wake_up_new_task+0x310/0x470
  _do_fork+0x188/0x78c
  SyS_clone+0x44/0x50
  __sys_trace_return+0x0/0x4
 GICv3: CPU0: ICC_SGI1R_EL1 12000

This could be fixed with printk_deferred() but that might lessen its
usefulness for debugging. So change it to pr_devel to keep it out of
production kernels. Developers working on gic-v3 can enable it as
needed in their kernels.

Signed-off-by: Mark Salter <msalter@redhat.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree dd09a54da6e772426883a57f57d0abbddf6f8dd5
parent 746b001eaf7e70148a26b68e9369e7f50a3c2616
author Paolo Bonzini <pbonzini@redhat.com> 1515686124 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1517164196 -0500

KVM: x86: emulate #UD while in guest mode

[ Upstream commit bd89525a823ce6edddcedbe9aed79faa1b9cf544 ]

This reverts commits ae1f57670703656cc9f293722c3b8b6782f8ab3f
and ac9b305caa0df6f5b75d294e4b86c1027648991e.

If the hardware doesn't support MOVBE, but L0 sets CPUID.01H:ECX.MOVBE
in L1's emulated CPUID information, then L1 is likely to pass that
CPUID bit through to L2. L2 will expect MOVBE to work, but if L1
doesn't intercept #UD, then any MOVBE instruction executed in L2 will
raise #UD, and the exception will be delivered in L2.

Commit ac9b305caa0df6f5b75d294e4b86c1027648991e is a better and more
complete version of ae1f57670703 ("KVM: nVMX: Do not emulate #UD while
in guest mode"); however, neither considers the above case.

Suggested-by: Jim Mattson <jmattson@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 704e01a42855a165b6da4a04494d9f6aea5e20e0
parent e3b5360919a2491a6ed34426a083f4afdcbc7973
author Sasha Levin <sasha.levin@oracle.com> 1465255006 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1465255006 -0400

Linux 3.18.35

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b4ddc4c9a36a5d49ddbdc836d4886ebe7a9c71c4
parent 8943ef69a08f6f354465a275ced137cbbc1c0b39
author Arnd Bergmann <arnd@arndb.de> 1553529043 +0100
committer Sasha Levin <sashal@kernel.org> 1555961689 -0400

ARM: iop: don't use using 64-bit DMA masks

[ Upstream commit 2125801ccce19249708ca3245d48998e70569ab8 ]

clang warns about statically defined DMA masks from the DMA_BIT_MASK
macro with length 64:

 arch/arm/mach-iop13xx/setup.c:303:35: error: shift count >= width of type [-Werror,-Wshift-count-overflow]
 static u64 iop13xx_adma_dmamask = DMA_BIT_MASK(64);
                                  ^~~~~~~~~~~~~~~~
 include/linux/dma-mapping.h:141:54: note: expanded from macro 'DMA_BIT_MASK'
 #define DMA_BIT_MASK(n) (((n) == 64) ? ~0ULL : ((1ULL<<(n))-1))
                                                      ^ ~~~

The ones in iop shouldn't really be 64 bit masks, so changing them
to what the driver can support avoids the warning.

Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree bf16499d18622a768357eddc54382393aa27cfd0
parent 32f4239edcd114980157ae2ee2795983c5d80e57
author Yuval Mintz <yuvalm@mellanox.com> 1515580963 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1517680316 -0500

mlxsw: pci: Wait after reset before accessing HW

[ Upstream commit 8e033a93b37f37aa9fca71a370a895155320af60 ]

After performing reset driver polls on HW indication until learning
that the reset is done, but immediately after reset the device becomes
unresponsive which might lead to completion timeout on the first read.

Wait for 100ms before starting the polling.

Fixes: 233fa44bd67a ("mlxsw: pci: Implement reset done check")
Signed-off-by: Yuval Mintz <yuvalm@mellanox.com>
Reviewed-by: Ido Schimmel <idosch@mellanox.com>
Signed-off-by: Jiri Pirko <jiri@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree b6d8e0ecbf8f710443ac4c30607546d7659bd4cb
parent 726734299582303f72a422ee6540a63e474f4b01
author Linus Torvalds <torvalds@linux-foundation.org> 1393206003 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1393206003 -0800

Linux 3.14-rc4
tree 4d0ef37cfe30a898227a175bca43bd6c938e78e8
parent 7a82b63f19b0a05a76271aee1eb7905cd1c7d5ad
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1194386266 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1194386266 -0800

Linux 2.6.24-rc2
tree 002908add5fedb1fb02c50cc44fc9a59f3d98c2f
parent 60815cf2e05057db5b78e398d9734c493560b11e
author Linus Torvalds <torvalds@linux-foundation.org> 1419124130 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1419124130 -0800

Linux 3.19-rc1
tree 69ebfee77c8a174c87ea8ed31e023c94b09a9d6e
parent cdada08eb26e7cc57bb423e51e6e70fd5450a0b5
author Linus Torvalds <torvalds@g5.osdl.org> 1130457728 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1130457728 -0700

Linux v2.6.14

"Better late than never"
tree e143863fb39a2b84649c87a7061f469e9f62f474
parent 10cd5edbd8124f32f42758547658537cb34d71a8
author Josh Abraham <j.abraham1776@gmail.com> 1536801234 -1000
committer Sasha Levin <alexander.levin@microsoft.com> 1538144187 -0400

xen: fix GCC warning and remove duplicate EVTCHN_ROW/EVTCHN_COL usage

[ Upstream commit 4dca864b59dd150a221730775e2f21f49779c135 ]

This patch removes duplicate macro useage in events_base.c.

It also fixes gcc warning:
variable ‘col’ set but not used [-Wunused-but-set-variable]

Signed-off-by: Joshua Abraham <j.abraham1776@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree afccfd23566a4ef49f883bee726888cd59173c91
parent 8bbbc2326eab5008ebcac7c7436e89eba779b4b1
author Haiyang Zhang <haiyangz@microsoft.com> 1506119498 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1525966572 -0400

hv_netvsc: Fix the real number of queues of non-vRSS cases

For older hosts without multi-channel (vRSS) support, and some error
cases, we still need to set the real number of queues to one.
This patch adds this missing setting.

Fixes: 8195b1396ec8 ("hv_netvsc: fix deadlock on hotplug")
Signed-off-by: Haiyang Zhang <haiyangz@microsoft.com>
Reviewed-by: Stephen Hemminger <sthemmin@microsoft.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 4ef0183fb2c451d4e5deefe260cadb8eac78c314
parent 14746306afe705f1d41bd51774a4378b1aec562d
author Linus Torvalds <torvalds@linux-foundation.org> 1422245081 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1422245081 -0800

Linux 3.19-rc6
tree cea669db0846197fbfdf241d2fbc75e75c0e0e46
parent 64a8920fab962fb581bbe67856cb4740fc37d743
author Linus Torvalds <torvalds@linux-foundation.org> 1271122895 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1271122895 -0700

Linux 2.6.34-rc4
tree 0db649f5657f2c4cd5580e1c50c42a6cfc130007
parent 2f952d47911f36766122918cc4e6ae782780f513
author Sasha Levin <alexander.levin@verizon.com> 1513092104 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1513092104 -0500

Linux 4.1.48

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree ed245ea52e84ad7d8c1846e5972575908f8d4db3
parent 610622cac573aef67811fbffc865d9fba1611050
author Sasha Levin <alexander.levin@verizon.com> 1512313715 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1512613216 -0500

Linux 4.1.47

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 381706566853b631a30af2b299fbbed4ef76717b
parent 1ced23539f9809cbdb86eed9b9626495720530aa
author Sasha Levin <sasha.levin@oracle.com> 1450201527 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1450201527 -0500

Linux 3.18.25

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree aa81dee7b10bef5b1fc6865437f5875d83aaed53
parent c02e48f3092369b4d9a0c8adbc392e52e6ddd58b
author Prarit Bhargava <prarit@redhat.com> 1539011178 -0400
committer Sasha Levin <sashal@kernel.org> 1541428185 -0500

cpupower: Fix AMD Family 0x17 msr_pstate size

[ Upstream commit 8c22e2f695920ebd94f9a53bcf2a65eb36d4dba1 ]

The msr_pstate data is only 63 bits long and should be 64 bits.

Add in the missing bit from res1 for AMD Family 0x17.

Reference: https://www.amd.com/system/files/TechDocs/54945_PPR_Family_17h_Models_00h-0Fh.pdf, page 138.

Signed-off-by: Prarit Bhargava <prarit@redhat.com>
Cc: Shuah Khan <shuah@kernel.org>
Cc: Stafford Horne <shorne@gmail.com>
Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 738dd8db0f3c667db8a5fa4c2dc0862c1a9768e0
parent 2cf206b40529561a61073892d8b8b6c07fef9c6b
author Nathan Chancellor <natechancellor@gmail.com> 1547098868 -0700
committer Sasha Levin <sashal@kernel.org> 1550940202 -0500

isdn: avm: Fix string plus integer warning from Clang

[ Upstream commit 7afa81c55fca0cad589722cb4bce698b4803b0e1 ]

A recent commit in Clang expanded the -Wstring-plus-int warning, showing
some odd behavior in this file.

drivers/isdn/hardware/avm/b1.c:426:30: warning: adding 'int' to a string does not append to the string [-Wstring-plus-int]
                cinfo->version[j] = "\0\0" + 1;
                                    ~~~~~~~^~~
drivers/isdn/hardware/avm/b1.c:426:30: note: use array indexing to silence this warning
                cinfo->version[j] = "\0\0" + 1;
                                           ^
                                    &      [  ]
1 warning generated.

This is equivalent to just "\0". Nick pointed out that it is smarter to
use "" instead of "\0" because "" is used elsewhere in the kernel and
can be deduplicated at the linking stage.

Link: https://github.com/ClangBuiltLinux/linux/issues/309
Suggested-by: Nick Desaulniers <ndesaulniers@google.com>
Signed-off-by: Nathan Chancellor <natechancellor@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 28fc40804196baed166c4164bc36078ee070f7c0
parent c01c8106f43ec7e460eeb56c7a8ae666acdfe5a0
author Linus Torvalds <torvalds@linux-foundation.org> 1292462688 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1292462688 -0800

Linux 2.6.37-rc6
tree c7bb0ec9d6db2f23138da1c9968b251465458a59
parent 9754e799f9e3ff2b99ca086253ad4006dfda938e
author Masami Hiramatsu <mhiramat@kernel.org> 1550940649 +0900
committer Sasha Levin <sashal@kernel.org> 1556821017 -0400

x86/kprobes: Avoid kretprobe recursion bug

[ Upstream commit b191fa96ea6dc00d331dcc28c1f7db5e075693a0 ]

Avoid kretprobe recursion loop bg by setting a dummy
kprobes to current_kprobe per-CPU variable.

This bug has been introduced with the asm-coded trampoline
code, since previously it used another kprobe for hooking
the function return placeholder (which only has a nop) and
trampoline handler was called from that kprobe.

This revives the old lost kprobe again.

With this fix, we don't see deadlock anymore.

And you can see that all inner-called kretprobe are skipped.

  event_1                                  235               0
  event_2                                19375           19612

The 1st column is recorded count and the 2nd is missed count.
Above shows (event_1 rec) + (event_2 rec) ~= (event_2 missed)
(some difference are here because the counter is racy)

Reported-by: Andrea Righi <righi.andrea@gmail.com>
Tested-by: Andrea Righi <righi.andrea@gmail.com>
Signed-off-by: Masami Hiramatsu <mhiramat@kernel.org>
Acked-by: Steven Rostedt <rostedt@goodmis.org>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: stable@vger.kernel.org
Fixes: c9becf58d935 ("[PATCH] kretprobe: kretprobe-booster")
Link: http://lkml.kernel.org/r/155094064889.6137.972160690963039.stgit@devbox
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 684ad9f542b52d0771a13ae4b040ad483f75cbde
parent 76d25a5f2fbd10d97d580f2d511e6b020ca87c09
author Linus Torvalds <torvalds@linux-foundation.org> 1375070013 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1375070013 -0700

Linux 3.11-rc3
tree a1794701d38720bc3f17bec800fbcd12ff9e0274
parent 9c1f8594df4814ebfd6822ca3c9444fb3445888d
author Linus Torvalds <torvalds@linux-foundation.org> 1316649495 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1316649495 -0700

Linux 3.1-rc7
tree 84a55e4ac2dcf23add97bd9fde3e9cb232c12b30
parent d28dc711217a2d5cafb64ec4e33a469b01376d91
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1203888354 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1203888354 -0800

Linux 2.6.25-rc3
tree d42b38eafc956fb2c661fc566784eb73bf6ccd30
parent c07978b3f80cc5b2aceba72eff7daefa4a57cd48
author Linus Torvalds <torvalds@linux-foundation.org> 1341097737 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1341097737 -0700

Linux 3.5-rc5
tree 35fe4efe8e14c8474e16cfe0f8453af99725732e
parent 9f3dd1a341aba4d1bccb239cfe72e0a63afa3036
author Douglas Anderson <dianders@chromium.org> 1530572379 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1537750706 -0400

pinctrl: qcom: spmi-gpio: Fix pmic_gpio_config_get() to be compliant

[ Upstream commit 1cf86bc21257a330e3af51f2a4e885f1a705f6a5 ]

If you do this on an sdm845 board:
  grep "" /sys/kernel/debug/pinctrl/*spmi:pmic*/pinconf-groups

...it looks like nonsense.  For every pin you see listed:
  input bias disabled, input bias high impedance, input bias pull down, input bias pull up, ...

That's because pmic_gpio_config_get() isn't complying with the rules
that pinconf_generic_dump_one() expects.  Specifically for boolean
parameters (anything with a "struct pin_config_item" where has_arg is
false) the function expects that the function should return its value
not through the "config" parameter but should return "0" if the value
is set and "-EINVAL" if the value isn't set.

Let's fix this.

From a quick sample of other pinctrl drivers, it appears to be
tradition to also return 1 through the config parameter for these
boolean parameters when they exist.  I'm not one to knock tradition,
so I'll follow tradition and return 1 in these cases.  While I'm at
it, I'll also continue searching for four leaf clovers, kocking on
wood three times, and trying not to break mirrors.

NOTE: This also fixes an apparent typo for reading
PIN_CONFIG_BIAS_DISABLE where the old driver was accidentally
using "=" instead of "==" and thus was setting some internal
state when you tried to query PIN_CONFIG_BIAS_DISABLE.  Oops.

Fixes: eadff3024472 ("pinctrl: Qualcomm SPMI PMIC GPIO pin controller driver")
Signed-off-by: Douglas Anderson <dianders@chromium.org>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree abaa85f23db1821a85c57e6473df2803e9dd8890
parent a82642fa190029a438c0d09edb0e5463a0fe9e1e
author Linus Torvalds <torvalds@g5.osdl.org> 1146104365 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1146104365 -0700

Linux v2.6.17-rc3
tree af6b4e876c732daaafb59781836bfce9715d21c2
parent 69048e01881747e27457cd514a6b85d925982046
author Linus Torvalds <torvalds@linux-foundation.org> 1391388133 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1391388133 -0800

Linus 3.14-rc1
tree acd2921e0411bb2d203f6c0331d164a815ab26da
parent f3c15b0a128f7de42a0332107218ef747e48c288
author Linus Torvalds <torvalds@linux-foundation.org> 1371930451 -1000
committer Linus Torvalds <torvalds@linux-foundation.org> 1371930451 -1000

Linux 3.10-rc7
tree df6c43cb64a83036d3efdf06894b6170fb4d69ed
parent e9ca75b53576ddf82ea2d803f87c59dffac7bc42
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1179547577 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1179547577 -0700

Linux v2.6.22-rc2
tree ee6cc389293bebffaf4552b9f34c20f4b2bd7967
parent 82d63fc9e30687c055b97928942b8893ea65b0bb
author Linus Torvalds <torvalds@linux-foundation.org> 1219286156 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1219286156 -0700

Linux v2.6.27-rc4
tree 1d34af29ab9e0f8057ebf570597df9938fbd68fa
parent bc9432581714eba5708f5187fb7fdd05a82adf09
author Sasha Levin <sasha.levin@oracle.com> 1429559282 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1429559282 -0400

Linux 3.18.12

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree f857114b9c58e3dc204237d69513430e26cb5881
parent 874bdeb95ddb7dada978230398672595b36b16ad
author Greg Kroah-Hartman <gregkh@linuxfoundation.org> 1556546186 +0200
committer Sasha Levin <sashal@kernel.org> 1556619615 -0400

Revert "block/loop: Use global lock for ioctl() operation."

This reverts commit a17189a0e107ee316b3fff61217f5a037357d65e which is
commit 310ca162d779efee8a2dc3731439680f3e9c1e86 upstream.

Jan Kara has reported seeing problems with this patch applied, as has
Salvatore Bonaccorso, so let's drop it for now.

Reported-by: Salvatore Bonaccorso <carnil@debian.org>
Reported-by: Jan Kara <jack@suse.cz>
Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Cc: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

tree b671eed0ece1ff341db141802cf656d6a54b508c
parent 1b5471a74360452b0d76a026ccd348583c9d2444
author Dominique Martinet <dominique.martinet@cea.fr> 1535409155 +0900
committer Sasha Levin <sashal@kernel.org> 1541992211 -0500

9p: clear dangling pointers in p9stat_free

[ Upstream commit 62e3941776fea8678bb8120607039410b1b61a65 ]

p9stat_free is more of a cleanup function than a 'free' function as it
only frees the content of the struct; there are chances of use-after-free
if it is improperly used (e.g. p9stat_free called twice as it used to be
possible to)

Clearing dangling pointers makes the function idempotent and safer to use.

Link: http://lkml.kernel.org/r/1535410108-20650-2-git-send-email-asmadeus@codewreck.org
Signed-off-by: Dominique Martinet <dominique.martinet@cea.fr>
Reported-by: syzbot+d4252148d198410b864f@syzkaller.appspotmail.com
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 520b9d0db6a1142271a68b2b38cca002be40f6cb
parent a3470171d69d5526a01c31f1ce4a1e8090b6e5d9
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1191295492 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1191295492 -0700

Linux 2.6.23-rc9

No, I didn't want to do this, but we had more stuff go in after -rc8
than we had in the previous -rc. Gaah.
tree 6f0271ca08f7680800c9d85f38b86a42111f047b
parent 40c373cc3af9720d1cec0e32c3da26b1d220a95b
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1170614694 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1170614694 -0800

Linux 2.6.20
tree c376502d07f47c6098bbb9db1e0a47d9cba79fe3
parent e3f2f959ae8da5435092b168ed82aef73d7c62f7
author Parav Pandit <parav@mellanox.com> 1531731013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1536899828 -0400

RDMA/cma: Do not ignore net namespace for unbound cm_id

[ Upstream commit 643d213a9a034fa04f5575a40dfc8548e33ce04f ]

Currently if the cm_id is not bound to any netdevice, than for such cm_id,
net namespace is ignored; which is incorrect.

Regardless of cm_id bound to a netdevice or not, net namespace must
match. When a cm_id is bound to a netdevice, in such case net namespace
and netdevice both must match.

Fixes: 4c21b5bcef73 ("IB/cma: Add net_dev and private data checks to RDMA CM")
Signed-off-by: Parav Pandit <parav@mellanox.com>
Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 790e474578e242e3f31ef6c54b42cbb1d7fd6b1c
parent d24b9b8d95f0df8c3b1430ff76396fd705cc0140
author Sasha Levin <sasha.levin@oracle.com> 1435513240 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1435513240 -0400

Linux 3.18.17

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree a6bf5e518f8549c552408f5ef02e56f924105cf2
parent 6b2a4f7a5b777ea8fcf3bb38a0a33e68a920a9dc
author Linus Torvalds <torvalds@linux-foundation.org> 1301425787 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1301425787 -0700

Linux 2.6.39-rc1
tree 3b99e4b7c76bf5e3905dd8d7092f8f56b249d773
parent 3dc8d7f07e7496c0c6702e7e4b1acc179fa94019
author Linus Torvalds <torvalds@linux-foundation.org> 1282524209 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1282524209 -0700

Linux 2.6.36-rc2
tree e3668595e988a684a07f018308d0be23a97ed65e
parent 3752aee96538b582b089f4a97a26e2ccd9403929
author Linus Torvalds <torvalds@g5.osdl.org> 1158723726 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1158723726 -0700

Linux v2.6.18. Arrr!

Ahoy, all land-lubbers, test me out right smartly!

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree b08095800134a724e38624794d1b488e44a83b82
parent 00b10ecf2d75664cc1bdf702e0412e34a1f94b22
author Linus Torvalds <torvalds@linux-foundation.org> 1330201096 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1330201096 -0800

Linux 3.3-rc5
tree 0548974bde2374d5f9b207695e6d09a946a8339a
parent 89b9448c616c0a333a4ccb68b9bd91c0e4882d36
author Murilo Opsfelder Araujo <muriloo@linux.ibm.com> 1525287044 -0300
committer Sasha Levin <alexander.levin@microsoft.com> 1526742892 -0400

perf session: Fix undeclared 'oe'

Using linux-3.18.y branch, perf build fails with the following:

    $ make -s -j16 -C tools/perf V=1 WERROR=0 NO_LIBUNWIND=1 HAVE_CPLUS_DEMANGLE=1 NO_GTK2=1 NO_LIBNUMA=1 NO_STRLCPY=1 NO_BIONIC=1 prefix=/usr DESTDIR=/tmp/builddir/build all
    [...]
    util/session.c: In function ‘__perf_session__process_pipe_events’:
    util/session.c:1093:36: error: ‘oe’ undeclared (first use in this function)
      ordered_events__set_copy_on_queue(oe, true);
                                        ^
    util/session.c:1093:36: note: each undeclared identifier is reported only once for each function it appears in

This patch fixes it for linux-3.18.y branch.

Fixes: 95b33b99cdd6 ("perf inject: Copy events when reordering events in pipe mode")
Cc: <stable@vger.kernel.org> # 3.18.x
Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
Cc: Andi Kleen <ak@linux.intel.com>
Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
Cc: David Carrillo-Cisneros <davidcc@google.com>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: He Kuang <hekuang@huawei.com>
Cc: Ingo Molnar <mingo@redhat.com>
Cc: Jiri Olsa <jolsa@kernel.org>
Cc: Masami Hiramatsu <mhiramat@kernel.org>
Cc: Paul Mackerras <paulus@samba.org>
Cc: Paul Turner <pjt@google.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Sasha Levin <alexander.levin@microsoft.com>
Cc: Simon Que <sque@chromium.org>
Cc: Stephane Eranian <eranian@google.com>
Cc: Wang Nan <wangnan0@huawei.com>
Signed-off-by: Murilo Opsfelder Araujo <muriloo@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 9ecc4a85104d7669018e1330bd5fb29b188b47e3
parent 7855e916590ab8d97abcba3d0dc735bcfa55561d
author Sasha Levin <sasha.levin@oracle.com> 1461067038 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1461067038 -0400

Linux 3.18.31

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree f03257c2ce3776f832fb858361509da418a4d9a0
parent d08e69647a28e933cb0a4224610de1c0e1844491
author Xiao Liang <xiliang@redhat.com> 1534260088 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1537021373 -0400

xen-netfront: fix warn message as irq device name has '/'

[ Upstream commit 21f2706b20100bb3db378461ab9b8e2035309b5b ]

There is a call trace generated after commit 2d408c0d4574b01b9ed45e02516888bf925e11a9(
xen-netfront: fix queue name setting). There is no 'device/vif/xx-q0-tx' file found
under /proc/irq/xx/.

This patch only picks up device type and id as its name.

With the patch, now /proc/interrupts looks like below and the warning message gone:
 70:         21          0          0          0   xen-dyn    -event     vif0-q0-tx
 71:         15          0          0          0   xen-dyn    -event     vif0-q0-rx
 72:         14          0          0          0   xen-dyn    -event     vif0-q1-tx
 73:         33          0          0          0   xen-dyn    -event     vif0-q1-rx
 74:         12          0          0          0   xen-dyn    -event     vif0-q2-tx
 75:         24          0          0          0   xen-dyn    -event     vif0-q2-rx
 76:         19          0          0          0   xen-dyn    -event     vif0-q3-tx
 77:         21          0          0          0   xen-dyn    -event     vif0-q3-rx

Below is call trace information without this patch:

name 'device/vif/0-q0-tx'
WARNING: CPU: 2 PID: 37 at fs/proc/generic.c:174 __xlate_proc_name+0x85/0xa0
RIP: 0010:__xlate_proc_name+0x85/0xa0
RSP: 0018:ffffb85c40473c18 EFLAGS: 00010286
RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000000006
RDX: 0000000000000007 RSI: 0000000000000096 RDI: ffff984c7f516930
RBP: ffffb85c40473cb8 R08: 000000000000002c R09: 0000000000000229
R10: 0000000000000000 R11: 0000000000000001 R12: ffffb85c40473c98
R13: ffffb85c40473cb8 R14: ffffb85c40473c50 R15: 0000000000000000
FS:  0000000000000000(0000) GS:ffff984c7f500000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f69b6899038 CR3: 000000001c20a006 CR4: 00000000001606e0
Call Trace:
__proc_create+0x45/0x230
? snprintf+0x49/0x60
proc_mkdir_data+0x35/0x90
register_handler_proc+0xef/0x110
? proc_register+0xfc/0x110
? proc_create_data+0x70/0xb0
__setup_irq+0x39b/0x660
? request_threaded_irq+0xad/0x160
request_threaded_irq+0xf5/0x160
? xennet_tx_buf_gc+0x1d0/0x1d0 [xen_netfront]
bind_evtchn_to_irqhandler+0x3d/0x70
? xenbus_alloc_evtchn+0x41/0xa0
netback_changed+0xa46/0xcda [xen_netfront]
? find_watch+0x40/0x40
xenwatch_thread+0xc5/0x160
? finish_wait+0x80/0x80
kthread+0x112/0x130
? kthread_create_worker_on_cpu+0x70/0x70
ret_from_fork+0x35/0x40
Code: 81 5c 00 48 85 c0 75 cc 5b 49 89 2e 31 c0 5d 4d 89 3c 24 41 5c 41 5d 41 5e 41 5f c3 4c 89 ee 48 c7 c7 40 4f 0e b4 e8 65 ea d8 ff <0f> 0b b8 fe ff ff ff 5b 5d 41 5c 41 5d 41 5e 41 5f c3 66 0f 1f
---[ end trace 650e5561b0caab3a ]---

Signed-off-by: Xiao Liang <xiliang@redhat.com>
Reviewed-by: Juergen Gross <jgross@suse.com>

Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1588bbed8e3e51770fa4d3ae7b2d1dc702ead73d
parent e5e2918d6ff0b1cbf137855ac22ec3edde251528
author Dominique Martinet <dominique.martinet@cea.fr> 1535409155 +0900
committer Sasha Levin <sashal@kernel.org> 1541992233 -0500

9p: clear dangling pointers in p9stat_free

[ Upstream commit 62e3941776fea8678bb8120607039410b1b61a65 ]

p9stat_free is more of a cleanup function than a 'free' function as it
only frees the content of the struct; there are chances of use-after-free
if it is improperly used (e.g. p9stat_free called twice as it used to be
possible to)

Clearing dangling pointers makes the function idempotent and safer to use.

Link: http://lkml.kernel.org/r/1535410108-20650-2-git-send-email-asmadeus@codewreck.org
Signed-off-by: Dominique Martinet <dominique.martinet@cea.fr>
Reported-by: syzbot+d4252148d198410b864f@syzkaller.appspotmail.com
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 3f72f569fa24346f24381a1bcc3e97fc27067a4a
parent a890623c72cae84fa675cf76a6a2af2a7407cbe9
author Mohammed Gamal <mgamal@redhat.com> 1522955360 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1525911539 -0400

hv_netvsc: Ensure correct teardown message sequence order

Prior to commit 0cf737808ae7 ("hv_netvsc: netvsc_teardown_gpadl() split")
the call sequence in netvsc_device_remove() was as follows (as
implemented in netvsc_destroy_buf()):
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Teardown receive buffer GPADL
3- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
4- Teardown send buffer GPADL
5- Close vmbus

This didn't work for WS2016 hosts. Commit 0cf737808ae7
("hv_netvsc: netvsc_teardown_gpadl() split") rearranged the
teardown sequence as follows:
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Close vmbus
4- Teardown receive buffer GPADL
5- Teardown send buffer GPADL

That worked well for WS2016 hosts, but it prevented guests on older hosts from
shutting down after changing network settings. Commit 0ef58b0a05c1
("hv_netvsc: change GPAD teardown order on older versions") ensured the
following message sequence for older hosts
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Teardown receive buffer GPADL
4- Teardown send buffer GPADL
5- Close vmbus

However, with this sequence calling `ip link set eth0 mtu 1000` hangs and the
process becomes uninterruptible. On futher analysis it turns out that on tearing
down the receive buffer GPADL the kernel is waiting indefinitely
in vmbus_teardown_gpadl() for a completion to be signaled.

Here is a snippet of where this occurs:
int vmbus_teardown_gpadl(struct vmbus_channel *channel, u32 gpadl_handle)
{
        struct vmbus_channel_gpadl_teardown *msg;
        struct vmbus_channel_msginfo *info;
        unsigned long flags;
        int ret;

        info = kmalloc(sizeof(*info) +
                       sizeof(struct vmbus_channel_gpadl_teardown), GFP_KERNEL);
        if (!info)
                return -ENOMEM;

        init_completion(&info->waitevent);
        info->waiting_channel = channel;
[....]
        ret = vmbus_post_msg(msg, sizeof(struct vmbus_channel_gpadl_teardown),
                             true);

        if (ret)
                goto post_msg_err;

        wait_for_completion(&info->waitevent);
[....]
}

The completion is signaled from vmbus_ongpadl_torndown(), which gets called when
the corresponding message is received from the host, which apparently never happens
in that case.
This patch works around the issue by restoring the first mentioned message sequence
for older hosts

Fixes: 0ef58b0a05c1 ("hv_netvsc: change GPAD teardown order on older versions")
Signed-off-by: Mohammed Gamal <mgamal@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 0d05bdc0d51e6b5d357b662d6489ef6501158933
parent 39f3b1a6878bd9d8c81443546c1115c38d18d44d
author Linus Torvalds <torvalds@linux-foundation.org> 1295392442 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1295392442 -0800

Linux 2.6.38-rc1
tree f25647b22daf2c4137b7f94b23650e8d56975d61
parent 4fe19a136a8871e5fc6e44d72979f18a4968c2ab
author Linus Torvalds <torvalds@linux-foundation.org> 1356139140 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1356139140 -0800

Linux 3.8-rc1
tree e0ba86dc2d66128cdc540d4a0f2e5b161a85201b
parent 90cb28e8f76e57751ffe14abd09c2d53a6aea7c8
author Linus Torvalds <torvalds@woody.osdl.org> 1168148751 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1168148751 -0800

Linux 2.6.20-rc4
tree 9b182c47688d261775f8c49e06cb795dfc8931dc
parent 20b1730af3ae05450b0e03f5aed40c4313f65db6
author Linus Torvalds <torvalds@g5.osdl.org> 1125272461 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1125272461 -0700

Linux v2.6.13
tree 0bba044c4ce775e45a88a51686b5d9f90697ea9d
author Linus Torvalds <torvalds@ppc970.osdl.org> 1113690036 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1113690036 -0700

Linux-2.6.12-rc2

Initial git repository build. I'm not bothering with the full history,
even though we have it. We can create a separate "historical" git
archive of that later if we want to, and in the meantime it's about
3.2GB when imported into git - space that would just make the early
git days unnecessarily complicated, when we don't have a lot of good
infrastructure for it.

Let it rip!
tree 64e6da828a9e1a0c9dc4fbe45a1172e689a22deb
parent 605f884d05cc0de8c3bde36281d58216011f51a5
author Linus Torvalds <torvalds@linux-foundation.org> 1408207226 -0600
committer Linus Torvalds <torvalds@linux-foundation.org> 1408207226 -0600

Linux 3.17-rc1
tree 8eb1b1b26f9fc2f1893e10bcfac57b1f3a285566
parent 59bf6c3c6c1e8463234015ae7690f5cdd991dffe
author Linus Torvalds <torvalds@linux-foundation.org> 1395021084 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1395021084 -0700

Linux 3.14-rc7
tree 2926875bc58aadc296c0690f066f5cdf693c058c
parent fd2cde594ad79c9ddba23fbf22d6a525c04dff59
author Eric W. Biederman <ebiederm@xmission.com> 1503007666 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1522903969 -0400

signal/arm: Document conflicts with SI_USER and SIGFPE

[ Upstream commit 7771c66457004977b616bab785209f49d164f527 ]

Setting si_code to 0 results in a userspace seeing an si_code of 0.
This is the same si_code as SI_USER.  Posix and common sense requires
that SI_USER not be a signal specific si_code.  As such this use of 0
for the si_code is a pretty horribly broken ABI.

Further use of si_code == 0 guaranteed that copy_siginfo_to_user saw a
value of __SI_KILL and now sees a value of SIL_KILL with the result
that uid and pid fields are copied and which might copying the si_addr
field by accident but certainly not by design.  Making this a very
flakey implementation.

Utilizing FPE_FIXME, siginfo_layout will now return SIL_FAULT and the
appropriate fields will be reliably copied.

Possible ABI fixes includee:
- Send the signal without siginfo
- Don't generate a signal
- Possibly assign and use an appropriate si_code
- Don't handle cases which can't happen

Cc: Russell King <rmk@flint.arm.linux.org.uk>
Cc: linux-arm-kernel@lists.infradead.org
Ref: 451436b7bbb2 ("[ARM] Add support code for ARM hardware vector floating point")
History Tree: https://git.kernel.org/pub/scm/linux/kernel/git/tglx/history.git
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree bddefd4242b0efba1068b5260f831c2697ba4037
parent 4cbbd1d55dd9375a455d12fc7e844809fbb795c0
author Linus Torvalds <torvalds@linux-foundation.org> 1367195761 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1367195761 -0700

Linux 3.9
tree 065e90f84331ef726ce1d573aeb421270ad2c409
parent 4c96fef7b372ceca7feb913183585089ed58aa5f
author Eric W. Biederman <ebiederm@xmission.com> 1503007666 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1522903892 -0400

signal/arm: Document conflicts with SI_USER and SIGFPE

[ Upstream commit 7771c66457004977b616bab785209f49d164f527 ]

Setting si_code to 0 results in a userspace seeing an si_code of 0.
This is the same si_code as SI_USER.  Posix and common sense requires
that SI_USER not be a signal specific si_code.  As such this use of 0
for the si_code is a pretty horribly broken ABI.

Further use of si_code == 0 guaranteed that copy_siginfo_to_user saw a
value of __SI_KILL and now sees a value of SIL_KILL with the result
that uid and pid fields are copied and which might copying the si_addr
field by accident but certainly not by design.  Making this a very
flakey implementation.

Utilizing FPE_FIXME, siginfo_layout will now return SIL_FAULT and the
appropriate fields will be reliably copied.

Possible ABI fixes includee:
- Send the signal without siginfo
- Don't generate a signal
- Possibly assign and use an appropriate si_code
- Don't handle cases which can't happen

Cc: Russell King <rmk@flint.arm.linux.org.uk>
Cc: linux-arm-kernel@lists.infradead.org
Ref: 451436b7bbb2 ("[ARM] Add support code for ARM hardware vector floating point")
History Tree: https://git.kernel.org/pub/scm/linux/kernel/git/tglx/history.git
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 739e2c9d0a682dd3951f15a806f0b3eb2d639d85
parent d3f8ddea444b3b5324d74144177a50557cd1f137
author Linus Torvalds <torvalds@linux-foundation.org> 1231630985 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1231630985 -0800

Linux 2.6.29-rc1
tree 4b104c0f760c6940d8ebdb7a84a75482c73309f9
parent 39f99860357cd710c2c952e16efbd534313acde4
author Sasha Levin <alexander.levin@verizon.com> 1480437290 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1480437290 -0500

Linux 4.1.36

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree dd32d0c38697805787c7da077f01b8ad847b8b51
parent 3f80fbff5f1ef8a842bbe5343bbc9ddad883f25c
author Linus Torvalds <torvalds@linux-foundation.org> 1305777994 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1305777994 -0700

Linux 2.6.39
tree 190a5700ed645117bed39435fd72411c2ee03cd8
parent 56991065c36aac44cc2b38dba6c1f038abcbfd8f
author Sasha Levin <alexander.levin@verizon.com> 1476022725 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1476062709 -0400

Linux 4.1.34

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree dee9f8b31f3d6d2fb141541da88e1cc1329b017e
parent 18b34d9a7a085ba8f9cafa6a0d002e2cbac87c1f
author Linus Torvalds <torvalds@linux-foundation.org> 1405285473 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1405285473 -0700

Linux 3.16-rc5
tree c3c2ab8ac7066c66b781386e7a02139e4eb7489d
parent 9ea66ab5805daafc60ccb16dd617f610832c76bb
author Linus Torvalds <torvalds@linux-foundation.org> 1241066896 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1241066896 -0700

Linux 2.6.30-rc4
tree cf04a498ae57e7caf0922f348476b9e693abadf8
parent 927b95ae2a11fbce016bed2fdb127d1280db1a7b
author Naoya Horiguchi <n-horiguchi@ah.jp.nec.com> 1536101151 -0700
committer Sasha Levin <sashal@kernel.org> 1538619774 -0400

tools/vm/page-types.c: fix "defined but not used" warning

[ Upstream commit 7ab660f8baecfe26c1c267fa8e64d2073feae2bb ]

debugfs_known_mountpoints[] is not used any more, so let's remove it.

Link: http://lkml.kernel.org/r/1535102651-19418-1-git-send-email-n-horiguchi@ah.jp.nec.com
Signed-off-by: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Matthew Wilcox <willy@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ca7702527674dbafa2162a1456a44270e6e40838
parent f4d43bd579f13219ffd3cae48432eab5bbac2d6f
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1180148114 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1180148114 -0700

Linux 2.6.22-rc3

It's that time of the year again.  Summer starts in the US, and people
want to sit at the beach with a new -rc candidate.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree b0a6034cff0bd5b64d7bdb21c7aff6c4cc5727c9
parent eac3b3747576cc2de12815528e67c3f1eab0d2d6
author Andrey Ryabinin <aryabinin@virtuozzo.com> 1462974711 +0300
committer Sasha Levin <alexander.levin@verizon.com> 1471786225 -0400

perf/x86: Fix undefined shift on 32-bit kernels

[ Upstream commit 6d6f2833bfbf296101f9f085e10488aef2601ba5 ]

Jim reported:

	UBSAN: Undefined behaviour in arch/x86/events/intel/core.c:3708:12
	shift exponent 35 is too large for 32-bit type 'long unsigned int'

The use of 'unsigned long' type obviously is not correct here, make it
'unsigned long long' instead.

Reported-by: Jim Cromie <jim.cromie@gmail.com>
Signed-off-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
Cc: <stable@vger.kernel.org>
Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
Cc: H. Peter Anvin <hpa@zytor.com>
Cc: Imre Palik <imrep@amazon.de>
Cc: Jiri Olsa <jolsa@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Stephane Eranian <eranian@google.com>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: Vince Weaver <vincent.weaver@maine.edu>
Fixes: 2c33645d366d ("perf/x86: Honor the architectural performance monitoring version")
Link: http://lkml.kernel.org/r/1462974711-10037-1-git-send-email-aryabinin@virtuozzo.com
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree e6b7c88faa3aa88fc01ffcd07b2eab62e2b4a0f6
parent 738ddd30397c25adfa9729257623ada96ef8ce96
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1186979124 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1186979124 -0700

Linux 2.6.23-rc3
tree 4c65538be7e6f9cd792f7ecb7edc6a661b13e557
parent 8eff7fbfc0e90fc5917b10488b2b658604372e9c
author Eugenia Emantayev <eugenia@mellanox.com> 1484233905 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1519768233 -0500

net/mlx5e: Increase Striding RQ minimum size limit to 4 multi-packet WQEs

[ Upstream commit d1c61e6d79ea0d4d53dc18bcd2db30ef2d99cfa7 ]

This is to prevent the case of working with a single MPWQE
(1 WQE is always reserved as RQ is linked-list).
When the WQE is fully consumed, HW should still have available buffer
in order not to drop packets.

Fixes: 461017cb006a ("net/mlx5e: Support RX multi-packet WQE (Striding RQ)")
Signed-off-by: Eugenia Emantayev <eugenia@mellanox.com>
Reviewed-by: Tariq Toukan <tariqt@mellanox.com>
Cc: kernel-team@fb.com
Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b8e26f8ffcab260659c60f14b107a73c99586e46
parent 8de861b16d946b7c0ce246fcbb65d550c357c65c
author Sasha Levin <sasha.levin@oracle.com> 1463795173 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1463795173 -0400

Linux 4.1.25

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b351a3085a204bec28d907eaeec48fe23576ddf9
parent 57498f9cb91be1eebea48f1dc833ebf162606ad5
author Linus Torvalds <torvalds@linux-foundation.org> 1385148655 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1385148655 -0800

Linux 3.13-rc1
tree 2a05120500502f9b843c97e28863decd6c4086fe
parent c2a897f96b9d06cc4273c45be482b5eb816742ec
author Josh Abraham <j.abraham1776@gmail.com> 1536801234 -1000
committer Sasha Levin <sashal@kernel.org> 1538619817 -0400

xen: fix GCC warning and remove duplicate EVTCHN_ROW/EVTCHN_COL usage

[ Upstream commit 4dca864b59dd150a221730775e2f21f49779c135 ]

This patch removes duplicate macro useage in events_base.c.

It also fixes gcc warning:
variable ‘col’ set but not used [-Wunused-but-set-variable]

Signed-off-by: Joshua Abraham <j.abraham1776@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 33e16caa76a37895c674f0007ab2f9be25e129bd
parent fba7e99458b606dc9a84332d38cd40e9d367633f
author Linus Torvalds <torvalds@linux-foundation.org> 1422850041 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1422850041 -0800

Linux 3.19-rc7
tree 267e45628d11e0db09b2f259398213e311468775
parent ce25d4fc92272c3fbaca54166f5b00daffef832f
author Daniele Palmas <dnlplm@gmail.com> 1527758309 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1528341361 -0400

net: usb: cdc_mbim: add flag FLAG_SEND_ZLP

[ Upstream commit 9f7c728332e8966084242fcd951aa46583bc308c ]

Testing Telit LM940 with ICMP packets > 14552 bytes revealed that
the modem needs FLAG_SEND_ZLP to properly work, otherwise the cdc
mbim data interface won't be anymore responsive.

Signed-off-by: Daniele Palmas <dnlplm@gmail.com>
Acked-by: Bjørn Mork <bjorn@mork.no>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 2af88cfd31810e45293179b8cfb9131e843c1e16
parent 164c09978cebebd8b5fc198e9243777dbaecdfa0
author Linus Torvalds <torvalds@linux-foundation.org> 1399252482 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1399252482 -0700

Linux 3.15-rc4
tree e5cbcd95c91c85eb73bd7ebfb892ed260fbac227
parent 80da619d749a1a929bcab85f93b6392cc1beeb99
author Damian Kos <dkos@cadence.com> 1542640454 +0000
committer Sasha Levin <sashal@kernel.org> 1556927732 -0400

drm/rockchip: fix for mailbox read validation.

[ Upstream commit e4056bbb6719fe713bfc4030ac78e8e97ddf7574 ]

This is basically the same fix as in
commit fa68d4f8476b ("drm/rockchip: fix for mailbox read size")
but for cdn_dp_mailbox_validate_receive function.

See patchwork.kernel.org/patch/10671981/ for details.

Signed-off-by: Damian Kos <dkos@cadence.com>
Signed-off-by: Heiko Stuebner <heiko@sntech.de>
Link: https://patchwork.freedesktop.org/patch/msgid/1542640463-18332-1-git-send-email-dkos@cadence.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 448cad09b349eeca84e3ace49b84c4b3b1468bf9
parent fad0262fc33194c93dd26c5f42c28c92ea81737a
author Bart Van Assche <bart.vanassche@wdc.com> 1530813095 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1536903939 -0400

IB/nes: Fix a compiler warning

[ Upstream commit 4c5743bc4fe3233cecc1c184a773c79c8ee45bbe ]

Avoid that the following compiler warning is reported when building with
W=1:

drivers/infiniband/hw/nes/nes_hw.c:646:51: warning: suggest braces around empty body in an 'if' statement [-Wempty-body]

Signed-off-by: Bart Van Assche <bart.vanassche@wdc.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 98a54a796cc54ef32ab9811795d571363689fc9c
parent 48857be64f5e9b8f5a54043732f4fa76e22f93f0
author Sergej Sawazki <sergej@taudac.com> 1501017662 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1520110274 -0500

clk: si5351: Rename internal plls to avoid name collisions

[ Upstream commit cdba9a4fb0b53703959ac861e415816cb61aded4 ]

This drivers probe fails due to a clock name collision if a clock named
'plla' or 'pllb' is already registered when registering this drivers
internal plls.

Fix it by renaming internal plls to avoid name collisions.

Cc: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
Cc: Rabeeh Khoury <rabeeh@solid-run.com>
Signed-off-by: Sergej Sawazki <sergej@taudac.com>
Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1896baf8b0c89d68229dc335dcd104f14eca84b8
parent c1dd3f51ad77ea76dddb72af8add962f579b8551
author Sasha Levin <alexander.levin@verizon.com> 1497532849 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1497532849 -0400

Linux 4.1.41

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree d7da25e2bacb7a8f579cf43caaa23d66ce4ca6d7
parent 80d5d1622c0ae8e490e320ee67f92e19ef465687
author Mathias Nyman <mathias.nyman@linux.intel.com> 1521210786 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1526734959 -0400

xhci: Show what USB release number the xHC supports from protocol capablity

[ Upstream commit 0ee78c101425aae681c631ba59c6ac7f44b1d83a ]

xhci driver displays the supported xHC USB revision in a message during
driver load:

"Host supports USB 3.1 Enhanced SuperSpeed"

Get the USB minor revision number from the xhci protocol capability.
This will show the correct supported revisions for new USB 3.2 and later
hosts

Don't rely on the SBRN (serial bus revision number) register, it's often
showing 0x30 (USB3.0) for hosts that support USB 3.1

Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 76b71fbfd1fb8e57726e834c1bb0cfa055e09241
parent 8e8ad4a07714556769f0bc5496b69c63b0fc902d
author Sasha Levin <sasha.levin@oracle.com> 1462939835 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1462939835 -0400

Linux 4.1.24

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree ba5bce2e97b5567491f09440cf190dd8000b4d08
parent 6bbc84e1645897b56dd3fd34b5a42de08dd6d0ec
author Nicholas Piggin <npiggin@gmail.com> 1504240196 +1000
committer Sasha Levin <alexander.levin@verizon.com> 1513783477 -0500

cpuidle: fix broadcast control when broadcast can not be entered

[ Upstream commit f187851b9b4a76952b1158b86434563dd2031103 ]

When failing to enter broadcast timer mode for an idle state that
requires it, a new state is selected that does not require broadcast,
but the broadcast variable remains set. This causes
tick_broadcast_exit to be called despite not having entered broadcast
mode.

This causes the WARN_ON_ONCE(!irqs_disabled()) to trigger in some
cases. It does not appear to cause problems for code today, but seems
to violate the interface so should be fixed.

Signed-off-by: Nicholas Piggin <npiggin@gmail.com>
Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 2b66baf73fb56b8c8a8c5d36e2082e3059cd0ca6
parent 82e0a5b7a4b73884d7252b64b24a310f25ce01f2
author J. Bruce Fields <bfields@redhat.com> 1528917695 -0400
committer Sasha Levin <alexander.levin@microsoft.com> 1537966327 -0400

nfsd: fix corrupted reply to badly ordered compound

[ Upstream commit 5b7b15aee641904ae269be9846610a3950cbd64c ]

We're encoding a single op in the reply but leaving the number of ops
zero, so the reply makes no sense.

Somewhat academic as this isn't a case any real client will hit, though
in theory perhaps that could change in a future protocol extension.

Reviewed-by: Jeff Layton <jlayton@kernel.org>
Signed-off-by: J. Bruce Fields <bfields@redhat.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7839c0d9dfaf0146ae3b426cf036d1e3b8d9656c
parent df20ce5a6fa618e236ff6b33ee88413d6f1bfa0a
author Linus Torvalds <torvalds@linux-foundation.org> 1417394547 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1417394547 -0800

Linux 3.18-rc7
tree 8b4b4b93ae019446b012d7807f7d95c8e5c857a7
parent 075d6adf909ac8706bd0be7832e6dadb0aef314b
author Linus Torvalds <torvalds@g5.osdl.org> 1152158989 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1152158989 -0700

Linux 2.6.18-rc1

It's all good.
tree d727ab1f1b48bbd938c6b7f10538662ff80252ef
parent 7d0dbc92e9b574795fd153a669c868f277fe9588
author Peter Zijlstra <peterz@infradead.org> 1515608588 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1517979582 -0500

perf/x86: Fix perf,x86,cpuhp deadlock

[ Upstream commit efe951d3de9141626a494bcb1efb0650eaef6491 ]

More lockdep gifts, a 5-way lockup race:

	perf_event_create_kernel_counter()
	  perf_event_alloc()
	    perf_try_init_event()
	      x86_pmu_event_init()
		__x86_pmu_event_init()
		  x86_reserve_hardware()
 #0		    mutex_lock(&pmc_reserve_mutex);
		    reserve_ds_buffer()
 #1		      get_online_cpus()

	perf_event_release_kernel()
	  _free_event()
	    hw_perf_event_destroy()
	      x86_release_hardware()
 #0		mutex_lock(&pmc_reserve_mutex)
		release_ds_buffer()
 #1		  get_online_cpus()

 #1	do_cpu_up()
	  perf_event_init_cpu()
 #2	    mutex_lock(&pmus_lock)
 #3	    mutex_lock(&ctx->mutex)

	sys_perf_event_open()
	  mutex_lock_double()
 #3	    mutex_lock(ctx->mutex)
 #4	    mutex_lock_nested(ctx->mutex, 1);

	perf_try_init_event()
 #4	  mutex_lock_nested(ctx->mutex, 1)
	  x86_pmu_event_init()
	    intel_pmu_hw_config()
	      x86_add_exclusive()
 #0		mutex_lock(&pmc_reserve_mutex)

Fix it by using ordering constructs instead of locking.

Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
Cc: Alexander Shishkin <alexander.shishkin@linux.intel.com>
Cc: Arnaldo Carvalho de Melo <acme@redhat.com>
Cc: Jiri Olsa <jolsa@redhat.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Stephane Eranian <eranian@google.com>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: Vince Weaver <vincent.weaver@maine.edu>
Cc: linux-kernel@vger.kernel.org
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6685232d289279d2169b2f0b80453a18f29bb792
parent cee58483cf56e0ba355fdd97ff5e8925329aa936
author Linus Torvalds <torvalds@linux-foundation.org> 1346521198 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1346521198 -0700

Linux 3.6-rc4
tree dc628a7fe344465fffe8a955e11e0bb770ed3d60
parent 9128b040eb774e04bc23777b005ace2b66ab2a85
author Linus Torvalds <torvalds@linux-foundation.org> 1425402299 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1425402299 -0800

Linux 4.0-rc2
tree 129a2431aae7c67fd8be56c1d16359ba83922cf2
parent 3b03117c5cfbb04175b688c79ea4155b8ef812d3
author Linus Torvalds <torvalds@linux-foundation.org> 1275250862 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1275250862 -0700

Linux 2.6.35-rc1

.. and thus endeth the merge window.
tree a610f485f369d35189dd1a089ccd51b17c58d011
parent fe5a2de17e65d82b9d502da80ccb5a689d03fdd2
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1183937537 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1183937537 -0700

Linux 2.6.22

Woo-hoo. I'm sure somebody will report a "this doesn't compile, and
I have a new root exploit" five minutes after release, but it still
feels good ;)

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 38c5cb9e5e096264b903d1f85b5ef984c4722a0f
parent aee23d958d738186b877f085c05ed5d14ec23cce
author Miaoqing Pan <miaoqing@codeaurora.org> 1506474814 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1513265064 -0500

ath9k: fix tx99 potential info leak

[ Upstream commit ee0a47186e2fa9aa1c56cadcea470ca0ba8c8692 ]

When the user sets count to zero the string buffer would remain
completely uninitialized which causes the kernel to parse its
own stack data, potentially leading to an info leak. In addition
to that, the string might be not terminated properly when the
user data does not contain a 0-terminator.

Signed-off-by: Miaoqing Pan <miaoqing@codeaurora.org>
Reviewed-by: Christoph Böhmwalder <christoph@boehmwalder.at>
Signed-off-by: Kalle Valo <kvalo@qca.qualcomm.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree ca8d242fd23cc9d715c89527a211d673f0f461a3
parent 79e615420c3d7426a117aa825bdb1483b927e429
author Linus Torvalds <torvalds@linux-foundation.org> 1394419317 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1394419317 -0700

Linux 3.14-rc6
tree 5479de58bf66be5f416ace8cf2526759eb16a34f
parent db1003f23189cdbb2d450dff1edbc8e318797344
author Linus Torvalds <torvalds@linux-foundation.org> 1401059160 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1401059160 -0700

Linux 3.15-rc7
tree 85332a118faafbd6839183cc67ccab092d81e0fd
parent 65d9055ea39c07671bc41a8cd1ace9aaa6e1bc70
author Linus Torvalds <torvalds@linux-foundation.org> 1297123397 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1297123435 -0800

Linux 2.6.38-rc4
tree a8af712e7b90524847bda63e8f7b41e55881c9b6
parent 8e0c8b353c4492ef708511aefc3abfc0a244e300
author Lucas Stach <l.stach@pengutronix.de> 1555084780 +0200
committer Sasha Levin <sashal@kernel.org> 1556927661 -0400

gpu: ipu-v3: dp: fix CSC handling

[ Upstream commit d4fad0a426c6e26f48c9a7cdd21a7fe9c198d645 ]

Initialize the flow input colorspaces to unknown and reset to that value
when the channel gets disabled. This avoids the state getting mixed up
with a previous mode.

Also keep the CSC settings for the background flow intact when disabling
the foreground flow.

Root-caused-by: Jonathan Marek <jonathan@marek.ca>
Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 837c4e35ea5ea64161a9cd9be8f61f27e1a7bea4
parent 1850a4b4ebd5c1507bb152d31e129c9f5d7bb0c6
author Richard Weinberger <richard@nod.at> 1536008783 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1538313630 -0400

ubifs: Check for name being NULL while mounting

[ Upstream commit 37f31b6ca4311b94d985fb398a72e5399ad57925 ]

The requested device name can be NULL or an empty string.
Check for that and refuse to continue. UBIFS has to do this manually
since we cannot use mount_bdev(), which checks for this condition.

Fixes: 1e51764a3c2ac ("UBIFS: add new flash file system")
Reported-by: syzbot+38bd0f7865e5c6379280@syzkaller.appspotmail.com
Signed-off-by: Richard Weinberger <richard@nod.at>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d6a235d4d8a5ea4a80bfbdc2314dd92fdd88f915
parent 086b17046c068ef3fa6e69c03c786b39ca617a0a
author Linus Torvalds <torvalds@linux-foundation.org> 1291694944 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1291694944 -0800

Linux 2.6.37-rc5
tree 031bc7fd6f6df704cb7aa114bf051cc1561f9c4f
parent b3b75cef705708402b5d381a30fa17f89e0549b4
author Linus Torvalds <torvalds@linux-foundation.org> 1254088668 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1254088668 -0700

Linux 2.6.32-rc1
tree 20226f3dfee26bfc00c8342de4dd5e6d2682ce08
parent 315917d23fdd20a0f4ff99b9228de5840d9d276c
author Linus Torvalds <torvalds@woody.osdl.org> 1164837457 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1164837457 -0800

Linux 2.6.19

It's all good.
tree bb2f5ce4327865835636db37dee885a1ef62484e
parent f50bf2b2f5e83b794e0bdb2f3f589f55ef0d52d0
author Linus Torvalds <torvalds@linux-foundation.org> 1246730328 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1246730328 -0700

Linux 2.6.31-rc2
tree 39ed7fda125cdeca0c7b6c5777aa1cb47fecbe78
parent c7b285550544c22bc005ec20978472c9ac7138c6
author Linus Torvalds <torvalds@linux-foundation.org> 1331416192 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1331416192 -0800

Linux 3.3-rc7
tree 72c47986f69313d67dbfb9663d68260ed1695201
parent 432273c710ae564a9530f44c0deb92b9e7a463d8
author Sasha Levin <alexander.levin@verizon.com> 1471873848 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1471873848 -0400

Linux 4.1.31

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 911705a4e0d2f8b368889addb2c13c44bf6a8fcf
parent 3aa0ce825ade0cf5506e32ccf51d01fc8d22a9cf
author Linus Torvalds <torvalds@linux-foundation.org> 1287098803 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1287098803 -0700

Linux 2.6.36-rc8
tree 550bbe61357f33e46557976b6e0067ad3467f29a
parent e7b526bb852cdd67b24e174da6850222f8da41b1
author Linus Torvalds <torvalds@linux-foundation.org> 1275795804 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1275795804 -0700

Linux 2.6.35-rc2
tree d3c74ca730fc09416e1c355d3b6c7ff4ec22fff6
parent 5420276a7c9bb09b24f17c8bbd51aef5fe191aa8
author Jann Horn <jannh@google.com> 1538779923 -0700
committer Sasha Levin <sashal@kernel.org> 1539641088 -0400

mm/vmstat.c: fix outdated vmstat_text

[ Upstream commit 28e2c4bb99aa40f9d5f07ac130cbc4da0ea93079 ]

7a9cdebdcc17 ("mm: get rid of vmacache_flush_all() entirely") removed the
VMACACHE_FULL_FLUSHES statistics, but didn't remove the corresponding
entry in vmstat_text.  This causes an out-of-bounds access in
vmstat_show().

Luckily this only affects kernels with CONFIG_DEBUG_VM_VMACACHE=y, which
is probably very rare.

Link: http://lkml.kernel.org/r/20181001143138.95119-1-jannh@google.com
Fixes: 7a9cdebdcc17 ("mm: get rid of vmacache_flush_all() entirely")
Signed-off-by: Jann Horn <jannh@google.com>
Reviewed-by: Kees Cook <keescook@chromium.org>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Acked-by: Roman Gushchin <guro@fb.com>
Cc: Davidlohr Bueso <dave@stgolabs.net>
Cc: Oleg Nesterov <oleg@redhat.com>
Cc: Christoph Lameter <clameter@sgi.com>
Cc: Kemi Wang <kemi.wang@intel.com>
Cc: Andy Lutomirski <luto@kernel.org>
Cc: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree a3fc1f3d3ed06cae9b83850bcd9aadb957849f20
parent efc968d450e013049a662d22727cf132618dcb2f
author Linus Torvalds <torvalds@linux-foundation.org> 1223590433 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1223590433 -0700

Linux 2.6.27
tree 579865877539ddc598d6b5916cb509e85a972268
parent 7d7c4d06be246b249f0f7e0b7df2f73d09cc6376
author Linus Torvalds <torvalds@linux-foundation.org> 1287606622 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1287606622 -0700

Linux 2.6.36
tree 59c7153a43c359c9d02e6bd2c745e765439c4ae8
parent 2fb90b128aaf7758e3de22119515fb11174d4f23
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1177556912 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1177556912 -0700

Linux 2.6.21

.. ok, enough waffling about it already. "Just do it!"

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 93d3332f46f415701bb371604b1a30874ae1fa3e
parent bb75775fccb4f20a810fcb942be91a53238334d5
author Changbin Du <changbin.du@gmail.com> 1553527007 +0000
committer Sasha Levin (Microsoft) <sashal@kernel.org> 1555464127 -0400

kconfig/[mn]conf: handle backspace (^H) key

[ Upstream commit 9c38f1f044080392603c497ecca4d7d09876ff99 ]

Backspace is not working on some terminal emulators which do not send the
key code defined by terminfo. Terminals either send '^H' (8) or '^?' (127).
But currently only '^?' is handled. Let's also handle '^H' for those
terminals.

Signed-off-by: Changbin Du <changbin.du@gmail.com>
Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree ed0cdc81e72343132da9f52620ec40391f6dcbed
parent 72932611b4b05bbd89fafa369d564ac8e449809b
author Linus Torvalds <torvalds@linux-foundation.org> 1362959659 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1362959659 -0700

Linux 3.9-rc2
tree 2327eb4ca9f4884e8e3817060e8128063a1b9c35
parent 508862e493f1107d17fa5a0015084b1773ffc41e
author Linus Torvalds <torvalds@g5.osdl.org> 1131759816 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1131759816 -0800

Linux v2.6.15-rc1

As per the new release rules: two weeks of merging, and then an -rc1 and
calming down for the next release.
tree 4616b0363de156dbda6a201e2efd5da24ad01bad
parent f4e52e7ffdea791c89494752b175b991090f0920
author Linus Torvalds <torvalds@linux-foundation.org> 1333848641 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1333848641 -0700

Linux 3.4-rc2
tree 7995334f800f5ea27d17ebf0abe4862cbc980b07
parent 944a95511d75c2aae5d47975f990aa2b26e14c1b
author Joerg Roedel <jroedel@suse.de> 1555066231 +0200
committer Sasha Levin <sashal@kernel.org> 1556243670 -0400

iommu/amd: Set exclusion range correctly

[ Upstream commit 3c677d206210f53a4be972211066c0f1cd47fe12 ]

The exlcusion range limit register needs to contain the
base-address of the last page that is part of the range, as
bits 0-11 of this register are treated as 0xfff by the
hardware for comparisons.

So correctly set the exclusion range in the hardware to the
last page which is _in_ the range.

Fixes: b2026aa2dce44 ('x86, AMD IOMMU: add functions for programming IOMMU MMIO space')
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 3789bc18f7c3bc5f9552b1cde5379de38d748058
parent 9d66586f7723b73c5925c7c7819c260484627851
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1182046152 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1182046152 -0700

Linux 2.6.22-rc5

The manatees, they are dancing!

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree a9c6e1639313aa63de71cc667ec25681b33edf2b
parent feaf222925cdfbc841a695fd30df8c6d0a694146
author Linus Torvalds <torvalds@linux-foundation.org> 1424658074 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1424658074 -0800

Linux 4.0-rc1

.. after extensive statistical analysis of my G+ polling, I've come to
the inescapable conclusion that internet polls are bad.

Big surprise.

But "Hurr durr I'ma sheep" trounced "I like online polls" by a 62-to-38%
margin, in a poll that people weren't even supposed to participate in.
Who can argue with solid numbers like that? 5,796 votes from people who
can't even follow the most basic directions?

In contrast, "v4.0" beat out "v3.20" by a slimmer margin of 56-to-44%,
but with a total of 29,110 votes right now.

Now, arguably, that vote spread is only about 3,200 votes, which is less
than the almost six thousand votes that the "please ignore" poll got, so
it could be considered noise.

But hey, I asked, so I'll honor the votes.
tree 543e802e177aef5d41ea767e6f519d7d41eccc19
parent 6015d2c4ca5470509d9721d7bab8d796617ed996
author Linus Torvalds <torvalds@g5.osdl.org> 1133673042 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1133673042 -0800

Linux v2.6.15-rc5

Hey, for no other reason than the fact that I'll be off-line for a
week.

Of course, I could force everybody to just use git (and when I'm emperor
of the world, don't think I won't!), but it seems some people want to
just test official releases.  Even if they are just -rc's.

By the time I'm back, Andrew will have fixed all my bugs, and I'll
release it as 2.6.15 and take all the credit.

Mwahahahaaa

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree bab2992ceb2867672a0c4a1e771a130e989d5352
parent 73ea93b189fc5717d232bc4881a3dca5244d8e35
author Mark Salter <msalter@redhat.com> 1517581229 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1523804551 -0400

irqchip/gic-v3: Change pr_debug message to pr_devel

[ Upstream commit b6dd4d83dc2f78cebc9a7e6e7e4bc2be4d29b94d ]

The pr_debug() in gic-v3 gic_send_sgi() can trigger a circular locking
warning:

 GICv3: CPU10: ICC_SGI1R_EL1 5000400
 ======================================================
 WARNING: possible circular locking dependency detected
 4.15.0+ #1 Tainted: G        W
 ------------------------------------------------------
 dynamic_debug01/1873 is trying to acquire lock:
  ((console_sem).lock){-...}, at: [<0000000099c891ec>] down_trylock+0x20/0x4c

 but task is already holding lock:
  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 which lock already depends on the new lock.

 the existing dependency chain (in reverse order) is:

 -> #2 (&rq->lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock+0x4c/0x60
        task_fork_fair+0x3c/0x148
        sched_fork+0x10c/0x214
        copy_process.isra.32.part.33+0x4e8/0x14f0
        _do_fork+0xe8/0x78c
        kernel_thread+0x48/0x54
        rest_init+0x34/0x2a4
        start_kernel+0x45c/0x488

 -> #1 (&p->pi_lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        try_to_wake_up+0x48/0x600
        wake_up_process+0x28/0x34
        __up.isra.0+0x60/0x6c
        up+0x60/0x68
        __up_console_sem+0x4c/0x7c
        console_unlock+0x328/0x634
        vprintk_emit+0x25c/0x390
        dev_vprintk_emit+0xc4/0x1fc
        dev_printk_emit+0x88/0xa8
        __dev_printk+0x58/0x9c
        _dev_info+0x84/0xa8
        usb_new_device+0x100/0x474
        hub_port_connect+0x280/0x92c
        hub_event+0x740/0xa84
        process_one_work+0x240/0x70c
        worker_thread+0x60/0x400
        kthread+0x110/0x13c
        ret_from_fork+0x10/0x18

 -> #0 ((console_sem).lock){-...}:
        validate_chain.isra.34+0x6e4/0xa20
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        down_trylock+0x20/0x4c
        __down_trylock_console_sem+0x3c/0x9c
        console_trylock+0x20/0xb0
        vprintk_emit+0x254/0x390
        vprintk_default+0x58/0x90
        vprintk_func+0xbc/0x164
        printk+0x80/0xa0
        __dynamic_pr_debug+0x84/0xac
        gic_raise_softirq+0x184/0x18c
        smp_cross_call+0xac/0x218
        smp_send_reschedule+0x3c/0x48
        resched_curr+0x60/0x9c
        check_preempt_curr+0x70/0xdc
        wake_up_new_task+0x310/0x470
        _do_fork+0x188/0x78c
        SyS_clone+0x44/0x50
        __sys_trace_return+0x0/0x4

 other info that might help us debug this:

 Chain exists of:
   (console_sem).lock --> &p->pi_lock --> &rq->lock

  Possible unsafe locking scenario:

        CPU0                    CPU1
        ----                    ----
   lock(&rq->lock);
                                lock(&p->pi_lock);
                                lock(&rq->lock);
   lock((console_sem).lock);

  *** DEADLOCK ***

 2 locks held by dynamic_debug01/1873:
  #0:  (&p->pi_lock){-.-.}, at: [<000000001366df53>] wake_up_new_task+0x40/0x470
  #1:  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 stack backtrace:
 CPU: 10 PID: 1873 Comm: dynamic_debug01 Tainted: G        W        4.15.0+ #1
 Hardware name: GIGABYTE R120-T34-00/MT30-GS2-00, BIOS T48 10/02/2017
 Call trace:
  dump_backtrace+0x0/0x188
  show_stack+0x24/0x2c
  dump_stack+0xa4/0xe0
  print_circular_bug.isra.31+0x29c/0x2b8
  check_prev_add.constprop.39+0x6c8/0x6dc
  validate_chain.isra.34+0x6e4/0xa20
  __lock_acquire+0x3b4/0x6e0
  lock_acquire+0xf4/0x2a8
  _raw_spin_lock_irqsave+0x58/0x70
  down_trylock+0x20/0x4c
  __down_trylock_console_sem+0x3c/0x9c
  console_trylock+0x20/0xb0
  vprintk_emit+0x254/0x390
  vprintk_default+0x58/0x90
  vprintk_func+0xbc/0x164
  printk+0x80/0xa0
  __dynamic_pr_debug+0x84/0xac
  gic_raise_softirq+0x184/0x18c
  smp_cross_call+0xac/0x218
  smp_send_reschedule+0x3c/0x48
  resched_curr+0x60/0x9c
  check_preempt_curr+0x70/0xdc
  wake_up_new_task+0x310/0x470
  _do_fork+0x188/0x78c
  SyS_clone+0x44/0x50
  __sys_trace_return+0x0/0x4
 GICv3: CPU0: ICC_SGI1R_EL1 12000

This could be fixed with printk_deferred() but that might lessen its
usefulness for debugging. So change it to pr_devel to keep it out of
production kernels. Developers working on gic-v3 can enable it as
needed in their kernels.

Signed-off-by: Mark Salter <msalter@redhat.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree a964c292adc81dcf766a5416ae05172c99353db5
parent 0a4ebed781dbb9ecbfef2374d29da1ab3b1a63f3
author Linus Torvalds <torvalds@linux-foundation.org> 1322780161 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1322780161 -0800

Linux 3.2-rc4
tree b609c0402373af517a0a63485be1f21e4259b2c8
parent 3962dfbe22a8d65e4162354cc859440293d85524
author Linus Torvalds <torvalds@linux-foundation.org> 1392586225 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1392586225 -0800

Linux 3.14-rc3
tree 09d7969ea84bf168d37cedc6d8bcd58b2487663c
parent 3b244a6e53dc33f6701bfde8601d7677c0c6e9e8
author Sasha Levin <alexander.levin@verizon.com> 1477166753 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1477265872 -0400

Linux 4.1.35

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 2b01485b56b8132f938004ef22e841b6f78c0579
parent cbc99f9429d6978a4b6310250e3cfe1b2bf2d9fd
author Finn Thain <fthain@telegraphics.com.au> 1527649431 +1000
committer Sasha Levin <alexander.levin@microsoft.com> 1528400415 -0400

net/sonic: Use dma_mapping_error()

[ Upstream commit 26de0b76d9ba3200f09c6cb9d9618bda338be5f7 ]

With CONFIG_DMA_API_DEBUG=y, calling sonic_open() produces the
message, "DMA-API: device driver failed to check map error".
Add the missing dma_mapping_error() call.

Cc: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
Signed-off-by: Finn Thain <fthain@telegraphics.com.au>
Acked-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 037f2ddbc68584edc58b3bbd2e1370c4c0361e7f
parent 79051db9aedf7d169458a879accd1beda8f0cf8b
author Linus Torvalds <torvalds@linux-foundation.org> 1257277069 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1257277069 -0800

Linux 2.6.32-rc6
tree 9573fd2b945db53c54e7542fafd677f262f593df
parent 2f774456e4b9bc3d4fb3522b2482c7acfa2df197
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1173242480 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1173242480 -0800

Linux 2.6.21-rc3

.. hopefully most of the resume/suspend problems introduced by the timer
and other changes are behind us.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 24f55d9b553ae70ee44f41d38cefb6669538d50d
parent 08406204d43f00d93398c57fe25cd31ae0ae8f27
author Vignesh R <vigneshr@ti.com> 1513680676 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1520105931 -0500

dmaengine: ti-dma-crossbar: Fix event mapping for TPCC_EVT_MUX_60_63

[ Upstream commit d087f15786021a9605b20f4c678312510be4cac1 ]

Register layout of a typical TPCC_EVT_MUX_M_N register is such that the
lowest numbered event is at the lowest byte address and highest numbered
event at highest byte address. But TPCC_EVT_MUX_60_63 register layout is
different,  in that the lowest numbered event is at the highest address
and highest numbered event is at the lowest address. Therefore, modify
ti_am335x_xbar_write() to handle TPCC_EVT_MUX_60_63 register
accordingly.

Signed-off-by: Vignesh R <vigneshr@ti.com>
Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 0aa611fea7d21d18e36398b061394c01298a3a4d
parent 02376a52fa3bab6ad0ead626baa84cce4b09b77a
author Rasmus Villemoes <linux@rasmusvillemoes.dk> 1552572374 +0100
committer Sasha Levin <sashal@kernel.org> 1556801906 -0400

leds: trigger: netdev: use memcpy in device_name_store

[ Upstream commit 909346433064b8d840dc82af26161926b8d37558 ]

If userspace doesn't end the input with a newline (which can easily
happen if the write happens from a C program that does write(fd,
iface, strlen(iface))), we may end up including garbage from a
previous, longer value in the device_name. For example

# cat device_name

# printf 'eth12' > device_name
# cat device_name
eth12
# printf 'eth3' > device_name
# cat device_name
eth32

I highly doubt anybody is relying on this behaviour, so switch to
simply copying the bytes (we've already checked that size is <
IFNAMSIZ) and unconditionally zero-terminate it; of course, we also
still have to strip a trailing newline.

This is also preparation for future patches.

Fixes: 06f502f57d0d ("leds: trigger: Introduce a NETDEV trigger")
Signed-off-by: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Acked-by: Pavel Machek <pavel@ucw.cz>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree 13770cd135653636125b334a2a1d1e2dbf1616f3
parent 33052057e3e2db7f37fc78aa3f25c98f7e989fae
author Linus Torvalds <torvalds@g5.osdl.org> 1138946588 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1138946588 -0800

Linux v2.6.16-rc2
tree adc2a539ff621b90d2868e8b246d31fdf601a53a
parent 5a5210c6adaddbed823162eb76dfdbac72bdb802
author Linus Torvalds <torvalds@linux-foundation.org> 1351452288 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1351452288 -0700

Linux 3.7-rc3
tree 3178a4cfa4bc256188a400309af42098e9cc39e9
parent ef0680a31df994e1d77b840f37772ff727cdc8ca
author Sasha Levin <alexander.levin@verizon.com> 1508194493 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1508194493 -0400

Linux 4.1.45

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 5c786f9c2e6514cbe123286cc8ce47c6d905853e
parent 843f4f4bb1a2c4c196a1af1d18bb6477a580ac78
author Linus Torvalds <torvalds@linux-foundation.org> 1386351244 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1386351244 -0800

Linux 3.13-rc3
tree 8a29ebd7cc12d1da1bc9a41ed4267551a8c99542
parent f6062a9ea0edc4b6541ec9610acaf24dc3d2ba7d
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1540684258 -0400

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree d739c8075787af92c9cfa4e8fbce3a70cc29da43
parent 1b364bf438cf337a3818aee77d68c0713f3e1fc4
author Linus Torvalds <torvalds@linux-foundation.org> 1251421144 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1251421144 -0700

Linux 2.6.31-rc8
tree 8aa7b05bd09bcd36eaca256bdcc41fc57b942425
parent c20137fc5329eaf24093fc48c52608dc66be8e5c
author Linus Torvalds <torvalds@linux-foundation.org> 1230161197 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1230161197 -0800

Linux 2.6.28

Happy holidays..
tree 7544da72f82fdae5f27071c26d6e3cb99af52312
parent 55fa2435353b9f024674c841a9a2caef32adf4f8
author Roland Dreier <roland@purestorage.com> 1532056079 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1533735160 -0400

nvme: fix handling of metadata_len for NVME_IOCTL_IO_CMD

[ Upstream commit 9b382768135ee3ff282f828c906574a8478e036b ]

The old code in nvme_user_cmd() passed the userspace virtual address
from nvme_passthru_cmd.metadata as the length of the metadata buffer
as well as the address to nvme_submit_user_cmd().

Fixes: 63263d60 ("nvme: Use metadata for passthrough commands")
Signed-off-by: Roland Dreier <roland@purestorage.com>
Reviewed-by: Keith Busch <keith.busch@intel.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 71672b95cb424f90aad9da03c9e64daa007d3b0a
parent 318d7ca3635059617a2195ebe63de2c0b0ba78db
author Pan Bian <bianpan2016@163.com> 1555659540 +0000
committer Sasha Levin <sashal@kernel.org> 1556927644 -0400

Input: synaptics-rmi4 - fix possible double free

[ Upstream commit bce1a78423961fce676ac65540a31b6ffd179e6d ]

The RMI4 function structure has been released in rmi_register_function
if error occurs. However, it will be released again in the function
rmi_create_function, which may result in a double-free bug.

Signed-off-by: Pan Bian <bianpan2016@163.com>
Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree cba0118a6402f3a512d9a0f1472805c388cf549b
parent 0aa9a43c88c270166442a4cf23ad84070064d043
author Ard Biesheuvel <ard.biesheuvel@linaro.org> 1548331618 +0100
committer Sasha Levin <sashal@kernel.org> 1552347154 -0400

drm: disable uncached DMA optimization for ARM and arm64

[ Upstream commit e02f5c1bb2283cfcee68f2f0feddcc06150f13aa ]

The DRM driver stack is designed to work with cache coherent devices
only, but permits an optimization to be enabled in some cases, where
for some buffers, both the CPU and the GPU use uncached mappings,
removing the need for DMA snooping and allocation in the CPU caches.

The use of uncached GPU mappings relies on the correct implementation
of the PCIe NoSnoop TLP attribute by the platform, otherwise the GPU
will use cached mappings nonetheless. On x86 platforms, this does not
seem to matter, as uncached CPU mappings will snoop the caches in any
case. However, on ARM and arm64, enabling this optimization on a
platform where NoSnoop is ignored results in loss of coherency, which
breaks correct operation of the device. Since we have no way of
detecting whether NoSnoop works or not, just disable this
optimization entirely for ARM and arm64.

Cc: Christian Koenig <christian.koenig@amd.com>
Cc: Alex Deucher <alexander.deucher@amd.com>
Cc: David Zhou <David1.Zhou@amd.com>
Cc: Huang Rui <ray.huang@amd.com>
Cc: Junwei Zhang <Jerry.Zhang@amd.com>
Cc: Michel Daenzer <michel.daenzer@amd.com>
Cc: David Airlie <airlied@linux.ie>
Cc: Daniel Vetter <daniel@ffwll.ch>
Cc: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
Cc: Maxime Ripard <maxime.ripard@bootlin.com>
Cc: Sean Paul <sean@poorly.run>
Cc: Michael Ellerman <mpe@ellerman.id.au>
Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Cc: Will Deacon <will.deacon@arm.com>
Cc: Christoph Hellwig <hch@infradead.org>
Cc: Robin Murphy <robin.murphy@arm.com>
Cc: amd-gfx list <amd-gfx@lists.freedesktop.org>
Cc: dri-devel <dri-devel@lists.freedesktop.org>
Reported-by: Carsten Haitzler <Carsten.Haitzler@arm.com>
Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Reviewed-by: Christian König <christian.koenig@amd.com>
Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
Link: https://patchwork.kernel.org/patch/10778815/
Signed-off-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree b9d4a6c05c3594108db6d968be38d7ea451f54a0
parent 00460dd5f4b886f72699f2245206c935f9fd4b82
author Linus Torvalds <torvalds@linux-foundation.org> 1207079066 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1207079066 -0700

Linux 2.6.25-rc8
tree 974d556fca923439bc59150496e046824355137d
parent c0643ecfc7ef2e5fce522e7c86f858bf43d43a48
author Russell King <rmk+kernel@armlinux.org.uk> 1523467441 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1527952923 -0400

ARM: kexec: fix kdump register saving on panic()

[ Upstream commit 2d7b3c64431245c95b05a441669c074da10db943 ]

When a panic() occurs, the kexec code uses smp_send_stop() to stop
the other CPUs, but this results in the CPU register state not being
saved, and gdb is unable to inspect the state of other CPUs.

Commit 0ee59413c967 ("x86/panic: replace smp_send_stop() with kdump
friendly version in panic path") addressed the issue on x86, but
ignored other architectures.  Address the issue on ARM by splitting
out the crash stop implementation to crash_smp_send_stop() and
adding the necessary protection.

Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d3dcad48d2d3956f4e862fb690e0dcb814c148e2
parent e56c75617259652cad3103c78c829277aa3c0bab
author Linus Torvalds <torvalds@linux-foundation.org> 1375649206 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1375649206 -0700

Linux 3.11-rc4
tree 1813b464853cba4439b3c30412059ed6284114a0
parent 4d78b6c78ae6d87e4c1c8072f42efa716f04afb9
author Linus Torvalds <torvalds@ppc970.osdl.org> 1114039461 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1114039461 -0700

Linux v2.6.12-rc3

Releasing this will also make "git" the official source control
thing. Here's to hoping for the best.
tree ecf99d6087991ff47772b004ae40b67eeeef0713
parent 28f4991dda2ff28285bf14f961fefe8a4e3dba45
author Kangjie Lu <kjlu@umn.edu> 1552111451 -0600
committer Sasha Levin <sashal@kernel.org> 1556801937 -0400

leds: pca9532: fix a potential NULL pointer dereference

[ Upstream commit 0aab8e4df4702b31314a27ec4b0631dfad0fae0a ]

In case of_match_device cannot find a match, return -EINVAL to avoid
NULL pointer dereference.

Fixes: fa4191a609f2 ("leds: pca9532: Add device tree support")
Signed-off-by: Kangjie Lu <kjlu@umn.edu>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree eee42ff74d10470789d919b8499737ad0e919360
parent a5ef3f7dcba17e79c21afec38188c4c6a0baf995
author Linus Torvalds <torvalds@linux-foundation.org> 1350250864 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1350250864 -0700

Linux 3.7-rc1
tree db194367d7b9fbfd8cd72157914e7b9323f5cf38
parent cc1e95eaa2f5a69a9e501fb4abd1859f32dae893
author Łukasz Stelmach <l.stelmach@samsung.com> 1522742697 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1528182609 -0400

ARM: 8753/1: decompressor: add a missing parameter to the addruart macro

[ Upstream commit e07e3c33b9c0b5751ade624f44325c9bf2487ea6 ]

In commit 639da5ee374b ("ARM: add an extra temp register to the low
level debugging addruart macro") an additional temporary register was
added to the addruart macro, but the decompressor code wasn't updated.

Fixes: 639da5ee374b ("ARM: add an extra temp register to the low level debugging addruart macro")
Signed-off-by: Łukasz Stelmach <l.stelmach@samsung.com>
Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 5530ec710fd6a68cdf8da1e9e542f5ffe379e0d8
parent 3dc1a14baabbefb51ba58b815250815021b1abec
author Hans de Goede <hdegoede@redhat.com> 1546877301 +0100
committer Sasha Levin <sashal@kernel.org> 1553694926 -0400

ACPI / video: Extend chassis-type detection with a "Lunch Box" check

[ Upstream commit d693c008e3ca04db5916ff72e68ce661888a913b ]

Commit 53fa1f6e8a59 ("ACPI / video: Only default only_lcd to true on
Win8-ready _desktops_") introduced chassis type detection, limiting the
lcd_only check for the backlight to devices where the chassis-type
indicates their is no builtin LCD panel.

The purpose of the lcd_only check is to avoid advertising a backlight
interface on desktops, since skylake and newer machines seem to always
have a backlight interface even if there is no LCD panel. The limiting
of this check to desktops only was done to avoid breaking backlight
support on some laptops which do not have the lcd flag set.

The Fujitsu ESPRIMO Q910 which is a compact (NUC like) desktop machine
has a chassis type of 0x10 aka "Lunch Box". Without the lcd_only check
we end up falsely advertising backlight/brightness control on this
device. This commit extend the dmi_is_desktop check to return true
for type 0x10 to fix this.

Fixes: 53fa1f6e8a59 ("ACPI / video: Only default only_lcd to true ...")
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 24090c473d8fe11983fb10d96b72d20461940096
parent 181da3c34a4335e176c41c250035a03b092b7638
author Linus Torvalds <torvalds@linux-foundation.org> 1399666252 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1399666252 -0700

Linux 3.15-rc5
tree 800ce0df1466f8ff7b32d2602c6152a07486ef64
parent bd1bfe40ac6bdf9593da29b822bc301b77a97d6a
author Linus Torvalds <torvalds@linux-foundation.org> 1306716216 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1306716216 -0700

Linux 3.0-rc1

.. except there are various scripts that really know that there are
three numbers, so it calls itself "3.0.0-rc1".

Hopefully by the time the final 3.0 is out, we'll have that extra zero
all figured out.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 6920d116761a65612a8fc663983eb7e8a60df525
parent b810cdfcf91d76f603fd48023aede48ced8e6bed
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1174004401 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1174004401 -0700

Linux 2.6.21-rc4

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 067ad16b5a71a3663aa74e18fc2f6906159b1655
parent bfe73af41b7258015d6c7552fd4458d956bc0a01
author Mikko Perttunen <mperttunen@nvidia.com> 1530283094 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1537750674 -0400

clk: tegra: bpmp: Don't crash when a clock fails to register

[ Upstream commit f7b3182232c82bb9769e2d5471d702bae2972d2b ]

When registering clocks, we just skip any that fail to register
(leaving a NULL hole in the clock table). However, our of_xlate
function still tries to dereference each entry while looking for
the clock with the requested id, causing a crash if any clocks
failed to register. Add a check to of_xlate to skip any NULL
clocks.

Signed-off-by: Mikko Perttunen <mperttunen@nvidia.com>
Acked-by: Jon Hunter <jonathanh@nvidia.com>
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c872e45dc19b77f6941dd61d7d19b3f0e32fd888
parent f341d66cb75fa06b926079a380d6440aeae2f1b5
author Kevin Hilman <khilman@baylibre.com> 1526933312 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538094151 -0400

ARM: dts: dra7: fix DCAN node addresses

[ Upstream commit 949bdcc8a97c6078f21c8d4966436b117f2e4cd3 ]

Fix the DT node addresses to match the reg property addresses,
which were verified to match the TRM:
http://www.ti.com/lit/pdf/sprui30

Cc: Roger Quadros <rogerq@ti.com>
Signed-off-by: Kevin Hilman <khilman@baylibre.com>
Acked-by: Roger Quadros <rogerq@ti.com>
Signed-off-by: Tony Lindgren <tony@atomide.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 73f5bf92c9aa40ae1aba4bf3769245b82f8b946f
parent 58edf8ee5e3319373dae9d9038e1a8469a83bb76
author Linus Torvalds <torvalds@linux-foundation.org> 1234125440 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1234125447 -0800

Linux 2.6.29-rc4
tree 4237bcaa40f6a15e3af474e6a4cfaadf98e74681
parent d6d7ebef0d61cad6d866d08896897cc1ee69d510
author Qu Wenruo <wqu@suse.com> 1529642100 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1535640046 -0400

btrfs: Don't remove block group that still has pinned down bytes

[ Upstream commit 43794446548730ac8461be30bbe47d5d027d1d16 ]

[BUG]
Under certain KVM load and LTP tests, it is possible to hit the
following calltrace if quota is enabled:

BTRFS critical (device vda2): unable to find logical 8820195328 length 4096
BTRFS critical (device vda2): unable to find logical 8820195328 length 4096

WARNING: CPU: 0 PID: 49 at ../block/blk-core.c:172 blk_status_to_errno+0x1a/0x30
CPU: 0 PID: 49 Comm: kworker/u2:1 Not tainted 4.12.14-15-default #1 SLE15 (unreleased)
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.0.0-prebuilt.qemu-project.org 04/01/2014
Workqueue: btrfs-endio-write btrfs_endio_write_helper [btrfs]
task: ffff9f827b340bc0 task.stack: ffffb4f8c0304000
RIP: 0010:blk_status_to_errno+0x1a/0x30
Call Trace:
 submit_extent_page+0x191/0x270 [btrfs]
 ? btrfs_create_repair_bio+0x130/0x130 [btrfs]
 __do_readpage+0x2d2/0x810 [btrfs]
 ? btrfs_create_repair_bio+0x130/0x130 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 __extent_read_full_page+0xe7/0x100 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 read_extent_buffer_pages+0x1ab/0x2d0 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 btree_read_extent_buffer_pages+0x94/0xf0 [btrfs]
 read_tree_block+0x31/0x60 [btrfs]
 read_block_for_search.isra.35+0xf0/0x2e0 [btrfs]
 btrfs_search_slot+0x46b/0xa00 [btrfs]
 ? kmem_cache_alloc+0x1a8/0x510
 ? btrfs_get_token_32+0x5b/0x120 [btrfs]
 find_parent_nodes+0x11d/0xeb0 [btrfs]
 ? leaf_space_used+0xb8/0xd0 [btrfs]
 ? btrfs_leaf_free_space+0x49/0x90 [btrfs]
 ? btrfs_find_all_roots_safe+0x93/0x100 [btrfs]
 btrfs_find_all_roots_safe+0x93/0x100 [btrfs]
 btrfs_find_all_roots+0x45/0x60 [btrfs]
 btrfs_qgroup_trace_extent_post+0x20/0x40 [btrfs]
 btrfs_add_delayed_data_ref+0x1a3/0x1d0 [btrfs]
 btrfs_alloc_reserved_file_extent+0x38/0x40 [btrfs]
 insert_reserved_file_extent.constprop.71+0x289/0x2e0 [btrfs]
 btrfs_finish_ordered_io+0x2f4/0x7f0 [btrfs]
 ? pick_next_task_fair+0x2cd/0x530
 ? __switch_to+0x92/0x4b0
 btrfs_worker_helper+0x81/0x300 [btrfs]
 process_one_work+0x1da/0x3f0
 worker_thread+0x2b/0x3f0
 ? process_one_work+0x3f0/0x3f0
 kthread+0x11a/0x130
 ? kthread_create_on_node+0x40/0x40
 ret_from_fork+0x35/0x40

BTRFS critical (device vda2): unable to find logical 8820195328 length 16384
BTRFS: error (device vda2) in btrfs_finish_ordered_io:3023: errno=-5 IO failure
BTRFS info (device vda2): forced readonly
BTRFS error (device vda2): pending csums is 2887680

[CAUSE]
It's caused by race with block group auto removal:

- There is a meta block group X, which has only one tree block
  The tree block belongs to fs tree 257.
- In current transaction, some operation modified fs tree 257
  The tree block gets COWed, so the block group X is empty, and marked
  as unused, queued to be deleted.
- Some workload (like fsync) wakes up cleaner_kthread()
  Which will call btrfs_delete_unused_bgs() to remove unused block
  groups.
  So block group X along its chunk map get removed.
- Some delalloc work finished for fs tree 257
  Quota needs to get the original reference of the extent, which will
  read tree blocks of commit root of 257.
  Then since the chunk map gets removed, the above warning gets
  triggered.

[FIX]
Just let btrfs_delete_unused_bgs() skip block group which still has
pinned bytes.

However there is a minor side effect: currently we only queue empty
blocks at update_block_group(), and such empty block group with pinned
bytes won't go through update_block_group() again, such block group
won't be removed, until it gets new extent allocated and removed.

Signed-off-by: Qu Wenruo <wqu@suse.com>
Reviewed-by: Filipe Manana <fdmanana@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 5e93bc5b7dae99395557dc7150a3f53a80bba92a
parent 0b043686fd7136a47d9868e3386cefdc0452018f
author Linus Torvalds <torvalds@linux-foundation.org> 1315176310 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1315176310 -0700

Linux 3.1-rc5
tree d6df9e4072b1dee6911b26c4989336a6e0f696e2
parent 5889fc32171a41d2f306bba320715b72655dcb1a
author Linus Torvalds <torvalds@linux-foundation.org> 1336873067 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1336873067 -0700

Linux 3.4-rc7

.. and this should hopefully be the last -rc before final 3.4 release.
tree ad4c9b757711c5aee43275467097b1ded95c1a41
parent 4222721ebb50a8640860eeca0caeb63fe1cce935
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1170214977 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1170214977 -0800

Linux 2.6.20-rc7

Ok, so I said there wouldn't be another -rc.

I lied.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 237b694d7a06e34344c25b144c3f8bc4b38c8fb0
parent 34ab9650b664c82a8f9157f8d85d86e521f00089
author Vitaly Kuznetsov <vkuznets@redhat.com> 1547745130 +0100
committer Sasha Levin <sashal@kernel.org> 1551290072 -0500

KVM: selftests: check returned evmcs version range

[ Upstream commit 35b531a1e7fc30ac8c62e5ac1794eb1460da614e ]

Check that KVM_CAP_HYPERV_ENLIGHTENED_VMCS returns correct version range.

Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 611529a42eb71ef3e6c6b4af3a1dc391bda947cb
parent 41e7bff67db53fadb6208843c70c9bdb2cfb98e9
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1524768425 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d83079f4e3d9f3435a2fa0cf37389a072300d061
parent 884c5f53c202e574dd9a1861afa1a8f9aeeba4db
author Paul Moore <paul@paul-moore.com> 1504273474 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1513039011 -0500

audit: ensure that 'audit=1' actually enables audit for PID 1

[ Upstream commit 173743dd99a49c956b124a74c8aacb0384739a4c ]

Prior to this patch we enabled audit in audit_init(), which is too
late for PID 1 as the standard initcalls are run after the PID 1 task
is forked.  This means that we never allocate an audit_context (see
audit_alloc()) for PID 1 and therefore miss a lot of audit events
generated by PID 1.

This patch enables audit as early as possible to help ensure that when
PID 1 is forked it can allocate an audit_context if required.

Reviewed-by: Richard Guy Briggs <rgb@redhat.com>
Signed-off-by: Paul Moore <paul@paul-moore.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree a9831863c2551a9107a3ff65f59fd9360d8a3f88
parent e68cc578b23421486858a76f3720443997d7eee0
author Josh Abraham <j.abraham1776@gmail.com> 1536801234 -1000
committer Sasha Levin <alexander.levin@microsoft.com> 1538240621 -0400

xen: fix GCC warning and remove duplicate EVTCHN_ROW/EVTCHN_COL usage

[ Upstream commit 4dca864b59dd150a221730775e2f21f49779c135 ]

This patch removes duplicate macro useage in events_base.c.

It also fixes gcc warning:
variable ‘col’ set but not used [-Wunused-but-set-variable]

Signed-off-by: Joshua Abraham <j.abraham1776@gmail.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 740e5ecf34ccfdd6f560b86d9dbdbee1a2f64074
parent 55631fc5ff546032a01fc0952a3616ab966eccf7
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1540737252 -0400

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree d618f98cff0dd1c9deec4546d9d25f053bfa6dca
parent ed4a51842a9d9e618d4f4c31349b15b974dba5df
author Linus Torvalds <torvalds@linux-foundation.org> 1324089386 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1324089386 -0800

Linux 3.2-rc6
tree efb8e2941943ab52dcd50d20c73e51dd449b4a19
parent 01da5fd83d6b2c5e36b77539f6cbdd8f49849225
author Linus Torvalds <torvalds@g5.osdl.org> 1156736508 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1156736508 -0700

Linux v2.6.18-rc5
tree 9725b645b7d6723164c546d6c9d0a3483a5258f2
parent b20e481ab595e9667c33e2393bdfe9a31870d11f
author Linus Torvalds <torvalds@g5.osdl.org> 1153000388 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1153000388 -0700

Linux 2.6.18-rc2

Finishing up for the kernel summit. Ottawa, here I come.

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree 71dc64c5ec2ea6e72bef1598f3f967256e52b7d8
parent 0fd08c5545a806c960a6597fae4a2e656eb7ead9
author Linus Torvalds <torvalds@linux-foundation.org> 1296529549 +1000
committer Linus Torvalds <torvalds@linux-foundation.org> 1296529549 +1000

Linux 2.6.38-rc3
tree 6c32e8786f2d65ff68ddf8335cee7d37a746ffab
parent ae6b37f1a19776e90384bedf5792a3b3eae71094
author Sasha Levin <sasha.levin@oracle.com> 1458238192 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1458238192 -0400

Linux 3.18.29

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 83765747b3fcb32973c2b0adfdf9f118aeb49633
parent ee867cf97a0290d40868c180e5a2b54761f2f9f0
author Linus Torvalds <torvalds@linux-foundation.org> 1415573729 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1415573729 -0800

Linux 3.18-rc4
tree 025842757c6bbe967e0d693960e8c68bcf3583a0
parent ef0a59924a795ccb4ced0ae1722a337745a1b045
author Linus Torvalds <torvalds@linux-foundation.org> 1412536984 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1412536984 -0700

Linux 3.17
tree 31371fa5e005ae4bd60ab8b909f570c202892d9f
parent f446a5928bc1ea8b6df8abbddd97674f58fe089c
author Sasha Levin <alexander.levin@verizon.com> 1501977374 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1501977374 -0400

Linux 4.1.43

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 7101d84842ece0adbfe7c650b2a60be39b2f0f99
parent 1e11ad8dc42975d5c2bab7d478f6cd875602eda4
author Linus Torvalds <torvalds@linux-foundation.org> 1339206009 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1339206009 -0700

Linux 3.5-rc2
tree b94d328dcea505762a83450d3b8b0e1c640ac692
parent 57cec70519450cdba5c3c90cf3391b615830d1f4
author Sasha Levin <sasha.levin@oracle.com> 1459722440 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1459722440 -0400

Linux 3.18.30

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b5a2fb878c0d6a1f9502ad090125685cb564474f
parent 0ed22810fb77092bbafaf26203170289f98b6bdf
author Russell King <rmk+kernel@armlinux.org.uk> 1523575367 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1527693877 -0400

ARM: fix kill( ,SIGFPE) breakage

[ Upstream commit 92d44a42af81e850a038c38278ff4f434b2871df ]

Commit 7771c6645700 ("signal/arm: Document conflicts with SI_USER and
SIGFPE") broke the siginfo structure for userspace triggered signals,
causing the strace testsuite to regress.  Fix this by eliminating
the FPE_FIXME definition (which is at the root of the breakage) and
use FPE_FLTINV instead for the case where the hardware appears to be
reporting nonsense.

Fixes: 7771c6645700 ("signal/arm: Document conflicts with SI_USER and SIGFPE")
Suggested-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6a9e0b90d34e13aa077f5f37c6f3d75190632a5c
parent f0277dce1b5e8200bb7914472ffdb40a10b6f0ce
author Linus Torvalds <torvalds@linux-foundation.org> 1372630409 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1372630409 -0700

Linux 3.10
tree fe79786b5f14275f4d5e515a6e3aa3c61414140f
parent 4245c8d53f0d4d3ad0ae88ada3694a102bf6e3b8
author Dmitry Vyukov <dvyukov@google.com> 1540591392 -0700
committer Sasha Levin <sashal@kernel.org> 1542074573 -0500

mm: don't warn about large allocations for slab

[ Upstream commit 61448479a9f2c954cde0cfe778cb6bec5d0a748d ]

Slub does not call kmalloc_slab() for sizes > KMALLOC_MAX_CACHE_SIZE,
instead it falls back to kmalloc_large().

For slab KMALLOC_MAX_CACHE_SIZE == KMALLOC_MAX_SIZE and it calls
kmalloc_slab() for all allocations relying on NULL return value for
over-sized allocations.

This inconsistency leads to unwanted warnings from kmalloc_slab() for
over-sized allocations for slab.  Returning NULL for failed allocations is
the expected behavior.

Make slub and slab code consistent by checking size >
KMALLOC_MAX_CACHE_SIZE in slab before calling kmalloc_slab().

While we are here also fix the check in kmalloc_slab().  We should check
against KMALLOC_MAX_CACHE_SIZE rather than KMALLOC_MAX_SIZE.  It all kinda
worked because for slab the constants are the same, and slub always checks
the size against KMALLOC_MAX_CACHE_SIZE before kmalloc_slab().  But if we
get there with size > KMALLOC_MAX_CACHE_SIZE anyhow bad things will
happen.  For example, in case of a newly introduced bug in slub code.

Also move the check in kmalloc_slab() from function entry to the size >
192 case.  This partially compensates for the additional check in slab
code and makes slub code a bit faster (at least theoretically).

Also drop __GFP_NOWARN in the warning check.  This warning means a bug in
slab code itself, user-passed flags have nothing to do with it.

Nothing of this affects slob.

Link: http://lkml.kernel.org/r/20180927171502.226522-1-dvyukov@gmail.com
Signed-off-by: Dmitry Vyukov <dvyukov@google.com>
Reported-by: syzbot+87829a10073277282ad1@syzkaller.appspotmail.com
Reported-by: syzbot+ef4e8fc3a06e9019bb40@syzkaller.appspotmail.com
Reported-by: syzbot+6e438f4036df52cbb863@syzkaller.appspotmail.com
Reported-by: syzbot+8574471d8734457d98aa@syzkaller.appspotmail.com
Reported-by: syzbot+af1504df0807a083dbd9@syzkaller.appspotmail.com
Acked-by: Christoph Lameter <cl@linux.com>
Acked-by: Vlastimil Babka <vbabka@suse.cz>
Cc: Pekka Enberg <penberg@kernel.org>
Cc: David Rientjes <rientjes@google.com>
Cc: Joonsoo Kim <iamjoonsoo.kim@lge.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 6c950c7ce28e9b90169464fe4353e3920b72c79b
parent e0f79aeda6659a81bd424279061b32238e7893f6
author Ville Syrjälä <ville.syrjala@linux.intel.com> 1538157839 +0300
committer Sasha Levin <sashal@kernel.org> 1553647646 -0400

drm/dp/mst: Configure no_stop_bit correctly for remote i2c xfers

[ Upstream commit c978ae9bde582e82a04c63a4071701691dd8b35c ]

We aren't supposed to force a stop+start between every i2c msg
when performing multi message transfers. This should eg. cause
the DDC segment address to be reset back to 0 between writing
the segment address and reading the actual EDID extension block.

To quote the E-DDC spec:
"... this standard requires that the segment pointer be
 reset to 00h when a NO ACK or a STOP condition is received."

Since we're going to touch this might as well consult the
I2C_M_STOP flag to determine whether we want to force the stop
or not.

Cc: Brian Vincent <brainn@gmail.com>
References: https://bugs.freedesktop.org/show_bug.cgi?id=108081
Signed-off-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20180928180403.22499-1-ville.syrjala@linux.intel.com
Reviewed-by: Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 054cd012bc78f56115cbce211e310082d119acf6
parent c11a7e26f8ee60bda0e64983291113ce5d04df55
author Linus Torvalds <torvalds@linux-foundation.org> 1314591361 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1314591361 -0700

Linux 3.1-rc4
tree 12fb5fab21ff55cb11e79e473108db02cc62a8d9
parent a0466479a1ea68a2707219d5ccaeff4859e6061a
author Mimi Zohar <zohar@linux.vnet.ibm.com> 1510144708 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1520972453 -0400

ima: relax requiring a file signature for new files with zero length

[ Upstream commit b7e27bc1d42e8e0cc58b602b529c25cd0071b336 ]

Custom policies can require file signatures based on LSM labels.  These
files are normally created and only afterwards labeled, requiring them
to be signed.

Instead of requiring file signatures based on LSM labels, entire
filesystems could require file signatures.  In this case, we need the
ability of writing new files without requiring file signatures.

The definition of a "new" file was originally defined as any file with
a length of zero.  Subsequent patches redefined a "new" file to be based
on the FILE_CREATE open flag.  By combining the open flag with a file
size of zero, this patch relaxes the file signature requirement.

Fixes: 1ac202e978e1 ima: accept previously set IMA_NEW_FILE
Signed-off-by: Mimi Zohar <zohar@linux.vnet.ibm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 099ac7ba5cfff478d11e3c75e40d596ae0635a10
parent e1843c94f567985bdbf9457ea4f3e2f75106667e
author Sinan Kaya <okaya@codeaurora.org> 1510671301 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1520972422 -0400

dmaengine: qcom_hidma: check pending interrupts

[ Upstream commit 38680bc6b1e3592bc9e18adc1d6e259667df27ce ]

Driver is missing the interrupts if two requests are queued up at the same
time as the interrupt handler is servicing a request that was just
delivered.

The ISR clears the interrupt at the end but it could be clearing the
interrupt for an outstanding event. Therefore, second interrupt never
arrives.

Clear the interrupt first and then check for completions.

Also, make sure that request start and interrupt clear do not overlap in
time by using a spinlock.

Signed-off-by: Sinan Kaya <okaya@codeaurora.org>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree f207018ca37e09d36e4a53dff0406d2b4d805651
parent 0cb9249adcdf439b14cecba29fe52efa934a2fa6
author Randy Dunlap <rdunlap@infradead.org> 1531877265 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1533826967 -0400

tcp: identify cryptic messages as TCP seq # bugs

[ Upstream commit e56b8ce363a36fb7b74b80aaa5cc9084f2c908b4 ]

Attempt to make cryptic TCP seq number error messages clearer by
(1) identifying the source of the message as "TCP", (2) identifying the
errors as "seq # bug", and (3) grouping the field identifiers and values
by separating them with commas.

E.g., the following message is changed from:

recvmsg bug 2: copied 73BCB6CD seq 70F17CBE rcvnxt 73BCB9AA fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:1881 tcp_recvmsg+0x649/0xb90

to:

TCP recvmsg seq # bug 2: copied 73BCB6CD, seq 70F17CBE, rcvnxt 73BCB9AA, fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:2011 tcp_recvmsg+0x694/0xba0

Suggested-by: 積丹尼 Dan Jacobson <jidanni@jidanni.org>
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree df32c75242bf8d797ccd43af8ce8e294f35cd8fd
parent 1f922d07704c501388a306c78536bca7432b3934
author Linus Torvalds <torvalds@linux-foundation.org> 1311301043 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1311301043 -0700

Linux 3.0
tree ba3d3ceafa81f999198ada904d4c7da64b264794
parent a9be22425e767d936105679fdc9f568b97bd47cf
author Linus Torvalds <torvalds@linux-foundation.org> 1402890328 -1000
committer Linus Torvalds <torvalds@linux-foundation.org> 1402890328 -1000

Linux 3.16-rc1
tree 6a816fbc23b782f0f3d815860da8e7b27b17861e
parent 68d740d79c4977a1a2197c6e68c618c8320c8ace
author Linus Torvalds <torvalds@linux-foundation.org> 1342305628 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1342305628 -0700

Linux 3.5-rc7
tree efeb2f8865def381f8c758ad2ed6a8e95e306851
parent d6c77973679d56a1834d8f8f9361f5fd0c7f4811
author Linus Torvalds <torvalds@linux-foundation.org> 1337552953 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1337552953 -0700

Linux 3.4
tree 6ac01c6a86c1eef05c28395552a64010aac1aa8c
parent 32d687cad3f188457696691677d0d276f115def0
author Linus Torvalds <torvalds@linux-foundation.org> 1347147825 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1347147825 -0700

Linux 3.6-rc5
tree d408af4fbcd4952b18fe593920005c86ee1170bd
parent b47d5e5563acf670d55120281b97c1c9f6957b65
author Kangjie Lu <kjlu@umn.edu> 1552111451 -0600
committer Sasha Levin <sashal@kernel.org> 1556801948 -0400

leds: pca9532: fix a potential NULL pointer dereference

[ Upstream commit 0aab8e4df4702b31314a27ec4b0631dfad0fae0a ]

In case of_match_device cannot find a match, return -EINVAL to avoid
NULL pointer dereference.

Fixes: fa4191a609f2 ("leds: pca9532: Add device tree support")
Signed-off-by: Kangjie Lu <kjlu@umn.edu>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree b8ecc9bfde191152b2d9dae9427fdd0b674dee27
parent fde24a23a0de22f4010af35c490770c9486ac17b
author Mark Salter <msalter@redhat.com> 1517581229 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1523804565 -0400

irqchip/gic-v3: Change pr_debug message to pr_devel

[ Upstream commit b6dd4d83dc2f78cebc9a7e6e7e4bc2be4d29b94d ]

The pr_debug() in gic-v3 gic_send_sgi() can trigger a circular locking
warning:

 GICv3: CPU10: ICC_SGI1R_EL1 5000400
 ======================================================
 WARNING: possible circular locking dependency detected
 4.15.0+ #1 Tainted: G        W
 ------------------------------------------------------
 dynamic_debug01/1873 is trying to acquire lock:
  ((console_sem).lock){-...}, at: [<0000000099c891ec>] down_trylock+0x20/0x4c

 but task is already holding lock:
  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 which lock already depends on the new lock.

 the existing dependency chain (in reverse order) is:

 -> #2 (&rq->lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock+0x4c/0x60
        task_fork_fair+0x3c/0x148
        sched_fork+0x10c/0x214
        copy_process.isra.32.part.33+0x4e8/0x14f0
        _do_fork+0xe8/0x78c
        kernel_thread+0x48/0x54
        rest_init+0x34/0x2a4
        start_kernel+0x45c/0x488

 -> #1 (&p->pi_lock){-.-.}:
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        try_to_wake_up+0x48/0x600
        wake_up_process+0x28/0x34
        __up.isra.0+0x60/0x6c
        up+0x60/0x68
        __up_console_sem+0x4c/0x7c
        console_unlock+0x328/0x634
        vprintk_emit+0x25c/0x390
        dev_vprintk_emit+0xc4/0x1fc
        dev_printk_emit+0x88/0xa8
        __dev_printk+0x58/0x9c
        _dev_info+0x84/0xa8
        usb_new_device+0x100/0x474
        hub_port_connect+0x280/0x92c
        hub_event+0x740/0xa84
        process_one_work+0x240/0x70c
        worker_thread+0x60/0x400
        kthread+0x110/0x13c
        ret_from_fork+0x10/0x18

 -> #0 ((console_sem).lock){-...}:
        validate_chain.isra.34+0x6e4/0xa20
        __lock_acquire+0x3b4/0x6e0
        lock_acquire+0xf4/0x2a8
        _raw_spin_lock_irqsave+0x58/0x70
        down_trylock+0x20/0x4c
        __down_trylock_console_sem+0x3c/0x9c
        console_trylock+0x20/0xb0
        vprintk_emit+0x254/0x390
        vprintk_default+0x58/0x90
        vprintk_func+0xbc/0x164
        printk+0x80/0xa0
        __dynamic_pr_debug+0x84/0xac
        gic_raise_softirq+0x184/0x18c
        smp_cross_call+0xac/0x218
        smp_send_reschedule+0x3c/0x48
        resched_curr+0x60/0x9c
        check_preempt_curr+0x70/0xdc
        wake_up_new_task+0x310/0x470
        _do_fork+0x188/0x78c
        SyS_clone+0x44/0x50
        __sys_trace_return+0x0/0x4

 other info that might help us debug this:

 Chain exists of:
   (console_sem).lock --> &p->pi_lock --> &rq->lock

  Possible unsafe locking scenario:

        CPU0                    CPU1
        ----                    ----
   lock(&rq->lock);
                                lock(&p->pi_lock);
                                lock(&rq->lock);
   lock((console_sem).lock);

  *** DEADLOCK ***

 2 locks held by dynamic_debug01/1873:
  #0:  (&p->pi_lock){-.-.}, at: [<000000001366df53>] wake_up_new_task+0x40/0x470
  #1:  (&rq->lock){-.-.}, at: [<00000000842e1587>] __task_rq_lock+0x54/0xdc

 stack backtrace:
 CPU: 10 PID: 1873 Comm: dynamic_debug01 Tainted: G        W        4.15.0+ #1
 Hardware name: GIGABYTE R120-T34-00/MT30-GS2-00, BIOS T48 10/02/2017
 Call trace:
  dump_backtrace+0x0/0x188
  show_stack+0x24/0x2c
  dump_stack+0xa4/0xe0
  print_circular_bug.isra.31+0x29c/0x2b8
  check_prev_add.constprop.39+0x6c8/0x6dc
  validate_chain.isra.34+0x6e4/0xa20
  __lock_acquire+0x3b4/0x6e0
  lock_acquire+0xf4/0x2a8
  _raw_spin_lock_irqsave+0x58/0x70
  down_trylock+0x20/0x4c
  __down_trylock_console_sem+0x3c/0x9c
  console_trylock+0x20/0xb0
  vprintk_emit+0x254/0x390
  vprintk_default+0x58/0x90
  vprintk_func+0xbc/0x164
  printk+0x80/0xa0
  __dynamic_pr_debug+0x84/0xac
  gic_raise_softirq+0x184/0x18c
  smp_cross_call+0xac/0x218
  smp_send_reschedule+0x3c/0x48
  resched_curr+0x60/0x9c
  check_preempt_curr+0x70/0xdc
  wake_up_new_task+0x310/0x470
  _do_fork+0x188/0x78c
  SyS_clone+0x44/0x50
  __sys_trace_return+0x0/0x4
 GICv3: CPU0: ICC_SGI1R_EL1 12000

This could be fixed with printk_deferred() but that might lessen its
usefulness for debugging. So change it to pr_devel to keep it out of
production kernels. Developers working on gic-v3 can enable it as
needed in their kernels.

Signed-off-by: Mark Salter <msalter@redhat.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b688276fb7aca698cb73021be2e9bad0aaa985a4
parent ebec20a9022a5f7259de6cd0648ce8030388cd6c
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1524756714 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 40caff0e77433c82ba301de670aa2c40d076731f
parent 450da6ca97185830315d21c06e46e232618e0fa6
author Linus Torvalds <torvalds@g5.osdl.org> 1129789385 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1129789385 -0700

Linux v2.6.14-rc5

The -rc4 release was supposed to be the last -rc, but here goes.  The
RCU fixes and the swiotlb changes need an -rc for final testing.
tree 4c9241dc664973ca19a8d151901bedd5cd1aeddc
parent c668934b4a7c52953ee8301d33cba62b03f71960
author Michal Hocko <mhocko@suse.com> 1542409733 -0800
committer Sasha Levin <sashal@kernel.org> 1542640846 -0500

mm, page_alloc: check for max order in hot path

[ Upstream commit c63ae43ba53bc432b414fd73dd5f4b01fcb1ab43 ]

Konstantin has noticed that kvmalloc might trigger the following
warning:

  WARNING: CPU: 0 PID: 6676 at mm/vmstat.c:986 __fragmentation_index+0x54/0x60
  [...]
  Call Trace:
   fragmentation_index+0x76/0x90
   compaction_suitable+0x4f/0xf0
   shrink_node+0x295/0x310
   node_reclaim+0x205/0x250
   get_page_from_freelist+0x649/0xad0
   __alloc_pages_nodemask+0x12a/0x2a0
   kmalloc_large_node+0x47/0x90
   __kmalloc_node+0x22b/0x2e0
   kvmalloc_node+0x3e/0x70
   xt_alloc_table_info+0x3a/0x80 [x_tables]
   do_ip6t_set_ctl+0xcd/0x1c0 [ip6_tables]
   nf_setsockopt+0x44/0x60
   SyS_setsockopt+0x6f/0xc0
   do_syscall_64+0x67/0x120
   entry_SYSCALL_64_after_hwframe+0x3d/0xa2

the problem is that we only check for an out of bound order in the slow
path and the node reclaim might happen from the fast path already.  This
is fixable by making sure that kvmalloc doesn't ever use kmalloc for
requests that are larger than KMALLOC_MAX_SIZE but this also shows that
the code is rather fragile.  A recent UBSAN report just underlines that
by the following report

  UBSAN: Undefined behaviour in mm/page_alloc.c:3117:19
  shift exponent 51 is too large for 32-bit type 'int'
  CPU: 0 PID: 6520 Comm: syz-executor1 Not tainted 4.19.0-rc2 #1
  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Bochs 01/01/2011
  Call Trace:
   __dump_stack lib/dump_stack.c:77 [inline]
   dump_stack+0xd2/0x148 lib/dump_stack.c:113
   ubsan_epilogue+0x12/0x94 lib/ubsan.c:159
   __ubsan_handle_shift_out_of_bounds+0x2b6/0x30b lib/ubsan.c:425
   __zone_watermark_ok+0x2c7/0x400 mm/page_alloc.c:3117
   zone_watermark_fast mm/page_alloc.c:3216 [inline]
   get_page_from_freelist+0xc49/0x44c0 mm/page_alloc.c:3300
   __alloc_pages_nodemask+0x21e/0x640 mm/page_alloc.c:4370
   alloc_pages_current+0xcc/0x210 mm/mempolicy.c:2093
   alloc_pages include/linux/gfp.h:509 [inline]
   __get_free_pages+0x12/0x60 mm/page_alloc.c:4414
   dma_mem_alloc+0x36/0x50 arch/x86/include/asm/floppy.h:156
   raw_cmd_copyin drivers/block/floppy.c:3159 [inline]
   raw_cmd_ioctl drivers/block/floppy.c:3206 [inline]
   fd_locked_ioctl+0xa00/0x2c10 drivers/block/floppy.c:3544
   fd_ioctl+0x40/0x60 drivers/block/floppy.c:3571
   __blkdev_driver_ioctl block/ioctl.c:303 [inline]
   blkdev_ioctl+0xb3c/0x1a30 block/ioctl.c:601
   block_ioctl+0x105/0x150 fs/block_dev.c:1883
   vfs_ioctl fs/ioctl.c:46 [inline]
   do_vfs_ioctl+0x1c0/0x1150 fs/ioctl.c:687
   ksys_ioctl+0x9e/0xb0 fs/ioctl.c:702
   __do_sys_ioctl fs/ioctl.c:709 [inline]
   __se_sys_ioctl fs/ioctl.c:707 [inline]
   __x64_sys_ioctl+0x7e/0xc0 fs/ioctl.c:707
   do_syscall_64+0xc4/0x510 arch/x86/entry/common.c:290
   entry_SYSCALL_64_after_hwframe+0x49/0xbe

Note that this is not a kvmalloc path.  It is just that the fast path
really depends on having sanitzed order as well.  Therefore move the
order check to the fast path.

Link: http://lkml.kernel.org/r/20181113094305.GM15120@dhcp22.suse.cz
Signed-off-by: Michal Hocko <mhocko@suse.com>
Reported-by: Konstantin Khlebnikov <khlebnikov@yandex-team.ru>
Reported-by: Kyungtae Kim <kt0755@gmail.com>
Acked-by: Vlastimil Babka <vbabka@suse.cz>
Cc: Balbir Singh <bsingharora@gmail.com>
Cc: Mel Gorman <mgorman@techsingularity.net>
Cc: Pavel Tatashin <pavel.tatashin@microsoft.com>
Cc: Oscar Salvador <osalvador@suse.de>
Cc: Mike Rapoport <rppt@linux.vnet.ibm.com>
Cc: Aaron Lu <aaron.lu@intel.com>
Cc: Joonsoo Kim <iamjoonsoo.kim@lge.com>
Cc: Byoungyoung Lee <lifeasageek@gmail.com>
Cc: "Dae R. Jeong" <threeearcat@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 9fb54ecdb95c0e8d3df938595d24922111df12ab
parent 6053f65133fe9155ae6a9ec89db91f7b6ac7118d
author Dmitry Osipenko <digetx@gmail.com> 1531843838 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1535516418 -0400

gpio: tegra: Fix tegra_gpio_irq_set_type()

[ Upstream commit f78709a5d4114edc21a5d86586ed5e56e284f2bd ]

Commit 36b312792b97 ("gpiolib: Respect error code of ->get_direction()")
broke tegra_gpio_irq_set_type() because requesting of GPIO direction must
be done after enabling GPIO function for a pin.

This patch fixes drivers probe failure like this:

 gpio gpiochip0: (tegra-gpio): gpiochip_lock_as_irq: cannot get GPIO direction
 tegra-gpio 6000d000.gpio: unable to lock Tegra GPIO 144 as IRQ

Fixes: 36b312792b97 ("gpiolib: Respect error code of ->get_direction()")
Signed-off-by: Dmitry Osipenko <digetx@gmail.com>
Acked-by: Jon Hunter <jonathanh@nvidia.com>
Tested-by: Jon Hunter <jonathanh@nvidia.com>
Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree e286f82c594dd3acb4ae53113c6c2d2dd1eb76b2
parent 481c99e311dc3bf6c971c3a41a886da0b749d165
author Jim Mattson <jmattson@google.com> 1495565572 -0700
committer Sasha Levin <alexander.levin@verizon.com> 1501111660 -0400

kvm: vmx: Do not disable intercepts for BNDCFGS

[ Upstream commit a8b6fda38f80e75afa3b125c9e7f2550b579454b ]

The MSR permission bitmaps are shared by all VMs. However, some VMs
may not be configured to support MPX, even when the host does. If the
host supports VMX and the guest does not, we should intercept accesses
to the BNDCFGS MSR, so that we can synthesize a #GP
fault. Furthermore, if the host does not support MPX and the
"ignore_msrs" kvm kernel parameter is set, then we should intercept
accesses to the BNDCFGS MSR, so that we can skip over the rdmsr/wrmsr
without raising a #GP fault.

Fixes: da8999d31818fdc8 ("KVM: x86: Intel MPX vmx and msr handle")
Signed-off-by: Jim Mattson <jmattson@google.com>
Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 87ac3f1f8ca2a319cf5497d46e19496cab6d46f1
parent f3aa59132ba8aa88067cfd40b70953349baa42ad
author Leon Romanovsky <leon@kernel.org> 1508962219 +0300
committer Sasha Levin <alexander.levin@verizon.com> 1513038841 -0500

RDMA/cxgb4: Annotate r2 and stag as __be32

[ Upstream commit 7d7d065a5eec7e218174d5c64a9f53f99ffdb119 ]

Chelsio cxgb4 HW is big-endian, hence there is need to properly
annotate r2 and stag fields as __be32 and not __u32 to fix the
following sparse warnings.

  drivers/infiniband/hw/cxgb4/qp.c:614:16:
    warning: incorrect type in assignment (different base types)
      expected unsigned int [unsigned] [usertype] r2
      got restricted __be32 [usertype] <noident>
  drivers/infiniband/hw/cxgb4/qp.c:615:18:
    warning: incorrect type in assignment (different base types)
      expected unsigned int [unsigned] [usertype] stag
      got restricted __be32 [usertype] <noident>

Cc: Steve Wise <swise@opengridcomputing.com>
Signed-off-by: Leon Romanovsky <leon@kernel.org>
Reviewed-by: Steve Wise <swise@opengridcomputing.com>
Signed-off-by: Doug Ledford <dledford@redhat.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 4563115b6565dcfd97015c1c9366fb3d07cabf19
parent 3e5b787ac38575c88ceb20619bcda09cb4c17d8b
author Linus Torvalds <torvalds@linux-foundation.org> 1211146601 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1211146601 -0700

Linux 2.6.26-rc3
tree 78a67267ba07a8dda6693e965b55b0a1cb7ca612
parent f0c15f48bb4a68d5f74855720ae5efc56dec6a3b
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1193197857 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1193197857 -0700

Linux 2.6.24-rc1

The patch is big.  Really big.  You just won't believe how vastly hugely
mindbogglingly big it is.  I mean you may think it's a long way down the
road to the chemist, but that's just peanuts to how big the patch from
2.6.23 is.

But it's all good.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 6b0c1d440c490a65c51ab5cf5aee7095cb4089d3
parent bff9d1865640dcb4d9711dcc50714e9a8b859453
author Linus Torvalds <torvalds@linux-foundation.org> 1342904309 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1342904309 -0700

Linux 3.5
tree 3fd91d0b3aba06ebfd30599ac9a450118935c4f4
parent 5c49985c21bba4d2f899e3a97121868a5c58a876
author Linus Torvalds <torvalds@linux-foundation.org> 1357786795 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1357786795 -0800

Linux 3.8-rc3
tree e24b1426a53d267f6bf2e3620495636a1a7097f0
parent ef2e0391e531832eea96ed31cba5a131bdfe4149
author Linus Torvalds <torvalds@linux-foundation.org> 1404076296 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1404076296 -0700

Linux 3.16-rc3
tree f3f3de540df654e6a8ea443b1ec7023866e26b07
parent 26d551bc0ffca051abf6b44d827a8d609d104478
author Mathias Nyman <mathias.nyman@linux.intel.com> 1521210786 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1526352884 -0400

xhci: Show what USB release number the xHC supports from protocol capablity

[ Upstream commit 0ee78c101425aae681c631ba59c6ac7f44b1d83a ]

xhci driver displays the supported xHC USB revision in a message during
driver load:

"Host supports USB 3.1 Enhanced SuperSpeed"

Get the USB minor revision number from the xhci protocol capability.
This will show the correct supported revisions for new USB 3.2 and later
hosts

Don't rely on the SBRN (serial bus revision number) register, it's often
showing 0x30 (USB3.0) for hosts that support USB 3.1

Signed-off-by: Mathias Nyman <mathias.nyman@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree d0ac76500488bcba2e9cb42ebdf0b830a5810e6f
parent fcd134cd7de8d67c0bb7481068d4a17429c5f669
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1526735228 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 91ffcc8d9340c2d357ebf8460ec8b0e631c9d84f
parent 241ceee0b442c69226fb882d61d9b9785743898f
author Linus Torvalds <torvalds@woody.osdl.org> 1167612800 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1167612800 -0800

Linux 2.6.20-rc3

...because it's always a good idea to cut a release *before* you go out
to party and get drunk.

Remember kids: "Don't Drink and Release!"
tree dc90180fefae266de8c475083fa218cea206e790
parent 948ac6d71cf868b431adb3139d8dfbd9c4e4a6ca
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1174863383 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1174863383 -0700

Linux 2.6.21-rc5

.. hopefully most of the fallout of the timer changes is contained now.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree fa97747350796154a09df2834695827051fe82c3
parent 204fe0380b14557a3179cf18f1101d4ed6532172
author Linus Torvalds <torvalds@linux-foundation.org> 1401675144 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1401675144 -0700

Linux 3.15-rc8
tree b34419c0d090af950a1b307551fbfb6f53888e24
parent 51601f09e49161266cd9feb95839c621f7088f81
author Lucas Stach <l.stach@pengutronix.de> 1555084780 +0200
committer Sasha Levin <sashal@kernel.org> 1556927652 -0400

gpu: ipu-v3: dp: fix CSC handling

[ Upstream commit d4fad0a426c6e26f48c9a7cdd21a7fe9c198d645 ]

Initialize the flow input colorspaces to unknown and reset to that value
when the channel gets disabled. This avoids the state getting mixed up
with a previous mode.

Also keep the CSC settings for the background flow intact when disabling
the foreground flow.

Root-caused-by: Jonathan Marek <jonathan@marek.ca>
Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 856ccb170ccc008d02ddd6a8135835e68e8664ad
parent 441193dc4d750593c8ce1483eaff171ab8a6fc0f
author Randy Dunlap <rdunlap@infradead.org> 1531877265 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1533834331 -0400

tcp: identify cryptic messages as TCP seq # bugs

[ Upstream commit e56b8ce363a36fb7b74b80aaa5cc9084f2c908b4 ]

Attempt to make cryptic TCP seq number error messages clearer by
(1) identifying the source of the message as "TCP", (2) identifying the
errors as "seq # bug", and (3) grouping the field identifiers and values
by separating them with commas.

E.g., the following message is changed from:

recvmsg bug 2: copied 73BCB6CD seq 70F17CBE rcvnxt 73BCB9AA fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:1881 tcp_recvmsg+0x649/0xb90

to:

TCP recvmsg seq # bug 2: copied 73BCB6CD, seq 70F17CBE, rcvnxt 73BCB9AA, fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:2011 tcp_recvmsg+0x694/0xba0

Suggested-by: 積丹尼 Dan Jacobson <jidanni@jidanni.org>
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7439bcac7a2fd11a2614d70f3840d3ae641ae6d8
parent 8e079d7a679b14a5ed020b9306f35ba3f3ad60fc
author David Howells <dhowells@redhat.com> 1536360917 +0100
committer Sasha Levin <sashal@kernel.org> 1538619760 -0400

afs: Fix cell specification to permit an empty address list

[ Upstream commit ecfe951f0c1b169ea4b7dd6f3a404dfedd795bc2 ]

Fix the cell specification mechanism to allow cells to be pre-created
without having to specify at least one address (the addresses will be
upcalled for).

This allows the cell information preload service to avoid the need to issue
loads of DNS lookups during boot to get the addresses for each cell (500+
lookups for the 'standard' cell list[*]).  The lookups can be done later as
each cell is accessed through the filesystem.

Also remove the print statement that prints a line every time a new cell is
added.

[*] There are 144 cells in the list.  Each cell is first looked up for an
    SRV record, and if that fails, for an AFSDB record.  These get a list
    of server names, each of which then has to be looked up to get the
    addresses for that server.  E.g.:

	dig srv _afs3-vlserver._udp.grand.central.org

Signed-off-by: David Howells <dhowells@redhat.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d0ecff2efc46e2530f0f35614037410039e47215
parent 3426fadfa20454f124203768857e8f18ab4909bd
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1205126547 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1205126547 -0700

Linux 2.6.25-rc5
tree 778d6f026dcc406a28353bf0084ef9adaeb19e0f
parent 31a78f23bac0069004e69f98808b6988baccb6b6
author Linus Torvalds <torvalds@linux-foundation.org> 1222727042 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1222727042 -0700

Linux 2.6.27-rc8
tree c2ecd57b35e329b3dbc129ac6c9ee4e59421fa2c
parent aa8e4fc68d8024cd3132035d13c3cefa7baeac8f
author Linus Torvalds <torvalds@linux-foundation.org> 1236911968 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1236911968 -0700

Linus 2.6.29-rc8
tree 4f5c110fb63e9291282f267809badbab5c4a8d92
parent 0a4ab28ed2365960f882d0ed6ca18fe8e1707149
author Sasha Levin <sasha.levin@oracle.com> 1441059563 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1441059563 -0400

Linux 3.18.21

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree f53342ba6660328f08d227950c0ddbb6ebcdfa2d
parent 7cc65d0852fc30491d6b654ab2a95441fdb76784
author Sasha Levin <alexander.levin@verizon.com> 1489435476 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1489435476 -0400

Linux 4.1.39

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree b0ad997b6b91b6eb16fd60aba6d71a3803facee7
parent 082d7bbf5f31bc8b05381bc8f97a4ee94751fe80
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553891622 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 7a478da230cfb9053ef38323de44e3743747e623
parent d649dafd0713f2f3dfe29baa783868db33aa2c11
author Linus Torvalds <torvalds@g5.osdl.org> 1147390313 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1147390313 -0700

Linux v2.6.17-rc4
tree 014a227e8034dec8525674e622c6f209bea392cd
parent 2d3d0003b16c4cd8cc9fd93f1a48183f51c3d516
author Andrew Lunn <andrew@lunn.ch> 1541893270 +0100
committer Sasha Levin <sashal@kernel.org> 1542047791 -0500

net: dsa: mv88e6xxx: Fix clearing of stats counters

[ Upstream commit a9049ff9214da68df1179a7d5e36b43479abc9b8 ]

The mv88e6161 would sometime fail to probe with a timeout waiting for
the switch to complete an operation. This operation is supposed to
clear the statistics counters. However, due to a read/modify/write,
without the needed mask, the operation actually carried out was more
random, with invalid parameters, resulting in the switch not
responding. We need to preserve the histogram mode bits, so apply a
mask to keep them.

Reported-by: Chris Healy <Chris.Healy@zii.aero>
Fixes: 40cff8fca9e3 ("net: dsa: mv88e6xxx: Fix stats histogram mode")
Signed-off-by: Andrew Lunn <andrew@lunn.ch>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 0f06ac618a5b12cfd11088fbc8c541e6012fbf5f
parent 93dc6107a76daed81c07f50215fa6ae77691634f
author Linus Torvalds <torvalds@linux-foundation.org> 1332112534 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1332112534 -0700

Linux 3.3
tree 36a18d1c70528863ca15668063ff96013ee139d4
parent 13a4d7fa46dbd58177d04e7c8fb8d95a105dd792
author José Roberto de Souza <jose.souza@intel.com> 1522276237 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1532704311 -0400

drm: Add DP PSR2 sink enable bit

[ Upstream commit 4f212e40468650e220c1770876c7f25b8e0c1ff5 ]

To comply with eDP1.4a this bit should be set when enabling PSR2.

Signed-off-by: José Roberto de Souza <jose.souza@intel.com>
Reviewed-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Signed-off-by: Rodrigo Vivi <rodrigo.vivi@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20180328223046.16125-1-jose.souza@intel.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 4e2f7ea657ad19c3cc122a8cb9af2e1ba4bca1c9
parent 1711fd9addf214823b993468567cab1f8254fc51
author Linus Torvalds <torvalds@linux-foundation.org> 1425856149 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1425856149 -0700

Linux 4.0-rc3
tree ab21a890347109882b864c6cbb18f0392159bc02
parent 23cb3ada1b011f708ff881b66b2cfb6c11068fa5
author Linus Torvalds <torvalds@g5.osdl.org> 1134952614 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1134952614 -0800

Linux v2.6.15-rc6

Also renamed in honor of Portland being snowed in and everybody sliding
around on the highways like greased pumpkins.

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree 67a7e0bec408cc72b3bc2a6e3d22f1236c6062eb
parent 15b812f1d0a5ca8f5efe7f5882f468af10682ca8
author Linus Torvalds <torvalds@linux-foundation.org> 1255297436 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1255297436 -0700

Linux 2.6.32-rc4
tree 26db245eb9b9d1ec152e8df7d06307041825dd35
parent d4164973a0d93d4925b6d630782d6c5a1c44efe6
author Linus Torvalds <torvalds@linux-foundation.org> 1352056059 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1352056059 -0800

Linux 3.7-rc4
tree e229d4ee188c8164f88b0f378ba27c774cd9186a
parent e8f9b41ab701c2e028df850124198b1c0c6f0270
author Alexey Khoroshilov <khoroshilov@ispras.ru> 1514585121 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1522903937 -0400

thermal: int3400_thermal: fix error handling in int3400_thermal_probe()

[ Upstream commit 0be86969ae385c5c944286bd9f66068525de15ee ]

There are resources that are not dealocated on failure path
in int3400_thermal_probe().

Found by Linux Driver Verification project (linuxtesting.org).

Signed-off-by: Alexey Khoroshilov <khoroshilov@ispras.ru>
Signed-off-by: Zhang Rui <rui.zhang@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7fe91f4ddb6fc89a847d774747cab245929e32b6
parent 63082402968f4b73f10b28a8ac1f3da821aeb82d
author Linus Torvalds <torvalds@linux-foundation.org> 1328757713 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1328757713 -0800

Linux 3.3-rc3
tree f65bb936dcd559a910889fbc38145d6e27a01473
parent 629d0452604e4e2acc7cd3b8efd4ce92330dc178
author Sasha Levin <alexander.levin@verizon.com> 1470708705 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1470708705 -0400

Linux 4.1.30

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree a58ca78e698a41faeef7458a79aa85ecd8b4a148
parent 9f546f6a54dadda3f5743dca2c5e1ba0c472f792
author Parav Pandit <parav@mellanox.com> 1531731013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1536947685 -0400

RDMA/cma: Do not ignore net namespace for unbound cm_id

[ Upstream commit 643d213a9a034fa04f5575a40dfc8548e33ce04f ]

Currently if the cm_id is not bound to any netdevice, than for such cm_id,
net namespace is ignored; which is incorrect.

Regardless of cm_id bound to a netdevice or not, net namespace must
match. When a cm_id is bound to a netdevice, in such case net namespace
and netdevice both must match.

Fixes: 4c21b5bcef73 ("IB/cma: Add net_dev and private data checks to RDMA CM")
Signed-off-by: Parav Pandit <parav@mellanox.com>
Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d0278271092e35263c103c8a5e7e9a19efa93756
parent 8fa3c2132bb69f475a338d0e346af4f24879a4cd
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1524698410 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree cc570e5654ea8a60672fc802bdf60c06e2d1797e
parent 174788ee57cd13adf92721cca0d8a69bd9b6a345
author Daniel Borkmann <daniel@iogearbox.net> 1527909719 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1528316771 -0400

bpf: fix uapi hole for 32 bit compat applications

[ Upstream commit 36f9814a494a874d5a0f44843544b4b2539022db ]

In 64 bit, we have a 4 byte hole between ifindex and netns_dev in the
case of struct bpf_map_info but also struct bpf_prog_info. In net-next
commit b85fab0e67b ("bpf: Add gpl_compatible flag to struct bpf_prog_info")
added a bitfield into it to expose some flags related to programs. Thus,
add an unnamed __u32 bitfield for both so that alignment keeps the same
in both 32 and 64 bit cases, and can be naturally extended from there
as in b85fab0e67b.

Before:

  # file test.o
  test.o: ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
  # pahole test.o
  struct bpf_map_info {
	__u32                      type;                 /*     0     4 */
	__u32                      id;                   /*     4     4 */
	__u32                      key_size;             /*     8     4 */
	__u32                      value_size;           /*    12     4 */
	__u32                      max_entries;          /*    16     4 */
	__u32                      map_flags;            /*    20     4 */
	char                       name[16];             /*    24    16 */
	__u32                      ifindex;              /*    40     4 */
	__u64                      netns_dev;            /*    44     8 */
	__u64                      netns_ino;            /*    52     8 */

	/* size: 64, cachelines: 1, members: 10 */
	/* padding: 4 */
  };

After (same as on 64 bit):

  # file test.o
  test.o: ELF 32-bit LSB relocatable, Intel 80386, version 1 (SYSV), not stripped
  # pahole test.o
  struct bpf_map_info {
	__u32                      type;                 /*     0     4 */
	__u32                      id;                   /*     4     4 */
	__u32                      key_size;             /*     8     4 */
	__u32                      value_size;           /*    12     4 */
	__u32                      max_entries;          /*    16     4 */
	__u32                      map_flags;            /*    20     4 */
	char                       name[16];             /*    24    16 */
	__u32                      ifindex;              /*    40     4 */

	/* XXX 4 bytes hole, try to pack */

	__u64                      netns_dev;            /*    48     8 */
	__u64                      netns_ino;            /*    56     8 */
	/* --- cacheline 1 boundary (64 bytes) --- */

	/* size: 64, cachelines: 1, members: 10 */
	/* sum members: 60, holes: 1, sum holes: 4 */
  };

Reported-by: Dmitry V. Levin <ldv@altlinux.org>
Reported-by: Eugene Syromiatnikov <esyr@redhat.com>
Fixes: 52775b33bb507 ("bpf: offload: report device information about offloaded maps")
Fixes: 675fc275a3a2d ("bpf: offload: report device information for offloaded programs")
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Alexei Starovoitov <ast@kernel.org>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ea019826653e49aab7d7b1df23d0bcba67c590a4
parent c6b993f6b64bb33957c391a3d5669081a8eedcb2
author Xiao Liang <xiliang@redhat.com> 1534260088 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1537021461 -0400

xen-netfront: fix warn message as irq device name has '/'

[ Upstream commit 21f2706b20100bb3db378461ab9b8e2035309b5b ]

There is a call trace generated after commit 2d408c0d4574b01b9ed45e02516888bf925e11a9(
xen-netfront: fix queue name setting). There is no 'device/vif/xx-q0-tx' file found
under /proc/irq/xx/.

This patch only picks up device type and id as its name.

With the patch, now /proc/interrupts looks like below and the warning message gone:
 70:         21          0          0          0   xen-dyn    -event     vif0-q0-tx
 71:         15          0          0          0   xen-dyn    -event     vif0-q0-rx
 72:         14          0          0          0   xen-dyn    -event     vif0-q1-tx
 73:         33          0          0          0   xen-dyn    -event     vif0-q1-rx
 74:         12          0          0          0   xen-dyn    -event     vif0-q2-tx
 75:         24          0          0          0   xen-dyn    -event     vif0-q2-rx
 76:         19          0          0          0   xen-dyn    -event     vif0-q3-tx
 77:         21          0          0          0   xen-dyn    -event     vif0-q3-rx

Below is call trace information without this patch:

name 'device/vif/0-q0-tx'
WARNING: CPU: 2 PID: 37 at fs/proc/generic.c:174 __xlate_proc_name+0x85/0xa0
RIP: 0010:__xlate_proc_name+0x85/0xa0
RSP: 0018:ffffb85c40473c18 EFLAGS: 00010286
RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000000006
RDX: 0000000000000007 RSI: 0000000000000096 RDI: ffff984c7f516930
RBP: ffffb85c40473cb8 R08: 000000000000002c R09: 0000000000000229
R10: 0000000000000000 R11: 0000000000000001 R12: ffffb85c40473c98
R13: ffffb85c40473cb8 R14: ffffb85c40473c50 R15: 0000000000000000
FS:  0000000000000000(0000) GS:ffff984c7f500000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f69b6899038 CR3: 000000001c20a006 CR4: 00000000001606e0
Call Trace:
__proc_create+0x45/0x230
? snprintf+0x49/0x60
proc_mkdir_data+0x35/0x90
register_handler_proc+0xef/0x110
? proc_register+0xfc/0x110
? proc_create_data+0x70/0xb0
__setup_irq+0x39b/0x660
? request_threaded_irq+0xad/0x160
request_threaded_irq+0xf5/0x160
? xennet_tx_buf_gc+0x1d0/0x1d0 [xen_netfront]
bind_evtchn_to_irqhandler+0x3d/0x70
? xenbus_alloc_evtchn+0x41/0xa0
netback_changed+0xa46/0xcda [xen_netfront]
? find_watch+0x40/0x40
xenwatch_thread+0xc5/0x160
? finish_wait+0x80/0x80
kthread+0x112/0x130
? kthread_create_worker_on_cpu+0x70/0x70
ret_from_fork+0x35/0x40
Code: 81 5c 00 48 85 c0 75 cc 5b 49 89 2e 31 c0 5d 4d 89 3c 24 41 5c 41 5d 41 5e 41 5f c3 4c 89 ee 48 c7 c7 40 4f 0e b4 e8 65 ea d8 ff <0f> 0b b8 fe ff ff ff 5b 5d 41 5c 41 5d 41 5e 41 5f c3 66 0f 1f
---[ end trace 650e5561b0caab3a ]---

Signed-off-by: Xiao Liang <xiliang@redhat.com>
Reviewed-by: Juergen Gross <jgross@suse.com>

Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 82cc0fd2accb5c080f440d616abc93aa669e9c6e
parent 199637437af24dc075a57dcb05bf8878fdf9d731
author Sasha Levin <sasha.levin@oracle.com> 1432134290 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1432134290 -0400

Linux 3.18.14

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree c7f19111a578bd8cc93819b2e5513a864e9794ab
parent e6694d984adbe8146d2f1e08d500befc1481835e
author Linus Torvalds <torvalds@linux-foundation.org> 1371333067 -1000
committer Linus Torvalds <torvalds@linux-foundation.org> 1371333067 -1000

Linux 3.10-rc6
tree 03761607fb891d2bf081c8c3d7842e9b6baef7c8
parent b014bae072a1dad1767c5c6e7e7b480165685c3e
author Sasha Levin <sasha.levin@oracle.com> 1458238263 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1458238263 -0400

Linux 4.1.20

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree b0387721789f0c616825795d1a830ff71bf840fd
parent a263898f628dd21e59210b547986c154788f628e
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1199655938 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1199655938 -0800

Linux 2.6.24-rc7
tree 1101e32d7b8b1bc5b89b7d725828abd681c1e6c7
parent d2af6768f6128a682e7490d04e2f3d660bd6fb76
author Linus Torvalds <torvalds@linux-foundation.org> 1304477953 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1304477953 -0700

Linux 2.6.39-rc6
tree f442552c9ebf8faa847180a046e6d77e73538a06
parent dae0af783ddce6d4f6f3d09ee8d71cc8c92c8d9f
author Linus Torvalds <torvalds@linux-foundation.org> 1411339382 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1411339382 -0700

Linux 3.17-rc6
tree c05e25621c6d38e758b7af040a7d42e75547685e
parent 87f3b6b6fbcbfa715f0d0db3e7a63e65716a6d4e
author Linus Torvalds <torvalds@linux-foundation.org> 1223336398 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1223336398 -0700

Linux 2.6.27-rc9
tree fc74f7bf9674dd1a304d8481812920c875eecbcc
parent 528ba4ef855bd184b7d68e3fa596b420fb4fa86a
author Linus Torvalds <torvalds@g5.osdl.org> 1162265856 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1162265856 -0800

Linux 2.6.19-rc4

Not halloween. Not scary. Just a regular -rc release.
tree e4a6190c051e75c1d83057d256ac05acabcf3d6a
parent a73dfcb67dcec0c011738df57dc66b40bf366b41
author Jakub Kicinski <jakub.kicinski@netronome.com> 1555717939 -0700
committer Sasha Levin <sashal@kernel.org> 1556619569 -0400

net/tls: don't leak IV and record seq when offload fails

[ Upstream commit 12c7686111326148b4b5db189130522a4ad1be4a ]

When device refuses the offload in tls_set_device_offload_rx()
it calls tls_sw_free_resources_rx() to clean up software context
state.

Unfortunately, tls_sw_free_resources_rx() does not free all
the state tls_set_sw_offload() allocated - it leaks IV and
sequence number buffers.  All other code paths which lead to
tls_sw_release_resources_rx() (which tls_sw_free_resources_rx()
calls) free those right before the call.

Avoid the leak by moving freeing of iv and rec_seq into
tls_sw_release_resources_rx().

Fixes: 4799ac81e52a ("tls: Add rx inline crypto offload")
Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
Reviewed-by: Dirk van der Merwe <dirk.vandermerwe@netronome.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 50c8629e6c6222c5b9681506b52afbde818c5e56
parent 55220bb3e5f917dd5fee1153c612f9a83599f639
author Linus Torvalds <torvalds@linux-foundation.org> 1355196657 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1355196657 -0800

Linux 3.7
tree eca5b3681abcef1ace11612d3cd4f8f93076dcc7
parent f03995c48d299c9b997607a960b6c22383ca5712
author Xiao Liang <xiliang@redhat.com> 1534260088 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1537021320 -0400

xen-netfront: fix warn message as irq device name has '/'

[ Upstream commit 21f2706b20100bb3db378461ab9b8e2035309b5b ]

There is a call trace generated after commit 2d408c0d4574b01b9ed45e02516888bf925e11a9(
xen-netfront: fix queue name setting). There is no 'device/vif/xx-q0-tx' file found
under /proc/irq/xx/.

This patch only picks up device type and id as its name.

With the patch, now /proc/interrupts looks like below and the warning message gone:
 70:         21          0          0          0   xen-dyn    -event     vif0-q0-tx
 71:         15          0          0          0   xen-dyn    -event     vif0-q0-rx
 72:         14          0          0          0   xen-dyn    -event     vif0-q1-tx
 73:         33          0          0          0   xen-dyn    -event     vif0-q1-rx
 74:         12          0          0          0   xen-dyn    -event     vif0-q2-tx
 75:         24          0          0          0   xen-dyn    -event     vif0-q2-rx
 76:         19          0          0          0   xen-dyn    -event     vif0-q3-tx
 77:         21          0          0          0   xen-dyn    -event     vif0-q3-rx

Below is call trace information without this patch:

name 'device/vif/0-q0-tx'
WARNING: CPU: 2 PID: 37 at fs/proc/generic.c:174 __xlate_proc_name+0x85/0xa0
RIP: 0010:__xlate_proc_name+0x85/0xa0
RSP: 0018:ffffb85c40473c18 EFLAGS: 00010286
RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000000006
RDX: 0000000000000007 RSI: 0000000000000096 RDI: ffff984c7f516930
RBP: ffffb85c40473cb8 R08: 000000000000002c R09: 0000000000000229
R10: 0000000000000000 R11: 0000000000000001 R12: ffffb85c40473c98
R13: ffffb85c40473cb8 R14: ffffb85c40473c50 R15: 0000000000000000
FS:  0000000000000000(0000) GS:ffff984c7f500000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f69b6899038 CR3: 000000001c20a006 CR4: 00000000001606e0
Call Trace:
__proc_create+0x45/0x230
? snprintf+0x49/0x60
proc_mkdir_data+0x35/0x90
register_handler_proc+0xef/0x110
? proc_register+0xfc/0x110
? proc_create_data+0x70/0xb0
__setup_irq+0x39b/0x660
? request_threaded_irq+0xad/0x160
request_threaded_irq+0xf5/0x160
? xennet_tx_buf_gc+0x1d0/0x1d0 [xen_netfront]
bind_evtchn_to_irqhandler+0x3d/0x70
? xenbus_alloc_evtchn+0x41/0xa0
netback_changed+0xa46/0xcda [xen_netfront]
? find_watch+0x40/0x40
xenwatch_thread+0xc5/0x160
? finish_wait+0x80/0x80
kthread+0x112/0x130
? kthread_create_worker_on_cpu+0x70/0x70
ret_from_fork+0x35/0x40
Code: 81 5c 00 48 85 c0 75 cc 5b 49 89 2e 31 c0 5d 4d 89 3c 24 41 5c 41 5d 41 5e 41 5f c3 4c 89 ee 48 c7 c7 40 4f 0e b4 e8 65 ea d8 ff <0f> 0b b8 fe ff ff ff 5b 5d 41 5c 41 5d 41 5e 41 5f c3 66 0f 1f
---[ end trace 650e5561b0caab3a ]---

Signed-off-by: Xiao Liang <xiliang@redhat.com>
Reviewed-by: Juergen Gross <jgross@suse.com>

Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7e0ac1ca1ec5559316c16342762ac97d1895d2b1
parent c27edfb64bbff3cd5d8fc723161128dd4bb57789
author Sasha Levin <alexander.levin@verizon.com> 1482595784 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1482595793 -0500

Linux 4.1.37

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree db0d56232c481812a81ffbec6021ea4686f5598b
parent d7ada73c189610614d863da7799f24c32c468809
author Linus Torvalds <torvalds@linux-foundation.org> 1388361693 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1388361693 -0800

Linux 3.13-rc6
tree 2a27dc78b6883265da24f03b16774745c0f0865a
parent bafd2df5d0049bccc74947fece37963e3f68fadc
author Linus Torvalds <torvalds@g5.osdl.org> 1122590684 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1122590684 -0700

Linux 2.6.13-rc4
tree 7ddf03af1c694092e22f003611070258a190076e
parent 08e627b5cee12ca63de60aae2cc30af2028f6159
author Linus Torvalds <torvalds@linux-foundation.org> 1353895159 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1353895159 -0800

Linux 3.7-rc7
tree 61521ae54f4aa3688f5a7708462e4860dbab2995
parent a85c2854036924e4c1a32c7f9d3fb8c4b76b8bab
author Tyrel Datwyler <tyreld@linux.vnet.ibm.com> 1471040407 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1474161498 -0400

scsi: fix upper bounds check of sense key in scsi_sense_key_string()

[ Upstream commit a87eeb900dbb9f8202f96604d56e47e67c936b9d ]

Commit 655ee63cf371 ("scsi constants: command, sense key + additional
sense string") added a "Completed" sense string with key 0xF to
snstext[], but failed to updated the upper bounds check of the sense key
in scsi_sense_key_string().

Fixes: 655ee63cf371 ("[SCSI] scsi constants: command, sense key + additional sense strings")
Cc: <stable@vger.kernel.org> # v3.12+
Signed-off-by: Tyrel Datwyler <tyreld@linux.vnet.ibm.com>
Reviewed-by: Bart Van Assche <bart.vanassche@sandisk.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree d77e5861a9b7d748afe51cd43bef84ceff0fcc20
parent 9806e6c69f493ab39bec305fafe513f15108a8df
author Arnd Bergmann <arnd@arndb.de> 1553529043 +0100
committer Sasha Levin <sashal@kernel.org> 1555961705 -0400

ARM: iop: don't use using 64-bit DMA masks

[ Upstream commit 2125801ccce19249708ca3245d48998e70569ab8 ]

clang warns about statically defined DMA masks from the DMA_BIT_MASK
macro with length 64:

 arch/arm/mach-iop13xx/setup.c:303:35: error: shift count >= width of type [-Werror,-Wshift-count-overflow]
 static u64 iop13xx_adma_dmamask = DMA_BIT_MASK(64);
                                  ^~~~~~~~~~~~~~~~
 include/linux/dma-mapping.h:141:54: note: expanded from macro 'DMA_BIT_MASK'
 #define DMA_BIT_MASK(n) (((n) == 64) ? ~0ULL : ((1ULL<<(n))-1))
                                                      ^ ~~~

The ones in iop shouldn't really be 64 bit masks, so changing them
to what the driver can support avoids the warning.

Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 6f7f4542a9ff9079db30761494f123272fe45c75
parent af652c26f5f0eceb6d8cb97eb9b86fba6f1f3b85
author Linus Torvalds <torvalds@g5.osdl.org> 1154240136 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1154240136 -0700

Linux v2.6.18-rc3
tree 3cfa25e0f6db737e04889594c38ecb5aab21c1d3
parent 906430a99ec8ca48f264e835a264df89fc50dfd4
author Linus Torvalds <torvalds@linux-foundation.org> 1227223162 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1227223162 -0800

Linux 2.6.28-rc6
tree 580c896cc01d7d6c02659f46493eb17c9adbadb5
parent a45440f05e9ebc26f2a375df911823fdef5b5281
author Linus Torvalds <torvalds@linux-foundation.org> 1345153884 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1345153884 -0700

Linux 3.6-rc2
tree 855dfc37c06c8876897cdf037d7585b449da2dd1
parent 8f03e30ef13219ea2520f44d2b01daad5c95f30f
author Sasha Levin <alexander.levin@verizon.com> 1471882523 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1471883011 -0400

Linux 3.18.40

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree f971c46af2e7fd41cecbee1594e1e75bcf9636af
parent e6236f781cc7777a2e74d256c478bb07496f35ec
author Linus Torvalds <torvalds@linux-foundation.org> 1258669958 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1258669958 -0800

Linux 2.6.32-rc8
tree 1d0c1b2f609c6881d3253e4c07df9718040b1d19
parent 2ec82ba143b26c871400eba9c556bbd9cf529613
author Prarit Bhargava <prarit@redhat.com> 1539011178 -0400
committer Sasha Levin <sashal@kernel.org> 1541428175 -0500

cpupower: Fix AMD Family 0x17 msr_pstate size

[ Upstream commit 8c22e2f695920ebd94f9a53bcf2a65eb36d4dba1 ]

The msr_pstate data is only 63 bits long and should be 64 bits.

Add in the missing bit from res1 for AMD Family 0x17.

Reference: https://www.amd.com/system/files/TechDocs/54945_PPR_Family_17h_Models_00h-0Fh.pdf, page 138.

Signed-off-by: Prarit Bhargava <prarit@redhat.com>
Cc: Shuah Khan <shuah@kernel.org>
Cc: Stafford Horne <shorne@gmail.com>
Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 8c3cc85b1211f697d659c693f2da4e43be3d0caa
parent 5640c4c37eee293451388cd5ee74dfed3a30f32d
author Sasha Levin <sasha.levin@oracle.com> 1461444416 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1461599856 -0400

Linux 4.1.23

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree a612e27fd72ed27df948f072f9debaf9d7bf4f34
parent 3b1c662fe0e13ff0b0fad801bbfc0b46d7c21e27
author Michael Müller <michael@fds-team.de> 1531607226 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1536083105 -0400

crypto: sharah - Unregister correct algorithms for SAHARA 3

[ Upstream commit 0e7d4d932ffc23f75efb31a8c2ac2396c1b81c55 ]

This patch fixes two typos related to unregistering algorithms supported by
SAHARAH 3. In sahara_register_algs the wrong algorithms are unregistered
in case of an error. In sahara_unregister_algs the wrong array is used to
determine the iteration count.

Signed-off-by: Michael Müller <michael@fds-team.de>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1b06206738fe515efb908e738152eab699ef1320
parent fe47463d4117e8f20905246ee660aa15eb811a18
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1195276596 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1195276596 -0800

Linux 2.6.24-rc3
tree 1e3f0e911e7f33f3686b2eb46aabd03204e1b824
parent 8a04b45367c7943f8f7f30257d42e2106ab7a0bf
author Linus Torvalds <torvalds@linux-foundation.org> 1317777110 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1317777110 -0700

Linux 3.1-rc9
tree 36a538e1835cf819076120363d71fc44d1a31d73
parent d6c48d4e6908224a2856bb0076e25c522f5cabab
author Vignesh R <vigneshr@ti.com> 1513680676 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1520108789 -0500

dmaengine: ti-dma-crossbar: Fix event mapping for TPCC_EVT_MUX_60_63

[ Upstream commit d087f15786021a9605b20f4c678312510be4cac1 ]

Register layout of a typical TPCC_EVT_MUX_M_N register is such that the
lowest numbered event is at the lowest byte address and highest numbered
event at highest byte address. But TPCC_EVT_MUX_60_63 register layout is
different,  in that the lowest numbered event is at the highest address
and highest numbered event is at the lowest address. Therefore, modify
ti_am335x_xbar_write() to handle TPCC_EVT_MUX_60_63 register
accordingly.

Signed-off-by: Vignesh R <vigneshr@ti.com>
Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 044e5c4328ec9625063f89f084648f34195f4432
parent 4ef4c3e928f08b6904db7616c3572dcf0b0b3fe8
author jie@chenjie6@huwei.com <jie@chenjie6@huwei.com> 1533946986 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1534601803 -0400

mm/memory.c: check return value of ioremap_prot

[ Upstream commit 24eee1e4c47977bdfb71d6f15f6011e7b6188d04 ]

ioremap_prot() can return NULL which could lead to an oops.

Link: http://lkml.kernel.org/r/1533195441-58594-1-git-send-email-chenjie6@huawei.com
Signed-off-by: chen jie <chenjie6@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Li Zefan <lizefan@huawei.com>
Cc: chenjie <chenjie6@huawei.com>
Cc: Yang Shi <shy828301@gmail.com>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 181aeeba4025c84ef1883fdc64a3b28ca99ce94c
parent 236e946b53ffd5e2f5d7e6abebbe72a9f0826d15
author Linus Torvalds <torvalds@linux-foundation.org> 1245885937 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1245885937 -0700

Linux 2.6.31-rc1
tree 0e06cd06e3258eee6c5d7a8bf698515c069747eb
parent eb4cac10d9f7b006da842e2d37414d13e1333781
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1176681057 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1176681057 -0700

Linux 2.6.21-rc7

I tend to prefer to not have to cut an -rc7, but we still have some
network device driver and suspend issues. So here's -rc7.

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree d216b322e9826258ea0da6a37f202ca4573072f8
parent 7a8ecd79bc5acd1dbcd7a16116b951cb2deaf4bd
author Hoang Tran <tranviethoang.vn@gmail.com> 1506529858 +0200
committer Sasha Levin <alexander.levin@verizon.com> 1513783507 -0500

tcp: fix under-evaluated ssthresh in TCP Vegas

[ Upstream commit cf5d74b85ef40c202c76d90959db4d850f301b95 ]

With the commit 76174004a0f19785 (tcp: do not slow start when cwnd equals
ssthresh), the comparison to the reduced cwnd in tcp_vegas_ssthresh() would
under-evaluate the ssthresh.

Signed-off-by: Hoang Tran <hoang.tran@uclouvain.be>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 9fba45e2b1a769b0f984fa7b780020256ed3b9ba
parent b9a05d1d51e27681e8a1162d8f11c1820915e921
author Linus Torvalds <torvalds@ppc970.osdl.org> 1120024649 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1120024649 -0700

Linux v2.6.13-rc1

Ok, a lot of things were pending after the 2.6.12 release, let's try to
start calming things down again.
tree d74fa7cfe4d3fbca22fea20ab9ba2e57c595dde2
parent 13f939b5d34fc912f03dccc96f7bcc7dc84e9c43
author Linus Torvalds <torvalds@g5.osdl.org> 1141016975 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1141016975 -0800

Linux v2.6.16-rc5
tree 464ed1f1953bc71c3648f187641e426b6f93a983
parent c43a5082a61f351248c5f015ee5d4641309bd96e
author Linus Torvalds <torvalds@woody.osdl.org> 1168628066 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1168628066 -0800

Linux v2.6.20-rc5
tree c639f9cd004001db8a6b4ffb8793d6efa330bfa5
parent 6d1637919e07a42598bebd1c04a9c565cc7ea6da
author Sasha Levin <sasha.levin@oracle.com> 1434223038 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1434223038 -0400

Linux 3.18.15

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 74f4ea31b145211ae549ae6dffde1a160d3c9d79
parent b3b2b6351a3f3342e6669b5c2defc85f6af75ee3
author Linus Torvalds <torvalds@linux-foundation.org> 1288612452 -0400
committer Linus Torvalds <torvalds@linux-foundation.org> 1288612452 -0400

Linux 2.6.37-rc1
tree 1de51336a41786b289a11af93833ea620176853c
parent 035be494ac3950db41da1dda1ae2bd2f556866bd
author Arindam Nath <arindam.nath@amd.com> 1537265458 +0530
committer Sasha Levin <sashal@kernel.org> 1539640923 -0400

iommu/amd: Return devid as alias for ACPI HID devices

[ Upstream commit 5ebb1bc2d63d90dd204169e21fd7a0b4bb8c776e ]

ACPI HID devices do not actually have an alias for
them in the IVRS. But dev_data->alias is still used
for indexing into the IOMMU device table for devices
being handled by the IOMMU. So for ACPI HID devices,
we simply return the corresponding devid as an alias,
as parsed from IVRS table.

Signed-off-by: Arindam Nath <arindam.nath@amd.com>
Fixes: 2bf9a0a12749 ('iommu/amd: Add iommu support for ACPI HID devices')
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 177975ee063399b0f0c2105d89b7fa5c77483364
parent 003086497f07f7f1e67c0c295e261740f822b377
author Linus Torvalds <torvalds@linux-foundation.org> 1237849934 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1237849934 -0700

Linux 2.6.29
tree 6a124fb578fe44f01f910df1260a7c8d187224e7
parent 36e138622db6fe30f96614cf943a9c2d0d011958
author Wenwen Wang <wang6495@umn.edu> 1538747307 -0500
committer Sasha Levin <sashal@kernel.org> 1539868095 -0400

net: cxgb3_main: fix a missing-check bug

[ Upstream commit 2c05d88818ab6571816b93edce4d53703870d7ae ]

In cxgb_extension_ioctl(), the command of the ioctl is firstly copied from
the user-space buffer 'useraddr' to 'cmd' and checked through the
switch statement. If the command is not as expected, an error code
EOPNOTSUPP is returned. In the following execution, i.e., the cases of the
switch statement, the whole buffer of 'useraddr' is copied again to a
specific data structure, according to what kind of command is requested.
However, after the second copy, there is no re-check on the newly-copied
command. Given that the buffer 'useraddr' is in the user space, a malicious
user can race to change the command between the two copies. By doing so,
the attacker can supply malicious data to the kernel and cause undefined
behavior.

This patch adds a re-check in each case of the switch statement if there is
a second copy in that case, to re-check whether the command obtained in the
second copy is the same as the one in the first copy. If not, an error code
EINVAL is returned.

Signed-off-by: Wenwen Wang <wang6495@umn.edu>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree bed7d2c24e5748e80829d536aa0a7f0fd296e59e
parent b251f0f399e275b027d6541cfbac1d2a3206b44a
author Linus Torvalds <torvalds@linux-foundation.org> 1352637873 +0100
committer Linus Torvalds <torvalds@linux-foundation.org> 1352637873 +0100

Linux 3.7-rc5
tree 9cc94bc0c47c27a08fcaa59f896ae8ebdaadc15b
parent 798ca389c55870394440f32a630de01412ee2466
author Mimi Zohar <zohar@linux.vnet.ibm.com> 1510144708 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1520972465 -0400

ima: relax requiring a file signature for new files with zero length

[ Upstream commit b7e27bc1d42e8e0cc58b602b529c25cd0071b336 ]

Custom policies can require file signatures based on LSM labels.  These
files are normally created and only afterwards labeled, requiring them
to be signed.

Instead of requiring file signatures based on LSM labels, entire
filesystems could require file signatures.  In this case, we need the
ability of writing new files without requiring file signatures.

The definition of a "new" file was originally defined as any file with
a length of zero.  Subsequent patches redefined a "new" file to be based
on the FILE_CREATE open flag.  By combining the open flag with a file
size of zero, this patch relaxes the file signature requirement.

Fixes: 1ac202e978e1 ima: accept previously set IMA_NEW_FILE
Signed-off-by: Mimi Zohar <zohar@linux.vnet.ibm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree f25b075f4fd9713dcd65129bccb33ff5a1b4416c
parent 3c8d7c6ee12423f91287ef7e8411bdeb2c52db94
author Richard Weinberger <richard@nod.at> 1536008783 +0200
committer Sasha Levin <sashal@kernel.org> 1538619867 -0400

ubifs: Check for name being NULL while mounting

[ Upstream commit 37f31b6ca4311b94d985fb398a72e5399ad57925 ]

The requested device name can be NULL or an empty string.
Check for that and refuse to continue. UBIFS has to do this manually
since we cannot use mount_bdev(), which checks for this condition.

Fixes: 1e51764a3c2ac ("UBIFS: add new flash file system")
Reported-by: syzbot+38bd0f7865e5c6379280@syzkaller.appspotmail.com
Signed-off-by: Richard Weinberger <richard@nod.at>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 9f216b107a2932b2f3055d62a8ff0a9405136d9b
parent 88e92ff1a5b608b31b46ed67fe4d212d54b13a48
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553815663 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 01d2a4ba35773ade7638195f9abd40dbd1f05e6a
parent aee4336adf52d0617762be6677cdaf2a56d9448c
author Finn Thain <fthain@telegraphics.com.au> 1527649431 +1000
committer Sasha Levin <alexander.levin@microsoft.com> 1528400445 -0400

net/sonic: Use dma_mapping_error()

[ Upstream commit 26de0b76d9ba3200f09c6cb9d9618bda338be5f7 ]

With CONFIG_DMA_API_DEBUG=y, calling sonic_open() produces the
message, "DMA-API: device driver failed to check map error".
Add the missing dma_mapping_error() call.

Cc: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
Signed-off-by: Finn Thain <fthain@telegraphics.com.au>
Acked-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 79b87ea9b3f5ee5e2d1efdeb2807f1afd1f02e16
parent 71665963af194f50402a2cb1339828caff4ee9ee
author Linus Torvalds <torvalds@linux-foundation.org> 1278300170 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1278300170 -0700

Linux 2.6.35-rc4
tree 783a4904d3a43da2dca4fbe3411c8a133d553a71
parent 7e625219949149ece6e2dc629af5024becb987c1
author Mika Westerberg <mika.westerberg@linux.intel.com> 1535619013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1538240472 -0400

i2c: i801: Allow ACPI AML access I/O ports not reserved for SMBus

[ Upstream commit 7fd6d98b89f382d414e1db528e29a67bbd749457 ]

Commit 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict
with PCI BAR") made it possible for AML code to access SMBus I/O ports
by installing custom SystemIO OpRegion handler and blocking i80i driver
access upon first AML read/write to this OpRegion.

However, while ThinkPad T560 does have SystemIO OpRegion declared under
the SMBus device, it does not access any of the SMBus registers:

    Device (SMBU)
    {
        ...

        OperationRegion (SMBP, PCI_Config, 0x50, 0x04)
        Field (SMBP, DWordAcc, NoLock, Preserve)
        {
            ,   5,
            TCOB,   11,
            Offset (0x04)
        }

        Name (TCBV, 0x00)
        Method (TCBS, 0, NotSerialized)
        {
            If ((TCBV == 0x00))
            {
            TCBV = (\_SB.PCI0.SMBU.TCOB << 0x05)
            }

            Return (TCBV) /* \_SB_.PCI0.SMBU.TCBV */
        }

        OperationRegion (TCBA, SystemIO, TCBS (), 0x10)
        Field (TCBA, ByteAcc, NoLock, Preserve)
        {
            Offset (0x04),
            ,   9,
            CPSC,   1
        }
    }

Problem with the current approach is that it blocks all I/O port access
and because this system has touchpad connected to the SMBus controller
after first AML access (happens during suspend/resume cycle) the
touchpad fails to work anymore.

Fix this so that we allow ACPI AML I/O port access if it does not touch
the region reserved for the SMBus.

Fixes: 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict with PCI BAR")
Link: https://bugzilla.kernel.org/show_bug.cgi?id=200737
Reported-by: Yussuf Khalil <dev@pp3345.net>
Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>
Reviewed-by: Jean Delvare <jdelvare@suse.de>
Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 3f2804e7b19f1651527da9973b75ed7fbaef0cea
parent 140982c677257f4ba274ed599774c269c1a74d99
author Rui Sousa <rui.sousa@nxp.com> 1486951285 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1512228942 -0500

net: fec: fix multicast filtering hardware setup

[ Upstream commit 01f8902bcf3ff124d0aeb88a774180ebcec20ace ]

Fix hardware setup of multicast address hash:
- Never clear the hardware hash (to avoid packet loss)
- Construct the hash register values in software and then write once
to hardware

Signed-off-by: Rui Sousa <rui.sousa@nxp.com>
Signed-off-by: Fugang Duan <fugang.duan@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree cd02f426a4f85bbcc92d8bf2a7c68724c19274e2
parent 5305172566330ded9e8d9286ece4c40073b87e9b
author Alexandre Belloni <alexandre.belloni@bootlin.com> 1536526138 +0200
committer Sasha Levin <sashal@kernel.org> 1540685755 -0400

mfd: menelaus: Fix possible race condition and leak

[ Upstream commit 9612f8f503804d2fd2f63aa6ba1e58bba4612d96 ]

The IRQ work is added before the struct rtc is allocated and registered,
but this struct is used in the IRQ handler. This may lead to a NULL pointer
dereference.

Switch to devm_rtc_allocate_device/rtc_register_device to allocate the rtc
before calling menelaus_add_irq_work.

Also, this solves a possible leak as the RTC is never released.

Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
Signed-off-by: Lee Jones <lee.jones@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree f056a8a78aeaacb8ed4abbcc2edbedb30a58b2ab
parent 54be8200198ddfc6cb396720460c19881fac2d5a
author Linus Torvalds <torvalds@linux-foundation.org> 1373840307 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1373840307 -0700

Linux 3.11-rc1
tree 67801cf51469e924e9caa040fe549b2f04be0320
parent 7f7c17388b5e27914a2edd8b15092e05c80597d8
author Mikko Perttunen <mperttunen@nvidia.com> 1530283094 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1537750683 -0400

clk: tegra: bpmp: Don't crash when a clock fails to register

[ Upstream commit f7b3182232c82bb9769e2d5471d702bae2972d2b ]

When registering clocks, we just skip any that fail to register
(leaving a NULL hole in the clock table). However, our of_xlate
function still tries to dereference each entry while looking for
the clock with the requested id, causing a crash if any clocks
failed to register. Add a check to of_xlate to skip any NULL
clocks.

Signed-off-by: Mikko Perttunen <mperttunen@nvidia.com>
Acked-by: Jon Hunter <jonathanh@nvidia.com>
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 20a09622b27b1ff0e1b645a260478671fb05f91e
parent 59da1f87b276c593b852766c2fdcad62835970f7
author Linus Torvalds <torvalds@linux-foundation.org> 1229649613 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1229649613 -0800

Linux 2.6.28-rc9
tree d257e128215141dfc0c08f367910affebab6f5bf
parent 325dcfdc81f124812a7b692354996ef7fe5b90ed
author Linus Torvalds <torvalds@linux-foundation.org> 1224817612 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1224817612 -0700

Linux 2.6.28-rc1
tree 909c767ffc1b6e4413357e6b069e834efab19955
parent 22da317629bad23816f3fa26d657fb46e7af21c7
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1186195795 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1186195795 -0700

Linux 2.6.23-rc2
tree b56e48a238a1a9163c0d6dcce585647ce315ab9d
parent 0eb096933a02226dd0b6a2199453fcf0936bf7e4
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1189478995 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1189479029 -0700

Linux 2.6.23-rc6
tree 05176fbc1bdd09582f8bf32d83cfa8bac623c538
parent 8f2779491abe57b8f0f27d96b6a3edd5a8775a58
author Linus Torvalds <torvalds@g5.osdl.org> 1157336388 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1157336388 -0700

Linux 2.6.18-rc6
tree f4dee5cadb781131c0ec3c16eb65552846afe8e6
parent 4b178169b2b1bbbdf424bf0e57683ae95921a918
author Jia-Ju Bai <baijiaju1990@163.com> 1513068592 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517760013 -0500

hippi: Fix a Fix a possible sleep-in-atomic bug in rr_close

[ Upstream commit 6e266610eb6553cfb7e7eb5d11914bd01509c406 ]

The driver may sleep under a spinlock.
The function call path is:
rr_close (acquire the spinlock)
  free_irq --> may sleep

To fix it, free_irq is moved to the place without holding the spinlock.

This bug is found by my static analysis tool(DSAC) and checked by my code review.

Signed-off-by: Jia-Ju Bai <baijiaju1990@163.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 77613240f58063cd1a13e4e4fdc9853ec395acb9
parent dcb5a62d60438aa5a47b2659e8d170622941c27e
author Sasha Levin <alexander.levin@verizon.com> 1470708779 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1470708779 -0400

Linux 3.18.39

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree f616b533390efdfc03a97abec5d663a3ae4872d4
parent a99bbaf5ee6bad1aca0c88ea65ec6e5373e86184
author Linus Torvalds <torvalds@linux-foundation.org> 1254701550 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1254701550 -0700

Linux 2.6.32-rc3

I'm skipping -rc2 because the -rc1 Makefile mistakenly said -rc2, so in
order to avoid confusion, I'm jumping from -rc1 to -rc3.  That way, when
'uname' (or an oops report) says 2.6.32-rc2, there's no confusion about
whether people perhaps meant -rc1 or -rc2.
tree 33d1ff2ac67152cd9fb52517b65bd931bf220dac
parent 48593229adc1d71147512f91e95dfbf88c91816d
author Linus Torvalds <torvalds@linux-foundation.org> 1255653710 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1255653710 -0700

Linux 2.6.32-rc5
tree a42dde3cd90b4f01acded7c560f26db0dce0bf24
parent dfd742cecf233b6b4a1d903a9c64f1b4bf04f1da
author Sasha Levin <alexander.levin@verizon.com> 1472870774 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1472874020 -0400

Linux 4.1.32

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 46cabd3ea33149cf100950c9b613ae730c68f0df
parent 67e9a4573805eadf32f098b36baf3665aec2048c
author Al Viro <viro@zeniv.linux.org.uk> 1552345236 -0400
committer Sasha Levin <sashal@kernel.org> 1555961649 -0400

aio: fold lookup_kiocb() into its sole caller

[ Upstream commit 833f4154ed560232120bc475935ee1d6a20e159f ]

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 47056a55adc54de4d35d0c368fe64f90e4c6c92e
parent 217f735335730706d40616ba91c77165f61f7594
author Qu Wenruo <wqu@suse.com> 1529642100 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1535744052 -0400

btrfs: Don't remove block group that still has pinned down bytes

[ Upstream commit 43794446548730ac8461be30bbe47d5d027d1d16 ]

[BUG]
Under certain KVM load and LTP tests, it is possible to hit the
following calltrace if quota is enabled:

BTRFS critical (device vda2): unable to find logical 8820195328 length 4096
BTRFS critical (device vda2): unable to find logical 8820195328 length 4096

WARNING: CPU: 0 PID: 49 at ../block/blk-core.c:172 blk_status_to_errno+0x1a/0x30
CPU: 0 PID: 49 Comm: kworker/u2:1 Not tainted 4.12.14-15-default #1 SLE15 (unreleased)
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.0.0-prebuilt.qemu-project.org 04/01/2014
Workqueue: btrfs-endio-write btrfs_endio_write_helper [btrfs]
task: ffff9f827b340bc0 task.stack: ffffb4f8c0304000
RIP: 0010:blk_status_to_errno+0x1a/0x30
Call Trace:
 submit_extent_page+0x191/0x270 [btrfs]
 ? btrfs_create_repair_bio+0x130/0x130 [btrfs]
 __do_readpage+0x2d2/0x810 [btrfs]
 ? btrfs_create_repair_bio+0x130/0x130 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 __extent_read_full_page+0xe7/0x100 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 read_extent_buffer_pages+0x1ab/0x2d0 [btrfs]
 ? run_one_async_done+0xc0/0xc0 [btrfs]
 btree_read_extent_buffer_pages+0x94/0xf0 [btrfs]
 read_tree_block+0x31/0x60 [btrfs]
 read_block_for_search.isra.35+0xf0/0x2e0 [btrfs]
 btrfs_search_slot+0x46b/0xa00 [btrfs]
 ? kmem_cache_alloc+0x1a8/0x510
 ? btrfs_get_token_32+0x5b/0x120 [btrfs]
 find_parent_nodes+0x11d/0xeb0 [btrfs]
 ? leaf_space_used+0xb8/0xd0 [btrfs]
 ? btrfs_leaf_free_space+0x49/0x90 [btrfs]
 ? btrfs_find_all_roots_safe+0x93/0x100 [btrfs]
 btrfs_find_all_roots_safe+0x93/0x100 [btrfs]
 btrfs_find_all_roots+0x45/0x60 [btrfs]
 btrfs_qgroup_trace_extent_post+0x20/0x40 [btrfs]
 btrfs_add_delayed_data_ref+0x1a3/0x1d0 [btrfs]
 btrfs_alloc_reserved_file_extent+0x38/0x40 [btrfs]
 insert_reserved_file_extent.constprop.71+0x289/0x2e0 [btrfs]
 btrfs_finish_ordered_io+0x2f4/0x7f0 [btrfs]
 ? pick_next_task_fair+0x2cd/0x530
 ? __switch_to+0x92/0x4b0
 btrfs_worker_helper+0x81/0x300 [btrfs]
 process_one_work+0x1da/0x3f0
 worker_thread+0x2b/0x3f0
 ? process_one_work+0x3f0/0x3f0
 kthread+0x11a/0x130
 ? kthread_create_on_node+0x40/0x40
 ret_from_fork+0x35/0x40

BTRFS critical (device vda2): unable to find logical 8820195328 length 16384
BTRFS: error (device vda2) in btrfs_finish_ordered_io:3023: errno=-5 IO failure
BTRFS info (device vda2): forced readonly
BTRFS error (device vda2): pending csums is 2887680

[CAUSE]
It's caused by race with block group auto removal:

- There is a meta block group X, which has only one tree block
  The tree block belongs to fs tree 257.
- In current transaction, some operation modified fs tree 257
  The tree block gets COWed, so the block group X is empty, and marked
  as unused, queued to be deleted.
- Some workload (like fsync) wakes up cleaner_kthread()
  Which will call btrfs_delete_unused_bgs() to remove unused block
  groups.
  So block group X along its chunk map get removed.
- Some delalloc work finished for fs tree 257
  Quota needs to get the original reference of the extent, which will
  read tree blocks of commit root of 257.
  Then since the chunk map gets removed, the above warning gets
  triggered.

[FIX]
Just let btrfs_delete_unused_bgs() skip block group which still has
pinned bytes.

However there is a minor side effect: currently we only queue empty
blocks at update_block_group(), and such empty block group with pinned
bytes won't go through update_block_group() again, such block group
won't be removed, until it gets new extent allocated and removed.

Signed-off-by: Qu Wenruo <wqu@suse.com>
Reviewed-by: Filipe Manana <fdmanana@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ba6666f5dbf6a6e6a6a705c3112256a6f40f372a
parent ef1e21861e3df5b3765ece7c60b7ca08a8076da7
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1540769870 -0400

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree f20d9e2415fc97137ee3090bea373c8412099015
parent ecbec53b1d00ba582f71b210ed96cafc05ebd189
author Linus Torvalds <torvalds@linux-foundation.org> 1309227142 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1309227142 -0700

Linux 3.0-rc5
tree ba29462a466d436086c702723305a0cbe5067bb5
parent 16f6941d981a4dfd4cfbce792ed2fd4002510e01
author Kees Cook <keescook@chromium.org> 1504382986 -0700
committer Sasha Levin <alexander.levin@verizon.com> 1512228432 -0500

locking/refcounts, x86/asm: Enable CONFIG_ARCH_HAS_REFCOUNT

[ Upstream commit 39208aa7ecb7d9c4e86df782b5693270313cbab1 ]

With the section inlining bug fixed for the x86 refcount protection,
we can turn the config back on.

Signed-off-by: Kees Cook <keescook@chromium.org>
Cc: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Cc: Elena <elena.reshetova@intel.com>
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Mike Galbraith <efault@gmx.de>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Thomas Gleixner <tglx@linutronix.de>
Cc: linux-arch <linux-arch@vger.kernel.org>
Link: http://lkml.kernel.org/r/1504382986-49301-3-git-send-email-keescook@chromium.org
Signed-off-by: Ingo Molnar <mingo@kernel.org>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree eb14bf1e256fbfceb7fcc10dd7bfefa083a6908a
parent 52c84a95dc6af6c9e856c6a0f7745fd19afccd4e
author Sasha Levin <alexander.levin@verizon.com> 1469842904 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1469842904 -0400

Linux 3.18.38

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree eed337ef5e9ae7d62caa84b7974a11fddc7f06e0
parent 2d58cc9a437f3833d242e9d1617ec9b4044e26f3
author Linus Torvalds <torvalds@ppc970.osdl.org> 1115443231 -0700
committer Linus Torvalds <torvalds@ppc970.osdl.org> 1115443231 -0700

Linux v2.6.12-rc4
tree 13722b6d39ec990f96744b77b0bab53f0b3edd90
parent a63d02e870ffd8476d67bedacae84a6b8497cd7a
author Jakub Kicinski <jakub.kicinski@netronome.com> 1555717939 -0700
committer Sasha Levin <sashal@kernel.org> 1556619548 -0400

net/tls: don't leak IV and record seq when offload fails

[ Upstream commit 12c7686111326148b4b5db189130522a4ad1be4a ]

When device refuses the offload in tls_set_device_offload_rx()
it calls tls_sw_free_resources_rx() to clean up software context
state.

Unfortunately, tls_sw_free_resources_rx() does not free all
the state tls_set_sw_offload() allocated - it leaks IV and
sequence number buffers.  All other code paths which lead to
tls_sw_release_resources_rx() (which tls_sw_free_resources_rx()
calls) free those right before the call.

Avoid the leak by moving freeing of iv and rec_seq into
tls_sw_release_resources_rx().

Fixes: 4799ac81e52a ("tls: Add rx inline crypto offload")
Signed-off-by: Jakub Kicinski <jakub.kicinski@netronome.com>
Reviewed-by: Dirk van der Merwe <dirk.vandermerwe@netronome.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 36a975abc9ddffad8e7e916cd4c41dfbd9815962
parent 9abe55fd58c1579be2dd84c4667055cbe2bf3d50
author Mohammed Gamal <mgamal@redhat.com> 1522955360 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1525913645 -0400

hv_netvsc: Ensure correct teardown message sequence order

Prior to commit 0cf737808ae7 ("hv_netvsc: netvsc_teardown_gpadl() split")
the call sequence in netvsc_device_remove() was as follows (as
implemented in netvsc_destroy_buf()):
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Teardown receive buffer GPADL
3- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
4- Teardown send buffer GPADL
5- Close vmbus

This didn't work for WS2016 hosts. Commit 0cf737808ae7
("hv_netvsc: netvsc_teardown_gpadl() split") rearranged the
teardown sequence as follows:
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Close vmbus
4- Teardown receive buffer GPADL
5- Teardown send buffer GPADL

That worked well for WS2016 hosts, but it prevented guests on older hosts from
shutting down after changing network settings. Commit 0ef58b0a05c1
("hv_netvsc: change GPAD teardown order on older versions") ensured the
following message sequence for older hosts
1- Send NVSP_MSG1_TYPE_REVOKE_RECV_BUF message
2- Send NVSP_MSG1_TYPE_REVOKE_SEND_BUF message
3- Teardown receive buffer GPADL
4- Teardown send buffer GPADL
5- Close vmbus

However, with this sequence calling `ip link set eth0 mtu 1000` hangs and the
process becomes uninterruptible. On futher analysis it turns out that on tearing
down the receive buffer GPADL the kernel is waiting indefinitely
in vmbus_teardown_gpadl() for a completion to be signaled.

Here is a snippet of where this occurs:
int vmbus_teardown_gpadl(struct vmbus_channel *channel, u32 gpadl_handle)
{
        struct vmbus_channel_gpadl_teardown *msg;
        struct vmbus_channel_msginfo *info;
        unsigned long flags;
        int ret;

        info = kmalloc(sizeof(*info) +
                       sizeof(struct vmbus_channel_gpadl_teardown), GFP_KERNEL);
        if (!info)
                return -ENOMEM;

        init_completion(&info->waitevent);
        info->waiting_channel = channel;
[....]
        ret = vmbus_post_msg(msg, sizeof(struct vmbus_channel_gpadl_teardown),
                             true);

        if (ret)
                goto post_msg_err;

        wait_for_completion(&info->waitevent);
[....]
}

The completion is signaled from vmbus_ongpadl_torndown(), which gets called when
the corresponding message is received from the host, which apparently never happens
in that case.
This patch works around the issue by restoring the first mentioned message sequence
for older hosts

Fixes: 0ef58b0a05c1 ("hv_netvsc: change GPAD teardown order on older versions")
Signed-off-by: Mohammed Gamal <mgamal@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1041e0ea3650a74d5b1fc730cd7b697d0eed5d01
parent 85cc5135ace4c8b75d7b4e1ea9fe15a7fcbd1516
author Linus Torvalds <torvalds@g5.osdl.org> 1128115055 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1128115055 -0700

Linux v2.6.14-rc3
tree 6c1ec1cbd8f98dfc4afa060ee01c448bb05bfe65
parent 4db995ad7ba82b7b175e65057ef1e7303483f7c7
author Randy Dunlap <rdunlap@infradead.org> 1536963029 -0700
committer Sasha Levin <sashal@kernel.org> 1538619809 -0400

x86/APM: Fix build warning when PROC_FS is not enabled

[ Upstream commit 002b87d2aace62b4f3841c3aa43309d2380092be ]

Fix build warning in apm_32.c when CONFIG_PROC_FS is not enabled:

../arch/x86/kernel/apm_32.c:1643:12: warning: 'proc_apm_show' defined but not used [-Wunused-function]
 static int proc_apm_show(struct seq_file *m, void *v)

Fixes: 3f3942aca6da ("proc: introduce proc_create_single{,_data}")
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Reviewed-by: Christoph Hellwig <hch@lst.de>
Cc: Jiri Kosina <jikos@kernel.org>
Link: https://lkml.kernel.org/r/be39ac12-44c2-4715-247f-4dcc3c525b8b@infradead.org
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 908983eebfdf8633dc24c26808869540055e66b0
parent 031fc8f313f55595c677c50b1d6d5c410fadee60
author Linus Torvalds <torvalds@linux-foundation.org> 1258073167 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1258073167 -0800

Linux 2.6.32-rc7
tree b24baa970bb96a362c603bdeb4ab4d7412305d54
parent 0b5e2588d8238b03df66c4e74769fd03ad84f694
author Linus Torvalds <torvalds@linux-foundation.org> 1261688981 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1261688981 -0800

Linux 2.6.33-rc2
tree efef98c04864d8493e97329048214e7d97eb6256
parent 407c808587bdab872ad0089434c81ffd61b4e40b
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553815676 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree e583438abdc271c0e4bdcfdec50834b69528e564
parent f01bfc977e26d010bbd6eccdd687340548f191b3
author Linus Torvalds <torvalds@linux-foundation.org> 1409006180 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1409006180 -0700

Linux 3.17-rc2
tree cec49fea2095ec77123684854ed519f01cf890da
parent d2149b542382bfc206cb28485108f6470c979566
author Linus Torvalds <torvalds@g5.osdl.org> 1133418315 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1133418315 -0800

Linux v2.6.15-rc4
tree 79a85257a76768801d30b8779b87917a09fac85a
parent 9a2f1aad2f5bf005560c334d6f0aebd82726315b
author Linus Torvalds <torvalds@linux-foundation.org> 1388877134 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1388877134 -0800

Linux 3.13-rc7
tree 6ba4c1bd5220889e584c84e56a14888aecc2e5f9
parent fb60a9fee970a1159a006abddc33e9685f89a83e
author Linus Torvalds <torvalds@g5.osdl.org> 1137483887 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1137483887 -0800

Linux v2.6.16-rc1
tree 03cf6d1d0948013c4b6baa51b7f4aa1e6b42de41
parent 6b4b416075e18d09bdffc7aff627afdcd3fe25dc
author ZhangXiaoxu <zhangxiaoxu5@huawei.com> 1555379244 +0800
committer Sasha Levin <sashal@kernel.org> 1556619583 -0400

ipv4: set the tcp_min_rtt_wlen range from 0 to one day

[ Upstream commit 19fad20d15a6494f47f85d869f00b11343ee5c78 ]

There is a UBSAN report as below:
UBSAN: Undefined behaviour in net/ipv4/tcp_input.c:2877:56
signed integer overflow:
2147483647 * 1000 cannot be represented in type 'int'
CPU: 3 PID: 0 Comm: swapper/3 Not tainted 5.1.0-rc4-00058-g582549e #1
Call Trace:
 <IRQ>
 dump_stack+0x8c/0xba
 ubsan_epilogue+0x11/0x60
 handle_overflow+0x12d/0x170
 ? ttwu_do_wakeup+0x21/0x320
 __ubsan_handle_mul_overflow+0x12/0x20
 tcp_ack_update_rtt+0x76c/0x780
 tcp_clean_rtx_queue+0x499/0x14d0
 tcp_ack+0x69e/0x1240
 ? __wake_up_sync_key+0x2c/0x50
 ? update_group_capacity+0x50/0x680
 tcp_rcv_established+0x4e2/0xe10
 tcp_v4_do_rcv+0x22b/0x420
 tcp_v4_rcv+0xfe8/0x1190
 ip_protocol_deliver_rcu+0x36/0x180
 ip_local_deliver+0x15b/0x1a0
 ip_rcv+0xac/0xd0
 __netif_receive_skb_one_core+0x7f/0xb0
 __netif_receive_skb+0x33/0xc0
 netif_receive_skb_internal+0x84/0x1c0
 napi_gro_receive+0x2a0/0x300
 receive_buf+0x3d4/0x2350
 ? detach_buf_split+0x159/0x390
 virtnet_poll+0x198/0x840
 ? reweight_entity+0x243/0x4b0
 net_rx_action+0x25c/0x770
 __do_softirq+0x19b/0x66d
 irq_exit+0x1eb/0x230
 do_IRQ+0x7a/0x150
 common_interrupt+0xf/0xf
 </IRQ>

It can be reproduced by:
  echo 2147483647 > /proc/sys/net/ipv4/tcp_min_rtt_wlen

Fixes: f672258391b42 ("tcp: track min RTT using windowed min-filter")
Signed-off-by: ZhangXiaoxu <zhangxiaoxu5@huawei.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 40dd76098c73e91705be577018203ee190c93692
parent cd63204c55a207873eee1e8e225bccc9ae27d949
author Linus Torvalds <torvalds@linux-foundation.org> 1391998547 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1391998547 -0800

Linux 3.14-rc2
tree 38b68b9cecca95eb23e5fc0d4d7419f7b312611c
parent 758d84827dc77129a33995e424f477a4a0d13a5a
author Dominique Martinet <dominique.martinet@cea.fr> 1535409155 +0900
committer Sasha Levin <sashal@kernel.org> 1541992221 -0500

9p: clear dangling pointers in p9stat_free

[ Upstream commit 62e3941776fea8678bb8120607039410b1b61a65 ]

p9stat_free is more of a cleanup function than a 'free' function as it
only frees the content of the struct; there are chances of use-after-free
if it is improperly used (e.g. p9stat_free called twice as it used to be
possible to)

Clearing dangling pointers makes the function idempotent and safer to use.

Link: http://lkml.kernel.org/r/1535410108-20650-2-git-send-email-asmadeus@codewreck.org
Signed-off-by: Dominique Martinet <dominique.martinet@cea.fr>
Reported-by: syzbot+d4252148d198410b864f@syzkaller.appspotmail.com
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 49e79452260d9f58d37bad37895141d30a6354e0
parent 7e6991696a20858827a250e9e583eea3cd4ecb77
author Rui Sousa <rui.sousa@nxp.com> 1486951285 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1512229071 -0500

net: fec: fix multicast filtering hardware setup

[ Upstream commit 01f8902bcf3ff124d0aeb88a774180ebcec20ace ]

Fix hardware setup of multicast address hash:
- Never clear the hardware hash (to avoid packet loss)
- Construct the hash register values in software and then write once
to hardware

Signed-off-by: Rui Sousa <rui.sousa@nxp.com>
Signed-off-by: Fugang Duan <fugang.duan@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 772d27f501eb43cf8bc1a3a17f7d95badea5093c
parent a4ae54f90e0a7063799eb90852aa8648ccfbb791
author Linus Torvalds <torvalds@linux-foundation.org> 1379362671 -0400
committer Linus Torvalds <torvalds@linux-foundation.org> 1379362671 -0400

Linux 3.12-rc1
tree b461d1d3bbfdd41132dbd9c2e4e06c84e2f53a2c
parent d5ff835f88c7c346ba748f389bd4ef5eae619ebc
author Linus Torvalds <torvalds@linux-foundation.org> 1385758634 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1385758634 -0800

Linux 3.13-rc2
tree f012c28e447ce6b960cb4b9755977d2ec365d83e
parent e9a5ea1852cd8d7e155d2e3a45e4a6ea25110f7d
author Linus Torvalds <torvalds@linux-foundation.org> 1335044872 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1335044872 -0700

Linux 3.4-rc4
tree e46e5185c77d9f4dcb96472561e142a9b41baeab
parent 79b8cb97373445d3f27d9dd8633fb2b8e3369af6
author Linus Torvalds <torvalds@linux-foundation.org> 1420506320 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1420506320 -0800

Linux 3.19-rc3
tree 956cd6ef2103a4b99bddcf1d186fb63820ad53b6
parent 8d71844b5194fee6edd49e68c01445266f364572
author Linus Torvalds <torvalds@linux-foundation.org> 1407104702 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1407104702 -0700

Linux 3.16
tree 82ade95d752b9c99e3fec4863dbe2d3d3cb002a1
parent a06381fec77bf88ec6c5eb6324457cb04e9ffd69
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1182727308 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1182727308 -0700

Linus 2.6.22-rc6
tree 52c10f40194bd5dec13648649dba4e0a6b007cc8
parent 9d23108df359e572a0dca0b631bfee9f5e0fa9ea
author Linus Torvalds <torvalds@linux-foundation.org> 1379976069 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1379976069 -0700

Linux 3.12-rc2
tree 97c70968683a1b1a233a9ce458ad219eee6c7208
parent 275dc3f897cd78818a0bd206bcc467d6589787e0
author Andrey Ryabinin <aryabinin@virtuozzo.com> 1556256238 -0700
committer Sasha Levin <sashal@kernel.org> 1556838800 -0400

mm/page_alloc.c: avoid potential NULL pointer dereference

[ Upstream commit 8139ad043d632c0e9e12d760068a7a8e91659aa1 ]

ac.preferred_zoneref->zone passed to alloc_flags_nofragment() can be NULL.
'zone' pointer unconditionally derefernced in alloc_flags_nofragment().
Bail out on NULL zone to avoid potential crash.  Currently we don't see
any crashes only because alloc_flags_nofragment() has another bug which
allows compiler to optimize away all accesses to 'zone'.

Link: http://lkml.kernel.org/r/20190423120806.3503-1-aryabinin@virtuozzo.com
Fixes: 6bb154504f8b ("mm, page_alloc: spread allocations across zones before introducing fragmentation")
Signed-off-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
Acked-by: Mel Gorman <mgorman@techsingularity.net>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 1300b3c71057d7ad6d5acfd2e37eb5d36e2f4f86
parent 8cb854a781c042063f8d981dd3d2da808bddbfaf
author Rui Sousa <rui.sousa@nxp.com> 1486951285 +0800
committer Sasha Levin <alexander.levin@verizon.com> 1512228824 -0500

net: fec: fix multicast filtering hardware setup

[ Upstream commit 01f8902bcf3ff124d0aeb88a774180ebcec20ace ]

Fix hardware setup of multicast address hash:
- Never clear the hardware hash (to avoid packet loss)
- Construct the hash register values in software and then write once
to hardware

Signed-off-by: Rui Sousa <rui.sousa@nxp.com>
Signed-off-by: Fugang Duan <fugang.duan@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree a48ff47f4e9be457d24f60d3c7e90480b09ec206
parent 03fe91536f0856036cdda25e57b27fb6ff103f07
author Jia-Ju Bai <baijiaju1990@163.com> 1513068592 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517760066 -0500

hippi: Fix a Fix a possible sleep-in-atomic bug in rr_close

[ Upstream commit 6e266610eb6553cfb7e7eb5d11914bd01509c406 ]

The driver may sleep under a spinlock.
The function call path is:
rr_close (acquire the spinlock)
  free_irq --> may sleep

To fix it, free_irq is moved to the place without holding the spinlock.

This bug is found by my static analysis tool(DSAC) and checked by my code review.

Signed-off-by: Jia-Ju Bai <baijiaju1990@163.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 64314edefe1766f16fb488e6b95f1f9dd98bebfe
parent fa8a4b01c685195ffb30c3d2f920a7d5f7817bfd
author Michael Müller <michael@fds-team.de> 1531607226 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1536083126 -0400

crypto: sharah - Unregister correct algorithms for SAHARA 3

[ Upstream commit 0e7d4d932ffc23f75efb31a8c2ac2396c1b81c55 ]

This patch fixes two typos related to unregistering algorithms supported by
SAHARAH 3. In sahara_register_algs the wrong algorithms are unregistered
in case of an error. In sahara_unregister_algs the wrong array is used to
determine the iteration count.

Signed-off-by: Michael Müller <michael@fds-team.de>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 5dcc2f18b066b6fc8d2b091f21d12ed96559b994
parent 9c2aba4852c7e4a33741023109c3713e309d5f8f
author Linus Torvalds <torvalds@g5.osdl.org> 1126581129 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1126581129 -0700

Linux 2.6.14-rc1

Two weeks after 2.6.13: starting to calm things down.
tree 3f6246f645b7c137cf61a9864241f06b9d482bc4
parent 05bdb8c90e9973ca5f1d338a697f9582b11a27e2
author Linus Torvalds <torvalds@linux-foundation.org> 1409534584 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1409534584 -0700

Linux 3.17-rc3
tree 95cac2d8b251a810f44495de4b2bab83dd94a515
parent 1cf29683f4414296dc772a87caa207cab16c310c
author Linus Torvalds <torvalds@linux-foundation.org> 1247534332 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1247534332 -0700

Linux 2.6.31-rc3
tree b78477d9b0e765b7fcb5b48cbe90e24916a57d4c
parent 57053d8c5c59562cac156513740c10b502a40968
author Linus Torvalds <torvalds@linux-foundation.org> 1387139493 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1387139493 -0800

Linux 3.13-rc4
tree 415b458eef2c6ac2d86404651127ec738f29cd6d
parent 91bc9c9182d59750734fe00294aa6e1b5bdf4401
author Max Gurtovoy <maxg@mellanox.com> 1520273388 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1523803512 -0400

RDMA/core: Reduce poll batch for direct cq polling

[ Upstream commit d3b9e8ad425cfd5b9116732e057f1b48e4d3bcb8 ]

Fix warning limit for kernel stack consumption:

drivers/infiniband/core/cq.c: In function 'ib_process_cq_direct':
drivers/infiniband/core/cq.c:78:1: error: the frame size of 1032 bytes
is larger than 1024 bytes [-Werror=frame-larger-than=]

Using smaller ib_wc array on the stack brings us comfortably below that
limit again.

Fixes: 246d8b184c10 ("IB/cq: Don't force IB_POLL_DIRECT poll context for ib_process_cq_direct")
Reported-by: Arnd Bergmann <arnd@arndb.de>
Reviewed-by: Sergey Gorenko <sergeygo@mellanox.com>
Signed-off-by: Max Gurtovoy <maxg@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Reviewed-by: Bart Van Assche <bart.vanassche@wdc.com>
Acked-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 9320b223f5878f0d911fc0f752e985ed6b794a70
parent 6e1e63259b1e01f047796e7985d960ca040993e6
author Linus Torvalds <torvalds@g5.osdl.org> 1154888411 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1154888411 -0700

Linux v2.6.18-rc4
tree c3a28edf1971fe6e1252816f28df2705ca674d05
parent 038e5e2bf2819058fb1b4b52b583bef9ad063356
author Linus Torvalds <torvalds@g5.osdl.org> 1145415649 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1145415649 -0700

Linux v2.6.17-rc2
tree 9212762d8c77ab0b0446a934b3f5880b16bd5f65
parent 0fd0f21603de6ff30ffa974279ccb44842f5b813
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1541428215 -0500

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 89a8f7a67cd40b59106f39dd2bd9f3b5da7e4bd7
parent d0054dc58c31c386c2b1c0f82a83e456d10292a7
author Sasha Levin <sasha.levin@oracle.com> 1463795284 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1463795284 -0400

Linux 3.18.34

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 38db5ab815734c29ed808d7e8dfb13c28c31ea48
parent 6bfb7d4358c6ac62d82376201b3d85928d46a678
author Mauro Carvalho Chehab <mchehab@s-opensource.com> 1523015691 -0400
committer Sasha Levin <alexander.levin@microsoft.com> 1532735675 -0400

media: si470x: fix __be16 annotations

[ Upstream commit 90db5c829692a0a7845e977e45719b4699216bd4 ]

The annotations there are wrong as warned:
   drivers/media/radio/si470x/radio-si470x-i2c.c:107:35: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:107:35: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:107:35: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:107:35: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:129:24: warning: incorrect type in assignment (different base types)
   drivers/media/radio/si470x/radio-si470x-i2c.c:129:24:    expected unsigned short [unsigned] [short] <noident>
   drivers/media/radio/si470x/radio-si470x-i2c.c:129:24:    got restricted __be16 [usertype] <noident>
   drivers/media/radio/si470x/radio-si470x-i2c.c:163:39: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:163:39: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:163:39: warning: cast to restricted __be16
   drivers/media/radio/si470x/radio-si470x-i2c.c:163:39: warning: cast to restricted __be16

Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree f1f69a1da9fd7b91adf325a2edca7558e37ef11e
parent 35aeae47f2b407a6492cb5149b4bbd2ad6fa5822
author Changbin Du <changbin.du@gmail.com> 1553527007 +0000
committer Sasha Levin <sashal@kernel.org> 1556801962 -0400

kconfig/[mn]conf: handle backspace (^H) key

[ Upstream commit 9c38f1f044080392603c497ecca4d7d09876ff99 ]

Backspace is not working on some terminal emulators which do not send the
key code defined by terminfo. Terminals either send '^H' (8) or '^?' (127).
But currently only '^?' is handled. Let's also handle '^H' for those
terminals.

Signed-off-by: Changbin Du <changbin.du@gmail.com>
Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree d7c667ace9790b0e62352ad738c131d7604ae9f6
parent c2330e286f68f1c408b4aa6515ba49d57f05beae
author Linus Torvalds <torvalds@linux-foundation.org> 1278971733 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1278971733 -0700

Linux 2.6.35-rc5
tree 346d0ca66ee053260ee3012d07f0e62a6c592f7f
parent 058e0676ba73d1345e70d07d341a29e2073b2e67
author Linus Torvalds <torvalds@linux-foundation.org> 1317163714 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1317163714 -0700

Linux 3.1-rc8
tree e7f3804c7efe2de5e43d1b8a9e74bce5ab827ec1
parent 27efd7e2e6d052e543425dba172d96f42704ef65
author Linus Torvalds <torvalds@linux-foundation.org> 1279826018 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1279826018 -0700

Linux 2.6.35-rc6
tree dc9fa159ab9886d66ae3e81bb28cbef63cacdf30
parent b0e0c9e7f6d5764633e93944dafd896dd6097318
author Linus Torvalds <torvalds@linux-foundation.org> 1218592539 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1218592539 -0700

Linux 2.6.27-rc3
tree 3bbadc06fd5b15cc8af3612314aaaf7d2c153ad2
parent c4edb610718c1b803910982d784d3f7cf9c384b9
author Linus Torvalds <torvalds@linux-foundation.org> 1555002899 -0700
committer Sasha Levin <sashal@kernel.org> 1556243192 -0400

mm: add 'try_get_page()' helper function

[ Upstream commit 88b1a17dfc3ed7728316478fae0f5ad508f50397 ]

This is the same as the traditional 'get_page()' function, but instead
of unconditionally incrementing the reference count of the page, it only
does so if the count was "safe".  It returns whether the reference count
was incremented (and is marked __must_check, since the caller obviously
has to be aware of it).

Also like 'get_page()', you can't use this function unless you already
had a reference to the page.  The intent is that you can use this
exactly like get_page(), but in situations where you want to limit the
maximum reference count.

The code currently does an unconditional WARN_ON_ONCE() if we ever hit
the reference count issues (either zero or negative), as a notification
that the conditional non-increment actually happened.

NOTE! The count access for the "safety" check is inherently racy, but
that doesn't matter since the buffer we use is basically half the range
of the reference count (ie we look at the sign of the count).

Acked-by: Matthew Wilcox <willy@infradead.org>
Cc: Jann Horn <jannh@google.com>
Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 49ba4fa5579faa22bee505f15526087a50936ae5
parent 72357d59559e3b9293bdea9c0d755862504f2bf3
author Linus Torvalds <torvalds@linux-foundation.org> 1242447177 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1242447177 -0700

Linux 2.6.30-rc6
tree 40d83555e3bff55a46fa0f32fee40141af7ff4ac
parent cc6c954a076c5df7e0ac8d5e4ffa8b4f5572ae1d
author Linus Torvalds <torvalds@linux-foundation.org> 1359680894 +1100
committer Linus Torvalds <torvalds@linux-foundation.org> 1359680894 +1100

Linux 3.8-rc6
tree fe734b66fd12f879350ed791c1dac62c7c57c667
parent 535ab314c384f080caf709eb71e17da4fab59094
author Vignesh R <vigneshr@ti.com> 1513680676 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1521473195 -0400

dmaengine: ti-dma-crossbar: Fix event mapping for TPCC_EVT_MUX_60_63

[ Upstream commit d087f15786021a9605b20f4c678312510be4cac1 ]

Register layout of a typical TPCC_EVT_MUX_M_N register is such that the
lowest numbered event is at the lowest byte address and highest numbered
event at highest byte address. But TPCC_EVT_MUX_60_63 register layout is
different,  in that the lowest numbered event is at the highest address
and highest numbered event is at the lowest address. Therefore, modify
ti_am335x_xbar_write() to handle TPCC_EVT_MUX_60_63 register
accordingly.

Signed-off-by: Vignesh R <vigneshr@ti.com>
Signed-off-by: Peter Ujfalusi <peter.ujfalusi@ti.com>
Signed-off-by: Vinod Koul <vinod.koul@intel.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1a76654289460ad3c1e541b06b38052236880597
parent b51ebdc40cf3a9eb4d3ace48dbd254bb0184481d
author Linus Torvalds <torvalds@linux-foundation.org> 1234567890 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1234567890 -0800

Linux 2.6.29-rc5
tree f1645f0bb18417c77859698d23e4cc21af4ff89a
parent f99ba18a96195f047546bd515aabf81fda70ef09
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1188264755 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1188264755 -0700

Linux 2.6.23-rc4
tree 5bf1fc2a63133b88e7d0d918971aa2168da48d87
parent d8435bb5e8fb1d20c480756ed6b76121c4d2d50d
author Sasha Levin <alexander.levin@verizon.com> 1484765286 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1484765286 -0500

Linux 4.1.38

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 8e825769a51fb79b5b2f47a41e2076208d2d91e5
parent b98a86a12eb236bf0594ccd1ecd4b4cf333de00b
author Changbin Du <changbin.du@gmail.com> 1553527007 +0000
committer Sasha Levin <sashal@kernel.org> 1556801956 -0400

kconfig/[mn]conf: handle backspace (^H) key

[ Upstream commit 9c38f1f044080392603c497ecca4d7d09876ff99 ]

Backspace is not working on some terminal emulators which do not send the
key code defined by terminfo. Terminals either send '^H' (8) or '^?' (127).
But currently only '^?' is handled. Let's also handle '^H' for those
terminals.

Signed-off-by: Changbin Du <changbin.du@gmail.com>
Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree df3ca7b17c7d8b14f78885308cc22482565561fe
parent 2be1aaf988e8b6775eece8374f4fd195b21cc4c4
author Linus Torvalds <torvalds@g5.osdl.org> 1142834009 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1142834009 -0800

Linux 2.6.16
tree 287d3a93e10a60e5dd112d51cfe143c318140bc7
parent 6a50b28bb2f3ce644a9337c53d9649ef0f666565
author Naoya Horiguchi <n-horiguchi@ah.jp.nec.com> 1536101151 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538240532 -0400

tools/vm/page-types.c: fix "defined but not used" warning

[ Upstream commit 7ab660f8baecfe26c1c267fa8e64d2073feae2bb ]

debugfs_known_mountpoints[] is not used any more, so let's remove it.

Link: http://lkml.kernel.org/r/1535102651-19418-1-git-send-email-n-horiguchi@ah.jp.nec.com
Signed-off-by: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Matthew Wilcox <willy@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree a8aaa817a509d29fe5f7f5b2324e0f608d8c909c
parent d1a35e4d74d070b06163e435e590ca90a2420b9e
author Linus Torvalds <torvalds@linux-foundation.org> 1225048409 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1225048409 -0700

Linux 2.6.28-rc2

.. fix all the worst problems in -rc1
tree 842f523e6afd6cbf5f163b14755cd8676edba556
parent e4977f015234bcef295e793fff20365cb3f58bb8
author Roman Gushchin <guro@fb.com> 1537471366 -0700
committer Sasha Levin <sashal@kernel.org> 1538619851 -0400

mm: slowly shrink slabs with a relatively small number of objects

[ Upstream commit 172b06c32b949759fe6313abec514bc4f15014f4 ]

9092c71bb724 ("mm: use sc->priority for slab shrink targets") changed the
way that the target slab pressure is calculated and made it
priority-based:

    delta = freeable >> priority;
    delta *= 4;
    do_div(delta, shrinker->seeks);

The problem is that on a default priority (which is 12) no pressure is
applied at all, if the number of potentially reclaimable objects is less
than 4096 (1<<12).

This causes the last objects on slab caches of no longer used cgroups to
(almost) never get reclaimed.  It's obviously a waste of memory.

It can be especially painful, if these stale objects are holding a
reference to a dying cgroup.  Slab LRU lists are reparented on memcg
offlining, but corresponding objects are still holding a reference to the
dying cgroup.  If we don't scan these objects, the dying cgroup can't go
away.  Most likely, the parent cgroup hasn't any directly charged objects,
only remaining objects from dying children cgroups.  So it can easily hold
a reference to hundreds of dying cgroups.

If there are no big spikes in memory pressure, and new memory cgroups are
created and destroyed periodically, this causes the number of dying
cgroups grow steadily, causing a slow-ish and hard-to-detect memory
"leak".  It's not a real leak, as the memory can be eventually reclaimed,
but it could not happen in a real life at all.  I've seen hosts with a
steadily climbing number of dying cgroups, which doesn't show any signs of
a decline in months, despite the host is loaded with a production
workload.

It is an obvious waste of memory, and to prevent it, let's apply a minimal
pressure even on small shrinker lists.  E.g.  if there are freeable
objects, let's scan at least min(freeable, scan_batch) objects.

This fix significantly improves a chance of a dying cgroup to be
reclaimed, and together with some previous patches stops the steady growth
of the dying cgroups number on some of our hosts.

Link: http://lkml.kernel.org/r/20180905230759.12236-1-guro@fb.com
Fixes: 9092c71bb724 ("mm: use sc->priority for slab shrink targets")
Signed-off-by: Roman Gushchin <guro@fb.com>
Acked-by: Rik van Riel <riel@surriel.com>
Cc: Josef Bacik <jbacik@fb.com>
Cc: Johannes Weiner <hannes@cmpxchg.org>
Cc: Shakeel Butt <shakeelb@google.com>
Cc: Michal Hocko <mhocko@kernel.org>
Cc: Vladimir Davydov <vdavydov.dev@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree ee910925ecee6347dbe78c39eb47e23c8df42e7a
parent 14aac3c5982093f9eb2fee19cfc9b5ddafb404aa
author Pi-Hsun Shih <pihsun@chromium.org> 1552502673 -0700
committer Sasha Levin <sashal@kernel.org> 1553868280 -0400

include/linux/swap.h: use offsetof() instead of custom __swapoffset macro

[ Upstream commit a4046c06be50a4f01d435aa7fe57514818e6cc82 ]

Use offsetof() to calculate offset of a field to take advantage of
compiler built-in version when possible, and avoid UBSAN warning when
compiling with Clang:

  UBSAN: Undefined behaviour in mm/swapfile.c:3010:38
  member access within null pointer of type 'union swap_header'
  CPU: 6 PID: 1833 Comm: swapon Tainted: G S                4.19.23 #43
  Call trace:
   dump_backtrace+0x0/0x194
   show_stack+0x20/0x2c
   __dump_stack+0x20/0x28
   dump_stack+0x70/0x94
   ubsan_epilogue+0x14/0x44
   ubsan_type_mismatch_common+0xf4/0xfc
   __ubsan_handle_type_mismatch_v1+0x34/0x54
   __se_sys_swapon+0x654/0x1084
   __arm64_sys_swapon+0x1c/0x24
   el0_svc_common+0xa8/0x150
   el0_svc_compat_handler+0x2c/0x38
   el0_svc_compat+0x8/0x18

Link: http://lkml.kernel.org/r/20190312081902.223764-1-pihsun@chromium.org
Signed-off-by: Pi-Hsun Shih <pihsun@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree f835b6dcfd2f49ee5477e5a1642aa341b46f19d7
parent cfc646fa848dfa124fe4d6e0e44ef6940f7f9e6d
author Linus Torvalds <torvalds@g5.osdl.org> 1123438736 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1123438736 -0700

Linux 2.6.13-rc6

Last (?) -rc, partly brought on by the aic7xxx performance fixes (ie get
them tested in an -rc release before the real 2.6.13).
tree c5e5528d6ab7cfd11b86be2ffe592a5f7c4417e1
parent b7c4a9d51100cf69d87b758fb8aac3c2eb7b8499
author Sasha Levin <sasha.levin@oracle.com> 1462939759 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1462939759 -0400

Linux 3.18.33

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree e2cbc6d41e3069b9491d6bf51f2cfb81d2efda89
parent 14aa2551642b801335516ba20857b0b215ad2174
author Michael Neuling <mikey@neuling.org> 1537868207 +1000
committer Sasha Levin <sashal@kernel.org> 1539640943 -0400

powerpc/tm: Avoid possible userspace r1 corruption on reclaim

[ Upstream commit 96dc89d526ef77604376f06220e3d2931a0bfd58 ]

Current we store the userspace r1 to PACATMSCRATCH before finally
saving it to the thread struct.

In theory an exception could be taken here (like a machine check or
SLB miss) that could write PACATMSCRATCH and hence corrupt the
userspace r1. The SLB fault currently doesn't touch PACATMSCRATCH, but
others do.

We've never actually seen this happen but it's theoretically
possible. Either way, the code is fragile as it is.

This patch saves r1 to the kernel stack (which can't fault) before we
turn MSR[RI] back on. PACATMSCRATCH is still used but only with
MSR[RI] off. We then copy r1 from the kernel stack to the thread
struct once we have MSR[RI] back on.

Suggested-by: Breno Leitao <leitao@debian.org>
Signed-off-by: Michael Neuling <mikey@neuling.org>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1378337832318d83868ff6488cd90fe0d38c6f35
parent ff3ea47c623276e9772cbc268471224648d5a7fe
author Linus Torvalds <torvalds@g5.osdl.org> 1149555422 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1149555422 -0700

Linux 2.6.17-rc6
tree 0d361c31ba4e4d68517a9ea42a5a70b33db2267c
parent 8cb3ed17cb88f2f1fe1cf36c8d48bccd4d9f459e
author Linus Torvalds <torvalds@linux-foundation.org> 1315861322 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1315861322 -0700

Linux 3.1-rc6
tree d949b55f5992a0d3dff88fe8e1de11523dce2acb
parent 8110e16d42d587997bcaee0c864179e6d93603fe
author Linus Torvalds <torvalds@linux-foundation.org> 1349048866 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1349048866 -0700

Linux 3.6
tree 355241bd2919016b19b7ffb5c8f44ed0e833d5fb
parent 8bcc9419d0e90ec04c7017760e0b873abca6edc1
author Randy Dunlap <rdunlap@infradead.org> 1531877265 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1533820630 -0400

tcp: identify cryptic messages as TCP seq # bugs

[ Upstream commit e56b8ce363a36fb7b74b80aaa5cc9084f2c908b4 ]

Attempt to make cryptic TCP seq number error messages clearer by
(1) identifying the source of the message as "TCP", (2) identifying the
errors as "seq # bug", and (3) grouping the field identifiers and values
by separating them with commas.

E.g., the following message is changed from:

recvmsg bug 2: copied 73BCB6CD seq 70F17CBE rcvnxt 73BCB9AA fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:1881 tcp_recvmsg+0x649/0xb90

to:

TCP recvmsg seq # bug 2: copied 73BCB6CD, seq 70F17CBE, rcvnxt 73BCB9AA, fl 0
WARNING: CPU: 2 PID: 1501 at /linux/net/ipv4/tcp.c:2011 tcp_recvmsg+0x694/0xba0

Suggested-by: 積丹尼 Dan Jacobson <jidanni@jidanni.org>
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 147c495ec5b5bcdc50a502f6502b9fb69dcdbda8
parent e60a470cc2020da9d18fe72fd4ccde33dd2388ff
author Anders Roxell <anders.roxell@linaro.org> 1532644041 +0200
committer Sasha Levin <sashal@kernel.org> 1539868076 -0400

clk: mvebu: armada-37xx-periph: Remove unused var num_parents

[ Upstream commit 8927c27b32703e28041ae19bf25ea53461be83a1 ]

When building armada-37xx-periph, num_parents isn't used in function
clk_pm_cpu_get_parent:
drivers/clk/mvebu/armada-37xx-periph.c: In function ‘clk_pm_cpu_get_parent’:
drivers/clk/mvebu/armada-37xx-periph.c:419:6: warning: unused variable ‘num_parents’ [-Wunused-variable]
  int num_parents = clk_hw_get_num_parents(hw);
      ^~~~~~~~~~~
Remove the declaration of num_parents to dispose the warning.

Fixes: 616bf80d381d ("clk: mvebu: armada-37xx-periph: Fix wrong return value in get_parent")
Signed-off-by: Anders Roxell <anders.roxell@linaro.org>
Signed-off-by: Stephen Boyd <sboyd@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree ef93b753185308856223654f4560a71e033ffc08
parent cc8639739250a4a5bbfb29abffdab8ff2c8ab1b6
author Linus Torvalds <torvalds@linux-foundation.org> 1370160677 +0900
committer Linus Torvalds <torvalds@linux-foundation.org> 1370160677 +0900

Linux 3.10-rc4
tree dde27aa545d6e3b0df3ab2c496234c8d4e7abc8d
parent 4262ee2a082c01bb2c29e146e163d321c183b0cd
author Damian Kos <dkos@cadence.com> 1542640454 +0000
committer Sasha Levin <sashal@kernel.org> 1556813827 -0400

drm/rockchip: fix for mailbox read validation.

[ Upstream commit e4056bbb6719fe713bfc4030ac78e8e97ddf7574 ]

This is basically the same fix as in
commit fa68d4f8476b ("drm/rockchip: fix for mailbox read size")
but for cdn_dp_mailbox_validate_receive function.

See patchwork.kernel.org/patch/10671981/ for details.

Signed-off-by: Damian Kos <dkos@cadence.com>
Signed-off-by: Heiko Stuebner <heiko@sntech.de>
Link: https://patchwork.freedesktop.org/patch/msgid/1542640463-18332-1-git-send-email-dkos@cadence.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 317796ba2667d14e9bb015e086cd9c022dc9ef3b
parent 959010e510258ef0e7b3e80c629b1d4de92c4fc1
author Sasha Levin <alexander.levin@verizon.com> 1510112668 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1510112668 -0500

Linux 4.1.46

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 6ceb626385b1f9d3d3e58efe1e2e1440365c29fa
parent 8e9d78edea3ce5c0036f85b93091483f2f15443a
author Linus Torvalds <torvalds@linux-foundation.org> 1250902846 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1250902846 -0700

Linux 2.6.31-rc7
tree dd65155eb5a9410e83c5b0d760c099f9fbb7719c
parent fedc1ed0f11be666de066b0c78443254736a942e
author Linus Torvalds <torvalds@linux-foundation.org> 1396237215 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1396237215 -0700

Linux 3.14
tree 50cb748a3dd5d9527cb48e4125774f302fa556b1
parent 8f5d27084d9832f75bc6e6bfdde7622e1e1bf798
author Linus Torvalds <torvalds@linux-foundation.org> 1403413374 -1000
committer Linus Torvalds <torvalds@linux-foundation.org> 1403413374 -1000

Linux 3.16-rc2
tree ac8032765649c7ece7f2854275125f31bca7e719
parent 037e20a3c5c206efdf63f1b45c8b082fc57253d2
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1185136860 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1185136860 -0700

Linux 2.6.23-rc1

Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
tree 89a68d73bf31a7142245de5742013c8d01badd14
parent 44779149e91ec8e684be23e06dc05197e367a45f
author Linus Torvalds <torvalds@g5.osdl.org> 1132457103 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1132457103 -0800

Linux v2.6.15-rc2
tree 1b75bd0b26515271d675a03a5b5dbfd334689030
parent 6f7f41851cc4508b672ab71dd48a154712faf15c
author Linus Torvalds <torvalds@linux-foundation.org> 1293584748 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1293584748 -0800

Linux 2.6.37-rc8
tree 6e23a64c6202ed814e7043ca80a38cad3f341f32
parent 93579aeec2093ff12b55491c655129431b63e3dd
author Linus Torvalds <torvalds@linux-foundation.org> 1387746512 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1387746512 -0800

Linux 3.13-rc5
tree b1fcfe4ab08fd4a6bbed4a62e73eb3bd09b91c5c
parent 0bb44280b5ac45e5e911009e66c1d273bea4ccc6
author Linus Torvalds <torvalds@linux-foundation.org> 1364767963 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1364767963 -0700

Linux 3.9-rc5
tree 735d446d1c39671146ca96cf5dea59ec35e433f2
parent c970d5a32ae1a90fba89892cc3432cf0b408cb8b
author Linus Torvalds <torvalds@linux-foundation.org> 1208400584 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1208400584 -0700

Linux 2.6.25
tree 33d8a4cd7218acb8408be359b2832d6dc1d7ed72
parent bdeeab62a611f1f7cd48fd285ce568e8dcd0455a
author Linus Torvalds <torvalds@linux-foundation.org> 1382210895 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1382210895 -0700

Linux 3.12-rc6
tree 5fadc5e71e3899bebd9fc5d415ad80ae458c7a32
parent 9c516370cef61e09bd7cb38375bae04ce43e782a
author Arindam Nath <arindam.nath@amd.com> 1537265458 +0530
committer Sasha Levin <sashal@kernel.org> 1539640930 -0400

iommu/amd: Return devid as alias for ACPI HID devices

[ Upstream commit 5ebb1bc2d63d90dd204169e21fd7a0b4bb8c776e ]

ACPI HID devices do not actually have an alias for
them in the IVRS. But dev_data->alias is still used
for indexing into the IOMMU device table for devices
being handled by the IOMMU. So for ACPI HID devices,
we simply return the corresponding devid as an alias,
as parsed from IVRS table.

Signed-off-by: Arindam Nath <arindam.nath@amd.com>
Fixes: 2bf9a0a12749 ('iommu/amd: Add iommu support for ACPI HID devices')
Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree fec2224bffa4c1ffa38c3d60af17fd6d9be3fb0c
parent 59766edc79da0583eff7d0a9e1049b0d3c5676b0
author Linus Torvalds <torvalds@linux-foundation.org> 1300152032 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1300152032 -0700

Linux 2.6.38
tree e938b692f8ea878f01f2b4c6fd4be76405546c91
parent abf0072434a36d5a4625986afae42d2e800e9886
author Peter Zijlstra <peterz@infradead.org> 1534951814 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1536437471 -0400

mm/tlb: Remove tlb_remove_table() non-concurrent condition

[ Upstream commit a6f572084fbee8b30f91465f4a085d7a90901c57 ]

Will noted that only checking mm_users is incorrect; we should also
check mm_count in order to cover CPUs that have a lazy reference to
this mm (and could do speculative TLB operations).

If removing this turns out to be a performance issue, we can
re-instate a more complete check, but in tlb_table_flush() eliding the
call_rcu_sched().

Fixes: 267239116987 ("mm, powerpc: move the RCU page-table freeing into generic code")
Reported-by: Will Deacon <will.deacon@arm.com>
Signed-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>
Acked-by: Rik van Riel <riel@surriel.com>
Acked-by: Will Deacon <will.deacon@arm.com>
Cc: Nicholas Piggin <npiggin@gmail.com>
Cc: David Miller <davem@davemloft.net>
Cc: Martin Schwidefsky <schwidefsky@de.ibm.com>
Cc: Michael Ellerman <mpe@ellerman.id.au>
Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 2adb621e27535f9b66e473a08b6e56be95edcf2e
parent 715695cac5f6670fd0eef18a0ffbcf6c824ab489
author Linus Torvalds <torvalds@linux-foundation.org> 1299560977 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1299560977 -0800

Linux 2.6.38-rc8
tree c6f37cfc496a83c972d894ebeee8ba57e52a363a
parent 79c6c01d8caaad34a595b3f4b7dab0b31c94b60d
author Darrick J. Wong <darrick.wong@oracle.com> 1553357429 -0400
committer Sasha Levin <sashal@kernel.org> 1553808020 -0400

ext4: prohibit fstrim in norecovery mode

[ Upstream commit 18915b5873f07e5030e6fb108a050fa7c71c59fb ]

The ext4 fstrim implementation uses the block bitmaps to find free space
that can be discarded.  If we haven't replayed the journal, the bitmaps
will be stale and we absolutely *cannot* use stale metadata to zap the
underlying storage.

Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 208f20750722e031b404f1447b22c5ffd0eed215
parent 2245ba2a3a975656bb303dfaa115accaa4667083
author Linus Torvalds <torvalds@linux-foundation.org> 1281919297 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1281919297 -0700

Linux 2.6.36-rc1
tree f1cf20292203dd2c5bd4a65559369885f6020fe9
parent 4534a1c432551e5588955a5eb8f6cb26c69b047f
author Sasha Levin <sasha.levin@oracle.com> 1446086986 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1446086986 -0400

Linux 3.18.23

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree da6508aa9d1f18bdfbd4a30a8017a667f863ae8f
parent 0cbaed1d8c2493934b86b4ad99b2de9fcce008e8
author Linus Torvalds <torvalds@linux-foundation.org> 1421009093 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1421009093 -0800

linux 3.19-rc4
tree 0d9ed94eaae0f0cdc4ab259f365d9de1b9601fb9
parent d4d5291c8cd499b1b590336059d5cc3e24c1ced6
author Linus Torvalds <torvalds@linux-foundation.org> 1240369620 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1240369620 -0700

Linux 2.6.30-rc3
tree 15103cae057915a9f20bd2ba91f06ae754d4e9ff
parent be2874cb4e625716fa9758ad122084da7764cad0
author Linus Torvalds <torvalds@linux-foundation.org> 1329609213 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1329609213 -0800

Linux 3.3-rc4
tree ff90cc51cb4638c98e97fe3b061362b682d25f83
parent dadda996a5841689afd15bab0b9b05048db52f43
author Yangbo Lu <yangbo.lu@nxp.com> 1515466953 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1517680380 -0500

net: gianfar_ptp: move set_fipers() to spinlock protecting area

[ Upstream commit 11d827a993a969c3c6ec56758ff63a44ba19b466 ]

set_fipers() calling should be protected by spinlock in
case that any interrupt breaks related registers setting
and the function we expect. This patch is to move set_fipers()
to spinlock protecting area in ptp_gianfar_adjtime().

Signed-off-by: Yangbo Lu <yangbo.lu@nxp.com>
Acked-by: Richard Cochran <richardcochran@gmail.com>
Reviewed-by: Fabio Estevam <fabio.estevam@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree cb021e256554cf6c8b04be45e7530444d7bc8673
parent 7cf9f2300c12ba5fba23e7c61a3477927b0cc6d1
author Sasha Levin <sasha.levin@oracle.com> 1466654394 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1466654394 -0400

Linux 4.1.27

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 34a580bc9237e4a0782eead469fb0c067dba8d01
parent c003797af3bc3b267a262b4d28ca06efc80390d4
author Sasha Levin <alexander.levin@verizon.com> 1477169102 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1477169102 -0400

Linux 3.18.44

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 8cc8f2a8216e7d108fad62897a04c3f0cd00c0c7
parent ea45ea70b6131fa0b006f5b687b9b1398b24f681
author Linus Torvalds <torvalds@linux-foundation.org> 1374433529 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1374433529 -0700

Linux 3.11-rc2
tree b494a3be23da558214079c479b540cc771b96b1c
parent ec4883b015c3212f6f6d04fb2ff45f528492f598
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1181005045 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1181005045 -0700

Linux 2.6.22-rc4
tree ded3b52b221615138836ef7c608d3a56e764086a
parent 6d03a68e6d5528630955452ec4b768dbde0dc00c
author Linus Torvalds <torvalds@g5.osdl.org> 1161644522 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1161644522 -0700

Linux 2.6.19-rc3
tree b69f88455c6654c0e420ca71edbaa58717bfab33
parent 54f642ea6676705893c34a0bf53880aea29a1363
author Sasha Levin <sasha.levin@oracle.com> 1437441190 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1437441190 -0400

Linux 3.18.19

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree ce9a69c3dc4b8c81fb0c1fe1f6b60cfe6d939956
parent f7d02ae76ebbf5b8a9531fe150c49e126a397704
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1179020756 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1179020756 -0700

Linux 2.6.22-rc1

.. close the merge window
tree b21695436e263d8aa9b1c958f4891ddac9225750
parent 8850b5fb5eaf090db61202be9d6178d008165aa0
author Randy Dunlap <rdunlap@infradead.org> 1512757159 -0800
committer Sasha Levin <alexander.levin@microsoft.com> 1525109924 -0400

kdb: make "mdr" command repeat

[ Upstream commit 1e0ce03bf142454f38a5fc050bf4fd698d2d36d8 ]

The "mdr" command should repeat (continue) when only Enter/Return
is pressed, so make it do so.

Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Daniel Thompson <daniel.thompson@linaro.org>
Cc: Jason Wessel <jason.wessel@windriver.com>
Cc: kgdb-bugreport@lists.sourceforge.net
Signed-off-by: Jason Wessel <jason.wessel@windriver.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree c731cde6cf0bea2ab7155e4280141896092f9e88
parent 0cef1e3cee84a4f300d3c4d3a9bd6bf0c75b7e9e
author Takashi Iwai <tiwai@suse.de> 1534023214 +0200
committer Sasha Levin <sashal@kernel.org> 1541428204 -0500

ALSA: hda: Check the non-cached stream buffers more explicitly

[ Upstream commit 78c9be61c3a5cd9e2439fd27a5ffad73a81958c7 ]

Introduce a new flag, uc_buffer, to indicate that the controller
requires the non-cached pages for stream buffers, either as a
chip-specific requirement or specified via snoop=0 option.
This improves the code-readability.

Also, this patch fixes the incorrect behavior for C-Media chip where
the stream buffers were never handled as non-cached due to the check
of driver_type even if you pass snoop=0 option.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree ecd63a07c47aafad9e2c06d9ddca45c58966749d
parent 01e33b5a2a153eec74dd87522e264948030b88c1
author Linus Torvalds <torvalds@g5.osdl.org> 1135468068 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1135468068 -0800

Linux v2.6.15-rc7

Ho ho ho.
tree 88568d9b9e8918c4cb30c256c7d616f6d06425fa
parent 18b15fcde715a5512671af9d72a76e7f6d7cb6f0
author Linus Torvalds <torvalds@linux-foundation.org> 1336342052 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1336342052 -0700

Linux 3.4-rc6
tree 434d237e8e6fdac43ae4a4a54bc69a24d9a4f088
parent b5dbc858717113c823fe6bb058807c2cb67d1efa
author Linus Torvalds <torvalds@linux-foundation.org> 1274044656 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1274044656 -0700

Linus 2.6.34
tree 758371b68af2470b5549fe9798f478cfc70cf2ab
parent 6c4c4d4bdaff7ec0b7b26da67d741f639727c934
author Linus Torvalds <torvalds@linux-foundation.org> 1365986716 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1365986716 -0700

Linux 3.9-rc7
tree ac5789db0f3c1fe1f45822907d6b9204315f787a
parent d31e817183a4c1ee2e5fc0635ac075381f5c4419
author Linus Torvalds <torvalds@woody.osdl.org> 1163649820 -0800
committer Linus Torvalds <torvalds@woody.osdl.org> 1163649820 -0800

Linux 2.6.19-rc6

Getting there.  Hopefully the MSI and other interrupt problems are all
solved now.

Signed-off-by: Linus Torvalds <torvalds@osdl.org>
tree 5858efe7e88a457f3fd1c51dc42272e5d28bacde
parent 816d9d4b991691302043b1c8b193c94364400c71
author Greg Kroah-Hartman <gregkh@linuxfoundation.org> 1556546186 +0200
committer Sasha Levin <sashal@kernel.org> 1556619594 -0400

Revert "block/loop: Use global lock for ioctl() operation."

This reverts commit 3ae3d167f5ec2c7bb5fcd12b7772cfadc93b2305 which is
commit 310ca162d779efee8a2dc3731439680f3e9c1e86 upstream.

Jan Kara has reported seeing problems with this patch applied, as has
Salvatore Bonaccorso, so let's drop it for now.

Reported-by: Salvatore Bonaccorso <carnil@debian.org>
Reported-by: Jan Kara <jack@suse.cz>
Cc: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Cc: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
tree 602ca9d584ce5a7d31671634faaf30b76dbcbe35
parent dff6c8627945248c41c8c14c20ac9d366a3f4baf
author Mimi Zohar <zohar@linux.vnet.ibm.com> 1510144708 -0500
committer Sasha Levin <alexander.levin@microsoft.com> 1520972401 -0400

ima: relax requiring a file signature for new files with zero length

[ Upstream commit b7e27bc1d42e8e0cc58b602b529c25cd0071b336 ]

Custom policies can require file signatures based on LSM labels.  These
files are normally created and only afterwards labeled, requiring them
to be signed.

Instead of requiring file signatures based on LSM labels, entire
filesystems could require file signatures.  In this case, we need the
ability of writing new files without requiring file signatures.

The definition of a "new" file was originally defined as any file with
a length of zero.  Subsequent patches redefined a "new" file to be based
on the FILE_CREATE open flag.  By combining the open flag with a file
size of zero, this patch relaxes the file signature requirement.

Fixes: 1ac202e978e1 ima: accept previously set IMA_NEW_FILE
Signed-off-by: Mimi Zohar <zohar@linux.vnet.ibm.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree fbc3e0ec24d5657d3356df8264227cfd3ea374b2
parent 62bdb288bf464862a2801b2e53aadc6c4d100fab
author Linus Torvalds <torvalds@linux-foundation.org> 1285722082 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1285722082 -0700

Linux 2.6.36-rc6
tree 9432bb5798ff18eb1a20f37a7fa3055ffcfb12e4
parent 5066f92a364fdd4fd902f70f4015afb05ff200cb
author jie@chenjie6@huwei.com <jie@chenjie6@huwei.com> 1533946986 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1535126150 -0400

mm/memory.c: check return value of ioremap_prot

[ Upstream commit 24eee1e4c47977bdfb71d6f15f6011e7b6188d04 ]

ioremap_prot() can return NULL which could lead to an oops.

Link: http://lkml.kernel.org/r/1533195441-58594-1-git-send-email-chenjie6@huawei.com
Signed-off-by: chen jie <chenjie6@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Li Zefan <lizefan@huawei.com>
Cc: chenjie <chenjie6@huawei.com>
Cc: Yang Shi <shy828301@gmail.com>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree d7eda9db9252f44c0755280de90f7ebc7ced0dfd
parent 81c20b96e51660762f7d0df58b5faa370d47e3fd
author Linus Torvalds <torvalds@linux-foundation.org> 1286397592 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1286397592 -0700

Linux 2.6.36-rc7
tree 11e9be4b05c1baf91961e08da475270f2af59f83
parent dc862e8aaff630319498c12685cf816e6ff830dd
author Rasmus Villemoes <linux@rasmusvillemoes.dk> 1552572374 +0100
committer Sasha Levin <sashal@kernel.org> 1555809967 -0400

leds: trigger: netdev: use memcpy in device_name_store

[ Upstream commit 909346433064b8d840dc82af26161926b8d37558 ]

If userspace doesn't end the input with a newline (which can easily
happen if the write happens from a C program that does write(fd,
iface, strlen(iface))), we may end up including garbage from a
previous, longer value in the device_name. For example

# cat device_name

# printf 'eth12' > device_name
# cat device_name
eth12
# printf 'eth3' > device_name
# cat device_name
eth32

I highly doubt anybody is relying on this behaviour, so switch to
simply copying the bytes (we've already checked that size is <
IFNAMSIZ) and unconditionally zero-terminate it; of course, we also
still have to strip a trailing newline.

This is also preparation for future patches.

Fixes: 06f502f57d0d ("leds: trigger: Introduce a NETDEV trigger")
Signed-off-by: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Acked-by: Pavel Machek <pavel@ucw.cz>
Signed-off-by: Jacek Anaszewski <jacek.anaszewski@gmail.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree 889486fd758dc6abaa3d4b8d1dcba4af577488c2
parent 73cac03d0c771e56481017b8f093ae0300e89dad
author Linus Torvalds <torvalds@linux-foundation.org> 1381704088 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1381704088 -0700

Linux 3.12-rc5
tree c731118f4b0e52b2ba74a932754d4abff016a41e
parent 2d18bd5d7e69085fc124fed81998e253f500244c
author Prarit Bhargava <prarit@redhat.com> 1539011178 -0400
committer Sasha Levin <sashal@kernel.org> 1541428192 -0500

cpupower: Fix AMD Family 0x17 msr_pstate size

[ Upstream commit 8c22e2f695920ebd94f9a53bcf2a65eb36d4dba1 ]

The msr_pstate data is only 63 bits long and should be 64 bits.

Add in the missing bit from res1 for AMD Family 0x17.

Reference: https://www.amd.com/system/files/TechDocs/54945_PPR_Family_17h_Models_00h-0Fh.pdf, page 138.

Signed-off-by: Prarit Bhargava <prarit@redhat.com>
Cc: Shuah Khan <shuah@kernel.org>
Cc: Stafford Horne <shorne@gmail.com>
Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 094107c47d93215c6e10b512755084f3a43665f6
parent 02ce1fd73386e7420cd9b2dc87abd02a7889eaac
author Sasha Levin <alexander.levin@verizon.com> 1476023025 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1476062687 -0400

Linux 3.18.43

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree b522416ab70b89995ac719bff4a021ecf2a4d1a1
parent f72eccdf8f9203609d088010bf4567b4d53c66fb
author David Rientjes <rientjes@google.com> 1546462593 -0800
committer Sasha Levin <sashal@kernel.org> 1550431946 -0500

kvm: sev: Fail KVM_SEV_INIT if already initialized

[ Upstream commit 3f14a89d1132dcae3c8ce6721c6ef51f6e6d9b5f ]

By code inspection, it was found that multiple calls to KVM_SEV_INIT
could deplete asid bits and overwrite kvm_sev_info's regions_list.

Multiple calls to KVM_SVM_INIT is not likely to occur with QEMU, but this
should likely be fixed anyway.

This code is serialized by kvm->lock.

Fixes: 1654efcbc431 ("KVM: SVM: Add KVM_SEV_INIT command")
Reported-by: Cfir Cohen <cfir@google.com>
Signed-off-by: David Rientjes <rientjes@google.com>
Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 881be106ca8c3453a9aa914433d1487a2c4b919c
parent 5d7e0d2bd98ef4f5a16ac9da1987ae655368dd6a
author Linus Torvalds <torvalds@linux-foundation.org> 1215298402 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1215298402 -0700

Linux 2.6.26-rc9
tree f9fb2bfbe536c6f589c38dc5786f18954e55d4b8
parent 35b73ceb9a7d10c81bd9e79e8485f7079ef2b40e
author Linus Torvalds <torvalds@g5.osdl.org> 1140215025 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1140215025 -0800

Linux v2.6.16-rc4
tree 3f4a7e51ecee64b66cc8748341f55d2687de3503
parent d541b22abde3e71af4b65d79a510b6bc551d5f76
author Linus Torvalds <torvalds@linux-foundation.org> 1222036195 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1222036195 -0700

Linux 2.6.27-rc7
tree 96a0b5842e24d6736c698cdbd820a3ad9d8d9f10
parent 8f493d797bc1fe470377adc9d8775845427e240e
author Linus Torvalds <torvalds@g5.osdl.org> 1136258470 -0800
committer Linus Torvalds <torvalds@g5.osdl.org> 1136258470 -0800

Linux v2.6.15

Hey, it's fifteen years today since I bought the machine that got Linux
started.  January 2nd is a good date.
tree 9878aa502b5c33a3c92fb305ac792828f5b3a981
parent dd3070debc95a6cfac69871fd1a0a4ad2958b550
author Keith Busch <keith.busch@intel.com> 1549902230 -0700
committer Sasha Levin <sashal@kernel.org> 1552324653 -0400

nvme-pci: add missing unlock for reset error

[ Upstream commit 4726bcf30fad37cc555cd9dcd6c73f2b2668c879 ]

The reset work holds a mutex to prevent races with removal modifying the
same resources, but was unlocking only on success. Unlock on failure
too.

Fixes: 5c959d73dba64 ("nvme-pci: fix rapid add remove sequence")
Signed-off-by: Keith Busch <keith.busch@intel.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 9ec1993c26aff5202ed1218713c7d440869cf587
parent 2ea1e35ab1f7adbae1bae2295529991d95c7f349
author Linus Torvalds <torvalds@linux-foundation.org> 1419814177 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1419814177 -0800

Linux 3.19-rc2
tree 6a52d6f5a80924872ae665a0c288cc6ab3812190
parent efde5b7eef5788797cf915ec87f0bdb931b1342c
author Xiao Liang <xiliang@redhat.com> 1534260088 +0800
committer Sasha Levin <alexander.levin@microsoft.com> 1537021472 -0400

xen-netfront: fix warn message as irq device name has '/'

[ Upstream commit 21f2706b20100bb3db378461ab9b8e2035309b5b ]

There is a call trace generated after commit 2d408c0d4574b01b9ed45e02516888bf925e11a9(
xen-netfront: fix queue name setting). There is no 'device/vif/xx-q0-tx' file found
under /proc/irq/xx/.

This patch only picks up device type and id as its name.

With the patch, now /proc/interrupts looks like below and the warning message gone:
 70:         21          0          0          0   xen-dyn    -event     vif0-q0-tx
 71:         15          0          0          0   xen-dyn    -event     vif0-q0-rx
 72:         14          0          0          0   xen-dyn    -event     vif0-q1-tx
 73:         33          0          0          0   xen-dyn    -event     vif0-q1-rx
 74:         12          0          0          0   xen-dyn    -event     vif0-q2-tx
 75:         24          0          0          0   xen-dyn    -event     vif0-q2-rx
 76:         19          0          0          0   xen-dyn    -event     vif0-q3-tx
 77:         21          0          0          0   xen-dyn    -event     vif0-q3-rx

Below is call trace information without this patch:

name 'device/vif/0-q0-tx'
WARNING: CPU: 2 PID: 37 at fs/proc/generic.c:174 __xlate_proc_name+0x85/0xa0
RIP: 0010:__xlate_proc_name+0x85/0xa0
RSP: 0018:ffffb85c40473c18 EFLAGS: 00010286
RAX: 0000000000000000 RBX: 0000000000000006 RCX: 0000000000000006
RDX: 0000000000000007 RSI: 0000000000000096 RDI: ffff984c7f516930
RBP: ffffb85c40473cb8 R08: 000000000000002c R09: 0000000000000229
R10: 0000000000000000 R11: 0000000000000001 R12: ffffb85c40473c98
R13: ffffb85c40473cb8 R14: ffffb85c40473c50 R15: 0000000000000000
FS:  0000000000000000(0000) GS:ffff984c7f500000(0000) knlGS:0000000000000000
CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f69b6899038 CR3: 000000001c20a006 CR4: 00000000001606e0
Call Trace:
__proc_create+0x45/0x230
? snprintf+0x49/0x60
proc_mkdir_data+0x35/0x90
register_handler_proc+0xef/0x110
? proc_register+0xfc/0x110
? proc_create_data+0x70/0xb0
__setup_irq+0x39b/0x660
? request_threaded_irq+0xad/0x160
request_threaded_irq+0xf5/0x160
? xennet_tx_buf_gc+0x1d0/0x1d0 [xen_netfront]
bind_evtchn_to_irqhandler+0x3d/0x70
? xenbus_alloc_evtchn+0x41/0xa0
netback_changed+0xa46/0xcda [xen_netfront]
? find_watch+0x40/0x40
xenwatch_thread+0xc5/0x160
? finish_wait+0x80/0x80
kthread+0x112/0x130
? kthread_create_worker_on_cpu+0x70/0x70
ret_from_fork+0x35/0x40
Code: 81 5c 00 48 85 c0 75 cc 5b 49 89 2e 31 c0 5d 4d 89 3c 24 41 5c 41 5d 41 5e 41 5f c3 4c 89 ee 48 c7 c7 40 4f 0e b4 e8 65 ea d8 ff <0f> 0b b8 fe ff ff ff 5b 5d 41 5c 41 5d 41 5e 41 5f c3 66 0f 1f
---[ end trace 650e5561b0caab3a ]---

Signed-off-by: Xiao Liang <xiliang@redhat.com>
Reviewed-by: Juergen Gross <jgross@suse.com>

Signed-off-by: David S. Miller <davem@davemloft.net>

Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6287734ad4ec8a495a6956ead109d30798c900da
parent ab4cbac488e63aa335cd79aa008f83335e8a690e
author Changbin Du <changbin.du@gmail.com> 1553527007 +0000
committer Sasha Levin (Microsoft) <sashal@kernel.org> 1555463664 -0400

kconfig/[mn]conf: handle backspace (^H) key

[ Upstream commit 9c38f1f044080392603c497ecca4d7d09876ff99 ]

Backspace is not working on some terminal emulators which do not send the
key code defined by terminfo. Terminals either send '^H' (8) or '^?' (127).
But currently only '^?' is handled. Let's also handle '^H' for those
terminals.

Signed-off-by: Changbin Du <changbin.du@gmail.com>
Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Sasha Levin (Microsoft) <sashal@kernel.org>
tree 6905a71b3c37cdaead1c44f739f5d1a20e3f1b31
parent dd536b607688315b3043ab5fd5243c3f530922a2
author Sasha Levin <sasha.levin@oracle.com> 1466654549 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1466654549 -0400

Linux 3.18.36

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 4c23b28f1ffc284be6fec0d4cb198b8371f681cd
parent c4568d6c7ec7557fbe8656286aea29f67388f7d4
author Linus Torvalds <torvalds@linux-foundation.org> 1233168570 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1233168570 -0800

Linux 2.6.29-rc3
tree c6aaa1327d4c290b92c451813dad849d39970cdc
parent 669c743362daa6b9167cef4df8b405ba9c5c3a53
author Linus Torvalds <torvalds@linux-foundation.org> 1369085858 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1369085858 -0700

Linux 3.10-rc2
tree 4241e3f450e5039d0b45e4f52a80097175546042
parent 2391dae3e36c19fe668c71eac2eb8344dbaaf46d
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1183319664 -0700
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1183319664 -0700

Linux 2.6.22-rc7

Last -rc? That's the plan..
tree 399f827f90446ea3234cd6719296fd7536b6089f
parent ddeaa97b67e36a2e891655d2154c1e2ba34c252e
author Russell King <rmk+kernel@armlinux.org.uk> 1523467441 +0100
committer Sasha Levin <alexander.levin@microsoft.com> 1527901305 -0400

ARM: kexec: fix kdump register saving on panic()

[ Upstream commit 2d7b3c64431245c95b05a441669c074da10db943 ]

When a panic() occurs, the kexec code uses smp_send_stop() to stop
the other CPUs, but this results in the CPU register state not being
saved, and gdb is unable to inspect the state of other CPUs.

Commit 0ee59413c967 ("x86/panic: replace smp_send_stop() with kdump
friendly version in panic path") addressed the issue on x86, but
ignored other architectures.  Address the issue on ARM by splitting
out the crash stop implementation to crash_smp_send_stop() and
adding the necessary protection.

Signed-off-by: Russell King <rmk+kernel@armlinux.org.uk>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree e8fd1bccb66c465b9a53d1f278d863cbfa8719ac
parent 40779859de0f73b40390c6401a024d06cf024290
author Linus Torvalds <torvalds@linux-foundation.org> 1308004199 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1308004199 -0700

Linux 3.0-rc3
tree 5fc29a4b720686efce545bc3db26567945868113
parent e024f69de9bd5b2686019f2491b779044cf89707
author Linus Torvalds <torvalds@linux-foundation.org> 1303187160 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1303187160 -0700

Linux 2.6.39-rc4
tree 5acca861d96fd207eecbe8a9e25c40a4b7647c30
parent 3c92c2ba33cd7d666c5f83cc32aa590e794e91b0
author Linus Torvalds <torvalds@g5.osdl.org> 1128993559 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1128993559 -0700

Linux v2.6.14-rc4
tree ff4b10ebd9cf1a057c4b1a703732858a539faff7
parent 79568f5be06c91071697c065f01f3ebfbeb25a61
author Linus Torvalds <torvalds@linux-foundation.org> 1308626746 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1308626746 -0700

Linux 3.0-rc4
tree f6f7009c0b6a896ff1ea22aac7f17f23bd5a9e4f
parent 869682384e78605897f9332700fe26c358ecf21c
author Linus Torvalds <torvalds@linux-foundation.org> 1325721344 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1325721344 -0800

Linux 3.2
tree 8518588c1f2cd05ba9fd393ca0c67168c16e8cfa
parent 7e0dae61e24a88ad21af2f196e49454e78a8df78
author Linus Torvalds <torvalds@linux-foundation.org> 1410131383 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1410131383 -0700

Linux 3.17-rc4
tree 69b6407ff87c8fd6c847ebe27af52897a7aded2b
parent 5adaf851d2073c76bb98bc5cdb13d5754b7f0983
author Linus Torvalds <torvalds@linux-foundation.org> 1310428312 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1310428312 -0700

Linux 3.0-rc7
tree 585be22c4d124330388d2ef472ab34149b361c0c
parent b97d4803400a4442b0e4ae14d0bd8e83994b9004
author Linus Torvalds <torvalds@linux-foundation.org> 1206495494 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1206495494 -0700

Linux 2.6.25-rc7
tree 44b429c1204df19f91580110ea977fa3777bee24
parent 2433c8f094a008895e66f25bd1773cdb01c91d01
author Linus Torvalds <torvalds@linux-foundation.org> 1381093220 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1381093220 -0700

Linux 3.12-rc4
tree 88c70a2a91cb91d7778d4368cd3d93d476e460ae
parent 18351070b86d155713cf790b26af4f21b1fd0b29
author Linus Torvalds <torvalds@linux-foundation.org> 1217998194 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1217998194 -0700

Linux 2.6.27-rc2
tree 0a22db5bbfbdd2e1cfb119a5e0cfda64d05cdbee
parent 554782dbd3d39535e505a0e095a4a67de9ee5759
author Arnd Bergmann <arnd@arndb.de> 1553529043 +0100
committer Sasha Levin <sashal@kernel.org> 1556040643 -0400

ARM: iop: don't use using 64-bit DMA masks

[ Upstream commit 2125801ccce19249708ca3245d48998e70569ab8 ]

clang warns about statically defined DMA masks from the DMA_BIT_MASK
macro with length 64:

 arch/arm/mach-iop13xx/setup.c:303:35: error: shift count >= width of type [-Werror,-Wshift-count-overflow]
 static u64 iop13xx_adma_dmamask = DMA_BIT_MASK(64);
                                  ^~~~~~~~~~~~~~~~
 include/linux/dma-mapping.h:141:54: note: expanded from macro 'DMA_BIT_MASK'
 #define DMA_BIT_MASK(n) (((n) == 64) ? ~0ULL : ((1ULL<<(n))-1))
                                                      ^ ~~~

The ones in iop shouldn't really be 64 bit masks, so changing them
to what the driver can support avoids the warning.

Signed-off-by: Arnd Bergmann <arnd@arndb.de>
Signed-off-by: Olof Johansson <olof@lixom.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 5a985bee5a61bc1997d37cd407f325ce54945eb0
parent 1d4d4ecc636962d215bd0fa82c6e7a4f8ead0ac3
author Richard Weinberger <richard@nod.at> 1536008783 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1538313638 -0400

ubifs: Check for name being NULL while mounting

[ Upstream commit 37f31b6ca4311b94d985fb398a72e5399ad57925 ]

The requested device name can be NULL or an empty string.
Check for that and refuse to continue. UBIFS has to do this manually
since we cannot use mount_bdev(), which checks for this condition.

Fixes: 1e51764a3c2ac ("UBIFS: add new flash file system")
Reported-by: syzbot+38bd0f7865e5c6379280@syzkaller.appspotmail.com
Signed-off-by: Richard Weinberger <richard@nod.at>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree a9780d065fd8a559ff75ec3f148501c4478f4216
parent f805fbdaacf4367ce566743a665622387768ac0d
author Linus Torvalds <torvalds@g5.osdl.org> 1127185241 -0700
committer Linus Torvalds <torvalds@g5.osdl.org> 1127185241 -0700

Linux v2.6.14-rc2

Avast, ye scurvy land-lubbers! Time to try out a new release.

Arrr!
tree c3d2126cb53512be2925ca222b585ed44ba82011
parent 833d8d9665d67525584f7ae9cfd2b486c0ef1aa8
author Prarit Bhargava <prarit@redhat.com> 1539011178 -0400
committer Sasha Levin <sashal@kernel.org> 1541344881 -0500

cpupower: Fix AMD Family 0x17 msr_pstate size

[ Upstream commit 8c22e2f695920ebd94f9a53bcf2a65eb36d4dba1 ]

The msr_pstate data is only 63 bits long and should be 64 bits.

Add in the missing bit from res1 for AMD Family 0x17.

Reference: https://www.amd.com/system/files/TechDocs/54945_PPR_Family_17h_Models_00h-0Fh.pdf, page 138.

Signed-off-by: Prarit Bhargava <prarit@redhat.com>
Cc: Shuah Khan <shuah@kernel.org>
Cc: Stafford Horne <shorne@gmail.com>
Signed-off-by: Shuah Khan (Samsung OSG) <shuah@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree c85f569dbce02b8f79f20dc328044ce4e4653a77
parent b9327296e5e7cbc46e8ab27616a96b56b0bece9c
author Darrick J. Wong <darrick.wong@oracle.com> 1553357429 -0400
committer Sasha Levin <sashal@kernel.org> 1553808032 -0400

ext4: prohibit fstrim in norecovery mode

[ Upstream commit 18915b5873f07e5030e6fb108a050fa7c71c59fb ]

The ext4 fstrim implementation uses the block bitmaps to find free space
that can be discarded.  If we haven't replayed the journal, the bitmaps
will be stale and we absolutely *cannot* use stale metadata to zap the
underlying storage.

Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 3a974a2b2283d37dc1ef3cb5a154a86eb1562f30
parent 65f42886e24be2197b1263f138eabf40c6774d00
author Linus Torvalds <torvalds@linux-foundation.org> 1294188619 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1294188619 -0800

Linux 2.6.37
tree 8446b466a51ad08c182fff63ec293798ed227bc1
parent c69ad7198848105127d1174230265cbe7136d982
author Parav Pandit <parav@mellanox.com> 1531731013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1536899874 -0400

RDMA/cma: Do not ignore net namespace for unbound cm_id

[ Upstream commit 643d213a9a034fa04f5575a40dfc8548e33ce04f ]

Currently if the cm_id is not bound to any netdevice, than for such cm_id,
net namespace is ignored; which is incorrect.

Regardless of cm_id bound to a netdevice or not, net namespace must
match. When a cm_id is bound to a netdevice, in such case net namespace
and netdevice both must match.

Fixes: 4c21b5bcef73 ("IB/cma: Add net_dev and private data checks to RDMA CM")
Signed-off-by: Parav Pandit <parav@mellanox.com>
Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree f17992c4fc226a80262bb4c4ecab5c220316304c
parent 994b384a040d6f8afc3595c1a99c1b784e0cce49
author Linus Torvalds <torvalds@linux-foundation.org> 1283096164 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1283096164 -0700

Linux 2.6.36-rc3
tree 42d5e315032f99ba671e37222ba8668b4925a51a
parent 048f039f3ee39417d5a6a1eb73bf01f935e9ed3f
author Linus Torvalds <torvalds@linux-foundation.org> 1297826625 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1297826625 -0800

Linux 2.6.38-rc5
tree 5d780ab27d9c0b1478eb9fb96a84eac311f275b3
parent 6cfdd02b886aac866098f33262d409565f101ce0
author Linus Torvalds <torvalds@linux-foundation.org> 1335737950 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1335737950 -0700

Linux 3.4-rc5
tree 37975237a92e235cebf9ebf0d79cee97630a4725
parent df0e5109cfea25f842bf99f567aac20ac9ef78fe
author Sasha Levin <sasha.levin@oracle.com> 1438974484 -0400
committer Sasha Levin <sasha.levin@oracle.com> 1438974484 -0400

Linux 3.18.20

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree d13f1778985d53e20322ffdd2c8e90daaa03aabc
parent 13a3cec8443290b082af2a5254562aca247fe591
author Linus Torvalds <torvalds@linux-foundation.org> 1295665294 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1295665294 -0800

Linux 2.6.38-rc2
tree b1b314abee4e8c2c7db3f5bbec2e4a2123702b97
parent f1b701cc7de75ef25f5d269d533c3ac9b14a270d
author Naoya Horiguchi <n-horiguchi@ah.jp.nec.com> 1536101151 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538144142 -0400

tools/vm/page-types.c: fix "defined but not used" warning

[ Upstream commit 7ab660f8baecfe26c1c267fa8e64d2073feae2bb ]

debugfs_known_mountpoints[] is not used any more, so let's remove it.

Link: http://lkml.kernel.org/r/1535102651-19418-1-git-send-email-n-horiguchi@ah.jp.nec.com
Signed-off-by: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Matthew Wilcox <willy@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 7cf197aee960cef052a85abd81bbe4cbfb8699be
parent 8482a0abe94e535bca25d22f8d46bbecbfe1f132
author Linus Torvalds <torvalds@linux-foundation.org> 1330823289 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1330823289 -0800

Linux 3.3-rc6
tree 30a2748aafb39131b8e3d0dbc427b040435e584b
parent 73f8be297e90f6ebb951c30490376833f8782349
author Linus Torvalds <torvalds@linux-foundation.org> 1347832731 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1347832731 -0700

Linux 3.6-rc6
tree 8cd1c790775176987969967bd1cfde18a9b28cc3
parent bfe29a5072a5677ff5b871cbc6cf64c9f7f32415
author Gabriel Fernandez <gabriel.fernandez@st.com> 1550380216 -0800
committer Sasha Levin <sashal@kernel.org> 1551291787 -0500

Input: st-keyscan - fix potential zalloc NULL dereference

[ Upstream commit 2439d37e1bf8a34d437573c086572abe0f3f1b15 ]

This patch fixes the following static checker warning:

drivers/input/keyboard/st-keyscan.c:156 keyscan_probe()
error: potential zalloc NULL dereference: 'keypad_data->input_dev'

Reported-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Gabriel Fernandez <gabriel.fernandez@st.com>
Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 0bf302497614d02f3f268079cf69ff4885fb1971
parent 8a1a4c7aa10452bba98a52434cf165ee45d0f362
author Sasha Levin <alexander.levin@verizon.com> 1472870795 -0400
committer Sasha Levin <alexander.levin@verizon.com> 1472874141 -0400

Linux 3.18.41

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 1ab8ca760688a42d7c25cd38d5fc2dec35059a7c
parent 50e37ccea06ca8846ceb60dbfbe056012c60d71b
author Linus Torvalds <torvalds@linux-foundation.org> 1376861813 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1376861813 -0700

Linux 3.11-rc6
tree 2138221a9ce78654e79286610949c7ecbcd96858
parent 2d860ad76f4ee4d2eba0fe3797c8d7cdce432cc0
author Linus Torvalds <torvalds@linux-foundation.org> 1250203414 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1250203414 -0700

Linux 2.6.31-rc6
tree 538a3165718ae0c5af0c3e290653fc176b4d7af4
parent 9a8e5d41124a7352e554581333d4d9689dc1526b
author Linus Torvalds <torvalds@linux-foundation.org> 1334539709 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1334539709 -0700

Linux 3.4-rc3
tree c2d25f7a35dc36788ca0064971734c2ebc4541c0
parent c8050d8ac40091fa303c4a642b2eb7a7510d5e64
author Daniele Palmas <dnlplm@gmail.com> 1527758309 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1528400376 -0400

net: usb: cdc_mbim: add flag FLAG_SEND_ZLP

[ Upstream commit 9f7c728332e8966084242fcd951aa46583bc308c ]

Testing Telit LM940 with ICMP packets > 14552 bytes revealed that
the modem needs FLAG_SEND_ZLP to properly work, otherwise the cdc
mbim data interface won't be anymore responsive.

Signed-off-by: Daniele Palmas <dnlplm@gmail.com>
Acked-by: Bjørn Mork <bjorn@mork.no>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree fe97d9f1716e19d4d38dcc0aa6b51c07e7646cc2
parent 768490990d14b0ff760d4284db4f4cdcc68e901f
author jie@chenjie6@huwei.com <jie@chenjie6@huwei.com> 1533946986 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1534601841 -0400

mm/memory.c: check return value of ioremap_prot

[ Upstream commit 24eee1e4c47977bdfb71d6f15f6011e7b6188d04 ]

ioremap_prot() can return NULL which could lead to an oops.

Link: http://lkml.kernel.org/r/1533195441-58594-1-git-send-email-chenjie6@huawei.com
Signed-off-by: chen jie <chenjie6@huawei.com>
Reviewed-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Li Zefan <lizefan@huawei.com>
Cc: chenjie <chenjie6@huawei.com>
Cc: Yang Shi <shy828301@gmail.com>
Cc: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree b7c95d1b5c560c1e9e45e94b75d8c7d0eac4d7a9
parent 0602b1a1f41849ee30e6bccb22d24f0faf0cbd89
author Darrick J. Wong <darrick.wong@oracle.com> 1553357429 -0400
committer Sasha Levin <sashal@kernel.org> 1553808042 -0400

ext4: prohibit fstrim in norecovery mode

[ Upstream commit 18915b5873f07e5030e6fb108a050fa7c71c59fb ]

The ext4 fstrim implementation uses the block bitmaps to find free space
that can be discarded.  If we haven't replayed the journal, the bitmaps
will be stale and we absolutely *cannot* use stale metadata to zap the
underlying storage.

Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree c4c4e3dae8014d38b8c2cc8700f6fc299e79a972
parent 61fb6fd223d297de96c8978dcc92684d352473c8
author Darrick J. Wong <darrick.wong@oracle.com> 1553357429 -0400
committer Sasha Levin <sashal@kernel.org> 1553807989 -0400

ext4: prohibit fstrim in norecovery mode

[ Upstream commit 18915b5873f07e5030e6fb108a050fa7c71c59fb ]

The ext4 fstrim implementation uses the block bitmaps to find free space
that can be discarded.  If we haven't replayed the journal, the bitmaps
will be stale and we absolutely *cannot* use stale metadata to zap the
underlying storage.

Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree d5705a3afd855a498328bd2dfd7a5a9140a51e6f
parent 77a63f3d1e0a3e7ede8d10f569e8481b13ff47c5
author Linus Torvalds <torvalds@linux-foundation.org> 1280700674 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1280700674 -0700

Linux 2.6.35
tree 88ff2bac7ad38feffa4ce1a921ac795c2ff79725
parent 8924206436d5ac6824b5c341b2570d80282a2dcf
author Coly Li <colyli@suse.de> 1549687986 +0800
committer Sasha Levin <sashal@kernel.org> 1553631822 -0400

bcache: fix potential div-zero error of writeback_rate_p_term_inverse

[ Upstream commit 5b5fd3c94eef69dcfaa8648198e54c92e5687d6d ]

Current code already uses d_strtoul_nonzero() to convert input string
to an unsigned integer, to make sure writeback_rate_p_term_inverse
won't be zero value. But overflow may happen when converting input
string to an unsigned integer value by d_strtoul_nonzero(), then
dc->writeback_rate_p_term_inverse can still be set to 0 even if the
sysfs file input value is not zero, e.g. 4294967296 (a.k.a UINT_MAX+1).

If dc->writeback_rate_p_term_inverse is set to 0, it might cause a
dev-zero error in following code from __update_writeback_rate(),
	int64_t proportional_scaled =
		div_s64(error, dc->writeback_rate_p_term_inverse);

This patch replaces d_strtoul_nonzero() by sysfs_strtoul_clamp() and
limit the value range in [1, UINT_MAX]. Then the unsigned integer
overflow and dev-zero error can be avoided.

Signed-off-by: Coly Li <colyli@suse.de>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 15ec91b6e2819c924a77f40667374c1136cdb667
parent 37ee489a5186634dccabbeca9fca1dd9cc49eb2a
author Parav Pandit <parav@mellanox.com> 1531731013 +0300
committer Sasha Levin <alexander.levin@microsoft.com> 1536899925 -0400

RDMA/cma: Do not ignore net namespace for unbound cm_id

[ Upstream commit 643d213a9a034fa04f5575a40dfc8548e33ce04f ]

Currently if the cm_id is not bound to any netdevice, than for such cm_id,
net namespace is ignored; which is incorrect.

Regardless of cm_id bound to a netdevice or not, net namespace must
match. When a cm_id is bound to a netdevice, in such case net namespace
and netdevice both must match.

Fixes: 4c21b5bcef73 ("IB/cma: Add net_dev and private data checks to RDMA CM")
Signed-off-by: Parav Pandit <parav@mellanox.com>
Reviewed-by: Daniel Jurgens <danielj@mellanox.com>
Signed-off-by: Leon Romanovsky <leonro@mellanox.com>
Signed-off-by: Jason Gunthorpe <jgg@mellanox.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 1c4ab86d4fbc8c699f8351f782dfbace586c5d36
parent 9e23311345135083f6074b280de1e6dc5eee1f68
author Linus Torvalds <torvalds@linux-foundation.org> 1312766610 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1312766610 -0700

Linux 3.1-rc1
tree 1ff7739ddc7e99437d36312c5af680e4e4239cda
parent 8f7b0ba1c853919b85b54774775f567f30006107
author Linus Torvalds <torvalds@linux-foundation.org> 1226785376 -0800
committer Linus Torvalds <torvalds@linux-foundation.org> 1226785376 -0800

Linux 2.6.28-rc5
tree faad6038e31dee1e805c9d7d44c47af6e43bb44e
parent b7a68369ea81dfae1416aadf722d830c14ba97c7
author Linus Torvalds <torvalds@linux-foundation.org> 1405915456 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1405915456 -0700

Linux 3.16-rc6
tree ec8525edc15fcceb96a07867bc974710f26a511a
parent 49e356b81ab7dcce8ec2d5a3960a209469de6d6c
author Kevin Hilman <khilman@baylibre.com> 1526933312 -0700
committer Sasha Levin <alexander.levin@microsoft.com> 1538094112 -0400

ARM: dts: dra7: fix DCAN node addresses

[ Upstream commit 949bdcc8a97c6078f21c8d4966436b117f2e4cd3 ]

Fix the DT node addresses to match the reg property addresses,
which were verified to match the TRM:
http://www.ti.com/lit/pdf/sprui30

Cc: Roger Quadros <rogerq@ti.com>
Signed-off-by: Kevin Hilman <khilman@baylibre.com>
Acked-by: Roger Quadros <rogerq@ti.com>
Signed-off-by: Tony Lindgren <tony@atomide.com>
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 6b58d3ab87cbff43251105dfab9f80d2543e696e
parent f982f91516fa4cfd9d20518833cd04ad714585be
author Linus Torvalds <torvalds@linux-foundation.org> 1313359748 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1313359748 -0700

Linux 3.1-rc2
tree 0f7588e4ee4c06769371801075550ba97ff1aab6
parent 56bae802681116dc279c40218b146b5a0c553a3b
author Linus Torvalds <torvalds@linux-foundation.org> 1348449057 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1348449057 -0700

Linux 3.6-rc7
tree 7bb7c72c515eaf036c0b4033be82bb4b3c0ce598
parent 6a0596583fadd15dca293736114abdea306d3d7c
author Linus Torvalds <torvalds@linux-foundation.org> 1319440205 +0200
committer Linus Torvalds <torvalds@linux-foundation.org> 1319440205 +0200

Linux 3.1
tree 70b1634c278cdce1cdfcb79e490cc574bdca8771
parent e4d806377b069881f930089bf880918d3ad555ab
author Linus Torvalds <torvalds@linux-foundation.org> 1269047877 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1269047877 -0700

Linux 2.6.34-rc2
tree 9e221aa4fc868767963da62d0db8130df2b16a09
parent 9e8afe6206faf72b467f97c742fb9f26aa6bd857
author Eric W. Biederman <ebiederm@xmission.com> 1535997766 +0200
committer Sasha Levin <sashal@kernel.org> 1541428144 -0500

signal: Always deliver the kernel's SIGKILL and SIGSTOP to a pid namespace init

[ Upstream commit 3597dfe01d12f570bc739da67f857fd222a3ea66 ]

Instead of playing whack-a-mole and changing SEND_SIG_PRIV to
SEND_SIG_FORCED throughout the kernel to ensure a pid namespace init
gets signals sent by the kernel, stop allowing a pid namespace init to
ignore SIGKILL or SIGSTOP sent by the kernel.  A pid namespace init is
only supposed to be able to ignore signals sent from itself and
children with SIG_DFL.

Fixes: 921cf9f63089 ("signals: protect cinit from unblocked SIG_DFL signals")
Reviewed-by: Thomas Gleixner <tglx@linutronix.de>
Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 175f8e716eab6c30b7a3c3348c92b9e898a936b7
parent bb077d600689dbf9305758efed1e16775db1c84c
author Linus Torvalds <torvalds@linux-foundation.org> 1402251594 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1402251594 -0700

Linux 3.15
tree e977b095d61d5cf7d8643e5d6b550f115c2aacd1
parent b897e6fbc49dd84b2634bca664344d503b907ce9
author Linus Torvalds <torvalds@linux-foundation.org> 1239742308 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1239742308 -0700

Linux 2.6.30-rc2
tree 7a1aea9c3e941bc5704b7afaa6fa89e4e310adea
parent b9a63ef9fb4c74acf4fed1503556b8ca1755abad
author David Sterba <dsterba@suse.com> 1529424247 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1536279627 -0400

btrfs: fix mount and ioctl device scan ioctl race

[ Upstream commit 81ffd56b5745355b70d54ca4e1bdd0d64a66ff9f ]

Technically this extends the critical section covered by uuid_mutex to:

- parse early mount options -- here we can call device scan on paths
  that can be passed as 'device=/dev/...'

- scan the device passed to mount

- open the devices related to the fs_devices -- this increases
  fs_devices::opened

The race can happen when mount calls one of the scans and there's
another one called eg. by mkfs or 'btrfs dev scan':

Mount                                  Scan
-----                                  ----
scan_one_device (dev1, fsid1)
                                       scan_one_device (dev2, fsid1)
				           add the device
					   free stale devices
					       fsid1 fs_devices::opened == 0
					           find fsid1:dev1
					           free fsid1:dev1
					           if it's the last one,
					            free fs_devices of fsid1
						    too

open_devices (dev1, fsid1)
   dev1 not found

When fixed, the uuid mutex will make sure that mount will increase
fs_devices::opened and this will not be touched by the racing scan
ioctl.

Reported-and-tested-by: syzbot+909a5177749d7990ffa4@syzkaller.appspotmail.com
Reported-and-tested-by: syzbot+ceb2606025ec1cc3479c@syzkaller.appspotmail.com
Reviewed-by: Anand Jain <anand.jain@oracle.com>
Signed-off-by: David Sterba <dsterba@suse.com>

Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree cba7bb8549be7bbf54b57f9ba830165287bb7dff
parent 312592945487c6e2451d4a41130bfc34d0dba22c
author Linus Torvalds <torvalds@linux-foundation.org> 1366580325 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1366580325 -0700

Linux 3.9-rc8
tree bdafd4ecd0633f3437e13709da33ce3bcb3c3c28
parent 4ff63e47f7b9dbd72031c364db44526b3c295591
author Linus Torvalds <torvalds@linux-foundation.org> 1345667346 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1345667346 -0700

Linux 3.6-rc3
tree 488b5a41a13c38d3838007e139ebbbe128a7e04e
parent f3d67277f91bc5cd7e7b4be13d07d7ae9481fd82
author Lucas Stach <l.stach@pengutronix.de> 1555084780 +0200
committer Sasha Levin <sashal@kernel.org> 1556839738 -0400

gpu: ipu-v3: dp: fix CSC handling

[ Upstream commit d4fad0a426c6e26f48c9a7cdd21a7fe9c198d645 ]

Initialize the flow input colorspaces to unknown and reset to that value
when the channel gets disabled. This avoids the state getting mixed up
with a previous mode.

Also keep the CSC settings for the background flow intact when disabling
the foreground flow.

Root-caused-by: Jonathan Marek <jonathan@marek.ca>
Signed-off-by: Lucas Stach <l.stach@pengutronix.de>
Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree a5be141137e5008b66ee1f344336e3e527919dfc
parent e5d081f4686f9c6be8ab3d34dfcdb0afdbbdeefd
author Linus Torvalds <torvalds@linux-foundation.org> 1376269460 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1376269460 -0700

Linux 3.11-rc5
tree b47737c85d456c0503c046752abbc23bd27fda67
parent eb0318dc28e262550f336a5caa1d599aec9fc85d
author Andy Shevchenko <andriy.shevchenko@linux.intel.com> 1521469172 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1532622816 -0400

drm/dp/mst: Fix off-by-one typo when dump payload table

[ Upstream commit 7056a2bccc3b5afc51f9b35b30a46f0d9219968d ]

It seems there is a classical off-by-one typo from the beginning
when commit

  ad7f8a1f9ced ("drm/helper: add Displayport multi-stream helper (v0.6)")

introduced a new helper.

Fix a typo by introducing a macro constant.

Cc: Dave Airlie <airlied@redhat.com>
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Signed-off-by: Jani Nikula <jani.nikula@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20180319141932.37290-1-andriy.shevchenko@linux.intel.com
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 2c8262afc5c19d264222c7bb809715a06c48d602
parent 5c120b79dd6601a987eb33214f2686e5b75f3c3e
author Sasha Levin <alexander.levin@verizon.com> 1482595818 -0500
committer Sasha Levin <alexander.levin@verizon.com> 1482595818 -0500

Linux 3.18.46

Signed-off-by: Sasha Levin <alexander.levin@verizon.com>
tree 4925da5e2cac397a61a14aacc9be496bd20db174
parent f1d2120487de3620ff47367d7bc0e290dc868c47
author Linus Torvalds <torvalds@woody.linux-foundation.org> 1172032350 -0800
committer Linus Torvalds <torvalds@woody.linux-foundation.org> 1172032350 -0800

Linux 2.6.21-rc1
tree b4689c2b5fd63b32e0622ce7d6ac00ffd32fb360
parent 85f499b9709a21920dace0f52052fbcf1ab2261d
author Hans de Goede <hdegoede@redhat.com> 1546877301 +0100
committer Sasha Levin <sashal@kernel.org> 1553647623 -0400

ACPI / video: Extend chassis-type detection with a "Lunch Box" check

[ Upstream commit d693c008e3ca04db5916ff72e68ce661888a913b ]

Commit 53fa1f6e8a59 ("ACPI / video: Only default only_lcd to true on
Win8-ready _desktops_") introduced chassis type detection, limiting the
lcd_only check for the backlight to devices where the chassis-type
indicates their is no builtin LCD panel.

The purpose of the lcd_only check is to avoid advertising a backlight
interface on desktops, since skylake and newer machines seem to always
have a backlight interface even if there is no LCD panel. The limiting
of this check to desktops only was done to avoid breaking backlight
support on some laptops which do not have the lcd flag set.

The Fujitsu ESPRIMO Q910 which is a compact (NUC like) desktop machine
has a chassis type of 0x10 aka "Lunch Box". Without the lcd_only check
we end up falsely advertising backlight/brightness control on this
device. This commit extend the dmi_is_desktop check to return true
for type 0x10 to fix this.

Fixes: 53fa1f6e8a59 ("ACPI / video: Only default only_lcd to true ...")
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 1d7b9f9e5a0fef3df9a2b83ab192beb94420637a
parent db1e802bc47b53c287d6094898af4736940bc11c
author Joerg Roedel <jroedel@suse.de> 1531906861 +0200
committer Sasha Levin <alexander.levin@microsoft.com> 1536004487 -0400

x86/mm/pti: Add an overflow check to pti_clone_pmds()

[ Upstream commit 935232ce28dfabff1171e5a7113b2d865fa9ee63 ]

The addr counter will overflow if the last PMD of the address space is
cloned, resulting in an endless loop.

Check for that and bail out of the loop when it happens.

Signed-off-by: Joerg Roedel <jroedel@suse.de>
Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Tested-by: Pavel Machek <pavel@ucw.cz>
Cc: "H . Peter Anvin" <hpa@zytor.com>
Cc: linux-mm@kvack.org
Cc: Linus Torvalds <torvalds@linux-foundation.org>
Cc: Andy Lutomirski <luto@kernel.org>
Cc: Dave Hansen <dave.hansen@intel.com>
Cc: Josh Poimboeuf <jpoimboe@redhat.com>
Cc: Juergen Gross <jgross@suse.com>
Cc: Peter Zijlstra <peterz@infradead.org>
Cc: Borislav Petkov <bp@alien8.de>
Cc: Jiri Kosina <jkosina@suse.cz>
Cc: Boris Ostrovsky <boris.ostrovsky@oracle.com>
Cc: Brian Gerst <brgerst@gmail.com>
Cc: David Laight <David.Laight@aculab.com>
Cc: Denys Vlasenko <dvlasenk@redhat.com>
Cc: Eduardo Valentin <eduval@amazon.com>
Cc: Greg KH <gregkh@linuxfoundation.org>
Cc: Will Deacon <will.deacon@arm.com>
Cc: aliguori@amazon.com
Cc: daniel.gruss@iaik.tugraz.at
Cc: hughd@google.com
Cc: keescook@google.com
Cc: Andrea Arcangeli <aarcange@redhat.com>
Cc: Waiman Long <llong@redhat.com>
Cc: "David H . Gutteridge" <dhgutteridge@sympatico.ca>
Cc: joro@8bytes.org
Link: https://lkml.kernel.org/r/1531906876-13451-25-git-send-email-joro@8bytes.org
Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
tree 40a612a48d6a022d4eb6ba089892f2be16826a49
parent 1eacda6c0dc441384129b5260a485cbb8b4e218a
author Sasha Levin <sasha.levin@oracle.com> 1453722960 -0500
committer Sasha Levin <sasha.levin@oracle.com> 1453723219 -0500

Linux 3.18.26

Signed-off-by: Sasha Levin <sasha.levin@oracle.com>
tree 05bc81f9b27a1ab60ea4e506357f0c7f2ece4eda
parent ec229e830060091b9be63c8f873c1b2407a82821
author Linus Torvalds <torvalds@linux-foundation.org> 1215985889 -0700
committer Linus Torvalds <torvalds@linux-foundation.org> 1215985889 -0700

Linux 2.6.26
tree 0a185200bcfd0e15486270e34f3c2db4b2e21190
parent 0e65ac8612692885122d3676b683a23d56c91aea
author Matthew Wilcox <willy@infradead.org> 1554498130 -0700
committer Sasha Levin <sashal@kernel.org> 1556287077 -0400

fs: prevent page refcount overflow in pipe_buf_get

[ Upstream commit 15fab63e1e57be9fdb5eec1bbc5916e9825e9acb ]

Change pipe_buf_get() to return a bool indicating whether it succeeded
in raising the refcount of the page (if the thing in the pipe is a page).
This removes another mechanism for overflowing the page refcount.  All
callers converted to handle a failure.

Reported-by: Jann Horn <jannh@google.com>
Signed-off-by: Matthew Wilcox <willy@infradead.org>
Cc: stable@kernel.org
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
tree 9424dfa1c758e1259733ee712fb072c2546e417c
parent 101041cf2619b397b0fa7e2ab544607026d59314
author Linus Torvalds <torvalds@linux-foundation.org> 1321376579 -0200
committer Linus Torvalds <torvalds@linux-foundation.org> 1321376579 -0200

Linux 3.2-rc2
